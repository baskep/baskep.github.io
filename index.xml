<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>ğŸ˜³ on ğŸ˜³</title>
    <link>https://xtid.github.io/</link>
    <description>Recent content in ğŸ˜³ on ğŸ˜³</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-CN</language>
    <lastBuildDate>Mon, 07 Sep 2020 22:03:34 +0800</lastBuildDate>
    <atom:link href="/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Webpackæ‰“åŒ…ä¼˜åŒ–</title>
      <link>https://xtid.github.io/2020/webpack%E6%89%93%E5%8C%85%E4%BC%98%E5%8C%96/</link>
      <pubDate>Mon, 07 Sep 2020 22:03:34 +0800</pubDate>
      
      <guid>https://xtid.github.io/2020/webpack%E6%89%93%E5%8C%85%E4%BC%98%E5%8C%96/</guid>
      <description>&lt;p&gt;ä¹‹å‰äº†è§£äº†&lt;code&gt;webpack&lt;/code&gt;çš„åŸºæœ¬æ‰“åŒ…æµç¨‹æˆ–è€…è¯´åŸç†ï¼Œå¦‚æœåªæ˜¯é…ç½®ä¸€ä¸ªåŸºæœ¬çš„&lt;code&gt;webpack&lt;/code&gt;æ‰“åŒ…é…ç½®ï¼Œ
æ‰“åŒ…åçš„æ–‡ä»¶ä¼šå˜å¾—å¾ˆå¤§ï¼Œå½“ä½ é¡¹ç›®éƒ¨ç½²åï¼Œç”¨æˆ·æ‰“å¼€å¯¹åº”çš„ç•Œé¢ï¼Œä¹Ÿè®¸ä¼šå¾ˆé•¿æ—¶é—´æ‰åŠ è½½å®Œ(å½“ç„¶å’Œç½‘ç»œç¯å¢ƒæˆ–ç¡¬ä»¶è®¾å¤‡ä¹Ÿæœ‰å…³ç³»)ï¼Œå°¤å…¶æ˜¯å•é¡µé¢åº”ç”¨æ•ˆæœå¾ˆæ˜æ˜¾ï¼Œè¿™æ ·çš„ç”¨æˆ·ä½“éªŒè‡ªç„¶æ˜¯ä¸å¥½çš„ï¼Œæ‰€ä»¥æ­¤æ–‡ç« ä¸»è¦æ˜¯å¯¹&lt;code&gt;webpack&lt;/code&gt;æ‰“åŒ…ä¼˜åŒ–çš„ä¸€ä¸ªå°å°æ€»ç»“&lt;/p&gt;

&lt;p&gt;é¦–å…ˆæ­å»ºå¥½ä¸€ä¸ªåŸºæœ¬çš„é¡¹ç›®ï¼Œç›®å½•ç»“æ„&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;â”œâ”€â”€ dist // æ‰“åŒ…ç›®å½•
â”‚Â Â  â”œâ”€â”€ bundle.js // æ‰“åŒ…åçš„js
â”‚Â Â  â””â”€â”€ index.html // å…¥å£htmlæ–‡ä»¶
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ public
â”‚Â Â  â””â”€â”€ index.html // htmlæ¨¡æ¿æ–‡ä»¶
â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ actions // redux actionsæ–‡ä»¶
â”‚Â Â  â”‚Â Â  â””â”€â”€ index.js
â”‚Â Â  â”œâ”€â”€ app.js // webpackæ‰“åŒ…å…¥å£æ–‡ä»¶ï¼Œä¹Ÿæ˜¯é¡¹ç›®çš„å…¥å£æ–‡ä»¶
â”‚Â Â  â”œâ”€â”€ assets // scss
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ about.scss
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ title.scss
â”‚Â Â  â”‚Â Â  â””â”€â”€ user.scss
â”‚Â Â  â”œâ”€â”€ dev.js // å¼€å‘æ—¶çš„ä¸€äº›é…ç½®
â”‚Â Â  â”œâ”€â”€ pages // pageé¡µé¢
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ about.jsx
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.jsx
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ title.jsx
â”‚Â Â  â”‚Â Â  â””â”€â”€ user.jsx
â”‚Â Â  â”œâ”€â”€ reducers // reduxä¸­çš„reducer
â”‚Â Â  â”‚Â Â  â””â”€â”€ index.js
â”‚Â Â  â””â”€â”€ store.js
â””â”€â”€ webpack.config.js
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;webpack&lt;/code&gt;åŸºæœ¬é…ç½®å¦‚ä¸‹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const path = require(&#39;path&#39;)
const HtmlWebPackPlugin = require(&#39;html-webpack-plugin&#39;)

module.exports = {
  entry: &#39;./src/app.js&#39;,
  output: {
    path: path.resolve(__dirname, &#39;./dist/&#39;),
    filename: &#39;bundle.js&#39;
  },
  resolve: {
    extensions: [&#39;.wasm&#39;, &#39;.mjs&#39;, &#39;.js&#39;, &#39;.json&#39;, &#39;.jsx&#39;]
  },

  devServer: {
    contentBase: path.join(__dirname, &#39;./src/&#39;),
    publicPath: &#39;/&#39;,
    host: &#39;127.0.0.1&#39;,
    port: 3000,
    hot: true,
    stats: {
      colors: true
    }
  },
  module: {
    rules: [{
      test: /\.jsx?$/,
      exclude: /node_modules/,
      use: {
        loader: &#39;babel-loader&#39;
      }
    }, {
      test: /\.scss$/,
      use: [&#39;style-loader&#39;, &#39;css-loader&#39;, &#39;sass-loader&#39;]
    }]
  },
  plugins: [
    new HtmlWebPackPlugin({
      template: &#39;public/index.html&#39;,
      filename: &#39;index.html&#39;,
      inject: true
    })
  ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¼˜åŒ–ï¼š&lt;/p&gt;

&lt;p&gt;1.åŸºç¡€ä¼˜åŒ–&lt;/p&gt;

&lt;p&gt;é…ç½®&lt;code&gt;loader&lt;/code&gt;ï¼Œæ·»åŠ &lt;code&gt;exclude&lt;/code&gt;ã€&lt;code&gt;include&lt;/code&gt;ç¼©å°æœç´¢èŒƒå›´ï¼Œæ¯”å¦‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;{
  test: /\.jsx?$/,
    exclude: /node_modules/, // è¿‡æ»¤node_modules
      use: {
        loader: &#39;babel-loader&#39;
      }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;2.ä½¿ç”¨&lt;code&gt;DllPlugin&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;å°†ä¸€äº›å˜åŠ¨è¾ƒå°‘æˆ–è€…æ ¹æœ¬ä¸ä¼šå˜åŠ¨çš„åº“å…ˆæ‰“åŒ…ç”Ÿæˆå¯¹åº”çš„&lt;code&gt;.dll.js&lt;/code&gt;ï¼Œåœ¨&lt;code&gt;webpack&lt;/code&gt;æ‰“åŒ…çš„æ—¶å€™ï¼Œå°†è¿™äº›èµ„æºå¼•å…¥&lt;/p&gt;

&lt;p&gt;é¦–å…ˆæ–°å»ºä¸€ä¸ª&lt;code&gt;webpack.config.dll.js&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const path = require(&#39;path&#39;);
const DllPlugin = require(&#39;webpack/lib/DllPlugin&#39;);

module.exports = {
  entry: {
    react: [&#39;react&#39;, &#39;react-dom&#39;]
  },
  output: {
    filename: &#39;[name].dll.js&#39;,
    // ç”Ÿæˆçš„æ–‡ä»¶ç›®å½•
    path: path.resolve(__dirname, &#39;dist&#39;),
    // åŠ¨æ€é“¾æ¥åº“åç§°
    library: &#39;_dll_[name]&#39;
  },
  plugins: [
    new DllPlugin({
      name: &#39;_dll_[name]&#39;,
      path: path.join(__dirname, &#39;dist&#39;, &#39;[name].manifest.json&#39;),
      context: __dirname, 
    })
  ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶ååœ¨&lt;code&gt;package.json&lt;/code&gt;çš„&lt;code&gt;scripts&lt;/code&gt;ä¸­æ·»åŠ dllæ‰“åŒ…å‘½ä»¤&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;webpack --config webpack.config.dll.js
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åè¿è¡Œæ­¤å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°ä¼šåœ¨&lt;code&gt;dist&lt;/code&gt;ç›®å½•ä¸‹é¢ç”Ÿæˆ&lt;code&gt;react.dll&lt;/code&gt;ï¼Œ&lt;code&gt;react.manifest.json&lt;/code&gt;ä¸¤ä¸ªæ–‡ä»¶ï¼Œè¿™å°±æ˜¯ç”Ÿæˆçš„&lt;code&gt;dll&lt;/code&gt;æ–‡ä»¶ï¼Œç„¶å&lt;code&gt;webpack.config.js&lt;/code&gt;é‡Œé¢æ·»åŠ é…ç½®ï¼Œæ‰“åŒ…æ—¶å¼•å…¥è¿™äº›çš„&lt;code&gt;dll&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆå®‰è£…æ’ä»¶&lt;code&gt;add-asset-html-webpack-plugin&lt;/code&gt;ï¼Œå¼•å…¥&lt;code&gt;DllReferencePlugin&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const DllReferencePlugin = require(&#39;webpack/lib/DllReferencePlugin&#39;)
const AddAssetHtmlPlugin = require(&#39;add-asset-html-webpack-plugin&#39;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ’ä»¶é‡Œé¢é…ç½®(webpack4+)&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;new DllReferencePlugin({
  context: __dirname,
  manifest: require(&#39;./dist/react.manifest.json&#39;),
}),
new AddAssetHtmlPlugin({
  filepath: path.resolve(__dirname, &#39;./dist/react.dll.js&#39;)
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ ·æ‰“åŒ…æ—¶é¡µé¢å°±ä¼šå¼•å…¥&lt;code&gt;react.dll.js&lt;/code&gt;èµ„æºäº†ï¼Œä»è€Œå‡å°‘é‡å¤çš„èµ„æºæ‰“åŒ…ã€‚è¿™ç§æ–¹å¼å¯ä»¥ç®€å•çš„ç†è§£ä¸ºï¼ŒæŠ½å‡ºå…¬å…±æ¨¡å—æ‰“åŒ…ï¼Œç„¶åå¼•å…¥&lt;/p&gt;

&lt;p&gt;3.&lt;code&gt;splitChunks&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ä»¥å‰&lt;code&gt;webpack&lt;/code&gt;æ‹†åˆ†æ¨¡å—è¿˜ä¼šç”¨&lt;code&gt;CommonsChunkPlugin&lt;/code&gt;ï¼Œåœ¨&lt;code&gt;webpack4&lt;/code&gt;åï¼Œå¯ä»¥ç›´æ¥ç”¨&lt;code&gt;splitChunks&lt;/code&gt;æ¥ä»£æ›¿å®Œæˆè¿™é¡¹å·¥ä½œï¼Œåœ¨&lt;code&gt;optimization&lt;/code&gt;é‡Œé¢è®¾ç½®äº†&lt;code&gt;splitChunks&lt;/code&gt;åï¼Œæ‰“åŒ…åˆ†å‰²å‡ºæ¥çš„æ–‡ä»¶æ˜¯é»˜è®¤å‹ç¼©è¿‡çš„&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;splitChunks: {
  chunks: &amp;quot;async&amp;quot;, // &amp;quot;initial&amp;quot; | &amp;quot;all&amp;quot; | &amp;quot;async&amp;quot;ï¼Œå¯¹å“ªç§ä»£ç è¿›è¡Œåˆ†å‰²
  minSize: 30000, // è¶…è¿‡minSizeçš„åŒ…æ‰åšä»£ç åˆ†å‰²
  minChunks: 1, // ä¸€ä¸ªåŒ…è‡³å°‘è¢«ç”¨äº†å¤šå°‘æ¬¡çš„æ—¶å€™æ‰è¿›è¡Œä»£ç åˆ†å‰²
  maxAsyncRequests: 5, // æŒ‰éœ€åŠ è½½æœ€å¤šèƒ½åŠ è½½å¤šå°‘ä¸ªæ¨¡å—
  maxInitialRequests: 3, // å¯¹äºentryé‡Œé¢çš„æ–‡ä»¶åšä»£ç åˆ†å‰²æœ€å¤šèƒ½ç”Ÿæˆå¤šå°‘ä¸ªjsæ–‡ä»¶
  automaticNameDelimiter: &#39;~&#39;, // æ–‡ä»¶ç”Ÿæˆæ—¶çš„è¿æ¥ç¬¦
  name: true, // ä¸ºtrueçš„æ—¶å€™ï¼Œæ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶åç”±cacheGroupsé‡Œé¢è®¾ç½®çš„ä¸ºå‡†
  cacheGroups: {
    vendors: {
      test: /[\\/]node_modules[\\/]/, // åŒ¹é…å“ªäº›éœ€è¦åˆ†å‰²çš„æ¨¡å—
      priority: -10, // ä¼˜å…ˆçº§
     	filename: &#39;vendors.js&#39;// æ‰“åŒ…åˆ°ä¸€ä¸ªå«vendors.jsçš„æ–‡ä»¶
    },
    default: {
      minChunks: 2,
      priority: -20,
      reuseExistingChunk: true
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;4.&lt;code&gt;catch-loader&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ä¸€äº›æ€§èƒ½å¼€é”€è¾ƒå¤§çš„&lt;code&gt;loader&lt;/code&gt;ä¹‹å‰æ·»åŠ æ­¤ &lt;code&gt;loader&lt;/code&gt;ï¼Œä»¥å°†ç»“æœç¼“å­˜åˆ°ç£ç›˜é‡Œï¼Œä¸åšè¿‡å¤šä»‹ç»&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;module.exports = {
  module: {
    rules: [
      {
        test: /\.ext$/,
        use: [
          &#39;cache-loader&#39;,
          ...loaders
        ],
        include: path.resolve(&#39;src&#39;)
      }
    ]
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;5.&lt;code&gt;HappyPack&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;HappyPack&lt;/code&gt;ä½¿ç”¨&lt;code&gt;node&lt;/code&gt;å¤šçº¿ç¨‹è¿›è¡Œæ„å»ºæ¥æå‡æ„å»ºçš„é€Ÿåº¦ï¼Œä½¿ç”¨æƒ…å†µè¾ƒå°‘&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const HappyPack = require(&#39;happypack&#39;)
const os = require(&#39;os&#39;)
const happyThreadPool = HappyPack.ThreadPool({
  size: os.cpus().length
})

......
plugins: [
  new HtmlWebPackPlugin({
    template: &#39;public/index.html&#39;,
    filename: &#39;index.html&#39;,
    inject: true
  }),
  new HappyPack({
    id: &#39;happyBabel&#39;,
    loaders: [{
      loader: &#39;babel-loader?cacheDirectory=true&#39;,
    }],
    threadPool: happyThreadPool,
    verbose: true,
  })
],
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;6.&lt;code&gt;css&lt;/code&gt;çš„å‹ç¼©&lt;/p&gt;

&lt;p&gt;å¯¹äº&lt;code&gt;scss&lt;/code&gt;æ–‡ä»¶ï¼Œä¸€èˆ¬æ¥è®²ï¼Œä¾æ¬¡é…ç½®&lt;code&gt;sass-loader&lt;/code&gt;ã€&lt;code&gt;css-loader&lt;/code&gt;ã€&lt;code&gt;style-loader&lt;/code&gt;æ¥è¿›è¡Œå¤„ç†&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;{
  test: /\.scss$/,
  use: [&#39;style-loader&#39;, &#39;css-loader&#39;, &#39;sass-loader&#39;]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æœ€ååŠ è½½å®Œåçš„é¡µé¢&lt;code&gt;css&lt;/code&gt;ä¼šä»¥å†…è”æ ·å¼çš„å½¢å¼ç­¾å…¥åˆ°é¡µé¢ä¸­ã€‚åœ¨&lt;code&gt;webpack4&lt;/code&gt;ä¸­ä½¿ç”¨&lt;code&gt;mini-css-extract-plugin&lt;/code&gt;æ’ä»¶æ¥æå–ã€å‹ç¼©&lt;code&gt;css&lt;/code&gt;ã€‚é¦–å…ˆå°†&lt;code&gt;style-loade&lt;/code&gt;ç”¨&lt;code&gt;MiniCssExtractPlugin.loader&lt;/code&gt;ä»£æ›¿ï¼Œç„¶åä½¿ç”¨&lt;code&gt;MiniCssExtractPlugin&lt;/code&gt;æ’ä»¶ï¼Œæ‰“åŒ…å‡ºå¯¹åº”çš„æ–‡ä»¶ï¼Œå¹¶åœ¨é¡µé¢ä¸­å¼•å…¥å¯¹åº”çš„&lt;code&gt;css&lt;/code&gt;æ–‡ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const MiniCssExtractPlugin = require(&#39;mini-css-extract-plugin&#39;)

......

{
  test: /\.scss$/,
  use: [MiniCssExtractPlugin.loader, &#39;css-loader&#39;, &#39;sass-loader&#39;]
}

new MiniCssExtractPlugin({
  filename: &#39;[name].[hash:5].css&#39;,
  chunkFilename: &#39;[id].[hash:5].css&#39;
})

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;7.å›¾ç‰‡çš„å¤„ç†&lt;/p&gt;

&lt;p&gt;åŒæ ·çš„ï¼Œå…ˆç”¨&lt;code&gt;file-loader&lt;/code&gt;è§£æå›¾ç‰‡ä¿è¯webpackèƒ½å¤„ç†ï¼Œç„¶åå¯ä»¥ç”¨&lt;code&gt;image-webpack-loader&lt;/code&gt;å‹ç¼©å›¾ç‰‡ï¼Œæˆ–è€…è¯´ç”¨&lt;code&gt;url-loader&lt;/code&gt;å°†å›¾ç‰‡è½¬ä¸º&lt;code&gt;base64&lt;/code&gt;ç¼–ç çš„å½¢å¼ï¼Œä¸å¤šèµ˜è¿°&lt;/p&gt;

&lt;p&gt;8.CDNåŠ é€Ÿ
é€šå¸¸åœ¨æ‰“åŒ…ä¸­ï¼ŒæŠŠä¸å˜çš„ä¸€äº›é™æ€æ–‡ä»¶æ”¾åˆ°&lt;code&gt;CDN&lt;/code&gt;ä¸Šï¼Œå¯ä»¥ç›´è§‚åœ°å‡å°èµ„æºåŒ…å¤§å°ï¼Œæ¯”å¦‚é¡¹ç›®ä¸­ç”¨åˆ°äº†&lt;code&gt;clipboard.js&lt;/code&gt;ï¼Œç„¶ååœ¨æ¨¡æ¿&lt;code&gt;html&lt;/code&gt;ä¸­å¼•å…¥è¿™ä¸ªæ–‡ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;&amp;lt;script src=&amp;quot;https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.6/clipboard.min.js&amp;quot; defer&amp;gt;&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸€èˆ¬æ¥è®²ï¼Œè¿™ç§æ–¹å¼å¼•å…¥jsé™æ€æ–‡ä»¶ï¼Œé‚£ä¹ˆå…¨å±€å¯¹è±¡(å¦‚window)é‡Œé¢æ˜¯ä¼šæœ‰å¯¹åº”çš„å¯¹è±¡çš„ï¼Œå°±å¯ä»¥ç›´æ¥å¼•ç”¨å¯¹åº”çš„å¯¹è±¡ã€‚å½“ç„¶è¿˜å¯ä»¥åŠ ä¸Š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;externals: {
  clipboard: &#39;clipboard&#39;
},
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ ·å°±ä¿è¯äº†æ‰“åŒ…æ—¶ä¸æ‰“åŒ…&lt;code&gt;clipboard&lt;/code&gt;ï¼Œä¼˜åŒ–æ‰“åŒ…åçš„æ–‡ä»¶ä½“ç§¯&lt;/p&gt;

&lt;p&gt;è¿˜æœ‰ä¸€ç§æ–¹å¼å°±æ˜¯æŠŠæ‰€æœ‰çš„é™æ€èµ„æºï¼Œå¦‚&lt;code&gt;js&lt;/code&gt;ã€&lt;code&gt;css&lt;/code&gt;éƒ½æ”¾åœ¨ç›¸åº”çš„&lt;code&gt;CDN&lt;/code&gt;ä¸Šï¼Œåœ¨æ‰“åŒ…çš„&lt;code&gt;config&lt;/code&gt;ä¸­æŒ‡å®šå¯¹åº”èµ„æºçš„&lt;code&gt;CDN&lt;/code&gt;åŸŸåï¼ŒåŒæ ·é…ç½®&lt;code&gt;externals&lt;/code&gt;ã€‚ä½†å…¶å®è¿™ç§æ–¹å¼æœ‰ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹å°±æ˜¯ï¼Œå¦‚æœå…¨éƒ¨è¿™æ ·åšçš„è¯ï¼Œä¸‡ä¸€&lt;code&gt;CDN&lt;/code&gt;æŒ‚äº†ï¼Œæ•´ä¸ªé¡µé¢ä¹Ÿå°±æŒ‚äº†&lt;/p&gt;

&lt;p&gt;9.æŒ‰éœ€åŠ è½½&lt;/p&gt;

&lt;p&gt;ä»¥&lt;code&gt;react&lt;/code&gt;ä¸ºä¾‹ï¼Œä½¿ç”¨&lt;code&gt;react-loadable&lt;/code&gt;æ¥åšæŒ‰éœ€åŠ è½½ï¼Œä»¥å‰è¿˜æœ‰äº›å…¶å®ƒæ–¹æ³•è¿™é‡Œå°±ä¸èµ˜è¿°ã€‚ä¸»è¦æ˜¯é’ˆå¯¹&lt;code&gt;react-router&lt;/code&gt;åšä¸€ä¸ªå¤„ç†ï¼Œé¦–å…ˆå®‰è£…ä¾èµ–&lt;code&gt;react-loadable&lt;/code&gt;ï¼Œå…¥å£æ–‡ä»¶ä¸­å°è£…ä¸€ä¸ª&lt;code&gt;loading&lt;/code&gt;ç»„ä»¶ï¼Œç”¨äºé¡µé¢åŠ è½½æ—¶ç»™ä¸€ä¸ªæç¤ºï¼Œç„¶åå°è£…ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå¼‚æ­¥åŠ è½½è¿™äº›ç»„ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;import Loadable from &#39;react-loadable&#39;
const Loading = (props) =&amp;gt; {
  return &amp;lt;div&amp;gt;è¿™æ˜¯ä¸€ä¸ªloadingç»„ä»¶&amp;lt;/div&amp;gt;
};
const asyncLoad = loader =&amp;gt; Loadable({
  loader,
  loading: Loading
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»¥ä¸‹æœ‰ä¸‰ä¸ªé¡µé¢ï¼Œ&lt;code&gt;index&lt;/code&gt;ã€&lt;code&gt;about&lt;/code&gt;ã€&lt;code&gt;user&lt;/code&gt;ï¼Œè°ƒç”¨&lt;code&gt;asyncLoad&lt;/code&gt;ï¼Œå¼•å…¥è¿™äº›æ–‡ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const Index = asyncLoad(() =&amp;gt; import(&#39;./pages/index&#39;))
const About = asyncLoad(() =&amp;gt; import(&#39;./pages/about&#39;))
const User = asyncLoad(() =&amp;gt; import(&#39;./pages/user&#39;))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å†é…ç½®å¥½è·¯ç”±ï¼Œè¿™æ ·æ‰“åŒ…å‡ºæ¥çš„&lt;code&gt;js&lt;/code&gt;æ–‡ä»¶å°±åªä¼šåœ¨å¯¹åº”é¡µé¢æˆ–è€…è¯´å¯¹åº”è·¯ç”±å‘½ä¸­æ—¶åŠ è½½äº†ï¼Œä»è€Œæå‡é¡µé¢çš„ä¸€ä¸ªåŠ è½½é€Ÿåº¦ï¼Œå½“ç„¶ä¹ŸæŠŠæ‰“åŒ…å‡ºæ¥çš„jsæ–‡ä»¶è¿›ä¸€æ­¥çš„åˆ†å‰²ï¼Œå‡å°ä½“ç§¯ï¼Œå½“ç„¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦åœ¨&lt;code&gt;webpack.config&lt;/code&gt;é‡Œé¢é…ç½®å¥½&lt;code&gt;chunFilename(æŒ‰éœ€åŠ è½½çš„chunkåå­—)&lt;/code&gt;ï¼Œèµ„æºçš„&lt;code&gt;publickPath&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;&amp;lt;Router&amp;gt;
  &amp;lt;Switch&amp;gt;
  	&amp;lt;Route path=&amp;quot;/&amp;quot; exact component={Index} /&amp;gt;
    &amp;lt;Route path=&amp;quot;/about/&amp;quot; component={About} /&amp;gt;
    &amp;lt;Route path=&amp;quot;/users/&amp;quot; component={User} /&amp;gt;
  &amp;lt;/Switch&amp;gt;
&amp;lt;/Router&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;webpack.config.js&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;output: {
  path: path.resolve(__dirname, &#39;./dist/&#39;),
  filename: &#39;[name].[hash:5].bundle.js&#39;,
  chunkFilename: &#39;[name].[hash:5].bundle.js&#39;,
  publicPath: &#39;/&#39;
},
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Webpackç®€å•ç†è§£</title>
      <link>https://xtid.github.io/2020/webpack%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/</link>
      <pubDate>Sun, 23 Aug 2020 21:36:20 +0800</pubDate>
      
      <guid>https://xtid.github.io/2020/webpack%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/</guid>
      <description>&lt;p&gt;&lt;code&gt;webpack&lt;/code&gt;æ˜¯ä¸€ä¸ªæ¨¡å—æ‰“åŒ…å™¨ï¼Œè€ä¸€ç‚¹çš„è¿˜æœ‰&lt;code&gt;gulp&lt;/code&gt;ã€&lt;code&gt;grunt&lt;/code&gt;ç­‰ç­‰ï¼Œ
ä»–æœ€æ˜¾è‘—çš„ç‰¹ç‚¹å°±æ˜¯å°†æ–‡ä»¶è§†ä¸ºä¸€ä¸ªä¸ªæ¨¡å—ï¼Œé€šè¿‡è®¾ç½®å…¥å£æ–‡ä»¶&lt;code&gt;entry&lt;/code&gt;ï¼ŒåŠ è½½ä¸åŒç±»å‹çš„æ–‡ä»¶ç”¨ä¸åŒ&lt;code&gt;loader&lt;/code&gt;è½¬æ¢æ–‡ä»¶ï¼Œ
ç„¶åä½¿ç”¨ä¸åŒ&lt;code&gt;plugin&lt;/code&gt;å¯¹æ–‡ä»¶å¤„ç†ï¼Œæœ€åè¾“å‡ºå¤šä¸ªæ‰“åŒ…ã€åˆ†å‰²åçš„æ–‡ä»¶&lt;/p&gt;

&lt;p&gt;é¦–å…ˆæœ‰å‡ ä¸ªæ¦‚å¿µ
1.entryï¼šå³&lt;code&gt;webpack&lt;/code&gt;æ‰“åŒ…çš„å…¥å£ï¼Œå‘Šè¯‰å®ƒåº”è¯¥ä»é‚£ä¸ªæ–‡ä»¶å¼€å§‹è¿›è¡Œæ„å»º
2.outputï¼šè®¾ç½®æ‰“åŒ…åæ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ä»¥åŠå¦‚ä½•å‘½åè¿™äº›æ–‡ä»¶
3.loaderï¼šå¤„ç†é‚£äº›é&lt;code&gt;javaScript&lt;/code&gt;æ–‡ä»¶ï¼Œé€šè¿‡æŒ‡å®šå¯¹åº”æ–‡ä»¶æ‰€éœ€çš„å¯¹åº”&lt;code&gt;loader&lt;/code&gt;çš„å¤„ç†ï¼Œå°†æ–‡ä»¶è½¬æ¢ä¸º&lt;code&gt;webpack&lt;/code&gt;èƒ½å¤Ÿå¤„ç†çš„æœ‰æ•ˆæ¨¡å—
4.pluginsï¼šè½¬æ¢æŸäº›ç±»å‹çš„æ¨¡å—ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œå¯ä»¥åšåˆ°æ‰“åŒ…ä¼˜åŒ–ï¼Œå‹ç¼©ä»¥åŠå„ç§å„æ ·çš„å…¶å®ƒä»»åŠ¡&lt;/p&gt;

&lt;p&gt;&lt;code&gt;bundle&lt;/code&gt;ï¼šè§†ä¸º&lt;code&gt;webpack&lt;/code&gt;æ‰“åŒ…æå–çš„æ¨¡å—ç”Ÿæˆçš„&lt;code&gt;js&lt;/code&gt;æ–‡ä»¶ï¼Œå°†å…¶å®ƒå…·ä½“æ¨¡å—çš„ä»£ç ä¼ å…¥å…¶ä¸­æ‰§è¡Œï¼ŒåŸæœ¬ç‹¬ç«‹çš„æ¨¡å—æ–‡ä»¶ï¼Œé€šè¿‡è°ƒç”¨&lt;code&gt;__webpack_require__&lt;/code&gt;ï¼Œåˆå¹¶åˆ°äº†&lt;code&gt;bundle&lt;/code&gt;ä¸­&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;(function(modules) {
/******/    var installedModules = {};
/******/
/******/    var installedChunks = {
/******/        2: 0
/******/    };
/******/
/******/    function __webpack_require__(moduleId) {
/******/
/******/        if(installedModules[moduleId]) {
/******/            return installedModules[moduleId].exports;
/******/        }
/******/        var module = installedModules[moduleId] = {
/******/            i: moduleId,
/******/            l: false,
/******/            exports: {}
/******/        };
/******/
/******/        modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/        module.l = true;
/******/
/******/        return module.exports;
/******/    }
/******/ })
/************************************************************************/
/******/ ({
	// ä¼ å…¥çš„æ¨¡å—
	......
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰“åŒ…åçš„&lt;code&gt;bundle&lt;/code&gt;æ˜¯ä¸€ä¸ªç«‹å³æ‰§è¡Œçš„åŒ¿åå‡½æ•°ï¼Œå…¶å‚æ•°å°±æ˜¯æ‰“åŒ…åçš„æ¨¡å—ï¼Œä¸Šé¢&lt;code&gt;__webpack_require__&lt;/code&gt;æ–¹æ³•ä¼šé¦–å…ˆåˆ¤æ–­å½“å‰æ¨¡å—&lt;code&gt;moduleId&lt;/code&gt;æ˜¯å¦å·²ç»å­˜åœ¨ç¼“å­˜&lt;code&gt;installedModules&lt;/code&gt;ä¸­ï¼Œè‹¥æ˜¯å­˜åœ¨åˆ™ç›´æ¥è¿”å›ã€‚è‹¥æ˜¯ä¸å­˜åœ¨ï¼Œåˆ™ä¼šæ„é€ ä¸€ä¸ªå¯¹è±¡å¹¶å°†å…¶åŒæ—¶å­˜åˆ°&lt;code&gt;installedModules&lt;/code&gt;ä¸­å’Œ&lt;code&gt;module&lt;/code&gt;ä¸­&lt;/p&gt;

&lt;p&gt;&lt;code&gt;modules[moduleId].call(module.exports, module, module.exports, __webpack_require__)&lt;/code&gt;
è¿™æ®µä»£ç é¦–å…ˆæ‰§è¡Œå½“å‰æ¨¡å—çš„å…·ä½“ä»£ç ï¼Œä¼ å…¥&lt;code&gt;module&lt;/code&gt;ï¼Œ&lt;code&gt;module.exports&lt;/code&gt;ï¼Œ&lt;code&gt;__webpack_require__&lt;/code&gt;ï¼Œé€’å½’è°ƒç”¨&lt;code&gt;__webpack_require__&lt;/code&gt;å¤„ç†æ¯ä¸ªæ¨¡å—ç§å¼•å…¥çš„å…¶å®ƒæ¨¡å—
å¦‚ä»¥ä¸‹å½¢å¼&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;/***/ 0:
/***/ (function(module, exports, __webpack_require__) {
	......
	__webpack_require__(1);
	module.exports = __webpack_require__(2);
	......

/***/ })
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸€ä¸ªç®€å•çš„bundleæ„å»ºè¿‡ç¨‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;// å¼•å…¥ç›¸å…³ä¾èµ–ï¼Œå¯¹æ–‡ä»¶è¿›è¡Œç¼–è¯‘è½¬æ¢è¾“å‡ºå¤„ç†
const fs = require(&#39;fs&#39;);
const path = require(&#39;path&#39;);
const parse = require(&#39;@babel/parser&#39;);
const traverse = require(&#39;@babel/traverse&#39;).default;
const babel = require(&#39;@babel/core&#39;);


let ID = 0;
// è¯»å–æ–‡ä»¶ä¿¡æ¯ï¼Œå¹¶è·å¾—å½“å‰jsæ–‡ä»¶çš„ä¾èµ–å…³ç³»
function createAsset(filename) {
  // è·å–æ–‡ä»¶ï¼Œè¿”å›å€¼æ˜¯å­—ç¬¦ä¸²
  const content = fs.readFileSync(filename, &#39;utf-8&#39;);

  // å°†å­—ç¬¦ä¸²è½¬ä¸ºast
  const ast = parse.parse(content, {
    sourceType: &#39;module&#39;
  });

  //ç”¨æ¥å­˜å‚¨ æ–‡ä»¶æ‰€ä¾èµ–çš„æ¨¡å—ï¼Œç®€å•æ¥è¯´å°±æ˜¯ï¼Œå½“å‰jsæ–‡ä»¶ import äº†å“ªäº›æ–‡ä»¶ï¼Œéƒ½ä¼šä¿å­˜åœ¨è¿™ä¸ªæ•°ç»„é‡Œ
  const dependencies = [];

  //éå†å½“å‰astï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰
  traverse(ast, {
    //æ‰¾åˆ°æœ‰ importè¯­æ³• çš„å¯¹åº”èŠ‚ç‚¹
    ImportDeclaration: ({ node }) =&amp;gt; {
      //æŠŠå½“å‰ä¾èµ–çš„æ¨¡å—åŠ å…¥åˆ°æ•°ç»„ä¸­
      dependencies.push(node.source.value);
    }
  });

  //æ¨¡å—çš„id ä»0å¼€å§‹ï¼Œ ç›¸å½“ä¸€ä¸ªjsæ–‡ä»¶ å¯ä»¥çœ‹æˆä¸€ä¸ªæ¨¡å—
  const id = ID++;

  //è¿™è¾¹ä¸»è¦æŠŠES6 çš„ä»£ç è½¬æˆ ES5
  const { code } = babel.transformFromAstSync(ast, null, {
    presets: [&#39;@babel/preset-env&#39;]
  });

  return {
    id,
    filename,
    dependencies,
    code
  };
}

// ä»å…¥å£å¼€å§‹åˆ†ææ‰€æœ‰ä¾èµ–é¡¹ï¼Œå½¢æˆä¾èµ–å›¾ï¼Œé‡‡ç”¨å¹¿åº¦éå†
function createGraph(entry) {
  const mainAsset = createAsset(entry);
    
  const queue = [mainAsset];

  for (const asset of queue) {
    const dirname = path.dirname(asset.filename);
    // æ–°å¢ä¸€ä¸ªå±æ€§æ¥ä¿å­˜å­ä¾èµ–é¡¹çš„æ•°æ®
    asset.mapping = {};
    asset.dependencies.forEach(relativePath =&amp;gt; {
      const absolutePath = path.join(dirname, relativePath);
      //è·å¾—å­ä¾èµ–ï¼ˆå­æ¨¡å—ï¼‰çš„ä¾èµ–é¡¹ã€ä»£ç ã€æ¨¡å—idï¼Œæ–‡ä»¶å
      const child = createAsset(absolutePath);
      //ç»™å­ä¾èµ–é¡¹èµ‹å€¼ï¼Œ
      asset.mapping[relativePath] = child.id;
      //å°†å­ä¾èµ–ä¹ŸåŠ å…¥é˜Ÿåˆ—ä¸­ï¼Œå¹¿åº¦éå†
      queue.push(child);
    });
  }
  return queue;
}

//æ ¹æ®ç”Ÿæˆçš„ä¾èµ–å…³ç³»å›¾ï¼Œç”Ÿæˆå¯¹åº”ç¯å¢ƒèƒ½æ‰§è¡Œçš„ä»£ç ï¼Œç›®å‰æ˜¯ç”Ÿäº§æµè§ˆå™¨å¯ä»¥æ‰§è¡Œçš„
function bundle(graph) {
  let modules = &#39;&#39;;

  //å¾ªç¯ä¾èµ–å…³ç³»ï¼Œå¹¶æŠŠæ¯ä¸ªæ¨¡å—ä¸­çš„ä»£ç å­˜åœ¨functionä½œç”¨åŸŸé‡Œ
  graph.forEach(mod =&amp;gt; {
    modules += `${mod.id}:[
      function (require, module, exports){
        ${mod.code}
      },
      ${JSON.stringify(mod.mapping)},
    ],`;
  });

  //require, module, exports æ˜¯ cjsçš„æ ‡å‡†ä¸èƒ½å†æµè§ˆå™¨ä¸­ç›´æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œæ¨¡æ‹Ÿcjsæ¨¡å—åŠ è½½ï¼Œæ‰§è¡Œï¼Œå¯¼å‡ºæ“ä½œã€‚
  const result = `
    (function(modules){
      //åˆ›å»ºrequireå‡½æ•°ï¼Œ å®ƒæ¥å—ä¸€ä¸ªæ¨¡å—IDï¼ˆè¿™ä¸ªæ¨¡å—idæ˜¯æ•°å­—0ï¼Œ1ï¼Œ2ï¼‰ ï¼Œå®ƒä¼šåœ¨æˆ‘ä»¬ä¸Šé¢å®šä¹‰ modules ä¸­æ‰¾åˆ°å¯¹åº”æ˜¯æ¨¡å—.
      function __webpack_require__(id){
        const [fn, mapping] = modules[id];
        function localRequire(relativePath){
          //æ ¹æ®æ¨¡å—çš„è·¯å¾„åœ¨mappingä¸­æ‰¾åˆ°å¯¹åº”çš„æ¨¡å—id
          return __webpack_require__(mapping[relativePath]);
        }
        const module = {exports:{}};
        //æ‰§è¡Œæ¯ä¸ªæ¨¡å—çš„ä»£ç ã€‚
        fn(localRequire,module,module.exports);
        return module.exports;
      }
      //æ‰§è¡Œå…¥å£æ–‡ä»¶ï¼Œ
      __webpack_require__(0);
    })({${modules}})
  `;

  return result;
}

// å…¥å£æ–‡ä»¶
const graph = createGraph(&#39;./entry.js&#39;);
// æ–‡ä»¶å†…å®¹
const ret = bundle(graph);

// æ‰“åŒ…ç”Ÿæˆæ–‡ä»¶
fs.writeFileSync(&#39;./bundle.js&#39;, ret);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;loader&lt;/code&gt;ï¼Œé€šè¿‡è®¾ç½®å¯¹åº”çš„&lt;code&gt;rule&lt;/code&gt;ï¼Œä½¿ç”¨ä¸åŒçš„&lt;code&gt;loader&lt;/code&gt;æ¥è½¬æ¢ã€å¤„ç†ä¸åŒçš„ç»„ä»¶ï¼Œæ¯”å¦‚&lt;code&gt;css&lt;/code&gt;æ–‡ä»¶ä½¿ç”¨&lt;code&gt;css-loader&lt;/code&gt;ä»¥åŠ&lt;code&gt;style-loader&lt;/code&gt;æ¥å¤„ç†&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;{
  test: /\.css$/,
  loader: &#39;style-loader!css-loader&#39;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§å†…è”&lt;code&gt;loader&lt;/code&gt;çš„å½¢å¼ï¼Œå³&lt;code&gt;import loader from &#39;......&#39;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ä¸¤ç§æ–¹å¼å¤„ç†çš„é¡ºåºä¹Ÿä¸åŒï¼Œå¤§è‡´æµç¨‹ä¸º
1.&lt;code&gt;webpack&lt;/code&gt;å¯åŠ¨åï¼Œåˆ›å»ºæ–°çš„&lt;code&gt;compilation&lt;/code&gt;
2.å®ä¾‹åŒ–&lt;code&gt;rules&lt;/code&gt;
3.è§£æ&lt;code&gt;inline loaders&lt;/code&gt;
4.è§£æ&lt;code&gt;config&lt;/code&gt;é…ç½®é‡Œé¢çš„&lt;code&gt;loaders&lt;/code&gt;
5.ç»„åˆè¿™ä¸¤ç§å½¢å¼çš„&lt;code&gt;loader&lt;/code&gt;ï¼Œæœ€ç»ˆè¾“å‡ºä¸Šè¯‰ç¬¬ä¸€ç§å½¢å¼çš„é…ç½®
6.ä½¿ç”¨&lt;code&gt;Loader-runner&lt;/code&gt;æŒ‰é…ç½®æ‰§è¡Œ&lt;code&gt;loader&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ä»¥ä¸‹ç®€å•å†™ä¸€ä¸ª&lt;code&gt;loader&lt;/code&gt;ï¼Œé¦–å…ˆå†™ä¸€ä¸ªæ–¹æ³•ç”¨äºåŠ è½½&lt;code&gt;loader&lt;/code&gt;ï¼Œå¹¶å¤„ç†ä¼ å…¥çš„æ¨¡å—ï¼Œç„¶åè¿”å›å¤„ç†å®Œäº†ä¹‹åçš„ä»£ç &lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;let source = ...... // sourceä¸ºè·å–åˆ°çš„æ¨¡å—çš„ä»£ç 
function loaderModule(loaderName) {
  // è·å–loaderè·¯å¾„
  const loaderPath = path.join(process.cwd(), loaderName)
  const loader = require(loaderPath)
  source = loader.call(_this, source)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®šä¹‰ä¸€ä¸ªè§„åˆ™&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;rules: [{
  test:/\.js/,
  use:[
    &#39;./loaderModule.js&#39;, // loaderçš„è·¯å¾„
  ]
}]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰§è¡Œçš„æ—¶å€™éå†&lt;code&gt;rules&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;for (let i = rules.length - 1; i &amp;gt;= 0; i--) {
  const { test, use } = rules[i]
  if (test.test(modulePath)) {
    // ä½¿ç”¨å¤šä¸ªloader
    if (Array.isArray(use)) {
      for (let j = use.length - 1; j &amp;gt;= 0; j--) {
        loaderModule(use[j])
      }
    } else if (typeof use === &#39;string&#39;) {
      loaderModule(use)
      // å¸¦å‚æ•°å‹çš„loader
    } else if (use instanceof Object) {
      loaderModule(use.loader, {
        query: use.options
      })
    }
  }
}

// loaderModule.jså†…å®¹
// loader-utilsæ˜¯webpackä¸€ä¸ªå·¥å…·ç±»ï¼Œç”¨äºè§£æloaderï¼Œè·å–é…ç½®çš„ä¸€äº›loaderå‚æ•°
const loaderUtils = require(&#39;loader-utils&#39;)

// è¿™ä¸ªç®€å•çš„loaderä¼šå°†jsæ–‡ä»¶é‡Œé¢çš„helloå­—ç¬¦ä¸²æ›¿æ¢æˆword
module.exports = function (source) {
  const optionsName = loaderUtils.getOptions(this) &amp;amp;&amp;amp; loaderUtils.getOptions(this).name || &#39;world&#39;
  return source.replace(/hello/g, optionsName)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å‰é¢æ˜¯ä¸€ä¸ªåŒæ­¥çš„&lt;code&gt;loader&lt;/code&gt;ï¼Œå¦‚æœæƒ³å†™ä¸€ä¸ªå¼‚æ­¥çš„&lt;code&gt;loader&lt;/code&gt;ï¼Œå¯ä»¥åœ¨&lt;code&gt;loader&lt;/code&gt;å†…éƒ¨è°ƒç”¨&lt;code&gt;async&lt;/code&gt;æ–¹æ³•ï¼Œç„¶ååœ¨å¤„ç†ä¹‹åè°ƒç”¨å¯¹åº”çš„å›è°ƒæ–¹æ³•å¤„ç†&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;module.exports = function (source) {
  const optionsName = loaderUtils.getOptions(this) &amp;amp;&amp;amp; loaderUtils.getOptions(this).name || &#39;world&#39;
  cosnt callback = this.async()

  // æ“ä½œå®Œäº†ä¹‹åï¼Œè°ƒç”¨callbackè¿”å›ç»“æœè¿›å…¥ä¸‹ä¸€ä¸ªloader
  asyncOperation(source, optionsName, function(err, result) {
    ifï¼ˆerrï¼‰return callback(err)
    callback(err, result)
  })
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœä¸ç”¨ä¸Šé¢çš„æ–¹å¼ï¼Œè¿”å›ä¸€ä¸ª&lt;code&gt;promise&lt;/code&gt;ä¹Ÿæ˜¯å¯ä»¥çš„&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;module.exports = function (source) {
  const optionsName = loaderUtils.getOptions(this) &amp;amp;&amp;amp; loaderUtils.getOptions(this).name || &#39;world&#39;
  return new Promise(resolve =&amp;gt; {
    asyncOperation(source, function(err, result) {
      if (err) resolve(err)
      resolve(err, result)
    })
  })
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;plugin&lt;/code&gt;
&lt;code&gt;plugin&lt;/code&gt;è¿›ä¸€æ­¥æ‹“å±•äº†&lt;code&gt;webpack&lt;/code&gt;çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æ‰“åŒ…ä¼˜åŒ–å’Œå‹ç¼©ï¼Œæ¸…ç©ºå½“å‰é¡¹ç›®çš„ç›®å½•ï¼Œé‡æ–°å®šä¹‰ç¯å¢ƒå˜é‡ï¼Œå°†ä»£ç è¾“å‡ºåˆ°æŸä¸ªæ–‡ä»¶ï¼Œæå–åŠŸèƒ½æ¨¡å—ç­‰ç­‰&lt;/p&gt;

&lt;p&gt;å®šä¹‰ä¸€ä¸ª&lt;code&gt;plugin&lt;/code&gt;çš„æ—¶å€™ï¼Œé¦–å…ˆè¦æä¾›ä¸€ä¸ª&lt;code&gt;apply&lt;/code&gt;æ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ª&lt;code&gt;compiler&lt;/code&gt;å¯¹è±¡ï¼Œç„¶åæ³¨å†Œå¯¹åº”çš„é’©å­å‡½æ•°ï¼Œåœ¨å›è°ƒé‡Œé¢æ‹¿åˆ°å¯¹åº”å‚æ•°ï¼Œç„¶åå¤„ç†
ä»¥ä¸‹å®šä¹‰ä¸€ä¸ª&lt;code&gt;plugin&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const path = require(&#39;path&#39;)
const fs = require(&#39;fs&#39;)
const cheerio = require(&#39;cheerio&#39;)

class BasePlugin {
  constructor(options){
    // æ’ä»¶çš„å‚æ•°ï¼Œfilenameã€templateç­‰
    this.options = options
  }
  apply(compiler) {
    // æ³¨å†ŒafterEmité’©å­å‡½æ•°
    compiler.hooks.afterEmit.tap(&#39;BasePlugin&#39;, (compilation) =&amp;gt; {
      // 2. æ ¹æ®æ¨¡æ¿è¯»å–htmlæ–‡ä»¶å†…å®¹
      const result = fs.readFileSync(this.options.template, &#39;utf-8&#39;)
      
      // 3. ä½¿ç”¨ cheerio æ¥åˆ†æ HTML
      let $ = cheerio.load(result)
    
      // 4. åˆ›å»º script æ ‡ç­¾åæ’å…¥HTMLä¸­
      // compilation.assetsä»£è¡¨æ‰€æœ‰è¾“å‡ºçš„èµ„æºæ–‡ä»¶
      Object.keys(compilation.assets).forEach(item =&amp;gt; {
        $(`&amp;lt;script src=&amp;quot;/${item}&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;`).appendTo(&#39;body&#39;)
      })
    
      // 5. è½¬æ¢æˆæ–°çš„HTMLå¹¶å†™å…¥åˆ° dist ç›®å½•ä¸­
      fs.writeFileSync(path.join(process.cwd(), &#39;dist&#39;, this.options.filename), $.html())
    })
  } 
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;compiler&lt;/code&gt;å¯¹è±¡åŒ…å«äº†&lt;code&gt;webpack&lt;/code&gt;ç¯å¢ƒæ‰€æœ‰çš„çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…å«&lt;code&gt;options&lt;/code&gt;ï¼Œ&lt;code&gt;loaders&lt;/code&gt;ï¼Œ&lt;code&gt;plugins&lt;/code&gt;è¿™äº›ä¿¡æ¯ï¼Œè¿™ä¸ªå¯¹è±¡åœ¨&lt;code&gt;webpack&lt;/code&gt;å¯åŠ¨æ—¶å€™è¢«å®ä¾‹åŒ–ï¼Œå®ƒæ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œå¯ä»¥ç®€å•åœ°æŠŠå®ƒç†è§£ä¸º&lt;code&gt;webpack&lt;/code&gt;å®ä¾‹ï¼Œ&lt;code&gt;compilation&lt;/code&gt;å¯¹è±¡åŒ…å«äº†å½“å‰çš„æ¨¡å—èµ„æºã€ç¼–è¯‘ç”Ÿæˆèµ„æºã€å˜åŒ–çš„æ–‡ä»¶ç­‰ã€‚å½“&lt;code&gt;webpack&lt;/code&gt;ä»¥å¼€å‘æ¨¡å¼è¿è¡Œæ—¶ï¼Œæ¯å½“æ£€æµ‹åˆ°ä¸€ä¸ªæ–‡ä»¶å˜åŒ–ï¼Œ&lt;code&gt;compilation&lt;/code&gt;å°±ä¼šè¢«é‡æ–°æ„å»ºï¼Œå…¶å®ƒçš„ä¸€äº›&lt;a href=&#34;https://www.webpackjs.com/api/compiler-hooks/#hooks&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;é’©å­å‡½æ•°&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;é¡ºä¾¿æ€»ç»“ä¸€ä¸‹ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„&lt;code&gt;webpack&lt;/code&gt;çš„æ­¥éª¤
1.å®šä¸€ä¸ªåŸºç¡€å¯¹è±¡ï¼Œæ„é€ æ–¹æ³•é‡Œé¢ä¼ å…¥&lt;code&gt;entry&lt;/code&gt;ã€&lt;code&gt;output&lt;/code&gt;ã€&lt;code&gt;rules&lt;/code&gt;ã€&lt;code&gt;plugins&lt;/code&gt;ç­‰å±æ€§
2.ç„¶åå®šä¹‰ä¸€ç³»åˆ—é’©å­å‡½æ•°ï¼Œåœ¨&lt;code&gt;webpack&lt;/code&gt;æ‰§è¡Œä¸­å¯ä»¥è°ƒç”¨è¿™äº›é’©å­å‡½æ•°åšå¤„ç†ï¼Œ
3.å¼€å§‹æ‰§è¡Œï¼Œåˆå§‹åŒ–å¯¹åº”çš„é’©å­å‡½æ•°ï¼Œä¼ å…¥&lt;code&gt;entry&lt;/code&gt;ç­‰ç›¸å…³ä¿¡æ¯
4.æ‹¿åˆ°æ–‡ä»¶æºç ä¿¡æ¯ï¼Œä½¿ç”¨&lt;code&gt;loader&lt;/code&gt;å¤„ç†ï¼Œå°†ä»£ç è½¬æ¢æˆ&lt;code&gt;ast&lt;/code&gt;å½¢å¼
5.&lt;code&gt;traverse&lt;/code&gt;å°†&lt;code&gt;ast&lt;/code&gt;ä»£ç ä¸­çš„&lt;code&gt;require&lt;/code&gt;æ›¿æ¢ä¸º&lt;code&gt;__webpack_require__&lt;/code&gt;ï¼Œæ·»åŠ æ–°çš„&lt;code&gt;module&lt;/code&gt;ä¿¡æ¯
6.é€’å½’å¤„ç†æ¯ä¸€ä¸ªä¾èµ–ï¼Œé‡å¤ä¸Šé¢çš„æ­¥éª¤
7.åˆå§‹åŒ–&lt;code&gt;plugin&lt;/code&gt;ï¼Œå¹¶å¯¹æ–‡ä»¶åšå¤„ç†
8.è¾“å…¥åˆ°æŒ‡å®šç›®å½•
9.å®¢æˆ·ç«¯/æµè§ˆå™¨è¿è¡Œæ—¶æ‰§è¡Œ&lt;/p&gt;

&lt;p&gt;å‚è€ƒé“¾æ¥&lt;/p&gt;

&lt;p&gt;1.&lt;a href=&#34;https://juejin.im/post/6844903957769224206&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;webpackåŸç†&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;2.&lt;a href=&#34;https://www.webpackjs.com/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;webpackå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>