<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>ğŸ‘¨ğŸ»â€ğŸ’» on ğŸ‘¨ğŸ»â€ğŸ’»</title>
    <link>https://xtid.github.io/</link>
    <description>Recent content in ğŸ‘¨ğŸ»â€ğŸ’» on ğŸ‘¨ğŸ»â€ğŸ’»</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-CN</language>
    <lastBuildDate>Tue, 03 Aug 2021 22:34:03 +0800</lastBuildDate>
    <atom:link href="/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Webpack5çš„æ–°ç‰¹æ€§ä»¥åŠé¡¹ç›®å®æˆ˜é…ç½®</title>
      <link>https://xtid.github.io/2021/webpack5%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7%E4%BB%A5%E5%8F%8A%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E9%85%8D%E7%BD%AE/</link>
      <pubDate>Tue, 03 Aug 2021 22:34:03 +0800</pubDate>
      
      <guid>https://xtid.github.io/2021/webpack5%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7%E4%BB%A5%E5%8F%8A%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E9%85%8D%E7%BD%AE/</guid>
      <description>

&lt;h3 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h3&gt;

&lt;p&gt;webpack5ä¹Ÿå·²ç»å‘å¸ƒäº†(2021.08)æ¥è¿›ä¸€å¹´äº†ï¼Œä¹‹å‰åˆšå‡ºæ¥çš„æ—¶å€™è¿˜æœ‰äº›å‘ä¹Ÿä¸æ•¢æ€¥ç€å®é™…åº”ç”¨åœ¨é¡¹ç›®ä¸­ï¼Œç°åœ¨å®˜æ–¹çš„bugä¹Ÿä¿®çš„å·®ä¸å¤šäº†ï¼Œæˆ‘ä¹Ÿå®é™…åœ¨é¡¹ç›®ä¸­è¿ç”¨äº†ä¸‹ï¼Œæ‰€ä»¥ç°åœ¨åšä¸ªæ€»ç»“&lt;/p&gt;

&lt;h3 id=&#34;æ–°ç‰¹æ€§&#34;&gt;æ–°ç‰¹æ€§&lt;/h3&gt;

&lt;h4 id=&#34;1-ç”¨æŒä¹…æ€§ç¼“å­˜æ¥æé«˜æ„å»ºæ€§èƒ½&#34;&gt;1.ç”¨æŒä¹…æ€§ç¼“å­˜æ¥æé«˜æ„å»ºæ€§èƒ½&lt;/h4&gt;

&lt;p&gt;åœ¨webpack4ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡cache-loaderç­‰æ‰‹æ®µæ¥å°†ç¼–è¯‘çš„ç»“æœå†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œç°åœ¨å¯ä»¥ç›´æ¥é€šè¿‡è®¾ç½®å°†ç¼–è¯‘ç»“æœç¼“å­˜åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­&lt;/p&gt;

&lt;p&gt;typeï¼š&lt;code&gt;string: &#39;memory&#39; | &#39;filesystem&#39;&lt;/code&gt; ï¼Œå°† &lt;code&gt;cache&lt;/code&gt; ç±»å‹è®¾ç½®ä¸ºå†…å­˜æˆ–è€…æ–‡ä»¶ç³»ç»Ÿ&lt;/p&gt;

&lt;p&gt;buildDependenciesï¼š&lt;code&gt;object&lt;/code&gt;ï¼Œé’ˆå¯¹æ„å»ºçš„é¢å¤–ä»£ç ä¾èµ–çš„æ•°ç»„å¯¹è±¡ã€‚webpack å°†ä½¿ç”¨è¿™äº›é¡¹å’Œæ‰€æœ‰ä¾èµ–é¡¹çš„å“ˆå¸Œå€¼æ¥ä½¿æ–‡ä»¶ç³»ç»Ÿç¼“å­˜å¤±æ•ˆ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;cache: {
  type: &#39;filesystem&#39;, // å°†ç¼“å­˜ç±»å‹è®¾ç½®ä¸ºæ–‡ä»¶ç³»ç»Ÿï¼Œé»˜è®¤ä¸ºmemory
  buildDependencies: {
    config: [__filename], // è¿™æ ·è®¾ç½®åwebpackèƒ½è·å–æœ€æ–°çš„é…ç½®ä»¥åŠä¾èµ–é¡¹æ¥é‡æ–°ç¼“å­˜
  },
},
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;2-å¯¹èµ„æºå®ç°äº†å†…éƒ¨æ”¯æŒè€Œä¸éœ€è¦é¢å¤–çš„loader&#34;&gt;2.å¯¹èµ„æºå®ç°äº†å†…éƒ¨æ”¯æŒè€Œä¸éœ€è¦é¢å¤–çš„loader&lt;/h4&gt;

&lt;p&gt;&lt;code&gt;asset/resource&lt;/code&gt; å‘é€ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å¹¶å¯¼å‡º URLã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ file-loader å®ç°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;asset/inline&lt;/code&gt; å¯¼å‡ºä¸€ä¸ªèµ„æºçš„ data URIã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ url-loader å®ç°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;asset/source&lt;/code&gt; å¯¼å‡ºèµ„æºçš„æºä»£ç ã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ raw-loader å®ç°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;asset&lt;/code&gt; åœ¨å¯¼å‡ºä¸€ä¸ª data URI å’Œå‘é€ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¹‹é—´è‡ªåŠ¨é€‰æ‹©ã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ url-loaderï¼Œå¹¶ä¸”é…ç½®èµ„æºä½“ç§¯é™åˆ¶å®ç°&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;module.export = {
  module: {
    rules: [{
      test: /\.png$/,
      type: &amp;quot;asset/resource&amp;quot;, //å¯¹åº”file-loader
    },
    {
      test: /\.svg$/,
      type: &amp;quot;asset/inline&amp;quot;, //å¯¹åº”url-loader å¤§å°&amp;lt;limt è½¬åŒ–ä¸ºbase64
    },
    {
      test: /\.txt$/,
      type: &amp;quot;asset/source&amp;quot;, //å¯¹åº”raw-loader
    },
    {
      test: /\.gif$/,
      type: &amp;quot;asset&amp;quot;, //è‡ªåŠ¨é€‰æ‹©
      parser: {
        dataUrlCondition: {
          maxSize: 4 * 1024,
        },
      },
    }],
  },
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;3-ç”¨æ›´å¥½çš„-tree-shaking-å’Œä»£ç ç”Ÿæˆæ¥æ”¹å–„åŒ…å¤§å°&#34;&gt;3.ç”¨æ›´å¥½çš„ Tree Shaking å’Œä»£ç ç”Ÿæˆæ¥æ”¹å–„åŒ…å¤§å°&lt;/h4&gt;

&lt;p&gt;ç°åœ¨çš„Tree Shaking èƒ½å¤Ÿå®Œå…¨å‰”é™¤æœªä½¿ç”¨çš„ä»£ç ï¼ŒåŒæ ·ä½¿ç”¨ES6æ¨¡å—ï¼Œå¹¶å¼€èµ·production modeï¼›å¹¶ä¸”ç°åœ¨èƒ½å¤„ç†å¯¹ Commonjs çš„ tree shakingï¼Œ&lt;strong&gt;å…è®¸æ¶ˆé™¤æœªä½¿ç”¨çš„CommonJså¯¼å‡ºå¹¶è·Ÿè¸ªrequire()è°ƒç”¨ä¸­å¼•ç”¨çš„å¯¼å‡ºåç§°&lt;/strong&gt;ï¼Œåœ¨æ‰“åŒ…å‡ºçš„æ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°æœ€ç»ˆçš„ä»£ç ã€‚&lt;/p&gt;

&lt;h4 id=&#34;4-moduleids-chunkids-content-hash-çš„ä¼˜åŒ–&#34;&gt;4.moduleIds &amp;amp; chunkIds &amp;amp; content hash çš„ä¼˜åŒ–&lt;/h4&gt;

&lt;p&gt;&lt;strong&gt;moduleIds &amp;amp; chunkIdsçš„ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨webpack5ä»¥å‰ï¼Œæ²¡æœ‰ä»entryæ‰“åŒ…çš„chunkæ–‡ä»¶ï¼Œéƒ½ä¼šä»¥1ï¼Œ2ï¼Œ3&amp;hellip;çš„æ–‡ä»¶å‘½åæ–¹å¼è¾“å‡ºï¼Œæ–‡ä»¶åç§°åçš„hashå€¼æ˜¯ç”¨chunkhashç”Ÿæˆçš„ã€‚è¿™æ ·ä¼šé€ æˆå½“åˆ é™¤æˆ–è€…æš‚æ—¶ä¸ç”¨1.jsè¿™ä¸ªæ–‡ä»¶åï¼Œé‚£ä¹ˆé‡æ–°æ‰“åŒ…æ—¶2.js-&amp;gt;1.js,3.js-&amp;gt;2.jsï¼Œè¿™æ ·ä¼šé€ æˆåŸæ¥çº¿ä¸Šçš„2.jså’Œ3.jsç¼“å­˜å¤±æ•ˆã€‚&lt;/p&gt;

&lt;p&gt;webpack5ä¸ºäº†ç¡®ä¿moduleIdï¼ŒchunkId çš„ç¡®å®šæ€§ï¼Œ å¢åŠ äº†å¦‚ä¸‹é…ç½®ï¼š&lt;/p&gt;

&lt;p&gt;&lt;code&gt;optimization.moduleIds&lt;/code&gt;&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;é€‰èå€¼&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;&lt;code&gt;natural&lt;/code&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;æŒ‰ä½¿ç”¨é¡ºåºçš„æ•°å­— idã€‚&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;&lt;code&gt;named&lt;/code&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;å¯¹è°ƒè¯•æ›´å‹å¥½çš„å¯è¯»çš„ idã€‚&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;&lt;code&gt;deterministic&lt;/code&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;è¢«å“ˆå¸Œè½¬åŒ–æˆçš„å°ä½æ•°å€¼æ¨¡å—åã€‚&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;&lt;code&gt;size&lt;/code&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;ä¸“æ³¨äºè®©åˆå§‹ä¸‹è½½åŒ…å¤§å°æ›´å°çš„æ•°å­— idã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;code&gt;deterministic&lt;/code&gt; é€‰é¡¹æœ‰ç›Šäºé•¿æœŸç¼“å­˜ï¼Œä½†å¯¹æ¯”äº &lt;code&gt;hashed&lt;/code&gt; æ¥è¯´ï¼Œå®ƒä¼šå¯¼è‡´æ›´å°çš„æ–‡ä»¶ bundlesã€‚æ•°å­—å€¼çš„é•¿åº¦ä¼šè¢«é€‰ä½œç”¨äºå¡«æ»¡æœ€å¤š 80%çš„ id ç©ºé—´ã€‚ å½“ &lt;code&gt;optimization.moduleIds&lt;/code&gt; è¢«è®¾ç½®æˆ &lt;code&gt;deterministic&lt;/code&gt;ï¼Œé»˜è®¤æœ€å° 3 ä½æ•°å­—ä¼šè¢«ä½¿ç”¨ã€‚deterministicé…ç½®åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹æ˜¯é»˜è®¤å¼€å¯ï¼‰&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;optimization.moduleIds = &#39;deterministic&#39;
optimization.chunkIds = &#39;deterministic&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å½“ç„¶åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è®¾ç½®æˆ&lt;code&gt;natural&lt;/code&gt;ä»¥ä¿æŒä»¥å‰çš„è€æ¨¡å¼&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;content hashçš„ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¹‹å‰ä½¿ç”¨content hashçš„æ—¶å€™ï¼Œå½“æ”¹åŠ¨æ–‡ä»¶å†…å®¹çš„æ—¶å€™content hashä¼šé‡æ–°ç”Ÿæˆï¼›è€Œç°åœ¨Webpack 5 å°†ä½¿ç”¨çœŸæ­£çš„æ–‡ä»¶å†…å®¹å“ˆå¸Œå€¼ï¼Œä¹Ÿå°±æ˜¯è¯´å½“è¿›è¡Œäº†ä¿®æ”¹æ³¨é‡Šæˆ–è€…ä¿®æ”¹å˜é‡åç­‰ä»£ç é€»è¾‘æ˜¯æ²¡æœ‰å½±å“çš„æ“ä½œæ—¶ï¼Œæ–‡ä»¶å†…å®¹çš„å˜æ›´ä¸ä¼šå¯¼è‡´ contenthash å˜åŒ–ã€‚&lt;/p&gt;

&lt;h4 id=&#34;5-æ”¯æŒç”Ÿæˆes6-es2015çš„ä»£ç &#34;&gt;5.æ”¯æŒç”ŸæˆES6/ES2015çš„ä»£ç &lt;/h4&gt;

&lt;p&gt;webpack 4 é»˜è®¤åªèƒ½è¾“å‡º ES5 ä»£ç ï¼Œç°åœ¨æ”¯æŒæŒ‡å®šç¯å¢ƒï¼Œç„¶åç”Ÿæˆè¯¥ç¯å¢ƒçš„ä¸€ä¸ªä»£ç &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;target&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;string&lt;/code&gt; &lt;code&gt;[string]&lt;/code&gt; &lt;code&gt;false&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;å‘ŠçŸ¥ webpack ä¸ºç›®æ ‡(target)æŒ‡å®šä¸€ä¸ªç¯å¢ƒã€‚é»˜è®¤å€¼ä¸º &lt;code&gt;&amp;quot;browserslist&amp;quot;&lt;/code&gt;ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ° browserslist çš„é…ç½®ï¼Œåˆ™é»˜è®¤ä¸º &lt;code&gt;&amp;quot;web&amp;quot;&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç„¶åæˆ‘ä»¬è®¾ç½®&lt;/p&gt;

&lt;p&gt;&lt;code&gt;target: [&#39;web&#39;, &#39;es5&#39;]&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;webpack å°†ç”Ÿæˆ web å¹³å°çš„è¿è¡Œæ—¶ä»£ç ï¼Œå¹¶ä¸”åªä½¿ç”¨ ES5 ç›¸å…³çš„ç‰¹æ€§&lt;/p&gt;

&lt;h4 id=&#34;6-ç§»é™¤äº†-node-js-polyfills&#34;&gt;6.ç§»é™¤äº† Node.js Polyfills&lt;/h4&gt;

&lt;blockquote&gt;
&lt;p&gt;åœ¨æ—©æœŸï¼Œwebpack çš„ç›®çš„æ˜¯ä¸ºäº†è®©å¤§å¤šæ•°çš„ Node.js æ¨¡å—è¿è¡Œåœ¨æµè§ˆå™¨ä¸­ï¼Œä½†å¦‚ä»Šæ¨¡å—çš„æ ¼å±€å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œç°åœ¨è®¸å¤šæ¨¡å—ä¸»è¦æ˜¯ä¸ºå‰ç«¯è€Œç¼–å†™ã€‚webpack &amp;lt;= 4 çš„ç‰ˆæœ¬ä¸­æä¾›äº†è®¸å¤š Node.js æ ¸å¿ƒæ¨¡å—çš„ polyfillsï¼Œä¸€æ—¦æŸä¸ªæ¨¡å—å¼•ç”¨äº†ä»»ä½•ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼ˆå¦‚ &lt;code&gt;cypto&lt;/code&gt; æ¨¡å—ï¼‰ï¼Œwebpack å°±ä¼šè‡ªåŠ¨å¼•ç”¨è¿™äº› polyfillsã€‚&lt;/p&gt;

&lt;p&gt;å°½ç®¡è¿™ä¼šä½¿å¾—ä½¿ç”¨ä¸º Node.js ç¼–å†™æ¨¡å—å˜å¾—å®¹æ˜“ï¼Œä½†å®ƒåœ¨æ„å»ºæ—¶ç»™ bundle é™„åŠ äº†åºå¤§çš„ polyfillsã€‚åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¿™äº› polyfills å¹¶éå¿…é¡»ã€‚&lt;/p&gt;

&lt;p&gt;ä» webpack 5 å¼€å§‹ä¸å†è‡ªåŠ¨å¡«å……è¿™äº› polyfillsï¼Œè€Œä¼šä¸“æ³¨äºå‰ç«¯æ¨¡å—å…¼å®¹ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æé«˜ web å¹³å°çš„å…¼å®¹æ€§ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è¿ç§»&lt;/strong&gt;ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å°½é‡ä½¿ç”¨å‰ç«¯å…¼å®¹çš„æ¨¡å—ã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥æ‰‹åŠ¨ä¸º Node.js æ ¸å¿ƒæ¨¡å—æ·»åŠ  polyfillã€‚é”™è¯¯æç¤ºä¼šå‘Šè¯‰ä½ å¦‚ä½•å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;Package ä½œè€…ï¼šåœ¨ &lt;code&gt;package.json&lt;/code&gt; ä¸­æ·»åŠ  &lt;code&gt;browser&lt;/code&gt; å­—æ®µï¼Œä½¿ package ä¸å‰ç«¯å…¼å®¹ã€‚ä¸ºæµè§ˆå™¨æä¾›å…¶ä»–çš„å®ç°/dependenciesã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;h4 id=&#34;7-module-federation&#34;&gt;7.Module Federation&lt;/h4&gt;

&lt;blockquote&gt;
&lt;p&gt;å¤šä¸ªç‹¬ç«‹çš„æ„å»ºå¯ä»¥ç»„æˆä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œè¿™äº›ç‹¬ç«‹çš„æ„å»ºä¹‹é—´ä¸åº”è¯¥å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œå› æ­¤å¯ä»¥å•ç‹¬å¼€å‘å’Œéƒ¨&amp;gt;ç½²å®ƒä»¬ã€‚&lt;/p&gt;

&lt;p&gt;è¿™é€šå¸¸è¢«ç§°ä½œå¾®å‰ç«¯ï¼Œä½†å¹¶ä¸ä»…é™äºæ­¤ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç®€å•æ¥è¯´å°±æ˜¯å…è®¸ä¸€ä¸ªåº”ç”¨ä¸­åŠ¨æ€åœ°å»åŠ è½½å’Œå¼•å…¥å¦ä¸€ä¸ªåº”ç”¨çš„ä»£ç ï¼Œå°±å¥½åƒæœ¬åœ°èµ·ä¸€ä¸ªåº”ç”¨ä½œCDNåº“ï¼Œå…¶å®ƒåœ°æ–¹å»å¼•ç”¨ï¼Œå…·ä½“å¯ä»¥çœ‹&lt;a href=&#34;https://webpack.docschina.org/concepts/module-federation/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;å®˜æ–¹é…ç½®&lt;/a&gt;ï¼Œä¸ªäººæ„Ÿè§‰å¹¶ä¸æ˜¯ç‰¹åˆ«çš„å®ç”¨&lt;/p&gt;

&lt;h3 id=&#34;é¡¹ç›®å®æˆ˜&#34;&gt;é¡¹ç›®å®æˆ˜&lt;/h3&gt;

&lt;p&gt;é¦–å…ˆå®šä¹‰ä¸€ä¸ªwebpack.config.base.jsï¼Œå³å¼€å‘ç¯å¢ƒä»¥åŠç”Ÿäº§ç¯å¢ƒéƒ½éœ€è¦çš„é…ç½®&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const path = require(&#39;path&#39;)
const { CleanWebpackPlugin } = require(&#39;clean-webpack-plugin&#39;)
const HtmlWebpackPlugin = require(&#39;html-webpack-plugin&#39;)
const MiniCssExtractPlugin = require(&amp;quot;mini-css-extract-plugin&amp;quot;)

module.exports = {
  entry: &#39;./src/index.js&#39;, 
  output: {
    filename: &#39;[name].[chunkhash].bundle.js&#39;,
    path: path.resolve(__dirname, &#39;dist&#39;) 
  },
  module: {
    rules: [{
        test: /\.m?js$/,
        exclude: /node_modules/,
        use: {
          loader: &#39;babel-loader&#39;, 
        }
      },
      {
        test: /\.s[ac]ss$/, 
        use: [MiniCssExtractPlugin.loader, &#39;css-loader&#39;, &#39;sass-loader&#39;]
      },
      {
        test: /\.(png|svg|jpg|gif|webp|jfif)$/,
        use: [{
          loader: &#39;url-loader&#39;,
          options: {
            limit: 1024 * 100,
            name: &#39;assets/[name]_[hash:10].[ext]&#39;
          }
        }]
      }
    ]
  },
  plugins: [
    new CleanWebpackPlugin({ // æ¯æ¬¡æ‰“åŒ…å‰åˆ é™¤distæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶
      cleanOnceBeforeBuildPatterns: [&#39;**/*&#39;, &#39;!favicon.ico&#39;, &#39;!lib/**&#39;], // distæ–‡ä»¶å¤¹ä¸‹çš„favicon.icoæ–‡ä»¶å’Œlibæ–‡ä»¶å¤¹ä¸‹çš„ä¸œè¥¿éƒ½å¿½ç•¥ä¸è¿›è¡Œåˆ é™¤
    }),
    new HtmlWebpackPlugin({
      template: &#39;index.html&#39;, 
      favicon: &#39;favicon.ico&#39;, 
      inject: &#39;head&#39; 
    }),
    new MiniCssExtractPlugin({
      filename: &#39;[name]-[contenthash].css&#39;
    }),
  ],
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åé…ç½®webpack.config.dev.jsï¼Œå¼€å‘ç¯å¢ƒä¸»è¦é…ç½®ä»£ç†æœåŠ¡å™¨ï¼Œä»£ç çƒ­æ›´æ–°ï¼Œä»¥åŠä½¿ç”¨æœ€æ–°çš„ç¼“å­˜ç‰¹æ€§&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const { merge } = require(&#39;webpack-merge&#39;)
const path = require(&#39;path&#39;)
const baseConfig = require(&#39;./webpack.base.js&#39;)
const ReactRefreshPlugin = require(&#39;@pmmmwh/react-refresh-webpack-plugin&#39;)
const webpack = require(&#39;webpack&#39;)

module.exports = merge(baseConfig, {
  mode: &#39;development&#39;,
  devtool: &#39;eval-cheap-module-source-map&#39;,
  devServer: { 
    contentBase: path.resolve(__dirname, &#39;dist&#39;),
    port: &#39;8090&#39;,
    proxy: { 
      &#39;/api&#39;: {
        target: &#39;http://127.0.0.1:3001&#39;,
        pathRewrite: {
          &#39;^/api&#39;: &#39;
        }
      },
    },
    hot: true,
    open: true,
  },
  // çƒ­æ›´æ–°
  plugins: [
    new ReactRefreshPlugin({
      overlay: false,
    }),
    new webpack.HotModuleReplacementPlugin()
  ],
  // ç¼“å­˜
  cache: {
    type: &#39;filesystem&#39;,
    buildDependencies: {
      config: [__filename],
    },
  },
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æœ€åæ˜¯ç”Ÿäº§ç¯å¢ƒçš„é…ç½®ï¼Œç”Ÿäº§ç¯å¢ƒçš„é…ç½®ä¸»è¦æ˜¯å¯¹ä»£ç è¿›è¡Œä¸€ä¸ªå‹ç¼©&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const { merge } = require(&#39;webpack-merge&#39;) 
const OptimizeCSSAssetsPlugin = require(&amp;quot;optimize-css-assets-webpack-plugin&amp;quot;)
const TerserJSPlugin = require(&amp;quot;terser-webpack-plugin&amp;quot;)
const baseConfig = require(&#39;./webpack.base.js&#39;)

module.exports = merge(baseConfig, {
  mode: &amp;quot;production&amp;quot;,
  optimization: {
    minimizer: [new OptimizeCSSAssetsPlugin({})],
    minimizer: [new TerserJSPlugin({}), new OptimizeCSSAssetsPlugin({})] 
  }
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªwebpack5çš„åŸºæœ¬é…ç½®ï¼Œå¯ä»¥çœ‹åˆ°é™¤äº†å…¶å†…éƒ¨æ›´æ–°çš„ç‰¹æ€§æ„å¤–ï¼Œå…¶å®ƒçš„è¿˜æ˜¯å¯ä»¥ç”¨åŸæ¥çš„loaderå»é…ç½®ï¼Œä¸»è¦ç”¨åˆ°çš„è¿˜æ˜¯å®ƒçš„ç¼“å­˜çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå½“ç„¶å…¶å®ƒçš„ä½ ä¹Ÿå¯ä»¥æŒ‰ç…§å®˜æ–¹æ–‡æ¡£è¿›è¡Œä¸€ä¸ªé…ç½®&lt;/p&gt;

&lt;h3 id=&#34;å‚è€ƒé“¾æ¥&#34;&gt;å‚è€ƒé“¾æ¥&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://webpack.docschina.org/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;webpackå®˜æ–¹ç½‘ç«™&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://juejin.cn/post/6983985071699001357&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;webpackæ–°ç‰¹æ€§&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å‰ç«¯çš„æ¨¡å—è§„èŒƒç®€è¿°ä»¥åŠå¦‚ä½•å®ç°ä¸€ä¸ªUMD-Loaderæ–¹æ³•</title>
      <link>https://xtid.github.io/2021/%E5%89%8D%E7%AB%AF%E7%9A%84%E6%A8%A1%E5%9D%97%E8%A7%84%E8%8C%83%E7%AE%80%E8%BF%B0%E4%BB%A5%E5%8F%8A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAumd-loader%E6%96%B9%E6%B3%95/</link>
      <pubDate>Sat, 10 Jul 2021 16:51:03 +0800</pubDate>
      
      <guid>https://xtid.github.io/2021/%E5%89%8D%E7%AB%AF%E7%9A%84%E6%A8%A1%E5%9D%97%E8%A7%84%E8%8C%83%E7%AE%80%E8%BF%B0%E4%BB%A5%E5%8F%8A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAumd-loader%E6%96%B9%E6%B3%95/</guid>
      <description>

&lt;p&gt;ç°åœ¨çš„å‰ç«¯å¼€å‘ä¸­æ ¹æœ¬ç¦»ä¸å¼€ç»„ä»¶åŒ–ã€æ¨¡å—åŒ–çš„å¼€å‘æ–¹å¼ï¼Œè¿™äº›æ¨¡å—æœ‰å„ç§å„æ ·çš„è§„èŒƒï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;

&lt;h4 id=&#34;1-commonjsè§„èŒƒ&#34;&gt;1.CommonJSè§„èŒƒ&lt;/h4&gt;

&lt;p&gt;ä¸»è¦ç”¨åœ¨ä¸NodejsæœåŠ¡ç«¯ï¼Œåœ¨æœåŠ¡å™¨ç«¯ï¼Œæ¨¡å—çš„åŠ è½½æ˜¯&lt;strong&gt;è¿è¡Œæ—¶&lt;/strong&gt;åŒæ­¥åŠ è½½çš„ï¼›åœ¨æµè§ˆå™¨ç«¯ï¼Œæ¨¡å—éœ€è¦æå‰ç¼–è¯‘æ‰“åŒ…å¤„ç†ã€‚æ¨¡å—æœ¬èº«æ˜¯&lt;strong&gt;è¾“å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´&lt;/strong&gt;ï¼Œæ„æ€å°±æ˜¯è¯´æ‹¿åˆ°æ¨¡å—åï¼Œå¯¹å…¶ä¸­exportsçš„å˜é‡è¿›è¡Œä¿®æ”¹çš„æ—¶å€™ï¼Œæ˜¯ä¸ä¼šå½±å“åˆ°åŸæ¥çš„æ¨¡å—çš„&lt;/p&gt;

&lt;p&gt;1.1.å¯¼å‡ºæ¨¡å—&lt;/p&gt;

&lt;p&gt;å¯¼å‡ºæ¨¡å—çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸¤ç§å†™æ³•éƒ½å¯ä»¥ï¼Œ&lt;code&gt;module.exports&lt;/code&gt;æ˜¯å¯¹&lt;code&gt;exports&lt;/code&gt;çš„ä¸€ä¸ªå¼•ç”¨&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;module.exports = {}

exports.xxx = &#39;xxx&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;1.2.å¼•å…¥æ¨¡å—&lt;/p&gt;

&lt;p&gt;æŒ‡çš„è¯´çš„ä¸€ç‚¹å°±æ˜¯è¿™ä¸ªè·¯å¾„å¯ä»¥æ˜¯ä¸€ä¸ªjsè¡¨è¾¾å¼è®¡ç®—çš„ç»“æœ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const module = requore(&#39;è·¯å¾„&#39;)
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;2-amdè§„èŒƒ&#34;&gt;2.AMDè§„èŒƒ&lt;/h4&gt;

&lt;p&gt;å‡ºç°AMDè§„èŒƒçš„åŸå› æ˜¯å› ä¸ºCommonJSä»¥æœåŠ¡ç«¯åŒæ­¥çš„æ–¹å¼åŠ è½½æœ¬åœ°çš„æ¨¡å—(æ–‡ä»¶)ï¼ŒæœåŠ¡å™¨ç«¯æ‰€æœ‰çš„æ¨¡å—éƒ½å­˜æ”¾åœ¨æœ¬åœ°ç¡¬ç›˜ä¸­ï¼Œå¯ä»¥åŒæ­¥åŠ è½½å®Œæˆï¼Œç­‰å¾…æ—¶é—´å°±æ˜¯ç¡¬ç›˜çš„è¯»å–æ—¶é—´ï¼›è€Œå¦‚æœåœ¨å®¢æˆ·ç«¯ä½¿ç”¨è¿™ä¸ªè§„èŒƒçš„å»è¯·æ±‚æœåŠ¡å™¨ä¸Šçš„æ¨¡å—èµ„æºçš„æ—¶å€™ï¼Œè¯·æ±‚çš„æ—¶é—´å°±å–å†³äºå½“å‰çš„ç½‘ç»œçŠ¶æ€äº†ï¼ŒåŠ ä¸ŠCommonJSæ˜¯ä¸€ä¸ªåŒæ­¥çš„åŠ è½½ï¼Œé‚£é¡µé¢å°±ä¼šé˜»å¡ã€å¡é¡¿ï¼Œæ‰€ä»¥ä¹Ÿå°±æœ‰äº†AMD(Asynchronous Module Definition)è§„èŒƒï¼Œä¸»è¦ç”¨åœ¨å®¢æˆ·ç«¯&lt;/p&gt;

&lt;p&gt;2.1å®šä¹‰(å¯¼å‡ºæ¨¡å—)&lt;/p&gt;

&lt;p&gt;å®šä¹‰æ¨¡å—ä½¿ç”¨&lt;code&gt;define(id?, dependencies?, factory)&lt;/code&gt;æ–¹æ³•ï¼Œidä¸ºä½ è‡ªå®šä¹‰æ¨¡å—çš„åç§°ï¼Œdependenciesä¸ºä½ å½“å‰æ¨¡å—æ‰€ä¾èµ–çš„å…¶ä»–æ¨¡å—é›†åˆçš„è·¯å¾„æ•°ç»„ï¼Œfactoryåˆ™æ˜¯å®é™…çš„å®šä¹‰æ¨¡å—çš„æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªç®€å•AMDæ¨¡å—ç”šè‡³ç›´æ¥ä¼ ä¸ªfactoryå‡½æ•°å°±è¡Œäº†ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°é‡Œé¢çš„å…¥å‚æ˜¯dependenciesæ•°ç»„é‡Œé¢åŠ è½½æˆåŠŸçš„ä¾èµ–&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;define(function () {
  return
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;2.2å¼•å…¥æ¨¡å—&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;require([&#39;module1&#39;, &#39;module2&#39;], function (m1, m2) {
  // ä½¿ç”¨module1ã€module2
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;éœ€è¦æ³¨æ„çš„åœ°æ–¹æµè§ˆå™¨æœ¬èº«æ˜¯ä¸æ”¯æŒè¿™ä¸ªè§„èŒƒçš„ï¼Œè¦ä½¿ç”¨çš„è¯å¿…é¡»ä¾èµ–äºrequire.js&lt;/p&gt;

&lt;h4 id=&#34;3-cmdè§„èŒƒ&#34;&gt;3.CMDè§„èŒƒ&lt;/h4&gt;

&lt;p&gt;CMDè§„èŒƒä¸AMDè§„èŒƒå¾ˆç›¸ä¼¼ï¼Œéƒ½ç”¨äºæµè§ˆå™¨ç¼–ç¨‹ï¼Œä¾èµ–å°±è¿‘æ‰§è¡Œï¼Œå»¶è¿Ÿæ‰§è¡Œ&lt;/p&gt;

&lt;p&gt;3.1å®šä¹‰(å¯¼å‡ºæ¨¡å—)&lt;/p&gt;

&lt;p&gt;&lt;code&gt;define(id?, dependencies?, factory)&lt;/code&gt;ï¼Œå…³äºå®šä¹‰å®ƒå’ŒAMDè§„èŒƒå¾ˆåƒï¼ŒåŒ…æ‹¬å…¥å‚ï¼Œä¸åŒåœ°æ–¹åœ¨äº&lt;code&gt;factory&lt;/code&gt;å›è°ƒå‡½æ•°çš„å…¥å‚ä¸åŒ&lt;code&gt;require, exports, module&lt;/code&gt;ï¼Œå¯ä»¥é€šè¿‡è¿™äº›å…³é”®å­—å†å¯¼å‡ºæˆ–è€…å¼•å…¥ç›¸å…³ä¾èµ–ï¼Œç„¶å&lt;code&gt;dependencies&lt;/code&gt;ä¸€èˆ¬ä¸ä¼šå»ä½¿ç”¨ï¼Œé€šå¸¸ä¼šåœ¨&lt;code&gt;factory&lt;/code&gt;çš„å›è°ƒå‡½æ•°ä¸­ç”¨&lt;code&gt;require&lt;/code&gt;å…³é”®å­—å»åŠ è½½å…¶ä»–çš„ä¾èµ–ã€‚&lt;/p&gt;

&lt;p&gt;å®ƒå’ŒAMDè§„èŒƒæœ€å¤§çš„ä¸åŒï¼Œå°±æ˜¯å®šä¹‰æ¨¡å—æ—¶ï¼ŒAMDä¼šå…ˆå»åŠ è½½&lt;code&gt;dependencies&lt;/code&gt;çš„å†…å®¹ï¼Œç„¶ååŠ è½½æ¨¡å—æœ¬èº«çš„å†…å®¹ï¼ŒCMDçš„è¯ä¼šåŠ è½½å°±è¿‘çš„ä¾èµ–ï¼Œæ„æ€æ˜¯é‡åˆ°äº†requireå…³é”®å­—çš„æ—¶å€™æ‰ä¼šå»åŠ è½½æ¨¡å—ã€‚æ‰€ä»¥ä½¿ç”¨CMDè§„èŒƒçš„è¯ï¼Œå¯ä»¥å°†requireå…³é”®å­—å†™åœ¨æ¨¡å—çš„é¡¶å±‚ï¼Œå½“ç„¶æµè§ˆå™¨ç¯å¢ƒä¹Ÿè¦ä¾èµ–ä¸&lt;code&gt;sea.js&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;define(function (require, exports, module) {
  // requireå¯¹è±¡å¯ä»¥åœ¨æ¨¡å—ä¸­å¼•å…¥å…¶ä»–æ¨¡å—
  exports.xxx = value
  module.exports = value
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;4.ES6çš„æ¨¡å—è§„èŒƒ&lt;/p&gt;

&lt;p&gt;1.å¯¼å‡ºï¼šES6æ¨¡å—æœ‰ä¸¤ç§æ¨¡å—å¯¼å‡ºæ–¹å¼ï¼šå‘½åå¼å¯¼å‡º(åç§°å¯¼å‡º)ã€é»˜è®¤å¯¼å‡º(è‡ªå®šä¹‰å¯¼å‡º)&lt;/p&gt;

&lt;p&gt;å‘½åå¼å¯¼å‡ºï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;// æœ€åŸºæœ¬çš„
export const a = &#39;1&#39;

// å¯¼å‡ºä½¿ç”¨åˆ«å
const a = &#39;1&#39;
export { a as A }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é»˜è®¤å¯¼å‡ºé€šå¸¸ä¼šåœ¨exportåé¢åŠ ä¸Šä¸€ä¸ªdefaultï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const a = &#39;1&#39;
export default a
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;2.importå¯¼å…¥æ¨¡å—&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;export const a = &#39;1&#39;
import { a } from &#39;è·¯å¾„&#39;


export default const a = &#39;1&#39;
import a from &#39;./module&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸Šè¿°çš„&lt;code&gt;Commone.js&lt;/code&gt;ã€&lt;code&gt;CMD&lt;/code&gt;ã€&lt;code&gt;AMD&lt;/code&gt;è§„èŒƒçš„ç‰¹ç‚¹å°±æ˜¯è¿è¡Œæ—¶åŠ è½½ã€æ¨¡å—å€¼çš„æ‹·è´&lt;/p&gt;

&lt;p&gt;è€Œ&lt;code&gt;ES6&lt;/code&gt;æ¨¡å—çš„ç‰¹ç‚¹åˆ™æ˜¯é™æ€ç¼–è¯‘æ—¶åŠ è½½ã€æŒ‰éœ€åŠ è½½ã€æ¨¡å—å€¼çš„å¼•ç”¨ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„ä¸Šä¸‹æ–‡ï¼Œæ¯ä¸€ä¸ªæ¨¡å—å†…å£°æ˜çš„å˜é‡éƒ½æ˜¯å±€éƒ¨å˜é‡ï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸ&lt;/p&gt;

&lt;p&gt;requireJSä¼šå…ˆå°½æ—©åœ°æ‰§è¡Œ(ä¾èµ–)æ¨¡å—, ç›¸å½“äºæ‰€æœ‰çš„requireéƒ½è¢«æå‰äº†, è€Œä¸”æ¨¡å—æ‰§è¡Œçš„é¡ºåºä¹Ÿä¸ä¸€å®š100%å°±æ˜¯å…ˆmod1å†mod2ï¼Œæ‰€ä»¥ä½¿ç”¨requireJSçš„æ—¶å€™æ¨¡å—ä¸æ¨¡å—ä¹‹é—´åº”å½“å°½é‡æ²¡æœ‰ä¸šåŠ¡æˆ–è€…é€»è¾‘çš„äº¤å‰&lt;/p&gt;

&lt;p&gt;5.UMDè§„èŒƒ&lt;/p&gt;

&lt;p&gt;æ‰€è°“UMD (Universal Module Definition)ï¼Œå°±æ˜¯ä¸€ç§javascripté€šç”¨æ¨¡å—å®šä¹‰è§„èŒƒï¼Œè®©ä½ çš„æ¨¡å—èƒ½åœ¨javascriptæ‰€æœ‰è¿è¡Œç¯å¢ƒä¸­å‘æŒ¥ä½œç”¨ã€‚é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å…¼å®¹ä¸Šè¿°æ‰€æœ‰è§„èŒƒï¼Œå®ç°æ–¹å¼æ˜¯é€šè¿‡åˆ¤æ–­å½“å‰è„šæœ¬è¿è¡Œç¯å¢ƒæ˜¯å¦æ”¯æŒç›¸åº”çš„å…³é”®å­—æ¥å®ç°çš„&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;(function (root, factory) {
  if (typeof module === &#39;object&#39; &amp;amp;&amp;amp; typeof module.exports === &#39;object&#39;) {
    module.exports = factory();
  } else if (typeof define === &#39;function&#39; &amp;amp;&amp;amp; define.amd) {
    define(factory())
  } else if (typeof define === &#39;function&#39; &amp;amp;&amp;amp; define.cmd) {
    define(function (require, exports, module) {
      module.exports = factory()
    })
  } else {
    root.curModule = factory();
  }
}(this, function () {
  return {
    name: &#39;æˆ‘æ˜¯ä¸€ä¸ªumdæ¨¡å—&#39;
  }
}))

// ç„¶ååœ¨ä½¿ç”¨çš„åœ°æ–¹é€šè¿‡requireæˆ–è€…æ ¹èŠ‚ç‚¹.curModuleçš„å½¢å¼å¼•ç”¨
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®é™…åº”ç”¨åœºæ™¯1ï¼š&lt;/p&gt;

&lt;p&gt;åœ¨&lt;code&gt;Webpack -&amp;gt; Output&lt;/code&gt;é€‰é¡¹ä¸­ï¼Œå¯ä»¥é…ç½®libraryåº“ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®æ‰“åŒ…åçš„æ–‡ä»¶æš´éœ²å‡ºå»çš„æ¨¡å—åï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šç”Ÿæˆæ”¯æŒæŸä¸ªè§„èŒƒçš„&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;output: {
  library: &#39;MyLibrary&#39;, // æš´éœ²å‡ºçš„æ¨¡å—å
  libraryTarget: &#39;amd&#39;, // æŒ‡å®šçš„è§„èŒƒ
},
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰“åŒ…ä»£ç ç”Ÿæˆï¼Œå³ç”Ÿæˆä¸€ä¸ªå…¼å®¹çš„UMDæ¨¡å—&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;(function webpackUniversalModuleDefinition(root, factory) {
  if (typeof exports === &#39;object&#39; &amp;amp;&amp;amp; typeof module === &#39;object&#39;)
    module.exports = factory();
  else if (typeof define === &#39;function&#39; &amp;amp;&amp;amp; define.amd)
    define([], factory);
  else if (typeof exports === &#39;object&#39;)
    exports[&amp;quot;MyLibrary&amp;quot;] = factory();
  else
    root[&amp;quot;MyLibrary&amp;quot;] = factory();
})(typeof self !== &#39;undefined&#39; ? self : this, function () {
 
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®é™…åº”ç”¨åœºæ™¯2ï¼š&lt;/p&gt;

&lt;p&gt;å¯¹äºä¸€ä¸ªå¤§å‹çš„åº”ç”¨æ¥è¯´ï¼Œå…¶å¤æ‚çš„åº”ç”¨ä»¥åŠåŠŸèƒ½ç”¨æˆ·åªä¼šç”¨åˆ°ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é€‚å½“çš„æ—¶å€™å»è¯·æ±‚ç›¸åº”çš„æ¨¡å—ï¼Œè¿™äº›æ¨¡å—çš„èµ„æºæ”¾åœ¨æœåŠ¡ç«¯ï¼Œä»è€Œå‡è½»é¡¹ç›®çš„ä½“é‡ä»¥åŠå‡å°‘é¡¹ç›®çš„å¼€å‘ç¼–è¯‘æ—¶é—´ã€‚å¯¹äºè¿™äº›è¿œç¨‹çš„æ¨¡å—ï¼Œå°±å¯ä»¥ä½¿ç”¨UMDæ¨¡å—å°è£…ï¼Œå…¼å®¹ä¸åŒç¯å¢ƒï¼Œç„¶åæœ¬åœ°å»è¯·æ±‚ã€‚&lt;/p&gt;

&lt;p&gt;è¦åšä¸€ä¸ªumd-loaderï¼Œé€šè¿‡ä¼ å…¥çš„urlã€nameå»åŠ è½½ç¬¬ä¸‰æ–¹çš„æ¨¡å—ï¼Œç„¶ååˆ›å»ºscriptæ ‡ç­¾æ’å…¥åˆ°æ¨¡æ¿æ–‡ä»¶çš„headå½“ä¸­ï¼Œå†å°±æ˜¯è§†å›¾é‡Œé¢è‡ªå·±å¤„ç†é€»è¾‘ï¼Œé¦–å…ˆæˆ‘åœ¨æœ¬åœ°å®šä¹‰å¥½è¿™ä¸ªclassï¼Œç¡®å®šå¥½ç›¸åº”çš„åŠ è½½é€»è¾‘&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;export class UMDLoader {
  static isExist (name) {
    return window.hasOwnProperty(name)
  }
  static getModule (name) {
    return window[name]
  }
  static getRemoteModule ({ name, url }) {
    if (UMDLoader.isExist(name)) {
      return Promise.resolve(UMDLoader.getModule(name))
    }
    return new Promise((resolve, reject) =&amp;gt; {
      const script = document.createElement(&#39;script&#39;)
      script.type = &#39;module&#39;
      script.url = url
      script.onload = () =&amp;gt; {
        return resolve(UMDLoader.getModule(name))
      }
      script.onerror = () =&amp;gt; {
        return reject(new Error(&#39;åŠ è½½å¤±è´¥&#39;))
      }
      document.head.appendChild(script)
    })
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨è§†å›¾ä»£ç ä¸­ä½¿ç”¨çš„æ—¶å€™&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;import React, { useEffect } from &#39;react
import { UMDLoader } from &#39;è·¯å¾„&#39;

const TestView = () =&amp;gt; {
  useEffect(() =&amp;gt; {
    UMDLoader.getRemoteModule({ url: &#39;jsæ¨¡å—åœ°å€&#39;, name: &#39;åå­—&#39; })
      .then((module) =&amp;gt; {
        console.log(module)
      }, (e) =&amp;gt; {
        console.log(e)
      })
  }, [])
}
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Links</title>
      <link>https://xtid.github.io/links/</link>
      <pubDate>Sun, 10 Jan 2021 23:35:28 +0800</pubDate>
      
      <guid>https://xtid.github.io/links/</guid>
      <description>&lt;p&gt;å‹æƒ…é“¾æ¥&lt;/p&gt;

&lt;blockquote&gt;
&lt;table style=&#34;width: 100%&#34;&gt;
 &lt;thead&gt;
  &lt;th colspan=&#34;3&#34;&gt;å‹æƒ…é“¾æ¥&lt;/th&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
  &lt;tr&gt;
  &lt;td align=&#34;center&#34;&gt;
      &lt;a href=&#34;http://jsshou.cn/&#34; title=&#34;JSShouçš„åšå®¢ç½‘ç«™&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;JSShou&lt;/a&gt;
    &lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>Reactè°ƒåº¦è¿‡ç¨‹</title>
      <link>https://xtid.github.io/2021/react%E8%B0%83%E5%BA%A6%E8%BF%87%E7%A8%8B/</link>
      <pubDate>Tue, 05 Jan 2021 23:02:17 +0800</pubDate>
      
      <guid>https://xtid.github.io/2021/react%E8%B0%83%E5%BA%A6%E8%BF%87%E7%A8%8B/</guid>
      <description>

&lt;h2 id=&#34;1-forwardref&#34;&gt;1.forwardRef&lt;/h2&gt;

&lt;p&gt;ç”¨æ¥è§£å†³é«˜é˜¶ç»„ä»¶ä¼ é€’&lt;code&gt;ref&lt;/code&gt;çš„é—®é¢˜ã€‚å®ƒçš„ç”¨æ³•å°±åƒæ˜¯ä½¿ç”¨&lt;code&gt;redux&lt;/code&gt;çš„æ—¶å€™ï¼Œåœ¨å¤–é¢åŒ…è£¹ä¸€å±‚ï¼Œé€šè¿‡&lt;code&gt;...props&lt;/code&gt;çš„æ–¹å¼æŠŠå¤–éƒ¨çš„&lt;code&gt;props&lt;/code&gt;ä¼ å…¥åˆ°å®é™…ç»„ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;const TargetComponent = React.forwardRef((props, ref) =&amp;gt; (
  &amp;lt;TargetComponent ref={ref} /&amp;gt;
))
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;2-reactelement&#34;&gt;2.ReactElement&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;ReactElement&lt;/code&gt;é€šè¿‡&lt;code&gt;createElement&lt;/code&gt;åˆ›å»ºï¼Œè°ƒç”¨è¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;type&lt;/li&gt;
&lt;li&gt;config&lt;/li&gt;
&lt;li&gt;children&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;type&lt;/code&gt;æŒ‡ä»£è¿™ä¸ª&lt;code&gt;ReactElement&lt;/code&gt;çš„ç±»å‹&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å­—ç¬¦ä¸²æ¯”å¦‚&lt;code&gt;div&lt;/code&gt;ï¼Œ&lt;code&gt;p&lt;/code&gt;ä»£è¡¨åŸç”ŸDOMï¼Œç§°ä¸º&lt;code&gt;HostComponent&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Classç±»å‹æ˜¯æˆ‘ä»¬ç»§æ‰¿è‡ª&lt;code&gt;Component&lt;/code&gt;æˆ–è€…&lt;code&gt;PureComponent&lt;/code&gt;çš„ç»„ä»¶ï¼Œç§°ä¸º&lt;code&gt;ClassComponent&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ–¹æ³•å°±æ˜¯&lt;code&gt;functional Component&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åŸç”Ÿæä¾›çš„&lt;code&gt;Fragment&lt;/code&gt;ã€&lt;code&gt;AsyncMode&lt;/code&gt;ç­‰æ˜¯Symbolï¼Œä¼šè¢«ç‰¹æ®Šå¤„ç†&lt;/li&gt;
&lt;li&gt;TODO: æ˜¯å¦æœ‰å…¶ä»–çš„&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä»æºç å¯ä»¥çœ‹å‡ºè™½ç„¶åˆ›å»ºçš„æ—¶å€™éƒ½æ˜¯é€šè¿‡&lt;code&gt;config&lt;/code&gt;ä¼ å…¥çš„ï¼Œä½†æ˜¯&lt;code&gt;key&lt;/code&gt;å’Œ&lt;code&gt;ref&lt;/code&gt;ä¸ä¼šè·Ÿå…¶ä»–&lt;code&gt;config&lt;/code&gt;ä¸­çš„å˜é‡ä¸€èµ·è¢«å¤„ç†ï¼Œè€Œæ˜¯å•ç‹¬ä½œä¸ºå˜é‡å‡ºç°åœ¨&lt;code&gt;ReactElement&lt;/code&gt;ä¸Šã€‚&lt;/p&gt;

&lt;p&gt;ä»æºç å¯ä»¥çœ‹å‡ºè™½ç„¶åˆ›å»ºçš„æ—¶å€™éƒ½æ˜¯é€šè¿‡&lt;code&gt;config&lt;/code&gt;ä¼ å…¥çš„ï¼Œä½†æ˜¯&lt;code&gt;key&lt;/code&gt;å’Œ&lt;code&gt;ref&lt;/code&gt;ä¸ä¼šè·Ÿå…¶ä»–&lt;code&gt;config&lt;/code&gt;ä¸­çš„å˜é‡ä¸€èµ·è¢«å¤„ç†ï¼Œè€Œæ˜¯å•ç‹¬ä½œä¸ºå˜é‡å‡ºç°åœ¨&lt;code&gt;ReactElement&lt;/code&gt;ä¸Šã€‚åœ¨æœ€ååˆ›å»º&lt;code&gt;ReactElement&lt;/code&gt;æˆ‘ä»¬çœ‹åˆ°äº†è¿™ä¹ˆä¸€ä¸ªå˜é‡&lt;code&gt;$$typeof&lt;/code&gt;ï¼Œåœ¨è¿™é‡Œä»–æ˜¯ä¸€ä¸ªå¸¸é‡ï¼š&lt;code&gt;REACT_ELEMENT_TYPE&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;3-react-children&#34;&gt;3.React Children&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;React&lt;/code&gt;ä¸Šé¢æœ‰æœ‰ä¸€ä¸ª&lt;code&gt;Children&lt;/code&gt;å¯¹è±¡ï¼Œä¸Šé¢æœ‰ç€&lt;code&gt;Children&lt;/code&gt;å®šä¹‰&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;const React = {
  Children: {
    map,
    forEach,
    count,
    toArray,
    only,
  },
	......
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰¾åˆ°å®šä¹‰&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function mapChildren(children, func, context) {
  if (children == null) {
    return children
  }
  const result = []
  mapIntoWithKeyPrefixInternal(children, result, null, func, context)
  return result
}

function mapIntoWithKeyPrefixInternal(children, array, prefix, func, context) {
  let escapedPrefix = &#39;&#39;
  if (prefix != null) {
    escapedPrefix = escapeUserProvidedKey(prefix) + &#39;/&#39;
  }
  const traverseContext = getPooledTraverseContext(
    array,
    escapedPrefix,
    func,
    context,
  )
  traverseAllChildren(children, mapSingleChildIntoContext, traverseContext)
  releaseTraverseContext(traverseContext)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°åé¢è°ƒç”¨äº†&lt;code&gt;getPooledTraverseContext&lt;/code&gt;ï¼Œè¿™æ˜¯ä»å†…å®¹æ± ä¸­æ‰¾åˆ°å½“å‰çš„&lt;code&gt;contex&lt;/code&gt;tå¯¹è±¡ï¼Œæ“ä½œå®Œäº†ä¹‹å&lt;code&gt;releaseTraverseContext&lt;/code&gt;ä¼šæŠŠå½“å‰çš„&lt;code&gt;context&lt;/code&gt;å¯¹è±¡æ¸…ç©ºç„¶åæ”¾å›åˆ°&lt;code&gt;pool&lt;/code&gt;ä¸­ã€‚ç„¶åè°ƒç”¨&lt;code&gt;traverseAllChildren&lt;/code&gt;ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯é€’å½’è°ƒç”¨&lt;code&gt;mapChildren&lt;/code&gt;å°†æ‰€æœ‰&lt;code&gt;Children&lt;/code&gt;é“ºå¹³ï¼Œç›´åˆ°å½“å‰å…ƒç´ æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„&lt;code&gt;ReactElement&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function mapSingleChildIntoContext(bookKeeping, child, childKey) {
  const { result, keyPrefix, func, context } = bookKeeping

  let mappedChild = func.call(context, child, bookKeeping.count++)
  if (Array.isArray(mappedChild)) {
    mapIntoWithKeyPrefixInternal(mappedChild, result, childKey, c =&amp;gt; c)
  } else if (mappedChild != null) {
    if (isValidElement(mappedChild)) {
      mappedChild = cloneAndReplaceKey(
        mappedChild,
        keyPrefix +
          (mappedChild.key &amp;amp;&amp;amp; (!child || child.key !== mappedChild.key)
            ? escapeUserProvidedKey(mappedChild.key) + &#39;/&#39;
            : &#39;&#39;) +
          childKey,
      )
    }
    result.push(mappedChild)
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨æ–¹æ³•&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;React.Children.map(this.props.children, function (child) {
    return &amp;lt;li&amp;gt;{child}&amp;lt;/li&amp;gt;;
})
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;4-reactä¸­çš„æ•°æ®ç»“æ„&#34;&gt;4.Reactä¸­çš„æ•°æ®ç»“æ„&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;Update&lt;/code&gt; &amp;amp;&lt;code&gt;UpdateQueue&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;export type Update&amp;lt;State&amp;gt; = {
  // æ›´æ–°çš„è¿‡æœŸæ—¶é—´
  expirationTime: ExpirationTime,

  // export const UpdateState = 0;
  // export const ReplaceState = 1;
  // export const ForceUpdate = 2;
  // export const CaptureUpdate = 3;
  // æŒ‡å®šæ›´æ–°çš„ç±»å‹ï¼Œå€¼ä¸ºä»¥ä¸Šå‡ ç§
  tag: 0 | 1 | 2 | 3,
  // æ›´æ–°å†…å®¹ï¼Œæ¯”å¦‚`setState`æ¥æ”¶çš„ç¬¬ä¸€ä¸ªå‚æ•°
  payload: any, // å½“å‰DOMå…ƒç´ ï¼Ÿ
  // å¯¹åº”çš„å›è°ƒï¼Œ`setState`ï¼Œ`render`éƒ½æœ‰
  callback: (() =&amp;gt; mixed) | null,

  // æŒ‡å‘ä¸‹ä¸€ä¸ªæ›´æ–°
  next: Update&amp;lt;State&amp;gt; | null,
  // æŒ‡å‘ä¸‹ä¸€ä¸ª`side effect`
  nextEffect: Update&amp;lt;State&amp;gt; | null,
};

export type UpdateQueue&amp;lt;State&amp;gt; = {
  // æ¯æ¬¡æ“ä½œå®Œæ›´æ–°ä¹‹åçš„`state`
  baseState: State,

  // é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ª`Update`
  firstUpdate: Update&amp;lt;State&amp;gt; | null,
  // é˜Ÿåˆ—ä¸­çš„æœ€åä¸€ä¸ª`Update`
  lastUpdate: Update&amp;lt;State&amp;gt; | null,

  // ç¬¬ä¸€ä¸ªæ•è·ç±»å‹çš„`Update`
  firstCapturedUpdate: Update&amp;lt;State&amp;gt; | null,
  // æœ€åä¸€ä¸ªæ•è·ç±»å‹çš„`Update`
  lastCapturedUpdate: Update&amp;lt;State&amp;gt; | null,

  // ç¬¬ä¸€ä¸ª`side effect`
  firstEffect: Update&amp;lt;State&amp;gt; | null,
  // æœ€åä¸€ä¸ª`side effect`
  lastEffect: Update&amp;lt;State&amp;gt; | null,

  // ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªæ•è·äº§ç”Ÿçš„`side effect`
  firstCapturedEffect: Update&amp;lt;State&amp;gt; | null,
  lastCapturedEffect: Update&amp;lt;State&amp;gt; | null,
};
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;5-åˆæ¬¡reactdom-reanderè¿‡ç¨‹&#34;&gt;5.åˆæ¬¡ReactDOM.reanderè¿‡ç¨‹&lt;/h2&gt;

&lt;p&gt;é¦–å…ˆè°ƒç”¨&lt;code&gt;legacyRenderSubtreeIntoContainer&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;ReactDOM = {
  render(
    element: React$Element&amp;lt;any&amp;gt;,
    container: DOMContainer,
    callback: ?Function,
  ) {
    return legacyRenderSubtreeIntoContainer(
      null,
      element,
      container,
      false,
      callback,
    )
  },
}
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function legacyRenderSubtreeIntoContainer(
  parentComponent: ?React$Component&amp;lt;any, any&amp;gt;,
  children: ReactNodeList,
  container: DOMContainer,
  forceHydrate: boolean,
  callback: ?Function,
) {
  let root: Root = (container._reactRootContainer: any)
  if (!root) {
    // ç”Ÿæˆrootï¼Œå½“å‰ä¼ å…¥çš„æ ¹containerçš„_reactRootContaineræŒ‡å‘ç”Ÿæˆçš„root
    root = container._reactRootContainer = legacyCreateRootFromDOMContainer(
      container,
      forceHydrate,
    )
    if (typeof callback === &#39;function&#39;) {
      const originalCallback = callback
      callback = function() {
        const instance = DOMRenderer.getPublicRootInstance(root._internalRoot)
        originalCallback.call(instance)
      }
    }
    // é¦–æ¬¡renderä¸æ¯”unbatchedUpdates
    DOMRenderer.unbatchedUpdates(() =&amp;gt; {
      if (parentComponent != null) {
        // ä¸€èˆ¬ä¸ä¼šå‡ºç°
      } else {
        root.render(children, callback)
      }
    })
  } else {
    // æœ‰rootçš„æƒ…å†µ
  }
  return DOMRenderer.getPublicRootInstance(root._internalRoot)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;legacyCreateRootFromDOMContainer&lt;/code&gt;æ–¹æ³•ç”Ÿæˆ&lt;code&gt;root&lt;/code&gt;ï¼Œè¿”å›çš„ç»“æœä¸Šçš„&lt;code&gt;_internalRoot&lt;/code&gt;æŒ‡å‘è¿™ä¸ª&lt;code&gt;root&lt;/code&gt;ã€‚åŒæ—¶ä¼šè°ƒç”¨&lt;code&gt;DOMRenderer.createContainer&lt;/code&gt;åˆ›å»º&lt;code&gt;FiberRoot&lt;/code&gt;ï¼Œç„¶åç”Ÿæˆçš„&lt;code&gt;root&lt;/code&gt;çš„&lt;code&gt;current&lt;/code&gt;å±æ€§æŒ‡å‘è¿™ä¸ª&lt;code&gt;FiberRoot&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function legacyCreateRootFromDOMContainer(
  container: DOMContainer,
  forceHydrate: boolean,
): Root {
  const shouldHydrate =
    forceHydrate || shouldHydrateDueToLegacyHeuristic(container)
  // First clear any existing content.
  if (!shouldHydrate) {
    let warned = false
    let rootSibling
    while ((rootSibling = container.lastChild)) {
      container.removeChild(rootSibling)
    }
  }
  // Legacy roots are not async by default.
  const isConcurrent = false
  return new ReactRoot(container, isConcurrent, shouldHydrate)
}

function ReactRoot(
  container: Container,
  isConcurrent: boolean,
  hydrate: boolean,
) {
  const root = DOMRenderer.createContainer(container, isConcurrent, hydrate)
  this._internalRoot = root
}

ReactRoot.prototype.render = function(
  children: ReactNodeList,
  callback: ?() =&amp;gt; mixed,
): Work {
  const root = this._internalRoot
  const work = new ReactWork()
  callback = callback === undefined ? null : callback
  if (__DEV__) {
    warnOnInvalidCallback(callback, &#39;render&#39;)
  }
  if (callback !== null) {
    work.then(callback)
  }
  DOMRenderer.updateContainer(children, root, null, work._onCommit)
  return work
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°è¿˜æœ‰ä¸ª&lt;code&gt;updateContainer&lt;/code&gt;æ–¹æ³•&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;export function updateContainer(
  element: ReactNodeList,
  container: OpaqueRoot,
  parentComponent: ?React$Component&amp;lt;any, any&amp;gt;,
  callback: ?Function,
): ExpirationTime {
  const current = container.current
  const currentTime = requestCurrentTime()
  const expirationTime = computeExpirationForFiber(currentTime, current)
  return updateContainerAtExpirationTime(
    element,
    container,
    parentComponent,
    expirationTime,
    callback,
  )
}

export function updateContainerAtExpirationTime(
  element: ReactNodeList,
  container: OpaqueRoot,
  parentComponent: ?React$Component&amp;lt;any, any&amp;gt;,
  expirationTime: ExpirationTime,
  callback: ?Function,
) {
  // TODO: If this is a nested container, this won&#39;t be the root.
  const current = container.current
  const context = getContextForSubtree(parentComponent)
  if (container.context === null) {
    container.context = context
  } else {
    container.pendingContext = context
  }

  return scheduleRootUpdate(current, element, expirationTime, callback)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°å…ˆç”Ÿæˆä¸€ä¸ªæ—¶é—´&lt;code&gt;const expirationTime&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯è¿™æ¬¡æ›´æ–°çš„è¶…æ—¶æ—¶é—´ï¼Œç„¶åè°ƒç”¨&lt;code&gt;updateContainerAtExpirationTime&lt;/code&gt;ï¼Œç„¶åè°ƒç”¨&lt;code&gt;scheduleRootUpdate&lt;/code&gt;è¿›è¡Œè°ƒåº¦&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function scheduleRootUpdate(
  current: Fiber,
  element: ReactNodeList,
  expirationTime: ExpirationTime,
  callback: ?Function,
) {
  const update = createUpdate(expirationTime)

  update.payload = { element }

  callback = callback === undefined ? null : callback
  if (callback !== null) {
    warningWithoutStack(
      typeof callback === &#39;function&#39;,
      &#39;render(...): Expected the last optional `callback` argument to be a &#39; +
        &#39;function. Instead received: %s.&#39;,
      callback,
    )
    update.callback = callback
  }
  enqueueUpdate(current, update)

  scheduleWork(current, expirationTime)
  return expirationTime
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;scheduleRootUpdate&lt;/code&gt;ä¼šè°ƒç”¨&lt;code&gt;createUpdate&lt;/code&gt;åˆ›å»º&lt;code&gt;Update&lt;/code&gt;å¯¹è±¡ï¼Œå…¶&lt;code&gt;playload&lt;/code&gt;ä¸º&lt;code&gt;container&lt;/code&gt;ä¸Šé¢çš„&lt;code&gt;ReactNodeList&lt;/code&gt;ï¼Œç„¶åè°ƒç”¨&lt;code&gt;enqueueUpdate&lt;/code&gt;ç”Ÿæˆä¸€ä¸ªåŒå‘åˆ—è¡¨é˜Ÿåˆ—ï¼Œç„¶åè°ƒç”¨&lt;code&gt;scheduleWork&lt;/code&gt;å¼€å§‹è°ƒç”¨ã€‚ä¸Šé¢çš„è¿‡ç¨‹éƒ½æ˜¯ä¾èµ–çš„&lt;code&gt;FiberRoot&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;6-expirationtime&#34;&gt;6.expirationTime&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;import MAX_SIGNED_31_BIT_INT from &#39;./maxSigned31BitInt&#39;;

export type ExpirationTime = number;

export const NoWork = 0;
export const Never = 1;
export const Sync = MAX_SIGNED_31_BIT_INT;

const UNIT_SIZE = 10;
const MAGIC_NUMBER_OFFSET = MAX_SIGNED_31_BIT_INT - 1;

// 1 unit of expiration time represents 10ms.
export function msToExpirationTime(ms: number): ExpirationTime {
  // Always add an offset so that we don&#39;t clash with the magic number for NoWork.
  return MAGIC_NUMBER_OFFSET - ((ms / UNIT_SIZE) | 0);
}

export function expirationTimeToMs(expirationTime: ExpirationTime): number {
  return (MAGIC_NUMBER_OFFSET - expirationTime) * UNIT_SIZE;
}

function ceiling(num: number, precision: number): number {
  return (((num / precision) | 0) + 1) * precision;
}

function computeExpirationBucket(
  currentTime,
  expirationInMs,
  bucketSizeMs,
): ExpirationTime {
  return (
    MAGIC_NUMBER_OFFSET -
    ceiling(
      MAGIC_NUMBER_OFFSET - currentTime + expirationInMs / UNIT_SIZE,
      bucketSizeMs / UNIT_SIZE,
    )
  );
}

export const LOW_PRIORITY_EXPIRATION = 5000;
export const LOW_PRIORITY_BATCH_SIZE = 250;

export function computeAsyncExpiration(
  currentTime: ExpirationTime,
): ExpirationTime {
  return computeExpirationBucket(
    currentTime,
    LOW_PRIORITY_EXPIRATION,
    LOW_PRIORITY_BATCH_SIZE,
  );
}

export const HIGH_PRIORITY_EXPIRATION = __DEV__ ? 500 : 150;
export const HIGH_PRIORITY_BATCH_SIZE = 100;

export function computeInteractiveExpiration(currentTime: ExpirationTime) {
  return computeExpirationBucket(
    currentTime,
    HIGH_PRIORITY_EXPIRATION,
    HIGH_PRIORITY_BATCH_SIZE,
  );
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æœ€åçš„è®¡ç®—å…¬å¼ä¸º&lt;code&gt;((((currentTime - 2 + 5000 / 10) / 25) | 0) + 1) * 25&lt;/code&gt;ï¼ˆå…¬å¼å­˜ç–‘ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€åçš„ç»“æœæ˜¯ä»¥&lt;code&gt;25ms&lt;/code&gt;ä¸ºå•ä½å‘ä¸Šå¢åŠ çš„ï¼Œåœ¨&lt;code&gt;25ms&lt;/code&gt;å†…ï¼Œ&lt;code&gt;react&lt;/code&gt;è¿™æ ·åšä¸ºçš„æ˜¯è®©ä¸¤æ¬¡æ—¶é—´éå¸¸æƒ³å°½çš„æ›´æ–°å¾—åˆ°åŒæ ·çš„&lt;code&gt;expirationTime&lt;/code&gt;ï¼Œç„¶åä»–ä»¬çš„ä¼˜å…ˆçº§å°±ä¼šåˆ¤å®šä¸€æ ·ï¼Œå°±ä¼šå†ä¸€æ¬¡æ›´æ–°ä¸­å®Œæˆï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ª&lt;code&gt;batchedUpdates&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;è®¡ç®—å½“å‰&lt;code&gt;currentTime&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function requestCurrentTime() {
  if (isRendering) {
    return currentSchedulerTime
  }
  findHighestPriorityRoot()
  if (
    nextFlushedExpirationTime === NoWork ||
    nextFlushedExpirationTime === Never
  ) {
    recomputeCurrentRendererTime()
    currentSchedulerTime = currentRendererTime
    return currentSchedulerTime
  }
  return currentSchedulerTime
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;react&lt;/code&gt;ä¸ºäº†é¿å…æ¯æ¬¡è®¡ç®—&lt;code&gt;expirationTime&lt;/code&gt;éƒ½è¦&lt;code&gt;Date now&lt;/code&gt;ï¼Œæ‰€ä»¥ç”¨&lt;code&gt;currentRendererTime&lt;/code&gt;æ¥ä¿å­˜äº†è¿™ä¸ªå€¼ï¼Œä¸Šé¢çš„&lt;code&gt;currentSchedulerTime&lt;/code&gt;ä¹Ÿæ˜¯è®°å½•è¿™ä¸ªå€¼çš„&lt;/p&gt;

&lt;p&gt;é¦–å…ˆ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;if (isRendering) {
  return currentSchedulerTime
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™ä¸ª&lt;code&gt;isRendering&lt;/code&gt;åªæœ‰åœ¨&lt;code&gt;performWorkOnRoot&lt;/code&gt;çš„æ—¶å€™æ‰ä¼šè¢«è®¾ç½®ä¸º&lt;code&gt;true&lt;/code&gt;ï¼Œè€Œå…¶æœ¬èº«æ˜¯ä¸€ä¸ªåŒæ­¥çš„æ–¹æ³•ï¼Œä¸å­˜åœ¨ä»–æ‰§è¡Œåˆ°ä¸€åŠæ²¡æœ‰è®¾ç½®&lt;code&gt;isRendering&lt;/code&gt;ä¸º&lt;code&gt;false&lt;/code&gt;çš„æ—¶å€™å°±è·³å‡ºï¼Œé‚£ä¹ˆä»€ä¹ˆæƒ…å†µä¸‹ä¼šåœ¨è¿™é‡Œå‡ºç°æ–°çš„&lt;code&gt;requestCurrentTime&lt;/code&gt;å‘¢ï¼Ÿ&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åœ¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­è°ƒç”¨äº†&lt;code&gt;setState&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;éœ€è¦æŒ‚èµ·ä»»åŠ¡çš„æ—¶å€™&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ React è¦æ±‚&lt;strong&gt;åœ¨ä¸€æ¬¡&lt;code&gt;rendering&lt;/code&gt;è¿‡ç¨‹ä¸­ï¼Œæ–°äº§ç”Ÿçš„&lt;code&gt;update&lt;/code&gt;ç”¨äºè®¡ç®—è¿‡æœŸæ—¶é—´çš„&lt;code&gt;current&lt;/code&gt;å¿…é¡»è·Ÿç›®å‰çš„&lt;code&gt;renderTime&lt;/code&gt;ä¿æŒä¸€è‡´ï¼ŒåŒç†åœ¨è¿™ä¸ªå‘¨æœŸä¸­æ‰€æœ‰äº§ç”Ÿçš„æ–°çš„æ›´æ–°çš„è¿‡æœŸæ—¶é—´éƒ½ä¼šä¿æŒä¸€è‡´ï¼&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;  findHighestPriorityRoot()
  if (
    nextFlushedExpirationTime === NoWork ||
    nextFlushedExpirationTime === Never
  ) {
    recomputeCurrentRendererTime()
    currentSchedulerTime = currentRendererTime
    return currentSchedulerTime
  }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;findHighestPriorityRoot&lt;/code&gt;æ‰¾åˆ°ä¼˜å…ˆçº§æœ€é«˜çš„èŠ‚ç‚¹ï¼ŒåŒæ—¶è®¾ç½®&lt;code&gt;nextFlushedExpirationTime&lt;/code&gt;ï¼Œç„¶åifåˆ¤æ–­å½“å‰é˜Ÿåˆ—ä¸­æ²¡æœ‰æ›´æ–°çš„ä»»åŠ¡ï¼Œå°±ä¼šé‡æ–°è®¡ç®—å½“å‰æ—¶é—´ï¼Œå¦åˆ™ï¼Œè¿˜æ˜¯è¿”å›æœ€åˆçš„&lt;code&gt;currentSchedulerTime&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;7-å„ç§expirationtime&#34;&gt;7.å„ç§expirationTime&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;root.expirationTime&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;root.nextExpirationTimeToWorkOn&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;root.childExpirationTime&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;root.earliestPendingTime &amp;amp; root.lastestPendingTime&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;root.earliestSuspendedTime &amp;amp; root.lastestSuspendedTime&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;root.lastestPingedTime&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nextFlushedExpirationTime&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nextLatestAbsoluteTimeoutMs&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;currentRendererTime&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;currentSchedulerTime&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;React&lt;/code&gt;æ›´æ–°æ˜¯ä»&lt;code&gt;FilberRoot&lt;/code&gt;å¼€å§‹çš„ï¼Œæ‰€ä»¥æ¯æ¬¡æ›´æ–°æ—¶éƒ½ä¼šéå†å‘ä¸ŠæŸ¥æ‰¾&lt;code&gt;FiberRoot&lt;/code&gt;ï¼Œè€Œè¿™ä¸ª&lt;code&gt;childExpirationTime&lt;/code&gt;ä¼šè®¾ç½®åˆ°æ¯ä¸ªçˆ¶èŠ‚ç‚¹ï¼Œä»£è¡¨å…¶å­èŠ‚ç‚¹&lt;code&gt;expirationTime&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;pendingTime&lt;/code&gt;ï¼Œåœ¨&lt;code&gt;FiberRoot&lt;/code&gt;ä¸Šæœ‰ä¸¤ä¸ªå€¼&lt;code&gt;earliestPendingTime&lt;/code&gt;å’Œ&lt;code&gt;lastestPedingTime&lt;/code&gt;ï¼Œä»–ä»¬æ˜¯ä¸€å¯¹å€¼ï¼Œ&lt;strong&gt;ç”¨æ¥è®°å½•æ‰€æœ‰å­æ ‘ä¸­éœ€è¦è¿›è¡Œæ¸²æŸ“çš„æ›´æ–°çš„&lt;code&gt;expirationTime&lt;/code&gt;çš„åŒºé—´&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;suspendedTime&lt;/code&gt;ï¼ŒåŒæ ·çš„åœ¨&lt;code&gt;ReactFiber&lt;/code&gt;ä¸Šæœ‰ä¸¤ä¸ªå€¼&lt;code&gt;earliestSuspendedTime&lt;/code&gt;å’Œ&lt;code&gt;lastestSuspendedTime&lt;/code&gt;ï¼Œ&lt;strong&gt;è¿™ä¸¤ä¸ªå€¼æ˜¯ç”¨æ¥è®°å½•è¢«æŒ‚èµ·çš„ä»»åŠ¡çš„è¿‡æœŸæ—¶é—´çš„&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸‹ä»€ä¹ˆæƒ…å†µä¸‹ä»»åŠ¡æ˜¯è¢«æŒ‚èµ·çš„ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å‡ºç°å¯æ•è·çš„é”™è¯¯å¹¶ä¸”è¿˜æœ‰ä¼˜å…ˆçº§æ›´ä½çš„ä»»åŠ¡çš„æƒ…å†µä¸‹&lt;/li&gt;
&lt;li&gt;å½“æ•è·åˆ°&lt;code&gt;thenable&lt;/code&gt;ï¼Œå¹¶ä¸”éœ€è¦è®¾ç½®&lt;code&gt;onTimeout&lt;/code&gt;çš„æ—¶å€™&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;root.expirationTime&lt;/code&gt;æ˜¯ç”¨æ¥æ ‡å¿—å½“å‰æ¸²æŸ“çš„è¿‡æœŸæ—¶é—´çš„ï¼Œè¯·æ³¨æ„ä»–åªç®¡æœ¬æ¸²æŸ“å‘¨æœŸï¼Œä»–å¹¶ä¸ç®¡ä½ ç°åœ¨çš„æ¸²æŸ“ç›®æ ‡æ˜¯å“ªä¸ªï¼Œæ¸²æŸ“ç›®æ ‡æ˜¯ç”±&lt;code&gt;root.nextExpirationTimeToWorkOn&lt;/code&gt;æ¥å†³å®šçš„ã€‚&lt;/p&gt;

&lt;p&gt;é‚£ä¹ˆä»–ä»¬æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿä¸»è¦åŒºåˆ«åœ¨äºå‘æŒ¥ä½œç”¨çš„é˜¶æ®µ&lt;/p&gt;

&lt;p&gt;&lt;code&gt;expirationTime&lt;/code&gt;ä½œç”¨äºè°ƒåº¦é˜¶æ®µï¼Œä¸»è¦æŒ‡è´£æ˜¯ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å†³å®šæ˜¯å¼‚æ­¥æ‰§è¡Œæ¸²æŸ“è¿˜æ˜¯åŒæ­¥æ‰§è¡Œæ¸²æŸ“&lt;/li&gt;
&lt;li&gt;ä½œä¸º&lt;code&gt;react-scheduler&lt;/code&gt;çš„&lt;code&gt;timeout&lt;/code&gt;æ ‡å‡†ï¼Œå†³å®šæ˜¯å¦è¦ä¼˜å…ˆæ¸²æŸ“&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;nextExpirationTimeToWorkOn&lt;/code&gt;ä¸»è¦ä½œç”¨äºæ¸²æŸ“é˜¶æ®µï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å†³å®šé‚£äº›æ›´æ–°è¦åœ¨å½“å‰å‘¨æœŸä¸­è¢«æ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;é€šè¿‡è·Ÿæ¯ä¸ªèŠ‚ç‚¹çš„&lt;code&gt;expirationTime&lt;/code&gt;æ¯”è¾ƒå†³å®šè¯¥èŠ‚ç‚¹æ˜¯å¦å¯ä»¥ç›´æ¥&lt;code&gt;bailout&lt;/code&gt;ï¼ˆè·³è¿‡ï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä»–ä»¬éƒ½æ˜¯é€šè¿‡&lt;code&gt;pendingTime&lt;/code&gt;ã€&lt;code&gt;suspenededTime&lt;/code&gt;å’Œ&lt;code&gt;pingedTime&lt;/code&gt;ä¸­åˆ é€‰å‡ºæ¥çš„ï¼Œå”¯ä¸€çš„ä¸åŒæ˜¯ï¼Œ&lt;code&gt;nextExpirationTimeToWorkOn&lt;/code&gt;åœ¨æ²¡æœ‰&lt;code&gt;pending&lt;/code&gt;æˆ–è€…&lt;code&gt;pinged&lt;/code&gt;çš„ä»»åŠ¡çš„æ—¶å€™ä¼šé€‰æ‹©æœ€æ™šçš„&lt;code&gt;suspendedTime&lt;/code&gt;ï¼Œè€Œ&lt;code&gt;expirationTime&lt;/code&gt;ä¼šé€‰æ‹©æœ€æ—©çš„&lt;/p&gt;

&lt;p&gt;&lt;code&gt;expirationTime&lt;/code&gt;çš„å˜åŒ–ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åœ¨&lt;code&gt;scheduleWork&lt;/code&gt;çš„æ—¶å€™é€šè¿‡&lt;code&gt;markPendingExpirationTime&lt;/code&gt;è®¾ç½®&lt;/li&gt;
&lt;li&gt;åœ¨&lt;code&gt;beginWork&lt;/code&gt;çš„æ—¶å€™è¢«è®¾ç½®ä¸º&lt;code&gt;NoWork&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åœ¨&lt;code&gt;onUncaughtError&lt;/code&gt;çš„æ—¶å€™è®¾ç½®ä¸º&lt;code&gt;NoWork&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;onSuspend&lt;/code&gt;çš„æ—¶å€™åˆä¼šè®¾ç½®å›å½“æ¬¡æ›´æ–°çš„&lt;code&gt;expirationTime&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;8-schedulework&#34;&gt;8.scheduleWork&lt;/h2&gt;

&lt;p&gt;ä¸Šé¢è¯´çš„åœ¨åˆ›å»ºå®Œæ›´æ–°é˜Ÿåˆ—åï¼Œå°±ä¼šè°ƒç”¨&lt;code&gt;scheduleWork&lt;/code&gt;è°ƒåº¦äº†&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function scheduleWork(fiber: Fiber, expirationTime: ExpirationTime) {
  const root = scheduleWorkToRoot(fiber, expirationTime);
  if (root === null) {
    if (__DEV__) {
      switch (fiber.tag) {
        case ClassComponent:
          warnAboutUpdateOnUnmounted(fiber, true);
          break;
        case FunctionComponent:
        case ForwardRef:
        case MemoComponent:
        case SimpleMemoComponent:
          warnAboutUpdateOnUnmounted(fiber, false);
          break;
      }
    }
    return;
  }
	
  // æ­¤æ¡ä»¶çš„æ„æ€æ˜¯å½“å‰å¤„ç†ç©ºé—²é˜¶æ®µï¼Œæ²¡æœ‰renderæˆ–è€…commitï¼Œå¹¶ä¸”ä¸‹ä¸€æ¬¡ä»»åŠ¡ä¸ä¸ºç©ºï¼Œè¿˜æœ‰å½“å‰è¿‡æœŸæ—¶é—´(ä¼˜å…ˆçº§)é«˜äºä¸‹æ¬¡çš„è¿‡æœŸæ—¶é—´
  // åˆ™æ¸…ç©ºé˜Ÿåˆ—
  // ä¾‹å¦‚ä¸Šä¸€ä¸ªä»»åŠ¡æ˜¯å¼‚æ­¥ä»»åŠ¡ï¼ˆä¼˜å…ˆçº§å¾ˆä½ï¼Œè¶…æ—¶æ—¶é—´æ˜¯ 502msï¼‰ï¼Œå¹¶ä¸”åœ¨ä¸Šä¸€ä¸ªæ—¶é—´ç‰‡ï¼ˆåˆå§‹æ˜¯ 33msï¼‰ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œï¼Œè€Œä¸”ç­‰å¾…ä¸‹ä¸€æ¬¡requestIdleCallbackçš„æ—¶å€™æ–°çš„ä»»åŠ¡è¿›æ¥äº†ï¼Œå¹¶ä¸”è¶…æ—¶æ—¶é—´å¾ˆçŸ­ï¼ˆ52ms æˆ–è€… 22ms ç”šè‡³æ˜¯ Syncï¼‰ï¼Œé‚£ä¹ˆä¼˜å…ˆçº§å°±å˜æˆäº†å…ˆæ‰§è¡Œå½“å‰ä»»åŠ¡ï¼Œä¹Ÿå°±æ„å‘³ç€ä¸Šä¸€ä¸ªä»»åŠ¡è¢«æ‰“æ–­äº†ï¼ˆinterruptedï¼‰
  if (
    !isWorking &amp;amp;&amp;amp;
    nextRenderExpirationTime !== NoWork &amp;amp;&amp;amp;
    expirationTime &amp;gt; nextRenderExpirationTime
  ) {
    interruptedBy = fiber;
    resetStack();
  }
  // è®°å½•æ‰€æœ‰å­èŠ‚ç‚¹çš„ä»»åŠ¡æ—¶é—´åŒºé—´
  markPendingPriorityLevel(root, expirationTime);
  // è¦ä¹ˆå¤„äºæ²¡æœ‰ work çš„çŠ¶æ€ï¼Œè¦ä¹ˆåªèƒ½åœ¨ render é˜¶æ®µï¼Œè¦ä¹ˆæœ‰ä¸¤ä¸ªä¸åŒçš„root
  if (
    !isWorking ||
    isCommitting ||
    nextRoot !== root
  ) {
    const rootExpirationTime = root.expirationTime;
    requestWork(root, rootExpirationTime);
  }
  if (nestedUpdateCount &amp;gt; NESTED_UPDATE_LIMIT) {
    // Reset this back to zero so subsequent updates don&#39;t throw.
    nestedUpdateCount = 0;
    invariant(
      false,
      &#39;Maximum update depth exceeded. This can happen when a &#39; +
        &#39;component repeatedly calls setState inside &#39; +
        &#39;componentWillUpdate or componentDidUpdate. React limits &#39; +
        &#39;the number of nested updates to prevent infinite loops.&#39;,
    );
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é¦–å…ˆæ˜¯è°ƒç”¨&lt;code&gt;scheduleWorkToRoot&lt;/code&gt;ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä¸»è¦æ˜¯æ›´æ–°å½“å‰ä»»åŠ¡å¯¹åº”&lt;code&gt;Filber&lt;/code&gt;çš„åˆ°æœŸæ—¶é—´&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function scheduleWorkToRoot(fiber: Fiber, expirationTime): FiberRoot | null {
  recordScheduleUpdate();

  if (__DEV__) {
    if (fiber.tag === ClassComponent) {
      const instance = fiber.stateNode;
      warnAboutInvalidUpdates(instance);
    }
  }

  // å¦‚æœfilberä¸Šçš„è¿‡æœŸæ—¶é—´å°äºå½“å‰çš„è¿‡æœŸæ—¶é—´ï¼Œæ›´æ–°
  if (fiber.expirationTime &amp;lt; expirationTime) {
    fiber.expirationTime = expirationTime;
  }
  let alternate = fiber.alternate;
  if (alternate !== null &amp;amp;&amp;amp; alternate.expirationTime &amp;lt; expirationTime) {
    alternate.expirationTime = expirationTime;
  }
  // fiber.return è¿”å›å½“å‰fiberçš„çˆ¶èŠ‚ç‚¹
  let node = fiber.return;
  let root = null;
  if (node === null &amp;amp;&amp;amp; fiber.tag === HostRoot) {
    // å¦‚æœfilber.returnçš„å€¼ä¸ºnullï¼Œè®¾ç½®rootçš„å€¼ä¸ºæ ¹èŠ‚ç‚¹(fiber.stateNode)
    root = fiber.stateNode;
  } else {
    // å¾ªç¯å‘ä¸Šéå†ï¼Œæ›´æ–°æ¯ä¸ªå­èŠ‚ç‚¹çš„è¿‡æœŸæ—¶é—´
    // å¦‚æœå­èŠ‚ç‚¹çš„è¿‡æœŸæ—¶é—´å°äºå½“å‰è¿‡æœŸæ—¶é—´ï¼Œåˆ™æ›´æ–°
    while (node !== null) {
      alternate = node.alternate;
      if (node.childExpirationTime &amp;lt; expirationTime) {
        node.childExpirationTime = expirationTime;
        if (
          alternate !== null &amp;amp;&amp;amp;
          alternate.childExpirationTime &amp;lt; expirationTime
        ) {
          alternate.childExpirationTime = expirationTime;
        }
      } else if (
        alternate !== null &amp;amp;&amp;amp;
        alternate.childExpirationTime &amp;lt; expirationTime
      ) {
        alternate.childExpirationTime = expirationTime;
      }
      if (node.return === null &amp;amp;&amp;amp; node.tag === HostRoot) {
        root = node.stateNode;
        break;
      }
      node = node.return;
    }
  }
  ......
  return root;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;requestWork&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function requestWork(root: FiberRoot, expirationTime: ExpirationTime) {
  // å°†rootåŠ å…¥è°ƒåº¦é˜Ÿåˆ—ä¸­ï¼Œä¸ä¼šå­˜åœ¨ä¸¤ä¸ªç›¸åŒçš„ root å‰åå‡ºç°åœ¨é˜Ÿåˆ—ä¸­
  addRootToSchedule(root, expirationTime)
  if (isRendering) {
    return
  }

  if (isBatchingUpdates) {
    if (isUnbatchingUpdates) {
      nextFlushedRoot = root
      nextFlushedExpirationTime = Sync
      performWorkOnRoot(root, Sync, true)
    }
    return
  }

  // æ ¹æ®expirationTimeè°ƒç”¨performSyncWorkè¿˜æ˜¯scheduleCallbackWithExpirationTime

  if (expirationTime === Sync) {
    performSyncWork()
  } else {
    // å¼‚æ­¥è°ƒåº¦ï¼Œå¹¶ä¸”å½“å‰å·²ç»æœ‰å¼‚æ­¥ä»»åŠ¡ï¼Œå¦‚æœå½“å‰ä¼ å…¥çš„ä»»åŠ¡ä¼˜å…ˆçº§é«˜ï¼Œå–æ¶ˆä¹‹å‰çš„è°ƒåº¦ï¼Œå¼‚æ­¥è°ƒåº¦å½“å‰ä»»åŠ¡
    // æ— å¼‚æ­¥ä»»åŠ¡ï¼Œç”Ÿæˆä¸€ä¸ªåˆ°æœŸæ—¶é—´ï¼Œè°ƒåº¦
    scheduleCallbackWithExpirationTime(root, expirationTime)
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;9-performwork&#34;&gt;9.performWork&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;performAsyncWork&lt;/code&gt; ä¸ºå¼‚æ­¥è°ƒç”¨ï¼Œä¸€å¼€å§‹çš„&lt;code&gt;shouldYieldToRenderer&lt;/code&gt;ä»£è¡¨æ˜¯å¦å½“å‰è°ƒåº¦ä¸­æœ‰æ²¡æœ‰æ—¶é—´æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œè‹¥&lt;code&gt;shouldYieldToRenderer&lt;/code&gt;è¿”å›&lt;code&gt;false&lt;/code&gt;ï¼Œåˆ™ä»£è¡¨æœ‰ï¼Œé‚£ä¹ˆé‡æ–°è®¡ç®—å½“å‰çš„&lt;code&gt;expirationTime&lt;/code&gt;ï¼Œæ›´æ–°æ‰€æœ‰çš„å·²è¿‡æœŸçš„&lt;code&gt;root&lt;/code&gt;ä»»åŠ¡çš„&lt;code&gt;nextExpirationTimeToWorkOn&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;let didYield: boolean = false;
function shouldYieldToRenderer() {
  if (didYield) {
    return true;
  }
  if (shouldYield()) {
    didYield = true;
    return true;
  }
  return false;
}

function performAsyncWork() {
  try {
    if (!shouldYieldToRenderer()) {
      // å¦‚æœå½“å‰è¿˜æœ‰è°ƒåº¦çš„é“¾è¡¨
      if (firstScheduledRoot !== null) {
        // é‡æ–°è®¡ç®—å½“å‰çš„ä¸€ä¸ªexpirationTime
        recomputeCurrentRendererTime();
        let root: FiberRoot = firstScheduledRoot;
        do {
          // è®¾ç½®æ‰€æœ‰çš„å·²è¿‡æœŸçš„rootä»»åŠ¡çš„nextExpirationTimeToWorkOnä¸ºå½“å‰è®¡ç®—å‡ºçš„expirationTime
          didExpireAtExpirationTime(root, currentRendererTime);
          root = (root.nextScheduledRoot: any);
        } while (root !== firstScheduledRoot);
      }
    }
    performWork(NoWork, true);
  } finally {
    didYield = false;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;performSyncWork&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;åŒæ­¥è°ƒåº¦ä»»åŠ¡ï¼Œæ–¹æ³•å¾ˆç®€å•ï¼Œç›´æ¥è°ƒç”¨&lt;code&gt;performWork&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function performSyncWork() {
  performWork(Sync, false);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;performWork&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;æ­¤æ–¹æ³•ä¸ºçœŸæ­£çš„è°ƒåº¦æ–¹æ³•ï¼Œé¦–å…ˆä¼šè°ƒç”¨&lt;code&gt;findHighestPriorityRoot&lt;/code&gt;ï¼Œæ‰¾åˆ°å½“å‰é˜Ÿåˆ—ä¼˜å…ˆçº§æœ€é«˜çš„&lt;code&gt;root&lt;/code&gt;ä»»åŠ¡ï¼Œå‘½åä¸º&lt;code&gt;nextFlushedRoot&lt;/code&gt;ï¼Œå·²ç»å…¶å¯¹åº”çš„&lt;code&gt;expirationTime&lt;/code&gt;ï¼Œå‘½åä¸º&lt;code&gt;nextFlushedExpirationTime&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function performWork(minExpirationTime: ExpirationTime, isYieldy: boolean) {
  findHighestPriorityRoot();

  if (isYieldy) {
    recomputeCurrentRendererTime();
    currentSchedulerTime = currentRendererTime;
		
    if (enableUserTimingAPI) {
      const didExpire = nextFlushedExpirationTime &amp;gt; currentRendererTime;
      const timeout = expirationTimeToMs(nextFlushedExpirationTime);
      stopRequestCallbackTimer(didExpire, timeout);
    }

    while (
      nextFlushedRoot !== null &amp;amp;&amp;amp;
      nextFlushedExpirationTime !== NoWork &amp;amp;&amp;amp;
      minExpirationTime &amp;lt;= nextFlushedExpirationTime &amp;amp;&amp;amp;
      !(didYield &amp;amp;&amp;amp; currentRendererTime &amp;gt; nextFlushedExpirationTime)
    ) {
      performWorkOnRoot(
        nextFlushedRoot,
        nextFlushedExpirationTime,
        currentRendererTime &amp;gt; nextFlushedExpirationTime,
      );
      findHighestPriorityRoot();
      recomputeCurrentRendererTime();
      currentSchedulerTime = currentRendererTime;
    }
  } else {
    while (
      nextFlushedRoot !== null &amp;amp;&amp;amp;
      nextFlushedExpirationTime !== NoWork &amp;amp;&amp;amp;
      minExpirationTime &amp;lt;= nextFlushedExpirationTime
    ) {
      performWorkOnRoot(nextFlushedRoot, nextFlushedExpirationTime, false);
      findHighestPriorityRoot();
    }
  }
  if (isYieldy) {
    callbackExpirationTime = NoWork;
    callbackID = null;
  }
  if (nextFlushedExpirationTime !== NoWork) {
    scheduleCallbackWithExpirationTime(
      ((nextFlushedRoot: any): FiberRoot),
      nextFlushedExpirationTime,
    );
  }
  finishRendering();
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œä¸ç®¡åŒæ­¥å¼‚æ­¥ï¼Œéƒ½æœ‰&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;while(
 nextFlushedRoot !== null &amp;amp;&amp;amp;
 nextFlushedExpirationTime !== NoWork &amp;amp;&amp;amp;
 minExpirationTime &amp;lt;= nextFlushedExpirationTime
)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªå¾ªç¯è°ƒåº¦&lt;code&gt;root&lt;/code&gt;ä»»åŠ¡çš„è¿‡ç¨‹ï¼Œåˆ¤æ–­æ¡ä»¶ä¸ºè°ƒåº¦é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œå¹¶ä¸”å½“å‰ä¼ å…¥çš„ä»»åŠ¡ä¼˜å…ˆçº§å°äºä¼˜å…ˆçº§æœ€é«˜çš„ä»»åŠ¡ã€‚å¼‚æ­¥è°ƒç”¨æ—¶è¿˜æœ‰ä¸ªé¢å¤–çš„æ¡ä»¶&lt;code&gt;!(didYield &amp;amp;&amp;amp; currentRendererTime &amp;gt; nextFlushedExpirationTime)&lt;/code&gt;ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯å½“å‰ä¼ å…¥çš„å¼‚æ­¥ä»»åŠ¡æ²¡è¿‡æœŸï¼Œå¹¶ä¸”å½“å‰çš„æ¸²æŸ“æ—¶é—´ä¹Ÿæ²¡è¶…è¿‡ä¼˜å…ˆçº§æœ€é«˜çš„ä»»åŠ¡ã€‚ç„¶åè¿™ä¸ªå¾ªç¯å°±ä¼šåœ¨æ¯æ¬¡å¾ªç¯ä¸­è°ƒç”¨&lt;code&gt;performWorkOnRoot&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;10-performworkonroot&#34;&gt;10.performWorkOnRoot&lt;/h2&gt;

&lt;p&gt;è¿™é‡Œæ˜¯æ•´ä¸ªè°ƒåº¦è¿‡ç¨‹çš„æäº¤ã€renderè¿‡ç¨‹ã€‚ä¸åŒçš„æ˜¯ï¼Œåœ¨å¼‚æ­¥ä»»åŠ¡ä¸­æœ‰ä¸ªåˆ¤æ–­&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;if (!shouldYieldToRenderer()) {
  completeRoot(root, finishedWork, expirationTime);
} else {
  root.finishedWork = finishedWork;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ„æ€å°±æ˜¯è¯´å¦‚æœå½“å‰æ²¡æœ‰æ—¶é—´å¤„ç†å¼‚æ­¥ä»»åŠ¡ï¼Œç›´æ¥&lt;code&gt;completeRoot&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function performWorkOnRoot(
  root: FiberRoot,
  expirationTime: ExpirationTime,
  isYieldy: boolean,
) {
  invariant(
    !isRendering,
    &#39;performWorkOnRoot was called recursively. This error is likely caused &#39; +
      &#39;by a bug in React. Please file an issue.&#39;,
  );

  isRendering = true;

  if (!isYieldy) {

    let finishedWork = root.finishedWork;
    if (finishedWork !== null) {
      completeRoot(root, finishedWork, expirationTime);
    } else {
      root.finishedWork = null;
      const timeoutHandle = root.timeoutHandle;
      if (timeoutHandle !== noTimeout) {
        root.timeoutHandle = noTimeout;
        cancelTimeout(timeoutHandle);
      }
      renderRoot(root, isYieldy);
      finishedWork = root.finishedWork;
      if (finishedWork !== null) {
        completeRoot(root, finishedWork, expirationTime);
      }
    }
  } else {
    let finishedWork = root.finishedWork;
    if (finishedWork !== null) {
      completeRoot(root, finishedWork, expirationTime);
    } else {
      root.finishedWork = null;
      const timeoutHandle = root.timeoutHandle;
      if (timeoutHandle !== noTimeout) {
        root.timeoutHandle = noTimeout;
        cancelTimeout(timeoutHandle);
      }
      renderRoot(root, isYieldy);
      finishedWork = root.finishedWork;
      if (finishedWork !== null) {
        if (!shouldYieldToRenderer()) {
          completeRoot(root, finishedWork, expirationTime);
        } else {
          root.finishedWork = finishedWork;
        }
      }
    }
  }
  isRendering = false;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;11-renderroot&#34;&gt;11.renderRoot&lt;/h2&gt;

&lt;p&gt;è¿™ä¸ªåˆ¤æ–­çš„æ„æ€å°±æ˜¯å¦‚æœå½“å‰æ²¡æœ‰å…¶ä»–çš„ä»»åŠ¡ï¼Œé‚£ä¹ˆå°±è¿›è¡Œä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;if (
    expirationTime !== nextRenderExpirationTime ||
    root !== nextRoot ||
    nextUnitOfWork === null
  ) {
    resetStack();
    nextRoot = root;
    nextRenderExpirationTime = expirationTime;
    nextUnitOfWork = createWorkInProgress(
      nextRoot.current,
      null,
      nextRenderExpirationTime,
    );
		root.pendingCommitExpirationTime = NoWork;
		......
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åè°ƒç”¨&lt;code&gt;workLoop&lt;/code&gt;ï¼Œå¯¹äºå¼‚æ­¥ä»»åŠ¡ï¼Œä»è¦åˆ¤æ–­æ˜¯å¦æœ‰å‰©ä½™æ—¶é—´å¤„ç†æ­¤ä»»åŠ¡&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;  do {
    try {
      workLoop(isYieldy);
    } catch (thrownValue) {
      
    }
    break;
  } while (true);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function workLoop(isYieldy) {
  if (!isYieldy) {
    while (nextUnitOfWork !== null) {
      nextUnitOfWork = performUnitOfWork(nextUnitOfWork);
    }
  } else {
    while (nextUnitOfWork !== null &amp;amp;&amp;amp; !shouldYieldToRenderer()) {
      nextUnitOfWork = performUnitOfWork(nextUnitOfWork);
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœåœ¨è¿™è¿‡ç¨‹ä¸­ä¼šæœ‰æŠ¥é”™ï¼Œåˆ™åœæ­¢è°ƒåº¦ï¼Œä¼šåœ¨ä¸Šé¢çš„&lt;code&gt;catchä¸­&lt;/code&gt;å¤„ç†ï¼Œå¹¶ä¸”è®¾ç½®&lt;code&gt;finishedWork&lt;/code&gt;ä¸º&lt;code&gt;null&lt;/code&gt;ï¼Œä»è€Œç»“æŸè¿™ä¸€æ¬¡çš„&lt;code&gt;render&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;performUnitOfWork&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function performUnitOfWork(workInProgress: Fiber): Fiber | null {
  const current = workInProgress.alternate;

  startWorkTimer(workInProgress);
  let next;
  ......
  if (enableProfilerTimer) {
    if (workInProgress.mode &amp;amp; ProfileMode) {
      startProfilerTimer(workInProgress);
    }

    next = beginWork(current, workInProgress, nextRenderExpirationTime);
    workInProgress.memoizedProps = workInProgress.pendingProps;

    if (workInProgress.mode &amp;amp; ProfileMode) {
      stopProfilerTimerIfRunningAndRecordDelta(workInProgress, true);
    }
  } else {
    next = beginWork(current, workInProgress, nextRenderExpirationTime);
    workInProgress.memoizedProps = workInProgress.pendingProps;
  }
  if (next === null) {
    next = completeUnitOfWork(workInProgress);
  }
	
  ......
  ReactCurrentOwner.current = null;

  return next;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é¦–å…ˆæ‰§è¡Œ&lt;code&gt;next = beginWork(current, workInProgress, nextRenderExpirationTime)&lt;/code&gt;å¯¹èŠ‚ç‚¹è¿›è¡Œæ“ä½œï¼Œå…¶å†…éƒ¨ä¼šé’ˆå¯¹ä¸åŒç±»å‹çš„èŠ‚ç‚¹è¿›è¡Œåˆ›å»ºï¼Œè¿”å›çš„ç»“æœå³ä¼šèµ‹å€¼ç»™&lt;code&gt;next&lt;/code&gt;ï¼Œ&lt;code&gt;return next&lt;/code&gt;ã€‚ å¦‚æœ&lt;code&gt;next === null&lt;/code&gt;ï¼Œè¯´æ˜å­èŠ‚ç‚¹å·²ç»å¤„ç†å®Œï¼Œè°ƒç”¨&lt;code&gt;next = completeUnitOfWork(workInProgress)&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;completeUnitOfWork&lt;/code&gt;ä¼šä»ä¸‹å¾€ä¸Šéå†ï¼Œå¤„ç†&lt;code&gt;effact tag&lt;/code&gt;ï¼Œå¦‚æœåˆ°&lt;code&gt;root&lt;/code&gt;èŠ‚ç‚¹è¿”å›çš„æ˜¯&lt;code&gt;null&lt;/code&gt;ï¼Œä»£è¡¨æ•´æ£µæ ‘çš„éå†å·²ç»ç»“æŸäº†ï¼Œå¦‚æœæ‰¾åˆ°äº†å…¶ä»–å…„å¼ŸèŠ‚ç‚¹ï¼Œå°±è¿”å›è¿™ä¸ªèŠ‚ç‚¹ï¼Œé‡æ–°èµ°ä¸€é&lt;code&gt;workLoop&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;12-updateclasscomponent&#34;&gt;12.updateClassComponent&lt;/h2&gt;

&lt;p&gt;åœ¨&lt;code&gt;beginWork&lt;/code&gt;ä¸­ï¼Œä¼šé’ˆå¯¹ä¸åŒçš„èŠ‚ç‚¹ç±»å‹æ¥è°ƒç”¨ä¸åŒçš„æ–¹æ³•å¤„ç†ï¼Œè¿™é‡Œä»¥&lt;code&gt;ClassComponent&lt;/code&gt;ä¸ºä¾‹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function updateClassComponent(
  current: Fiber | null,
  workInProgress: Fiber,
  Component: any,
  nextProps,
  renderExpirationTime: ExpirationTime,
) {
	......
  // å¯¹contextè¿›è¡Œå¤„ç†
  let hasContext;
  // å¦‚æœå½“å‰ç»„ä»¶æ˜¯context provider
  // è®¾ç½®hasContextæ ‡è®°
  if (isLegacyContextProvider(Component)) {
    hasContext = true;
    pushLegacyContextProvider(workInProgress);
  } else {
    hasContext = false;
  }
  prepareToReadContext(workInProgress, renderExpirationTime);

  const instance = workInProgress.stateNode;
  let shouldUpdate;
  // å¦‚æœå®ä¾‹ä¸ºç©º
  if (instance === null) {
    if (current !== null) {
      current.alternate = null;
      workInProgress.alternate = null;
      workInProgress.effectTag |= Placement;
    }
    constructClassInstance(
      workInProgress,
      Component,
      nextProps,
      renderExpirationTime,
    );
    // æŒ‚è½½è¿™ä¸ªå®ä¾‹
    mountClassInstance(
      workInProgress,
      Component,
      nextProps,
      renderExpirationTime,
    );
    shouldUpdate = true;
  } else if (current === null) {
    // ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ï¼Œcurrentä¸ºnull
    // é‡æ–°æŒ‚è½½å®ä¾‹
    shouldUpdate = resumeMountClassInstance(
      workInProgress,
      Component,
      nextProps,
      renderExpirationTime,
    );
  } else {
    // æ›´æ–°ç±»ç»„ä»¶çš„æ—¶å€™
    // è°ƒç”¨updateClassInstance
    shouldUpdate = updateClassInstance(
      current,
      workInProgress,
      Component,
      nextProps,
      renderExpirationTime,
    );
  }
  ......
  // è°ƒç”¨finishClassComponent
  // å¦‚æœéœ€è¦æ›´æ–°ï¼Œè°ƒç”¨reconcileChildrenï¼Œè¿”å›æ›´æ–°åçš„workInProgress
  const nextUnitOfWork = finishClassComponent(
    current,
    workInProgress,
    Component,
    shouldUpdate,
    hasContext,
    renderExpirationTime,
  );
  return nextUnitOfWork;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;constructClassInstance&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function constructClassInstance(
  workInProgress: Fiber,
  ctor: any,
  props: any,
  renderExpirationTime: ExpirationTime,
): any {
  .......
  adoptClassInstance(workInProgress, instance);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;adoptClassInstance&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function adoptClassInstance(workInProgress: Fiber, instance: any): void {
  instance.updater = classComponentUpdater;
  workInProgress.stateNode = instance;
  setInstance(instance, workInProgress);
	......
}
  
const classComponentUpdater = {
  isMounted,
  enqueueSetState(inst, payload, callback) {
  },
  enqueueReplaceState(inst, payload, callback) {
  },
  enqueueForceUpdate(inst, callback) {
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;classComponentUpdater&lt;/code&gt;é‡Œé¢å‡ ä¸ªæ–¹æ³•ï¼Œå³å¯¹åº”ç€&lt;code&gt;setState&lt;/code&gt;ã€&lt;code&gt;replaceState&lt;/code&gt;ã€&lt;code&gt;forceUpdate&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;mountClassInstance&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-react&#34;&gt;function mountClassInstance(
  workInProgress: Fiber,
  ctor: any,
  newProps: any,
  renderExpirationTime: ExpirationTime,
): void {
  if (__DEV__) {
    checkClassInstance(workInProgress, ctor, newProps);
  }

  const instance = workInProgress.stateNode;
  // åˆå§‹åŒ– propsã€state ç­‰å®ä¾‹å±æ€§
  instance.props = newProps;
  instance.state = workInProgress.memoizedState;
  instance.refs = emptyRefsObject;

  const contextType = ctor.contextType;
  if (typeof contextType === &#39;object&#39; &amp;amp;&amp;amp; contextType !== null) {
    instance.context = readContext(contextType);
  } else {
    const unmaskedContext = getUnmaskedContext(workInProgress, ctor, true);
    instance.context = getMaskedContext(workInProgress, unmaskedContext);
  }
	.......
	// å¦‚æœæœ‰updateQueueå°±æ›´æ–°
  let updateQueue = workInProgress.updateQueue;
  if (updateQueue !== null) {
    processUpdateQueue(
      workInProgress,
      updateQueue,
      newProps,
      instance,
      renderExpirationTime,
    );
    instance.state = workInProgress.memoizedState;
  }
	
	// å¦‚æœå®šä¹‰äº†getDerivedStateFromPropså‘¨æœŸå‡½æ•°ï¼Œåˆ™è°ƒç”¨
  const getDerivedStateFromProps = ctor.getDerivedStateFromProps;
  if (typeof getDerivedStateFromProps === &#39;function&#39;) {
    applyDerivedStateFromProps(
      workInProgress,
      ctor,
      getDerivedStateFromProps,
      newProps,
    );
    instance.state = workInProgress.memoizedState;
  }

  if (
    typeof ctor.getDerivedStateFromProps !== &#39;function&#39; &amp;amp;&amp;amp;
    typeof instance.getSnapshotBeforeUpdate !== &#39;function&#39; &amp;amp;&amp;amp;
    (typeof instance.UNSAFE_componentWillMount === &#39;function&#39; ||
      typeof instance.componentWillMount === &#39;function&#39;)
  ) {
    callComponentWillMount(workInProgress, instance);
    updateQueue = workInProgress.updateQueue;
    if (updateQueue !== null) {
      processUpdateQueue(
        workInProgress,
        updateQueue,
        newProps,
        instance,
        renderExpirationTime,
      );
      instance.state = workInProgress.memoizedState;
    }
  }

  // åˆ¤æ–­æ˜¯å¦æœ‰componentDidMountï¼Œ
	// componentDidMountè¦åœ¨çœŸæ­£æ¸²æŸ“è¿›DOMä¹‹åæ‰è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯commitä¹‹å
  if (typeof instance.componentDidMount === &#39;function&#39;) {
    workInProgress.effectTag |= Update;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;13-commitroot&#34;&gt;13.commitRoot&lt;/h2&gt;

&lt;p&gt;è°ƒç”¨å®Œ&lt;code&gt;renderRoot&lt;/code&gt;ä¹‹åï¼Œ&lt;code&gt;fiber&lt;/code&gt;ä¸­å¯¹åº”çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ‰§è¡Œäº†&lt;code&gt;render&lt;/code&gt;ä¹‹å‰æ‰€æœ‰çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œå¹¶åˆ›å»ºäº†å¯¹åº”çš„DOMå…ƒç´ ï¼Œæ”¾åœ¨&lt;code&gt;workInProgress.stateNode&lt;/code&gt;ä¸­ã€‚ç„¶åè°ƒç”¨&lt;code&gt;commitRoot&lt;/code&gt;ï¼Œæäº¤å­æ ‘ä¸­ä¼˜å…ˆçº§æœ€é«˜çš„ä»»åŠ¡ï¼Œæ›´æ–°DOMå…ƒç´ çš„å±æ€§åï¼ŒæŒ‚è½½ç»„ä»¶ï¼Œè°ƒç”¨&lt;code&gt;componentDidMount&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&#34;å‚è€ƒé“¾æ¥&#34;&gt;å‚è€ƒé“¾æ¥&lt;/h4&gt;

&lt;p&gt;&lt;a href=&#34;https://react.jokcy.me/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;reactæºç è§£æ&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Flutterå„ç§è¸©å‘å¿ƒå¾—</title>
      <link>https://xtid.github.io/2020/flutter%E5%90%84%E7%A7%8D%E8%B8%A9%E5%9D%91%E5%BF%83%E5%BE%97/</link>
      <pubDate>Sat, 05 Dec 2020 16:06:56 +0800</pubDate>
      
      <guid>https://xtid.github.io/2020/flutter%E5%90%84%E7%A7%8D%E8%B8%A9%E5%9D%91%E5%BF%83%E5%BE%97/</guid>
      <description>

&lt;h2 id=&#34;1-å®‰å“å¼€å‘ç¯å¢ƒçš„åŸºæœ¬é…ç½®&#34;&gt;1.å®‰å“å¼€å‘ç¯å¢ƒçš„åŸºæœ¬é…ç½®&lt;/h2&gt;

&lt;p&gt;é¦–å…ˆä¿®æ”¹ä½ åˆ›å»ºçš„é¡¹ç›®ä¸­çš„&lt;code&gt;/android/build.gradle&lt;/code&gt;æ–‡ä»¶ï¼Œä¿®æ”¹&lt;code&gt;buildscript&lt;/code&gt;ä»¥åŠ&lt;code&gt;allprojects&lt;/code&gt;çš„ä»“åº“åœ°å€ï¼Œå¦åˆ™ç¼–è¯‘æ‰“åŒ…ä¼šå¡ä½ä¸åŠ¨ï¼Œå…¶æ¬¡å°±æ˜¯&lt;code&gt;package get&lt;/code&gt;ä¼šå¡ä½ï¼ŒåŸå› æ˜¯å› ä¸ºè¿æ¥ä¸ä¸Šè°·æ­Œçš„æœåŠ¡ï¼Œæœ‰ç‚¹è›‹ç–¼&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;buildscript {
    repositories {
        // google()
        // jcenter()
        maven { url &#39;https://maven.aliyun.com/repository/google&#39; }
        maven { url &#39;https://maven.aliyun.com/repository/jcenter&#39; }
        maven { url &#39;https://maven.aliyun.com/nexus/content/groups/public&#39; }
    }
}

allprojects {
    repositories {
        // google()
        // jcenter()
        maven { url &#39;https://maven.aliyun.com/repository/google&#39; }
        maven { url &#39;https://maven.aliyun.com/repository/jcenter&#39; }
        maven { url &#39;https://maven.aliyun.com/nexus/content/groups/public&#39; }
    }

&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;2-signlechildscrollviewé¡µé¢ä¸æ»¡ä¸€å±æ— æ³•æ’‘æ»¡å…¨å±&#34;&gt;2.SignleChildScrollViewé¡µé¢ä¸æ»¡ä¸€å±æ— æ³•æ’‘æ»¡å…¨å±&lt;/h2&gt;

&lt;p&gt;å¯ä»¥æ¢ä¸ªå¸ƒå±€ç»„ä»¶æˆ–è€…å°†å…¶è®¾ç½®ä¸º&lt;code&gt;Container&lt;/code&gt;å­ç»„ä»¶ï¼Œè®¾ç½®&lt;code&gt;alignment&lt;/code&gt;ï¼Œå¦‚ä¸‹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-dart&#34;&gt;Container(
  alignment: Alignment.topLeft,
  child: SingleChildScrollView(),
),
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;3-è‡ªå®šä¹‰appbar&#34;&gt;3.è‡ªå®šä¹‰AppBar&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;AppBar&lt;/code&gt;è¿™ä¸ªç»„ä»¶å¯æ‹“å±•æ€§è¿˜æ˜¯æ¯”è¾ƒä½çš„ï¼Œå°¤å…¶æ˜¯å®ƒçš„é«˜åº¦éƒ½æ˜¯å†™æ­»çš„ï¼Œè¿™ç§æƒ…å†µå¯ä»¥æ¢&lt;code&gt;SliverAppBar&lt;/code&gt;æˆ–è€…è‡ªå®šä¹‰&lt;code&gt;AppBar&lt;/code&gt;ï¼Œæ¢å¥è¯è¯´è‡ªå®šä¹‰ç»„ä»¶ï¼Œè¿™é‡Œå°±ä¸è¯¦è¯‰&lt;/p&gt;

&lt;h2 id=&#34;4-pushé¡µé¢è¿”å›-ä¿æŒä¸Šä¸€æ¬¡çš„é¡µé¢ä½ç½®çŠ¶æ€&#34;&gt;4.pushé¡µé¢è¿”å›ï¼Œä¿æŒä¸Šä¸€æ¬¡çš„é¡µé¢ä½ç½®çŠ¶æ€&lt;/h2&gt;

&lt;p&gt;ä½¿ç”¨ &lt;code&gt;StatefulWidget&lt;/code&gt; æ··å…¥ &lt;code&gt;AutomaticKeepAliveClientMixin&lt;/code&gt;ï¼Œè¦†ç›–&lt;code&gt;wantKeepAlive&lt;/code&gt;å±æ€§&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-dart&#34;&gt;class TesPage extends StatefulWidget {
  @override
  createState() =&amp;gt; TesPageState();
}

class TesPageState extends State&amp;lt;TesPage&amp;gt; with AutomaticKeepAliveClientMixin {
  
  @override
  bool get wantKeepAlive =&amp;gt; true;
}

&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;5-è·¯ç”±è·³è½¬æ–¹å¼çš„é€‰æ‹©&#34;&gt;5.è·¯ç”±è·³è½¬æ–¹å¼çš„é€‰æ‹©&lt;/h2&gt;

&lt;p&gt;é€šå¸¸è·¯ç”±è·³è½¬ä¼šç”¨åˆ°&lt;code&gt;Navigator.push&lt;/code&gt;æ¨å…¥è·¯ç”±æ ˆï¼Œ&lt;code&gt;Navigator.pop&lt;/code&gt;å°±ç§»å‡ºã€è¿”å›ä¸Šä¸€ä¸ªçš„çŠ¶æ€ã€‚å¦‚æœåœ¨é¡µé¢ä¸Šå…¨éƒ¨ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œä½ ä¼šå‘ç°ä½ çš„é¡µé¢é—´çš„è·³è½¬ä»¿ä½›ä¹±äº†ä¸€æ ·ï¼ŒåŸå› å°±æ˜¯&lt;code&gt;Navigator.push&lt;/code&gt;æ˜¯æ¯æ¬¡å°†ä½ çš„è·¯ç”±æ¨å…¥æ ˆï¼Œä¹Ÿå°±æ˜¯ä½ å¯ä»¥ä¸€ç›´åšè¿”å›æ“ä½œã€æ‰‹åŠ¿æ¥è·å–ä¹‹å‰çš„é¡µé¢çŠ¶æ€ã€‚è¿™ä¸ªæ—¶å€™å°±è¦è€ƒè™‘ç”¨å…¶ä»–æ–¹å¼ï¼Œå¦‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;pushAndRemoveUntil&lt;/code&gt;ï¼šè·³è½¬åˆ°æŒ‡å®šè·¯ç”±ï¼Œåˆ é™¤å…ˆå‰çš„è·¯ç”±æ ˆ
&lt;code&gt;pushNamed&lt;/code&gt;ï¼šè·³è½¬åˆ°æŒ‡å®šå‘½åè·¯ç”±ï¼Œè·¯ç”±æ ˆä¸ä¼šåˆ é™¤ã€‚è¿™ç§æ–¹å¼éœ€è¦é…åˆå‘½åè·¯ç”±ä½¿ç”¨ï¼Œå³åœ¨å…¥å£æ–‡ä»¶&lt;code&gt;MaterialApp&lt;/code&gt;é…ç½®å¥½&lt;code&gt;routes&lt;/code&gt;
&lt;code&gt;pushNamedAndRemoveUntil&lt;/code&gt;ï¼šè·³è½¬åˆ°æŒ‡å®šè·¯ç”±ï¼Œåˆ é™¤å…ˆå‰çš„è·¯ç”±æ ˆ
&lt;code&gt;pushReplacement&lt;/code&gt;ï¼šè·¯ç”±æ›¿æ¢
&lt;code&gt;pushReplacementNamed&lt;/code&gt;ï¼šè·³è½¬åˆ°æŒ‡å®šå‘½åè·¯ç”±ï¼Œå¹¶åˆ é™¤æœ€åçš„è·¯ç”±&lt;/p&gt;

&lt;h2 id=&#34;6-é¡µé¢åˆå§‹åŒ–æ—¶æ‹¿åˆ°context&#34;&gt;6.é¡µé¢åˆå§‹åŒ–æ—¶æ‹¿åˆ°context&lt;/h2&gt;

&lt;p&gt;æœ‰æ—¶å€™ï¼Œå¯èƒ½ä¼šåœ¨é¡µé¢åˆå§‹åŒ–ä½¿ç”¨&lt;code&gt;context&lt;/code&gt;ï¼Œæ¯”å¦‚è¯´è·¯ç”±ç›¸å…³çš„&lt;code&gt;Navigator.of(context)&lt;/code&gt;ã€‚è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼Œåœ¨&lt;code&gt;initState&lt;/code&gt;æ–¹æ³•ä¸­ï¼Œ&lt;code&gt;this&lt;/code&gt;æŒ‡å‘ä¸Šä¸‹æ–‡ï¼Œå³ä½¿ç”¨&lt;code&gt;this.context&lt;/code&gt;å³å¯ä»¥ä¿å­˜é¡µé¢åˆå§‹çš„&lt;code&gt;context&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;7-é”®ç›˜å¼¹å‡ºæ—¶å°†å¸ƒå±€æ‰“ä¹±-æˆ–è€…è¯´å°†å…ƒç´ é¡¶èµ·æ¥äº†&#34;&gt;7.é”®ç›˜å¼¹å‡ºæ—¶å°†å¸ƒå±€æ‰“ä¹±ï¼Œæˆ–è€…è¯´å°†å…ƒç´ é¡¶èµ·æ¥äº†&lt;/h2&gt;

&lt;p&gt;åœ¨ &lt;code&gt;Scafold&lt;/code&gt; é‡Œè®¾ç½® &lt;code&gt;resizeToAvoidBottomInset: false&lt;/code&gt;ï¼Œé”®ç›˜ä¼šé®ä½å¸ƒå±€ï¼Œè€Œä¸æ˜¯é¡¶èµ·å¸ƒå±€ã€‚&lt;/p&gt;

&lt;h2 id=&#34;8-æ— æ³•è®¾ç½®è™šçº¿è¾¹æ¡†&#34;&gt;8.æ— æ³•è®¾ç½®è™šçº¿è¾¹æ¡†&lt;/h2&gt;

&lt;p&gt;è¯´å®è¯å½“æ—¶å‘ç°&lt;code&gt;Flutter&lt;/code&gt;æ— æ³•è®¾ç½®è™šçº¿è¾¹æ¡†çš„æ—¶å€™æˆ‘æ˜¯å¾ˆéœ‡æƒŠçš„ï¼Œæˆ‘æ„Ÿè§‰è¿™ç®—æ˜¯åŸºæœ¬çš„ä¸èƒ½åœ¨åŸºæœ¬çš„å±æ€§äº†ï¼Œè§£å†³æ–¹æ³•ï¼Œå‚è€ƒå®˜æ–¹&lt;code&gt;issues&lt;/code&gt;ä¸­å¤§ä½¬çš„è§£æ³•ï¼Œç›®å‰åªèƒ½è‡ªå·±å®ç°&lt;code&gt;paint&lt;/code&gt;æ–¹æ³•ï¼Œè‡ªå·±ç”¨&lt;code&gt;Canvas&lt;/code&gt;ç”»&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-dart&#34;&gt;import &#39;package:flutter/material.dart&#39;;
import &#39;package:path_drawing/path_drawing.dart&#39;;

void main() =&amp;gt; runApp(MyApp());

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: &#39;Flutter Demo&#39;,
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: MyHomePage(title: &#39;Flutter Demo Home Page&#39;),
    );
  }
}

class MyHomePage extends StatefulWidget {
  MyHomePage({Key key, this.title}) : super(key: key);
  final String title;

  @override
  _MyHomePageState createState() =&amp;gt; _MyHomePageState();
}

class _MyHomePageState extends State&amp;lt;MyHomePage&amp;gt; {
  int _counter = 0;

  void _incrementCounter() {
    setState(() {
      _counter++;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(widget.title),
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: &amp;lt;Widget&amp;gt;[
            Container(
              decoration: BoxDecoration(
                border: DashPathBorder.all(
                  dashArray: CircularIntervalList&amp;lt;double&amp;gt;(&amp;lt;double&amp;gt;[5.0, 2.5]),
                ),
              ),
              padding: const EdgeInsets.all(20.0),
              child: const Text(&#39;You have pushed the button this many times:&#39;),
            ),
            Text(
              &#39;$_counter&#39;,
              style: Theme.of(context).textTheme.display1,
            ),
          ],
        ),
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: _incrementCounter,
        tooltip: &#39;Increment&#39;,
        child: Icon(Icons.add),
      ),
    );
  }
}

class DashPathBorder extends Border {
  DashPathBorder({
    @required this.dashArray,
    BorderSide top = BorderSide.none,
    BorderSide left = BorderSide.none,
    BorderSide right = BorderSide.none,
    BorderSide bottom = BorderSide.none,
  }) : super(
          top: top,
          left: left,
          right: right,
          bottom: bottom,
        );

  factory DashPathBorder.all({
    BorderSide borderSide = const BorderSide(),
    @required CircularIntervalList&amp;lt;double&amp;gt; dashArray,
  }) {
    return DashPathBorder(
      dashArray: dashArray,
      top: borderSide,
      right: borderSide,
      left: borderSide,
      bottom: borderSide,
    );
  }
  final CircularIntervalList&amp;lt;double&amp;gt; dashArray;

  @override
  void paint(
    Canvas canvas,
    Rect rect, {
    TextDirection textDirection,
    BoxShape shape = BoxShape.rectangle,
    BorderRadius borderRadius,
  }) {
    if (isUniform) {
      switch (top.style) {
        case BorderStyle.none:
          return;
        case BorderStyle.solid:
          switch (shape) {
            case BoxShape.circle:
              assert(borderRadius == null,
                  &#39;A borderRadius can only be given for rectangular boxes.&#39;);
              canvas.drawPath(
                dashPath(Path()..addOval(rect), dashArray: dashArray),
                top.toPaint(),
              );
              break;
            case BoxShape.rectangle:
              if (borderRadius != null) {
                final RRect rrect =
                    RRect.fromRectAndRadius(rect, borderRadius.topLeft);
                canvas.drawPath(
                  dashPath(Path()..addRRect(rrect), dashArray: dashArray),
                  top.toPaint(),
                );
                return;
              }
              canvas.drawPath(
                dashPath(Path()..addRect(rect), dashArray: dashArray),
                top.toPaint(),
              );

              break;
          }
          return;
      }
    }

    assert(borderRadius == null,
        &#39;A borderRadius can only be given for uniform borders.&#39;);
    assert(shape == BoxShape.rectangle,
        &#39;A border can only be drawn as a circle if it is uniform.&#39;);

    // TODO(dnfield): implement when borders are not uniform.
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;9-ä½¿ç”¨dioæ—¶-è®¾ç½®ç›¸åº”æ•°æ®çš„åª’ä½“ç±»å‹&#34;&gt;9.ä½¿ç”¨Dioæ—¶ï¼Œè®¾ç½®ç›¸åº”æ•°æ®çš„åª’ä½“ç±»å‹&lt;/h2&gt;

&lt;p&gt;ä½¿ç”¨&lt;code&gt;Dio&lt;/code&gt;å°è£…ç½‘ç»œè¯·æ±‚ï¼Œæ™®é€šçš„è¯·æ±‚æœ€å¥½è®¾ç½®ç›¸åº”ç±»å‹&lt;code&gt;dio.options.responseType = ResponseType.json&lt;/code&gt;ï¼Œå¦åˆ™å¯èƒ½æ¥æ”¶åˆ°çš„å“åº”å¯èƒ½æ˜¯å­—ç¬¦ä¸²ã€‚&lt;/p&gt;

&lt;h2 id=&#34;10-buildé…ç½®&#34;&gt;10.buildé…ç½®&lt;/h2&gt;

&lt;h3 id=&#34;1-å®‰å“çš„sha1ç è·å–æ–¹å¼&#34;&gt;1.å®‰å“çš„SHA1ç è·å–æ–¹å¼&lt;/h3&gt;

&lt;p&gt;å¾ˆå¤šç¬¬ä¸‰æ–¹åº”ç”¨éƒ½éœ€è¦ç”¨åˆ°å®‰å“çš„SHA1ç ï¼Œåœ¨&lt;code&gt;Flutter&lt;/code&gt;åº”ç”¨ä¸­ï¼Œé¦–å…ˆç”¨&lt;code&gt;Andriod Studio&lt;/code&gt;æ‰“å¼€é¡¹ç›®ï¼Œéšæ„é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶ï¼Œç‚¹å‡»å³ä¸Šè§’&lt;code&gt;Open for Editing in Android Studio&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2020/12/05/KrYUhiXpHu3cLBs.png&#34; alt=&#34;1.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æ‰“å¼€&lt;code&gt;Terminal&lt;/code&gt;ï¼Œè¾“å…¥&lt;code&gt;gradlew signingReport&lt;/code&gt;ï¼Œmacç¯å¢ƒéœ€è¦æŒ‡å®šå½“å‰ç›®å½•&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2020/12/05/BxEfHGOAtQcLSn7.png&#34; alt=&#34;2.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æœ€åæ§åˆ¶å°ä¼šæ‰“å°å‡ºåº”ç”¨çš„å„ç§ç­¾åä¿¡æ¯ï¼Œå¤åˆ¶&lt;code&gt;SHA1&lt;/code&gt;ç å³å¯&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2020/12/05/6cKCEUzuBRS5Ohw.jpg&#34; alt=&#34;3.jpg&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;2-å®‰å“æ‰“åŒ…-release-é…ç½®&#34;&gt;2.å®‰å“æ‰“åŒ…&lt;code&gt;release&lt;/code&gt;é…ç½®&lt;/h3&gt;

&lt;p&gt;é¦–å…ˆæ‰“å¼€&lt;code&gt;/android/build.gradle&lt;/code&gt;æ–‡ä»¶ï¼Œåœ¨&lt;code&gt;buildscript&lt;/code&gt;ä¸­æŒ‡å®š&lt;code&gt;kotlin_version&lt;/code&gt;ï¼Œå¦åˆ™&lt;code&gt;debug&lt;/code&gt;ã€&lt;code&gt;release&lt;/code&gt;ç¼–è¯‘ä¼šä¸é€šè¿‡&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;buildscript {
    ext.kotlin_version = &#39;1.3.50&#39;
    repositories {
        // google()
        // jcenter()
        maven { url &#39;https://maven.aliyun.com/repository/google&#39; }
        maven { url &#39;https://maven.aliyun.com/repository/jcenter&#39; }
        maven { url &#39;https://maven.aliyun.com/nexus/content/groups/public&#39; }
    }

    dependencies {
        classpath &#39;com.android.tools.build:gradle:3.5.0&#39;
        classpath &amp;quot;org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version&amp;quot;
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åç”Ÿæˆ&lt;code&gt;key&lt;/code&gt;ï¼ŒåŒæ ·æ‰“å¼€&lt;code&gt;Andriod Studio&lt;/code&gt;ï¼Œæ‰“å¼€&lt;code&gt;Terminal&lt;/code&gt;ï¼Œè¾“å…¥&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;keytool -genkey -v -keystore ~/key.jks -keyalg RSA -keysize 2048 -validity 10000 -alias key
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç”Ÿæˆè¿‡ç¨‹ä¸­ä¼šè®©ä½ è¾“å…¥å­˜å‚¨å¯†ç å’Œæ–‡ä»¶å¯†ç ï¼Œç”Ÿæˆå®Œ&lt;code&gt;key&lt;/code&gt;åè®°ä½æ–‡ä»¶åœ°å€&lt;/p&gt;

&lt;p&gt;ç„¶ååœ¨åœ¨&lt;code&gt;android&lt;/code&gt;ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶åä¸ºï¼š&lt;code&gt;key.properties&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2020/12/05/MuVAtUaI3TojQi6.jpg&#34; alt=&#34;05D6800C-27E4-4550-A7CD-88C691BC8202.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æ·»åŠ å†…å®¹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;storePassword = // å’Œç”Ÿæˆkeyè¾“å…¥çš„å­˜å‚¨å¯†ç ä¸€è‡´
keyPassword = // å’Œç”Ÿæˆkeyè¾“å…¥çš„å¯†ç ä¸€è‡´
keyAlias = key // 
storeFile = // keyæ–‡ä»¶çš„å­˜å‚¨è·¯å¾„
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰¾åˆ°&lt;code&gt;android/app/build.gradle&lt;/code&gt;æ–‡ä»¶ï¼Œæ·»åŠ ç­¾åé…ç½®&lt;code&gt;singingConfig&lt;/code&gt;ä»¥åŠæ‰“åŒ…é…ç½®&lt;code&gt;buildTypes&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;android {
		.....
    signingConfigs {
        release {
            keyAlias keystoreProperties[&#39;keyAlias&#39;]
            keyPassword keystoreProperties[&#39;keyPassword&#39;]
            storeFile file(keystoreProperties[&#39;storeFile&#39;])
            storePassword keystoreProperties[&#39;storePassword&#39;]
        }
    }

    buildTypes {
        release {
            signingConfig signingConfigs.release
            ndk {
                abiFilters &#39;armeabi-v7a&#39;,&#39;x86&#39; // æŒ‡å®šæ‰“åŒ…å¹³å°
            }
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åè¿›å…¥é¡¹ç›®æ ¹ç›®å½•ï¼Œæ‰§è¡Œ&lt;code&gt;flutter build apk&lt;/code&gt;ï¼Œå³å¯ä»¥æ‰“åŒ…ä¸€ä¸ªå®‰å“apkåŒ…&lt;/p&gt;

&lt;h3 id=&#34;3-iosè°ƒè¯•æ‰“åŒ…æ³¨æ„äº‹é¡¹&#34;&gt;3.iOSè°ƒè¯•æ‰“åŒ…æ³¨æ„äº‹é¡¹&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;iOS&lt;/code&gt;æ¨¡æ‹Ÿå™¨è°ƒè¯•ä½“éªŒæ¯”å®‰å“å¥½çš„å¤šï¼Œä½†æ˜¯çœŸæœºè°ƒè¯•ï¼Œé¦–å…ˆä½ å¾—æœ‰ä¸ªè‹¹æœIDï¼Œç„¶åç”¨&lt;code&gt;Xcode&lt;/code&gt;æ‰“å¼€é¡¹ç›®ï¼Œç‚¹å‡»&lt;code&gt;Signing &amp;amp; Capabilities&lt;/code&gt;ï¼Œæ‰¾åˆ°&lt;code&gt;Team&lt;/code&gt;è®¾ç½®ï¼Œè®¾ç½®ä¸€ä¸ªå¼€å‘è´¦å·ï¼Œå¯ä»¥æ˜¯æœªä»˜è´¹æ³¨å†Œçš„è‹¹æœIDï¼Œè®¾ç½®å¥½å¼€å‘è€…è¯ä¹¦&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2020/12/05/IM1z4KEkUxPFAvl.jpg&#34; alt=&#34;4.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ç„¶å&lt;code&gt;flutter run&lt;/code&gt;çš„æ—¶å€™ï¼Œé€‰æ‹©ä¸€ä¸ªçœŸæœºè®¾å¤‡ï¼Œå³å¯åœ¨çœŸæœºä¸Šè°ƒè¯•&lt;code&gt;app&lt;/code&gt;äº†ï¼Œä½†æ˜¯æœªä»˜è´¹æ³¨å†Œçš„è‹¹æœIDè¯ä¹¦æœ‰æ•ˆæœŸåªæœ‰ä¸ƒå¤©ï¼Œä¸ƒå¤©åä½ æ‰‹æœºä¸Šçš„&lt;code&gt;app&lt;/code&gt;å°±ä¸å¯ç”¨äº†ã€‚&lt;/p&gt;

&lt;p&gt;æœªä»˜è´¹æ³¨å†Œçš„è´¦å·ä¹Ÿæ— æ³•æ‰“åŒ…ä¸Šä¼ &lt;code&gt;App Store&lt;/code&gt;ï¼Œä¸è¿‡é…ç½®å®Œäº†å¼€å‘å›¢é˜Ÿã€è´¦å·åã€å¼€å‘è¯ä¹¦åï¼Œå¯ä»¥ç›´æ¥&lt;code&gt;flutter build ios&lt;/code&gt;ï¼Œè¿™æ ·ä¼šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ã€‚è¿™æ—¶å€™åˆ›å»ºä¸€ä¸ªåä¸º&lt;code&gt;Payload&lt;/code&gt;çš„æ–‡ä»¶å¤¹ï¼Œå°†æ‰“åŒ…ç”Ÿæˆçš„æ–‡ä»¶æ”¾è¿›å»ã€å‹ç¼©ï¼Œç„¶åå°†å‹ç¼©æ–‡ä»¶åç¼€æ”¹ä¸º&lt;code&gt;ipa&lt;/code&gt;ï¼Œå³å¯ä»¥ç”Ÿæˆä¸€ä¸ª&lt;code&gt;ipa&lt;/code&gt;æ–‡ä»¶äº†ã€‚ç„¶åå€ŸåŠ©ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œå¦‚&lt;code&gt;itunes(è²Œä¼¼å·²ç»ä¸èƒ½ç”¨)ã€xxxåŠ©æ‰‹&lt;/code&gt;å³å¯å°†è¿™ä¸ªæ–‡ä»¶å®‰è£…åœ¨ç»ˆç«¯ä¸Šè¿è¡Œã€‚&lt;/p&gt;

&lt;h2 id=&#34;11-æ€»ç»“&#34;&gt;11.æ€»ç»“&lt;/h2&gt;

&lt;p&gt;æ–­æ–­ç»­ç»­åšè¿™ä¸ªå°é¡¹ç›®å·²ç»æœ‰å‡ ä¸ªæœˆäº†ï¼Œå› ä¸ºå¹³å¸¸å¾ˆå¿™ï¼Œæ‰€ä»¥æ‹–äº†è¿™ä¹ˆä¹…ã€‚&lt;code&gt;Flutter&lt;/code&gt;ç»™æˆ‘çš„æ„Ÿè§‰ä¼˜ç‚¹å°±æ˜¯æµç¨‹ã€åŠ¨ç”»è¾ƒä¸ºç»†è…»ï¼Œç›¸å¯¹äºå…¶å®ƒè·¨å¹³å°æ–¹æ¡ˆï¼Œä½¿ç”¨&lt;code&gt;JsBrigde&lt;/code&gt;ä¸&lt;code&gt;native&lt;/code&gt;ç«¯é€šä¿¡ï¼Œæœ‰è¾ƒå¤§çš„ä¼˜åŠ¿ï¼Œæ¯•ç«Ÿå®ƒæ˜¯è‡ªå·±çš„å¼•æ“ç»˜åˆ¶çš„é¡µé¢ã€‚ä½†æ˜¯å®ƒçš„å®˜æ–¹ç»„ä»¶å¤ªå°‘ï¼Œè‡ªå®šä¹‰ç»„ä»¶æ‰€éœ€ç²¾åŠ›è¾ƒå¤š(å¯èƒ½æ˜¯æˆ‘ä¸ç†Ÿæ‚‰)ï¼Œ&lt;code&gt;iOS&lt;/code&gt;é£æ ¼ç»„ä»¶è™½ç„¶æ ·å¼å’ŒåŸç”Ÿçš„å·®ä¸å¤šï¼Œä½†å…·ä½“æ•ˆæœè¿˜æ˜¯æœ‰å·®è·ã€‚è¿™ç§è·¨å¹³å°æ¡†æ¶ç»ˆäºè¿˜æ˜¯å¾—è¦å’ŒåŸç”Ÿå¼€å‘äººå‘˜ä¸€èµ·æ“ä½œæ‰ç©çš„æºœã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Flutterè‡ªå®šä¹‰ç»„ä»¶</title>
      <link>https://xtid.github.io/2020/flutter%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/</link>
      <pubDate>Sat, 28 Nov 2020 16:23:05 +0800</pubDate>
      
      <guid>https://xtid.github.io/2020/flutter%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6/</guid>
      <description>

&lt;h3 id=&#34;ç®€è¨€&#34;&gt;ç®€è¨€&lt;/h3&gt;

&lt;p&gt;åœ¨ä½¿ç”¨&lt;code&gt;Flutter&lt;/code&gt;å¼€å‘appçš„æ—¶å€™ï¼Œæ˜¯ä½¿ç”¨å„ç§å„æ ·çš„&lt;code&gt;Widget&lt;/code&gt; ç»„åˆç»˜åˆ¶å‡ºçš„é¡µé¢ï¼Œä¸€äº›æœ€åŸºç¡€çš„å¦‚&lt;code&gt;Container&lt;/code&gt;ã€&lt;code&gt;Padding&lt;/code&gt;ã€&lt;code&gt;Text&lt;/code&gt; ç­‰ç­‰ï¼Œç”±å®˜æ–¹å°è£…å¥½çš„æ¯”è¾ƒå¤æ‚çš„ç»„ä»¶å¦‚&lt;code&gt;AppBar&lt;/code&gt;ã€&lt;code&gt;æ—¥å†é€‰æ‹©å™¨&lt;/code&gt;ç­‰ç­‰ã€‚ä»…ä»…ä½¿ç”¨è¿™äº›ç»„ä»¶ä¹Ÿç¡®å®èƒ½å†™å‡ºä¸€äº›appï¼Œä½†æ˜¯å®˜æ–¹å°è£…å¥½çš„æ‹“å±•æ€§æˆ‘è§‰å¾—ä¸å¤ªå¥½ï¼Œæœ‰äº›å±æ€§æ ¹æœ¬æ— æ³•æ”¹å˜ï¼›å¦å¤–ä¸€æ—¦å’Œè®¾è®¡ç¨¿å‡ºå…¥æ¯”è¾ƒå¤§ï¼Œé‚£æ ¹ä¸å°±ç©ä¸äº†äº†ï¼Œæ‰€ä»¥è¿™å°±æ¶‰åŠåˆ°è‡ªå®šä¹‰ç»„ä»¶ã€‚&lt;code&gt;Flutter&lt;/code&gt;è‡ªå®šä¹‰ç»„ä»¶çš„æ–¹å¼æˆ‘äº†è§£åˆ°æœ‰ä¸‰ç§ï¼Œä¸€æ˜¯é€šè¿‡ç»„åˆå…¶å®ƒç»„ä»¶æ¥è¾¾åˆ°ä½ æƒ³è¦çš„æ•ˆæœï¼›äºŒæ˜¯è‡ªç»˜ï¼Œè¿™å—ç‰µæ‰¯åˆ°&lt;code&gt;Canvas&lt;/code&gt;ï¼›ä¸‰æ˜¯å®ç°&lt;code&gt;RenderObject&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;h4 id=&#34;1-åŸç†åŸºæœ¬ä»‹ç»&#34;&gt;1.åŸç†åŸºæœ¬ä»‹ç»&lt;/h4&gt;

&lt;p&gt;&lt;code&gt;Flutter&lt;/code&gt;å¼•æ“ä¼šå°†æˆ‘ä»¬æ‰€å†™ç»„ä»¶ç”Ÿæˆä¸€ä¸ª&lt;code&gt;Widget Tree&lt;/code&gt;ï¼Œè€Œå®é™…æ¸²æŸ“å‡ºæ¥çš„ç»“æœåˆæœ‰ä¸€ä¸ª&lt;code&gt;RenderObject Tree&lt;/code&gt;ï¼Œ&lt;code&gt;RenderObject&lt;/code&gt;æ˜¯ç»§æ‰¿&lt;code&gt;Widget&lt;/code&gt;çš„ã€‚åœ¨é¡¹ç›®è¿è¡Œä¸­&lt;code&gt;Widget Tree&lt;/code&gt;æ˜¯ä¸æ–­å˜åŒ–çš„ï¼Œå¦‚æœæ¯æ¬¡å˜åŒ–éƒ½è¦å¯¼è‡´æ•´ä¸ª&lt;code&gt;RenderObject Tree&lt;/code&gt;å˜åŒ–ï¼Œè¿™å¯¹æ€§èƒ½æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ¶ˆè€—ï¼Œäºæ˜¯å°±æœ‰äº†ä¸€ä¸ª&lt;code&gt;Element Trre&lt;/code&gt;ï¼Œè¿™å°±ç›¸å½“äºä¸€ä¸ªä¸­é—´å±‚ï¼Œç”±&lt;code&gt;Widget&lt;/code&gt;â†’&lt;code&gt;Elment&lt;/code&gt;â†’&lt;code&gt;RenderObject&lt;/code&gt;ã€‚æ¯æ¬¡&lt;code&gt;Widget&lt;/code&gt;å˜åŒ–æ—¶ï¼Œä¸&lt;code&gt;Element&lt;/code&gt;åšå¯¹æ¯”ï¼Œæ‰¾å‡ºæœ€å°æœ€ä¼˜çš„å˜åŒ–ï¼Œä½œç”¨äº&lt;code&gt;RenderObject&lt;/code&gt;ã€‚æˆ‘ä»¬åˆ›å»ºçš„&lt;code&gt;Widget&lt;/code&gt;åŸºæœ¬ç»§æ‰¿äº&lt;code&gt;StatelessWidget&lt;/code&gt;ã€&lt;code&gt;StatefulWidget&lt;/code&gt;ï¼Œä»–ä»¬ä»…è´Ÿè´£å±æ€§ã€ç”Ÿå‘½å‘¨æœŸç­‰çš„ç®¡ç†ï¼Œæœ€ç»ˆä¹Ÿè¿˜æ˜¯ä¼šç»§æ‰¿äº&lt;code&gt;RenderObjectWidget&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;RenderObjectWidget&lt;/code&gt;ä¸‹é¢åˆæœ‰ä¸‰ä¸ªå­ç±»&lt;/p&gt;

&lt;p&gt;&lt;code&gt;SngleChildRenderObjectWidget&lt;/code&gt;ï¼š&lt;code&gt;RenderObject&lt;/code&gt;åªæœ‰ä¸€ä¸ª &lt;code&gt;child&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;MultiChildRenderObjectWidget&lt;/code&gt;ï¼šå¯ä»¥æœ‰å¤šä¸ª &lt;code&gt;child&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;LeafRenderObjectWidget&lt;/code&gt; ï¼š&lt;code&gt;RenderObject&lt;/code&gt;æ˜¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼Œæ²¡æœ‰&lt;code&gt;child&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;å®˜æ–¹æ‰€æä¾›çš„ç»„ä»¶å¾ˆå¤šéƒ½æ˜¯ç»§æ‰¿&lt;code&gt;singleChildRenderObjectWidget&lt;/code&gt;ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸åªèƒ½ä¼ ä¸€ä¸ª&lt;code&gt;child&lt;/code&gt;ï¼Œæ‰¾åˆ°&lt;code&gt;singleChildRenderObjectWidget&lt;/code&gt;å®šä¹‰&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-dart&#34;&gt;abstract class SingleChildRenderObjectWidget extends RenderObjectWidget {
  const SingleChildRenderObjectWidget({ Key key, this.child }) : super(key: key);
  final Widget child;

  @override
  SingleChildRenderObjectElement createElement() =&amp;gt; SingleChildRenderObjectElement(this);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°æ¯æ¬¡åˆ›å»ºä¸€ä¸ª&lt;code&gt;SingleChildRenderObjectWidget&lt;/code&gt;å°±ä¼šè°ƒç”¨`&lt;code&gt;CreateElement&lt;/code&gt;ç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„&lt;code&gt;Elment&lt;/code&gt;ï¼Œå½“ç„¶&lt;code&gt;MultiChildRenderObjectWidget&lt;/code&gt;ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œè¿™ä¹Ÿå°±è¯´æ˜äº†ä»–ä»¬ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚æ‰€ä»¥æˆ‘ä»¬å®ç°è‡ªå®šä¹‰ç»„ä»¶å¿…é¡»å¾—ç»§æ‰¿&lt;code&gt;SingleChildRenderObjectWidget&lt;/code&gt;æˆ–è€…&lt;code&gt;MultiChildRenderObjectWidget&lt;/code&gt;æˆ–è€…è°ƒç”¨å®˜æ–¹å®ç°å¥½çš„è‡ªç»˜ç±»ï¼Œè¿™ä¹Ÿæ˜¯&lt;code&gt;Flutter&lt;/code&gt;å¼•æ“æ¸²æŸ“çš„åŸºæœ¬ç»“æ„ã€‚&lt;/p&gt;

&lt;h4 id=&#34;2-ç»„åˆå…¶å®ƒç»„ä»¶&#34;&gt;2..ç»„åˆå…¶å®ƒç»„ä»¶&lt;/h4&gt;

&lt;p&gt;è¿™ç§æ–¹å¼æ˜¯æœ€åŸºæœ¬æœ€ç®€å•çš„æ–¹å¼ï¼Œè¯´ç™½äº†å°±æ˜¯å°†ä¸€äº›åŸæœ‰çš„ã€å°è£…å¥½çš„ç»„ä»¶åˆå¹¶å†å°è£…ä¸€æ¬¡ã€‚&lt;code&gt;Flutter&lt;/code&gt;æœ¬èº«å°±æœ‰å¾ˆå¤šç»„åˆç»„ä»¶ï¼Œæ¯”å¦‚å¸¸ç”¨çš„&lt;code&gt;Container&lt;/code&gt;ï¼ŒæŸ¥çœ‹å®ƒçš„æºç å°±çŸ¥é“ï¼Œå®ƒæ˜¯ç”±&lt;code&gt;DecoratedBox&lt;/code&gt;ã€&lt;code&gt;ConstrainedBox&lt;/code&gt;ã€&lt;code&gt;Transform&lt;/code&gt;ã€&lt;code&gt;Padding&lt;/code&gt;ã€&lt;code&gt;Align&lt;/code&gt;ç­‰ç»„ä»¶ç»„æˆï¼Œå…¶å†…éƒ¨åšäº†å¾ˆå¤šåˆ¤æ–­å¤„ç†ã€‚è¿™é‡Œå®ç°ä¸€ä¸ªè‡ªå®šä¹‰å®½åº¦çš„&lt;code&gt;drawer&lt;/code&gt;ç»„ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªç±»&lt;code&gt;SmartDrawer&lt;/code&gt;ç»§æ‰¿&lt;code&gt;StatelessWidget&lt;/code&gt;ï¼Œå¹¶å®ç°å…¶å…·ä½“æ–¹æ³•&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-dart&#34;&gt;class SmartDrawer extends StatelessWidget {
  final double elevation;
  final Widget child;
  final String semanticLabel;
  final double widthPercent;
  const SmartDrawer({
    Key key,
    this.elevation = 16.0,
    this.child,
    this.semanticLabel,
    this.widthPercent = 0.7,
  }) : 
   assert(widthPercent != null &amp;amp;&amp;amp; widthPercent &amp;lt; 1.0 &amp;amp;&amp;amp; widthPercent&amp;gt; 0.0)
   ,super(key: key);

  @override
  Widget build(BuildContext context) {
    assert(debugCheckHasMaterialLocalizations(context));
    String label = semanticLabel;
    final double _width = MediaQuery.of(context).size.width * widthPercent;
    
    return Semantics(
      scopesRoute: true,
      namesRoute: true,
      explicitChildNodes: true,
      label: label,
      child: ConstrainedBox(
        constraints: BoxConstraints.expand(width: _width),
        child: Material(
          elevation: elevation,
          child: child,
        ),
      ),
    );
  }
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œä¸Šè¿°ç»„ä»¶å°±æ˜¯å°†&lt;code&gt;ConstrainedBox&lt;/code&gt;ä»¥åŠä¼ å…¥çš„&lt;code&gt;child&lt;/code&gt;ç»„åˆæˆä¸€ä¸ªæ–°çš„ç»„ä»¶ï¼Œå…¶ä»–å±æ€§åˆ™æ˜¯æ¥æ§åˆ¶æ ·å¼çš„ã€‚è¿™é‡Œéœ€è¦ç‰¹åˆ«è¯´æ˜çš„ï¼Œæœ€åè¿”å›çš„&lt;code&gt;Semantics&lt;/code&gt;ï¼Œå®ƒç»§æ‰¿&lt;code&gt;SingleChildRenderObjectWidget&lt;/code&gt;ï¼Œå®ƒä¸Šé¢å®šä¹‰çš„å±æ€§æœ‰ç‚¹å¸¦æœ‰è¯­ä¹‰åŒ–çš„æ„æ€ï¼Œè€Œå®ƒä¸Šé¢å®šä¹‰çš„&lt;code&gt;child&lt;/code&gt;å±æ€§åˆ™æ˜¯è¿”å›çš„ç»„ä»¶ï¼Œè¿™æ ·&lt;code&gt;return Semantices{}&lt;/code&gt;å®é™…å°±è¡¨ç¤ºè¿”å›äº†å¸¦æœ‰ä¸€äº›è¯­ä¹‰çš„ç»„ä»¶ã€‚&lt;/p&gt;

&lt;h4 id=&#34;4-è‡ªç»˜ç»„ä»¶&#34;&gt;4.è‡ªç»˜ç»„ä»¶&lt;/h4&gt;

&lt;p&gt;&lt;code&gt;Flutter&lt;/code&gt;è·¨å¹³å°çš„å®ç°æ–¹å¼å°±æ˜¯åœ¨ä¸åŒæ“ä½œç³»ç»Ÿçš„ä¸Šå±‚ç»˜åˆ¶ä¸€ä¸ªä¸­é—´çš„UIç³»ç»Ÿï¼Œå¯¹ä¸åŒçš„æ“ä½œç³»ç»Ÿçš„&lt;code&gt;API&lt;/code&gt;è¿›è¡Œé€‚é…ï¼Œé£æ ¼ç»Ÿä¸€ï¼Œè¿™æ ·å°±èƒ½å®ç°ä¸€ä¸ªè·¨å¹³å°åº”ç”¨äº†ï¼Œè¿™ä¹Ÿæ˜¯å’Œ&lt;code&gt;React Native&lt;/code&gt;çš„æœ€å¤§çš„å·®å¼‚ä»¥åŠä¼˜äº&lt;code&gt;React Native&lt;/code&gt;çš„åœ°æ–¹ã€‚å½“ä½ æ— æ³•ç”¨ç°æœ‰çš„ç»„ä»¶æ¥æç»˜ä½ æ‰€éœ€è¦UIæ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨è‡ªç»˜ç»„ä»¶æ¥å®ç°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªè‡ªç»˜çš„éªŒè¯ç ç»„ä»¶ç¤ºä¾‹&lt;/p&gt;

&lt;p&gt;é¦–å…ˆåˆ›å»ºä¸€ä¸ªåä¸º&lt;code&gt;CodeReview&lt;/code&gt;çš„&lt;code&gt;StatefulWidget&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-dart&#34;&gt;class CodeReview extends StatefulWidget {

  final String text;
  final callback;

  CodeReview({Key key, this.text, this.callback}) : super(key: key);

  _CodeReviewState createState() =&amp;gt; _CodeReviewState();

}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åå®ç°å…·ä½“ä»£ç &lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-dart&#34;&gt;class _CodeReviewState extends State&amp;lt;CodeReview&amp;gt; {
	
  // å­˜æ”¾æ¯ä¸ªéªŒè¯ç å­—ç¬¦ä¸Šçš„æ¨ªçº¿çš„ä½ç½®
  List&amp;lt;Offset&amp;gt; _lineOffsets = &amp;lt;Offset&amp;gt;[];

  // éªŒè¯ç çš„é•¿åº¦ï¼Œç”±å¤–éƒ¨ä¼ å…¥
  int _textLength;
  // éªŒè¯ç å®½åº¦
  double _width;
  // éªŒè¯ç é«˜åº¦
  double _height;

  // ç”ŸæˆéªŒè¯ç ä¸Šçš„æ¨ªçº¿é®æŒ¡ç‰©çš„ä½ç½®
  void _randLines() {
    _lineOffsets.clear();
    for (var i = 0; i &amp;lt; _textLength; i++) {
      double fromX = randomBetween(10, 20).toDouble();
      double fromY = randomBetween(3, 33).toDouble();
      Offset from = Offset(fromX, fromY);
      _lineOffsets.add(from);

      double endX = randomBetween(60, _width.toInt() - 10).toDouble();
      double endY = randomBetween(3, 33).toDouble();
      Offset end = Offset(endX, endY);
      _lineOffsets.add(end);
    }
  }

  @override
  void initState() {
    super.initState();
    _textLength = widget.text.length ?? 4;
    _width = _textLength.toDouble() * 22;
    _height = 36;
    _randLines();
  }

  void _changeCode() {
    setState(() {
      _randLines();
    });
  }
	
  // å¯¹æ¯ä¸ªå­—ç¬¦è¿›è¡Œéšæœºrotateæ“ä½œ
  Container _subString(index) {
    return Container(
      padding: EdgeInsets.only(left: 2, right: 2, top: randomBetween(0, 14).toDouble()),
      child: Transform.rotate(
        angle: pi / randomBetween(3, 30) * randomBetween(0, 1),
        child: Text(widget.text[index], style: TextStyle(fontSize: randomBetween(20, 22).toDouble(), color: Color(0xFF4abdcc))),
      ),
    );
  }
	
 	// æç»˜éªŒè¯ç ä¸Šæ¨ªçº¿é®æŒ¡ç‰©
  Container _backLines() {
    return Container(
      width: _width,
      height: _height,
      child: CustomPaint(
        painter: CodePaint(_lineOffsets, Tool.randomColor()),
        foregroundPainter: CodePaint(_lineOffsets, Tool.randomColor()),
      ),
    );
  }

  @override
  Widget build(BuildContext context) {
    return Container(
      width: _width,
      height: _height,
      color: Colors.grey[200],
      child: Stack(
        alignment: Alignment.center,
        children: &amp;lt;Widget&amp;gt;[
          _backLines(),
          _backLines(),
          GestureDetector(
            behavior: HitTestBehavior.opaque,
            onTap: () {
              _changeCode();
              widget.callback();
            },
            child: Container(
              width: _width,
              height: _height,
              child: Row(
                mainAxisAlignment: MainAxisAlignment.center,
                children: List.generate(_textLength, (int index) {
                  return _subString(index);
                }),
              ),
            ),
          ),
        ],
      ),
    );
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°ä¸Šé¢ç”¨åˆ°äº†&lt;code&gt;CustomPaint&lt;/code&gt;ï¼Œè¿™ä¸ªç±»ç»§æ‰¿&lt;code&gt;SingleChildRenderObjectWidget&lt;/code&gt;ï¼Œè¿™è®©æˆ‘ä»¬ç›´æ¥èƒ½ä½¿ç”¨&lt;code&gt;Canvas&lt;/code&gt;æ¥ç»˜åˆ¶ä½ æ‰€éœ€è¦çš„UI&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-dart&#34;&gt;class CustomPaint extends SingleChildRenderObjectWidget {
  /// Creates a widget that delegates its painting.
  const CustomPaint({
    Key key,
    this.painter,
    this.foregroundPainter,
    this.size = Size.zero,
    this.isComplex = false,
    this.willChange = false,
    Widget child,
  })......
    ......
    ......
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¼ å…¥&lt;code&gt;painter&lt;/code&gt; ã€&lt;code&gt;foregroundPainter&lt;/code&gt;å¯¹åº”ç±»ï¼Œåœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæ˜¯åˆ›å»ºä¸€ä¸ªç±»çš„&lt;code&gt;CodePaint&lt;/code&gt;ç»§æ‰¿&lt;code&gt;CustomPainer&lt;/code&gt;ï¼Œé‡å†™&lt;code&gt;paint&lt;/code&gt;æ–¹æ³•ï¼Œç„¶åè®¾ç½®ç”»ç¬”çš„å±æ€§ï¼Œæœ€åè°ƒç”¨å¯¹åº”çš„&lt;code&gt;Canvas&lt;/code&gt;apiå³å¯ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯&lt;code&gt;drawPoints&lt;/code&gt;ï¼Œè¿˜æœ‰å…¶ä»–çš„ï¼Œå¦‚&lt;code&gt;drawCircle&lt;/code&gt;ã€&lt;code&gt;drawLine&lt;/code&gt;ç­‰ç­‰ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-dart&#34;&gt;class CodePaint extends CustomPainter {
  final List&amp;lt;Offset&amp;gt; lineOffsets;
  final Color ranColor;
  CodePaint(this.lineOffsets, this.ranColor);

  @override
  void paint(Canvas canvas, Size size) {
    // debugPrint(canvas.runtimeType.toString());
    canvas.save();
    Paint _paint = Paint()
      ..color = ranColor // ç”»ç¬”é¢œè‰²
      ..strokeCap = StrokeCap.round // ç”»ç¬”ç¬”è§¦ç±»å‹
      ..isAntiAlias = true // æ˜¯å¦å¯åŠ¨æŠ—é”¯é½¿
      ..blendMode = BlendMode.exclusion // é¢œè‰²æ··åˆæ¨¡å¼
      ..style = PaintingStyle.fill // ç»˜ç”»é£æ ¼ï¼Œé»˜è®¤ä¸ºå¡«å……
      ..colorFilter = ColorFilter.mode(ranColor, BlendMode.exclusion) // é¢œè‰²æ¸²æŸ“æ¨¡å¼ï¼Œä¸€èˆ¬æ˜¯çŸ©é˜µæ•ˆæœæ¥æ”¹å˜çš„,ä½†æ˜¯flutterä¸­åªèƒ½ä½¿ç”¨é¢œè‰²æ··åˆæ¨¡å¼
      ..maskFilter = MaskFilter.blur(BlurStyle.inner, 1.0) // æ¨¡ç³Šé®ç½©æ•ˆæœ
      ..filterQuality = FilterQuality.high // é¢œè‰²æ¸²æŸ“æ¨¡å¼çš„è´¨é‡
      // ..strokeWidth = randomBetween(1, 3).toDouble(); // æš‚æ—¶å›ºå®š
      ..strokeWidth = 1;

    final pointMode = PointMode.lines;
    canvas.drawPoints(pointMode, lineOffsets, _paint);
    canvas.restore();
  }

  @override
  bool shouldRepaint(CustomPainter oldDelegate) {
    return false;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç»¼ä¸Šï¼Œè‡ªç»˜é€æ¸çš„æ ¸å¿ƒæ˜¯ç»§æ‰¿&lt;code&gt;CustomPaint&lt;/code&gt;ï¼Œç„¶åä½¿ç”¨&lt;code&gt;Canvas&lt;/code&gt;å®ç°UIçš„ç»˜åˆ¶&lt;/p&gt;

&lt;h4 id=&#34;5-å®ç°renderobject&#34;&gt;5.å®ç°RenderObject&lt;/h4&gt;

&lt;p&gt;å®ç°&lt;code&gt;RenderObject&lt;/code&gt;å³æ˜¯è‡ªå·±é‡å†™ä¸€æ•´å¥—æ¸²æŸ“æ ‘ï¼Œé¦–å…ˆå¾—ç»§æ‰¿ä¸€ä¸ª&lt;code&gt;RenderObject&lt;/code&gt;ï¼Œå®ç°å…¶å†…ç½®ä»¿ä½›ï¼Œè¿˜å¾—ç»§æ‰¿&lt;code&gt;Element&lt;/code&gt;ï¼Œå®ç°å…¶å†…ç½®æ–¹æ³•ï¼Œå¤æ‚çš„è‡ªå®šä¹‰ç»„ä»¶æœ€ç»ˆä¹Ÿæ˜¯é€šè¿‡&lt;code&gt;Canvas&lt;/code&gt; APIæ¥ç»˜åˆ¶çš„ï¼Œè€Œä¸Šé¢è¯´çš„&lt;code&gt;CustomPaint&lt;/code&gt;åªæ˜¯ä¸ºäº†æ–¹ä¾¿å¼€å‘è€…å°è£…çš„ä¸€ä¸ªä»£ç†ç±»ï¼Œå®ƒç›´æ¥ç»§æ‰¿è‡ª&lt;code&gt;SingleChildRenderObjectWidget&lt;/code&gt;ï¼Œé€šè¿‡&lt;code&gt;RenderCustomPaint&lt;/code&gt;çš„&lt;code&gt;paint&lt;/code&gt;æ–¹æ³•å°†&lt;code&gt;Canvas&lt;/code&gt;å’Œç”»ç¬”&lt;code&gt;Painter&lt;/code&gt;è¿æ¥èµ·æ¥å®ç°è‡ªç»˜ç»„ä»¶ã€‚è¿™ç§æ–¹å¼æ“ä½œèµ·æ¥å®åœ¨æ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä¹Ÿæ²¡æ€ä¹ˆç”¨è¿‡ï¼Œæ‰€ä»¥å°±ä¸æä¾›ç¤ºä¾‹å±•ç¤ºäº†ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>è¾“å…¥ä¸€ä¸ªURLåˆ°é¡µé¢å‘ˆç°çš„è¿‡ç¨‹</title>
      <link>https://xtid.github.io/2020/%E8%BE%93%E5%85%A5%E4%B8%80%E4%B8%AAurl%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%91%88%E7%8E%B0%E7%9A%84%E8%BF%87%E7%A8%8B/</link>
      <pubDate>Sun, 15 Nov 2020 15:21:34 +0800</pubDate>
      
      <guid>https://xtid.github.io/2020/%E8%BE%93%E5%85%A5%E4%B8%80%E4%B8%AAurl%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%91%88%E7%8E%B0%E7%9A%84%E8%BF%87%E7%A8%8B/</guid>
      <description>

&lt;h4 id=&#34;1-dnsè§£æ&#34;&gt;1.DNSè§£æ&lt;/h4&gt;

&lt;p&gt;å¹³æ—¶åœ¨æµè§ˆå™¨ä¸­è¾“å…¥çš„åŸŸåå¹¶éæ˜¯ç½‘å€æˆ–èµ„æºçœŸå®æ‰€åœ¨çš„æœåŠ¡å™¨åœ°å€æˆ–èµ„æºï¼ŒåŸŸååªæ˜¯ä¸&lt;code&gt;ip&lt;/code&gt;åœ°å€çš„ä¸€ä¸ªæ˜ å°„ã€‚åœ¨è¿›è¡Œæ­£å¼çš„è¯·æ±‚ä¹‹å‰ï¼Œå°±ä¼šå…ˆæœ‰è¿™ä¸ªè¿‡ç¨‹ï¼š&lt;code&gt;DNS&lt;/code&gt;æœåŠ¡å°†åŸŸåè§£ææˆå¯¹åº”çš„&lt;code&gt;ip&lt;/code&gt;åœ°å€ã€‚å…¶è§£æè¿‡ç¨‹ï¼š&lt;/p&gt;

&lt;p&gt;1.æ£€æŸ¥æœ¬æœº&lt;code&gt;host&lt;/code&gt;ä¸­æ˜¯å¦æœ‰é…ç½®ç›¸åº”çš„&lt;code&gt;ip&lt;/code&gt;æ˜ å°„å…³ç³»ï¼Œå¦‚æœæœ‰åˆ™ä½¿ç”¨è¿™ä¸ª&lt;code&gt;ip&lt;/code&gt;åœ°å€ï¼Œå®ŒæˆåŸŸåè§£æ
2.æ£€æŸ¥æµè§ˆå™¨ç¼“å­˜ä¸­æ˜¯å¦ç¼“å­˜è¿‡è¯¥åŸŸåå¯¹åº”çš„&lt;code&gt;ip&lt;/code&gt;åœ°å€
3.æ£€æŸ¥æ‰¾æœ¬æœºç³»ç»Ÿä¸­æ˜¯å¦ç¼“å­˜è¿‡&lt;code&gt;ip&lt;/code&gt;
4.å‘æœ¬åœ°åŸŸåè§£ææœåŠ¡å‘èµ·åŸŸåè§£æçš„è¯·æ±‚
5.å‘æ ¹åŸŸåè§£ææœåŠ¡å™¨å‘èµ·åŸŸåè§£æè¯·æ±‚
6.æŒ‰ç…§æ ¹åŸŸå&lt;code&gt;(.)&lt;/code&gt; -&amp;gt; é¡¶çº§åŸŸ&lt;code&gt;(å¦‚ï¼š.com)&lt;/code&gt; -&amp;gt; ç¬¬äºŒå±‚åŸŸ&lt;code&gt;(å¦‚ï¼šxxx.com)&lt;/code&gt; -&amp;gt; å­åŸŸ&lt;code&gt;(å¦‚ï¼šwww.xxx.com)&lt;/code&gt;çš„é¡ºåºæŸ¥æ‰¾åˆ°ipåœ°å€
8.è¿”å›è§£æç»“æœç»™ç”¨æˆ·&lt;/p&gt;

&lt;h4 id=&#34;2-å»ºç«‹-tcp-è¿æ¥&#34;&gt;2.å»ºç«‹&lt;code&gt;TCP&lt;/code&gt;è¿æ¥&lt;/h4&gt;

&lt;p&gt;ç»å…¸çš„ä¸‰æ¬¡æ¡æ‰‹&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼š å»ºç«‹è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€synåŒ…ï¼ˆsyn=jï¼‰åˆ°æœåŠ¡å™¨ï¼Œå¹¶è¿›å…¥SYN_SENTçŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨ç¡®è®¤ï¼›&lt;/p&gt;

&lt;p&gt;ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼š æœåŠ¡å™¨æ”¶åˆ°synåŒ…ï¼Œå¿…é¡»ç¡®è®¤å®¢æˆ·çš„SYNï¼ˆack=j+1ï¼‰ï¼ŒåŒæ—¶è‡ªå·±ä¹Ÿå‘é€ä¸€ä¸ªSYNåŒ…ï¼ˆsyn=kï¼‰ï¼Œå³SYN+ACKåŒ…ï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥SYN_RECVçŠ¶æ€ï¼›&lt;/p&gt;

&lt;p&gt;ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼š å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„SYN+ACKåŒ…ï¼Œå‘æœåŠ¡å™¨å‘é€ç¡®è®¤åŒ…ACK(ack=k+1ï¼‰ï¼Œæ­¤åŒ…å‘é€å®Œæ¯•ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›å…¥ESTABLISHEDï¼ˆTCPè¿æ¥æˆåŠŸï¼‰çŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç®€å•æ¥è¯´å…¶æ­¥éª¤å°±æ˜¯ï¼Œå®¢æˆ·ç«¯å‘é€æ•°æ®åŒ…å‘Šè¯‰æœåŠ¡ç«¯è¿æ¥è¯·æ±‚ï¼ŒæœåŠ¡ç«¯è¿”å›æ•°æ®åŒ…å“åº”è¡¨ç¤ºå¯ä»¥æ”¶åˆ°å»ºç«‹è¿æ¥è¯·æ±‚å¹¶ä¸”è¿”å›æ•°æ®åŒ…é€šçŸ¥å®¢æˆ·ç«¯ï¼Œå®¢æœç«¯å†æ¬¡å‘é€æ•°æ®åŒ…ç¡®è®¤å¹¶å»ºç«‹&lt;code&gt;TCP&lt;/code&gt;è¿æ¥&lt;/p&gt;

&lt;h4 id=&#34;3-å‘é€-http-è¯·æ±‚&#34;&gt;3.å‘é€&lt;code&gt;HTTP&lt;/code&gt;è¯·æ±‚&lt;/h4&gt;

&lt;p&gt;ä¸€ä¸ª&lt;code&gt;HTTP&lt;/code&gt;è¯·æ±‚åŒ…å«è¯·æ±‚è¡Œï¼Œè¯·æ±‚å¤´ï¼Œè¯·æ±‚ä¸»ä½“&lt;/p&gt;

&lt;h5 id=&#34;3-1è¯·æ±‚è¡Œ&#34;&gt;3.1è¯·æ±‚è¡Œ&lt;/h5&gt;

&lt;p&gt;å¸¸è§çš„ä¿¡æ¯æœ‰è¯·æ±‚åœ°å€ã€è¯·æ±‚æ–¹æ³•&lt;code&gt;GETã€POSTã€PUTã€DELETEã€PATCHã€HEADã€OPTIONSã€TRACE&lt;/code&gt;ã€&lt;code&gt;Http&lt;/code&gt;åè®®ä¿¡æ¯&lt;/p&gt;

&lt;h5 id=&#34;3-2è¯·æ±‚å¤´&#34;&gt;3.2è¯·æ±‚å¤´&lt;/h5&gt;

&lt;p&gt;å¸¸è§çš„è¯·æ±‚å¤´ä¿¡æ¯æœ‰&lt;/p&gt;

&lt;p&gt;&lt;code&gt;Host&lt;/code&gt;ï¼šä¸»æœºå
&lt;code&gt;Connection&lt;/code&gt;ï¼š&lt;code&gt;HTTP/1.1&lt;/code&gt;å¢åŠ çš„ï¼Œä½¿ç”¨&lt;code&gt;keepalive&lt;/code&gt;ï¼Œä¸€ä¸ªè¿æ¥å¯ä»¥å‘å¤šä¸ªè¯·æ±‚
&lt;code&gt;User-Agent&lt;/code&gt;ï¼šå®¢æˆ·ç«¯ç¨‹åºçš„ä¿¡æ¯ï¼Œå°±æ˜¯å‘é€è¯·æ±‚çš„æµè§ˆå™¨ä¿¡æ¯ï¼Œå¯æ ¹æ®è¿™ä¸ªä¿¡æ¯æ¥å¯¹ä¸åŒè®¾å¤‡è¿›è¡Œå¤„ç†
&lt;code&gt;Accept&lt;/code&gt;ï¼šæµè§ˆå™¨å¯ä»¥æ¥æ”¶çš„åª’ä½“æ•°æ®ç±»å‹
&lt;code&gt;Accept-Encoding&lt;/code&gt;ï¼šæ˜¯æµè§ˆå™¨ç”¨æ¥å‘ŠçŸ¥æœåŠ¡å™¨å®ƒèƒ½å¤Ÿæ”¯æŒçš„å†…å®¹ç¼–ç åŠå†…å®¹ç¼–ç çš„ä¼˜å…ˆçº§é¡ºåºï¼Œå¯ä¸€æ¬¡æ€§æŒ‡å®šå¤šç§å†…å®¹ç¼–ç 
&lt;code&gt;Accept-Language&lt;/code&gt;ï¼šå‘Šè¯‰æœåŠ¡å™¨æµè§ˆå™¨èƒ½å¤Ÿå¤„ç†çš„è‡ªç„¶è¯­è¨€é›†
&lt;code&gt;Content-Type&lt;/code&gt;ï¼šè¯·æ±‚ä¸­çš„æ•°æ®çš„åª’ä½“ç±»å‹
&lt;code&gt;Cookie&lt;/code&gt;ï¼šæµè§ˆå™¨è®°å½•çš„ç”¨æˆ·ç›¸å…³ä¿¡æ¯&lt;/p&gt;

&lt;p&gt;å½“ç„¶è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„ï¼Œè¿™é‡Œå°±ä¸ç½—åˆ—å®Œäº†ï¼Œå¦å¤–è¿˜å¯ä»¥è‡ªå·±æ·»åŠ ä¸€äº›è‡ªå®šä¹‰è¯·æ±‚å¤´ï¼Œåœ¨æœåŠ¡ç«¯æ‰‹åŠ¨è·å–å¤„ç†å°±è¡Œäº†&lt;/p&gt;

&lt;h5 id=&#34;3-3è¯·æ±‚ä¸»ä½“&#34;&gt;3.3è¯·æ±‚ä¸»ä½“&lt;/h5&gt;

&lt;p&gt;ä¸»è¦æ˜¯è¯·æ±‚æ‰€å¸¦çš„ä¸€äº›å‚æ•°ä¿¡æ¯ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°&lt;/p&gt;

&lt;h4 id=&#34;4-ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜&#34;&gt;4.ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜&lt;/h4&gt;

&lt;p&gt;æµè§ˆå™¨ç¼“å­˜ä¸»è¦&lt;code&gt;å¼ºç¼“å­˜&lt;/code&gt;å’Œ&lt;code&gt;åå•†ç¼“å­˜&lt;/code&gt;ï¼Œå…·ä½“ä½¿ç”¨å“ªä¸€ç§ç¼“å­˜ï¼Œå¼ºç¼“å­˜çš„ä¼˜å…ˆçº§æ¯”åå•†ç¼“å­˜é«˜ï¼Œæ€ä¹ˆè®¾ç½®è¿˜æ˜¯å¾—ä»å®é™…å‡ºå‘&lt;/p&gt;

&lt;h5 id=&#34;4-1å¼ºç¼“å­˜&#34;&gt;4.1å¼ºç¼“å­˜&lt;/h5&gt;

&lt;p&gt;å¼ºç¼“å­˜å¯ä»¥ç”¨&lt;code&gt;Expires&lt;/code&gt;å’Œ&lt;code&gt;Cache-Control&lt;/code&gt;æ¥æ§åˆ¶ï¼Œå¼ºç¼“å­˜æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯é€šè¿‡æœåŠ¡å™¨è¿”å›çš„è¿‡æœŸæ—¶é—´æ¥åˆ¤æ–­ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼Œä¸ä¼šå†å»å’ŒæœåŠ¡ç«¯åšæ ¡éªŒçœ‹èµ„æºæ˜¯å¦çœŸæ­£æ›´æ–°äº†&lt;/p&gt;

&lt;p&gt;&lt;code&gt;Expires&lt;/code&gt;ï¼šä¸»ç”±æœåŠ¡ç«¯è¿”ç»™å®¢æˆ·ç«¯ï¼Œåœ¨è¿‡æœŸæ—¶é—´å†…ï¼Œæµè§ˆå™¨å¯ç›´æ¥ä½¿ç”¨ç¼“å­˜è€Œä¸éœ€è¦é‡æ–°è¯·æ±‚ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸å°‘å±€é™ï¼Œé¦–å…ˆå®ƒåªèƒ½ç²¾ç¡®åˆ°ç§’ï¼Œå¯¹äºé‚£ç§æ¯«ç§’çº§æ›´æ–°çš„èµ„æºå®ƒæ²¡åŠæ³•åˆ¤æ–­ï¼Œå…¶æ¬¡å®ƒå—é™äºæœ¬åœ°æ—¶é—´ï¼Œå¦‚æœä¿®æ”¹äº†æœ¬åœ°æ—¶é—´ï¼Œå¯èƒ½ä¼šé€ æˆç¼“å­˜å¤±æ•ˆã€‚&lt;code&gt;Expires&lt;/code&gt;æ˜¯&lt;code&gt;Http/1&lt;/code&gt;æ—¶å€™çš„è¯·æ±‚å¤´ï¼Œç°åœ¨è¿™æ ·è®¾ç½®é€šå¸¸ä¹Ÿæ˜¯ä¸ºäº†å…¼å®¹&lt;/p&gt;

&lt;p&gt;&lt;code&gt;Cache-Control&lt;/code&gt;ï¼šæ˜¯ç°åœ¨ä¸»è¦ä½¿ç”¨çš„æ–¹å¼ï¼Œå¯ä»¥åœ¨è¯·æ±‚å¤´ä»¥åŠå“åº”å¤´ä¸­è®¾ç½®ï¼Œå¸¸è§è®¾ç½®æœ‰&lt;code&gt;max-age(è¡¨ç¤ºç¼“å­˜åœ¨å¤šå°‘ç§’åè¿‡æœŸ)&lt;/code&gt;ï¼Œ&lt;code&gt;no-cache(è¡¨ç¤ºä½¿ç”¨Etagæˆ–è€…Last-Modifiedå­—æ®µæ¥æ§åˆ¶ç¼“å­˜ï¼Œå³åå•†ç¼“å­˜)&lt;/code&gt;ï¼Œé€šå¸¸æ¥è®²ï¼Œ&lt;code&gt;Cache-control&lt;/code&gt;çš„ä¼˜å…ˆçº§æ˜¯è¦é«˜äº&lt;code&gt;Expires&lt;/code&gt;çš„&lt;/p&gt;

&lt;h5 id=&#34;4-2åå•†ç¼“å­˜&#34;&gt;4.2åå•†ç¼“å­˜&lt;/h5&gt;

&lt;p&gt;åœ¨å¼ºç¼“å­˜å¤±æ•ˆåå°±ä¼šç”¨åå•†ç¼“å­˜ï¼Œåå•†ç¼“å­˜ä¸»è¦ä½¿ç”¨&lt;code&gt;Last-Modified å’Œ ETag&lt;/code&gt;è¯·æ±‚å¤´æ§åˆ¶ï¼Œè¿™ä¸¤ä¸ªå­—æ®µéƒ½æ˜¯ç”±æœåŠ¡ç«¯è¿”å›çš„ã€‚å¦‚æœè¯´ç¼“å­˜è¿˜ç”Ÿæ•ˆï¼Œé‚£ä¹ˆè¿™æ¬¡è¯·æ±‚çš„çŠ¶æ€ç ä¼šè¿”å›&lt;code&gt;304&lt;/code&gt;ï¼Œè¡¨ç¤ºèµ„æºæœªæ”¹åŠ¨ï¼Œå¦‚æœç¼“å­˜å¤±æ•ˆï¼Œè¿”å›æ–°çš„èµ„æºå¹¶è®¾ç½®ç¼“å­˜ï¼Œè¿”å›&lt;code&gt;200&lt;/code&gt;çŠ¶æ€ç &lt;/p&gt;

&lt;p&gt;&lt;code&gt;Last-Modified&lt;/code&gt;ï¼šåœ¨è®¾ç½®&lt;code&gt;Last-Modified&lt;/code&gt;åï¼Œä¸‹æ¬¡è¯·æ±‚æ—¶è¯·æ±‚å¤´ä¼šå¸¦ä¸Š&lt;code&gt;If-Modified-Since&lt;/code&gt;è¿™ä¸ªå­—æ®µï¼Œç„¶åæœåŠ¡å™¨ä¼šç”¨è¿™ä¸ªæ—¶é—´ä¸èµ„æºä¿®æ”¹æ—¶é—´åšå¯¹æ¯”ï¼Œç„¶åå°±æ˜¯è¿”å›&lt;code&gt;304&lt;/code&gt;è¿˜æ˜¯&lt;code&gt;200&lt;/code&gt;çš„é—®é¢˜äº†ï¼ŒåŒæ ·å®ƒä¹Ÿåªèƒ½ç²¾ç¡®åˆ°ç§’ï¼Œæ‰€ä»¥ä¸€äº›éœ€è¦æ¯«ç§’çº§æ›´æ–°çš„èµ„æºä½¿ç”¨è¿™ä¸ªå¹¶ä¸å‡†ç¡®&lt;/p&gt;

&lt;p&gt;&lt;code&gt;ETag&lt;/code&gt;ï¼šé€šå¸¸ä¸&lt;code&gt;If-None-Match&lt;/code&gt;é…åˆä½¿ç”¨ï¼Œ&lt;code&gt;Etag&lt;/code&gt;ä¸ºæœåŠ¡ç«¯ä¸ºè¿™èµ„æºç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†ï¼Œä¸‹æ¬¡å®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶å€™ï¼Œå¸¦ä¸Šè¿™ä¸ªå€¼ï¼Œç”±æœåŠ¡ç«¯å†åšæ ¡éªŒï¼Œå¦‚æœèµ„æºæœªæ”¹åŠ¨ï¼Œè¿”å›&lt;code&gt;304&lt;/code&gt;ï¼Œä½¿ç”¨åŸæ¥çš„ç¼“å­˜ï¼Œåä¹‹è¿”å›&lt;code&gt;200&lt;/code&gt;ï¼Œè®¾ç½®ç¼“å­˜&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://i.loli.net/2020/10/28/O2gaJWm8jYPeI7c.png&#34; alt=&#34;æµè§ˆå™¨ç¼“å­˜.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å›¾å‡ºè‡ª&lt;a href=&#34;https://github.com/ljianshu/Blog&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;åšå®¢&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&#34;5-æµè§ˆå™¨æ¥æ”¶å“åº”&#34;&gt;5.æµè§ˆå™¨æ¥æ”¶å“åº”&lt;/h4&gt;

&lt;p&gt;å“åº”åˆ†ä¸ºçŠ¶æ€ç ï¼Œå“åº”å¤´ï¼Œå“åº”ä¸»ä½“ç»„æˆï¼Œå“åº”ä¸»ä½“é€šå¸¸æ˜¯ä¸€äº›æ–‡ä»¶&lt;code&gt;å¦‚(HTMLã€JSã€CSSæ–‡ä»¶)&lt;/code&gt;æˆ–è€…è¯´æ˜¯ä¸€äº›å“åº”æ•°æ®&lt;code&gt;(è¯·æ±‚çš„å“åº”æ•°æ®)&lt;/code&gt;ï¼ŒçŠ¶æ€ç å’Œå“åº”å¤´è¿™é‡Œå°±ä¸ç½—åˆ—äº†ã€‚æœ‰ä¸ªç‰¹åˆ«çš„é€šå¸¸ä¸ºäº†æå‡å“åº”çš„æ•ˆç‡ï¼ŒæœåŠ¡ç«¯ä¼šå°†ä¸€äº›è¿›è¡Œ&lt;code&gt;gzip&lt;/code&gt;å‹ç¼©ï¼Œç„¶åå“åº”å¤´é‡Œé¢ä¼šæœ‰ä¸ªå“åº”å¤´&lt;code&gt;content-encoding:gzip&lt;/code&gt;ï¼Œç„¶åæµè§ˆå™¨ä¼šå†è¿›è¡Œè§£å‹&lt;/p&gt;

&lt;h4 id=&#34;6-é¡µé¢æ¸²æŸ“&#34;&gt;6.é¡µé¢æ¸²æŸ“&lt;/h4&gt;

&lt;p&gt;åœ¨æ¥æ”¶å“åº”æˆåŠŸä¹‹åï¼Œæµè§ˆå™¨å°±å¼€å§‹æ¸²æŸ“é¡µé¢äº†ã€‚å…¶æ­¥éª¤åŒ…æ‹¬ï¼š1.è§£æ&lt;code&gt;HTML&lt;/code&gt;ä¸º&lt;code&gt;DOM&lt;/code&gt;æ ‘ã€2.è§£æ&lt;code&gt;CSS&lt;/code&gt;ä¸º&lt;code&gt;CSS&lt;/code&gt;æ ‘ã€3.åˆå¹¶&lt;code&gt;DOM&lt;/code&gt;æ ‘å·²ç»&lt;code&gt;CSS&lt;/code&gt;æ ‘ã€4.éå†æ•´ä¸ªèŠ‚ç‚¹ã€5.æŒ‰ç…§&lt;code&gt;CSS&lt;/code&gt;çš„ä¼˜å…ˆçº§æ¸²æŸ“æ¯ä¸ªèŠ‚ç‚¹çš„æ ·å¼ï¼Œå‘ˆç°åœ¨å±å¹•ä¸Šã€‚å½“æµè§ˆå™¨é‡åˆ°ä¸€ä¸ª&lt;code&gt;script&lt;/code&gt;æ ‡è®°æ—¶ï¼Œ&lt;code&gt;DOM&lt;/code&gt;æ„å»ºå°†æš‚åœï¼Œç›´è‡³è„šæœ¬å®Œæˆæ‰§è¡Œï¼Œç„¶åç»§ç»­æ„å»º&lt;code&gt;DOM&lt;/code&gt;ã€‚æ¯æ¬¡å»æ‰§è¡Œ&lt;code&gt;JS&lt;/code&gt;è„šæœ¬éƒ½ä¼šä¸¥é‡é˜»å¡&lt;code&gt;DOM&lt;/code&gt;æ ‘çš„æ„å»ºï¼Œå¦‚æœ&lt;code&gt;JS&lt;/code&gt;è„šæœ¬è¿˜æ“ä½œçš„&lt;code&gt;CSSOM&lt;/code&gt;ï¼Œè€Œæ­£å¥½è¿™ä¸ª&lt;code&gt;CSSOM&lt;/code&gt;è¿˜æ²¡æœ‰ä¸‹è½½å’Œæ„å»ºï¼Œæµè§ˆå™¨ç”šè‡³ä¼šå»¶è¿Ÿè„šæœ¬æ‰§è¡Œå’Œæ„å»º&lt;code&gt;DOM&lt;/code&gt;ï¼Œç›´è‡³å®Œæˆå…¶&lt;code&gt;CSSOM&lt;/code&gt;çš„ä¸‹è½½å’Œæ„å»ºã€‚æ‰€ä»¥è¿™é‡Œé€šå¸¸ä¼šæœ‰ä¸ªå¸¸è§çš„å°ä¼˜åŒ–ï¼Œ&lt;code&gt;CSS&lt;/code&gt;æ”¾åœ¨é¡¶éƒ¨ï¼Œ&lt;code&gt;JS&lt;/code&gt;æ”¾åœ¨åº•éƒ¨ï¼Œå¹¶ä¸”å‡å°‘ä½¿ç”¨åœ¨åŠ è½½çš„è¿‡ç¨‹ä¸­æ“ä½œ&lt;code&gt;DOM&lt;/code&gt;ï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯æ¯”è¾ƒè€çš„åšæ³•äº†ã€‚åœ¨é¡µé¢åŠ è½½çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€å†™çš„&lt;code&gt;CSS&lt;/code&gt;å’Œ&lt;code&gt;JS&lt;/code&gt;ä¹Ÿè¦å°½é‡é¿å…é‡ç»˜å’Œå›æµ&lt;/p&gt;

&lt;h4 id=&#34;7-å››æ¬¡æ¡æ‰‹&#34;&gt;7.å››æ¬¡æ¡æ‰‹&lt;/h4&gt;

&lt;p&gt;å››æ¬¡æ¡æ‰‹ç”¨äºæ–­å¼€&lt;code&gt;Tcp&lt;/code&gt;è¿æ¥ï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚è¡¨ç¤ºè¦æ–­å¼€è¿æ¥ï¼ŒæœåŠ¡æ¥å—åˆ°è¯·æ±‚åå“åº”ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°å“åº”å‡†å¤‡æ–­å¼€è¿æ¥ï¼ŒæœåŠ¡ç«¯å°†å…¶ä½™æ•°æ®æˆ–æ²¡å“åº”çš„æ•°æ®å…¨éƒ¨è¿”ç»™å®¢æˆ·ç«¯(å³åˆä¸€æ¬¡æ¡æ‰‹)ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°åå“åº”åå†å‘é€è¯·æ±‚ç¡®è®¤å…³é—­ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°åæ–­å¼€è¿æ¥&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;1ï¼‰å®¢æˆ·ç«¯è¿›ç¨‹å‘å‡ºè¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå¹¶ä¸”åœæ­¢å‘é€æ•°æ®ã€‚é‡Šæ”¾æ•°æ®æŠ¥æ–‡é¦–éƒ¨ï¼ŒFIN=1ï¼Œå…¶åºåˆ—å·ä¸ºseq=uï¼ˆç­‰äºå‰é¢å·²ç»ä¼ é€è¿‡æ¥çš„æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1ï¼‰ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-1ï¼ˆç»ˆæ­¢ç­‰å¾…1ï¼‰çŠ¶æ€ã€‚ TCPè§„å®šï¼ŒFINæŠ¥æ–‡æ®µå³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œä¹Ÿè¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚
2ï¼‰æœåŠ¡å™¨æ”¶åˆ°è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼ŒACK=1ï¼Œack=u+1ï¼Œå¹¶ä¸”å¸¦ä¸Šè‡ªå·±çš„åºåˆ—å·seq=vï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡ç«¯å°±è¿›å…¥äº†CLOSE-WAITï¼ˆå…³é—­ç­‰å¾…ï¼‰çŠ¶æ€ã€‚TCPæœåŠ¡å™¨é€šçŸ¥é«˜å±‚çš„åº”ç”¨è¿›ç¨‹ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨çš„æ–¹å‘å°±é‡Šæ”¾äº†ï¼Œè¿™æ—¶å€™å¤„äºåŠå…³é—­çŠ¶æ€ï¼Œå³å®¢æˆ·ç«¯å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä½†æ˜¯æœåŠ¡å™¨è‹¥å‘é€æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¾ç„¶è¦æ¥å—ã€‚è¿™ä¸ªçŠ¶æ€è¿˜è¦æŒç»­ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªCLOSE-WAITçŠ¶æ€æŒç»­çš„æ—¶é—´ã€‚
3ï¼‰å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤è¯·æ±‚åï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥FIN-WAIT-2ï¼ˆç»ˆæ­¢ç­‰å¾…2ï¼‰çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ˆåœ¨è¿™ä¹‹å‰è¿˜éœ€è¦æ¥å—æœåŠ¡å™¨å‘é€çš„æœ€åçš„æ•°æ®ï¼‰ã€‚
4ï¼‰æœåŠ¡å™¨å°†æœ€åçš„æ•°æ®å‘é€å®Œæ¯•åï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ï¼Œack=u+1ï¼Œç”±äºåœ¨åŠå…³é—­çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¾ˆå¯èƒ½åˆå‘é€äº†ä¸€äº›æ•°æ®ï¼Œå‡å®šæ­¤æ—¶çš„åºåˆ—å·ä¸ºseq=wï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡å™¨å°±è¿›å…¥äº†LAST-ACKï¼ˆæœ€åç¡®è®¤ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤ã€‚
5ï¼‰å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡åï¼Œå¿…é¡»å‘å‡ºç¡®è®¤ï¼ŒACK=1ï¼Œack=w+1ï¼Œè€Œè‡ªå·±çš„åºåˆ—å·æ˜¯seq=u+1ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥äº†TIME-WAITï¼ˆæ—¶é—´ç­‰å¾…ï¼‰çŠ¶æ€ã€‚æ³¨æ„æ­¤æ—¶TCPè¿æ¥è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå¿…é¡»ç»è¿‡2âˆ—âˆ—MSLï¼ˆæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ï¼‰çš„æ—¶é—´åï¼Œå½“å®¢æˆ·ç«¯æ’¤é”€ç›¸åº”çš„TCBåï¼Œæ‰è¿›å…¥CLOSEDçŠ¶æ€ã€‚
6ï¼‰æœåŠ¡å™¨åªè¦æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘å‡ºçš„ç¡®è®¤ï¼Œç«‹å³è¿›å…¥CLOSEDçŠ¶æ€ã€‚åŒæ ·ï¼Œæ’¤é”€TCBåï¼Œå°±ç»“æŸäº†è¿™æ¬¡çš„TCPè¿æ¥ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨ç»“æŸTCPè¿æ¥çš„æ—¶é—´è¦æ¯”å®¢æˆ·ç«¯æ—©ä¸€äº›ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h6 id=&#34;å‚è€ƒé“¾æ¥&#34;&gt;å‚è€ƒé“¾æ¥&lt;/h6&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/ljianshu/Blog&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;åšå®¢&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æµ…è°ˆå‰ç«¯ç»Ÿè®¡</title>
      <link>https://xtid.github.io/2020/%E6%B5%85%E8%B0%88%E5%89%8D%E7%AB%AF%E7%BB%9F%E8%AE%A1/</link>
      <pubDate>Wed, 28 Oct 2020 21:45:40 +0800</pubDate>
      
      <guid>https://xtid.github.io/2020/%E6%B5%85%E8%B0%88%E5%89%8D%E7%AB%AF%E7%BB%9F%E8%AE%A1/</guid>
      <description>&lt;p&gt;ç›‘æ§ç³»ç»Ÿåœ¨ç°åœ¨çš„é¡¹ç›®ä¸­æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå®ƒå…·æœ‰æ€§èƒ½ç›‘æ§ã€é”™è¯¯ç›‘æ§ä»¥åŠæ•°æ®ä¸ŠæŠ¥ç­‰åŠŸèƒ½ã€‚é€šè¿‡å¯¹çš„é”™è¯¯ç›‘æ§ã€ç”¨æˆ·æ­£å¸¸è¡Œä¸ºçš„æ”¶é›†ï¼Œä»è€ŒæŒ‡å®šå¯¹åº”çš„ä¼˜åŒ–æ–¹æ¡ˆã€è¥é”€ç­–ç•¥ä»¥åŠé¡¹ç›®çš„è¿­ä»£ã€‚ è¯•æƒ³ï¼Œå¦‚æœæ²¡æœ‰è¿™äº›ç›‘æ§ç³»ç»Ÿï¼Œé‚£ä¹ˆçº¿ä¸Šçš„è¿è¡Œçš„é¡¹ç›®å‡ºé—®é¢˜äº†ï¼Œå®šä½æ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œè¿™æ—¶å€™ä¿®å¤èµ·æ¥å°±æ¯”è¾ƒåŠ³ç¥äº†ã€‚æˆ‘è®°å½•ä¸‹æˆ‘æ‰€äº†è§£çš„ï¼Œå¸¸è§çš„æ–¹å¼ã€‚&lt;/p&gt;

&lt;p&gt;1.é”™è¯¯ç›‘æ§&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å¯¹äºé”™è¯¯çš„å¤„ç†ï¼Œåœ¨&lt;code&gt;js&lt;/code&gt;ä¸­å¾ˆå¸¸è§çš„é”™è¯¯æ•è·&lt;code&gt;try catch&lt;/code&gt;ã€&lt;code&gt;promiseä¸­çš„catch&lt;/code&gt;ç­‰ç­‰ã€‚åœ¨windowå¯¹è±¡ä¸Šæœ‰ä¸€ä¸ªæ–¹æ³•&lt;code&gt;onerror&lt;/code&gt;ï¼Œå¯ä»¥æ‹¿åˆ°å½“å‰æŠ¥é”™çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†è¿™ä¸ªä¿¡æ¯æ‹¿åˆ°ç„¶åæäº¤åˆ°æˆ‘ä»¬è‡ªå·±çš„ç›‘æ§ç³»ç»Ÿï¼Œè¿˜æœ‰ä¸ªå¾ˆé‡è¦çš„åŸå› ï¼Œä¸å¤„ç†è¿™äº›é”™è¯¯ï¼Œå¯¼è‡´é¡µé¢æŒ‚äº†åœæ­¢åŠ è½½ï¼Œé‚£æŸå¤±å¯å°±å¤§äº†ã€‚å¯¹äºæŠ›å‡ºçš„é”™è¯¯ï¼Œå®ƒæœ‰å‡ ä¸ªå±æ€§&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;// å®šä¹‰ä¸€ä¸ªé”™è¯¯å¯¹è±¡
const defaults = {
  msg: &#39;&#39;, // é”™è¯¯çš„å…·ä½“ä¿¡æ¯
  url: &#39;&#39;, // é”™è¯¯æ‰€åœ¨çš„url
  line: &#39;&#39;, // é”™è¯¯æ‰€åœ¨çš„è¡Œ
  col: &#39;&#39;, // é”™è¯¯æ‰€åœ¨çš„åˆ—
  nowTime: &#39;&#39; // æ—¶é—´
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åå®ç°&lt;code&gt;window.onerror&lt;/code&gt;æ–¹æ³•&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;window.onerror = function (msg, url, line, col, error) {
  col = col || (window.event &amp;amp;&amp;amp; window.event.errorCharacter) || 0

  defaults.url = url
  defaults.line = line
  defaults.col = col
  defaults.nowTime = new Date().getTime()

  if (error &amp;amp;&amp;amp; error.stack) {
    // å¦‚æœæµè§ˆå™¨æœ‰é”™è¯¯å †æ ˆä¿¡æ¯ï¼Œç›´æ¥ä½¿ç”¨
    defaults.msg = error.stack.toString()
  } else if (arguments.callee) {
    // é€šè¿‡calleeæ‹¿å †æ ˆä¿¡æ¯
    let ext = []
    let fn = arguments.callee.caller
    // æœ€å¤šæ‹¿åˆ°ä¸‰å±‚
    let floor = 3
    while (fn &amp;amp;&amp;amp; (--floor &amp;gt; 0)) {
      ext.push(fn.toString())
      if (fn === fn.caller) {
        break
      }
      fn = fn.caller
    }
    ext = ext.join(&#39;,&#39;)
    defaults.msg = error &amp;amp;&amp;amp; error.stack &amp;amp;&amp;amp; error.stack.toString()
  }
  let str = &#39;&#39;
  // æ ¼å¼åŒ–è¿™äº›é”™è¯¯ä¿¡æ¯
  for (const i in defaults) {
    if (!defaults[i]) {
      defaults[i] = &#39;null&#39;
    }
    str += &#39;&amp;amp;&#39; + i + &#39;=&#39; + defaults[i].toString()
  }
  // ç¡®å®šé”™è¯¯æ˜¯ç”±å“ªä½ç”¨æˆ·å¼•èµ·çš„ï¼Œè¿™ä¸€æ­¥æœ‰äº›æ—¶å€™å¯ä»¥ä¸ç”¨
  let userinfo = // æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯
  if (typeof userinfo === &#39;object&#39;) {
    userinfo = JSON.stringify(userinfo)
  }
  if (userinfo) userinfo = encodeURIComponent(userinfo)
  str = encodeURIComponent(str.replace(&#39;&amp;amp;&#39;, &#39;&#39;).replace(&#39;\n&#39;, &#39;&#39;).replace(/\s/g, &#39;&#39;))
	
  // é¿å…å‡ºç°è·¨åŸŸé”™è¯¯
  new Image().src = &#39;apiåœ°å€?msg=&#39; + str + &#39;&amp;amp;userinfo=&#39; + userinfo
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™ç§æ–¹å¼çš„ç¼ºé™·åœ¨äºï¼Œæ²¡åŠæ³•å¤„ç†&lt;code&gt;promise&lt;/code&gt;ä¸­æœªå¤„ç†çš„é”™è¯¯ï¼Œå¯¹äº&lt;code&gt;promise&lt;/code&gt;ï¼Œæ¨èä½¿ç”¨&lt;code&gt;unhandledrejection&lt;/code&gt;äº‹æƒ…å¤„ç†&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;window.addEventListener(&#39;unhandledrejection&#39;, event =&amp;gt; {
  let error = event.reason &amp;amp;&amp;amp; event.reason.message
  if (!error) {
    error = typeof event.reason === &#39;object&#39; ? JSON.stringify(event.reason) : event.reason
  }

  (new Image()).src = &#39;apiåœ°å€?msg=&#39; + encodeURIComponent(error)
})

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;2.åŸ‹ç‚¹&lt;/p&gt;

&lt;p&gt;åŸ‹ç‚¹æ˜¯ä¸€ç§å¸¸è§çš„ç»Ÿè®¡ç”¨æˆ·è¡Œä¸ºçš„æ–¹å¼æˆ–å·¥å…·ã€‚é€šè¿‡åœ¨é¡µé¢è®¾ç½®åŸ‹ç‚¹ï¼Œæ¥ç»Ÿè®¡ç”¨æˆ·å¯¹äºæŸä¸ªé¡µé¢ã€å¹¿å‘Šã€åŠŸèƒ½çš„ä½¿ç”¨é¢‘ç‡ã€å–œå¥½ï¼Œç„¶åé€šè¿‡å¯¹åŸ‹ç‚¹çš„æ•°æ®ç»Ÿè®¡ï¼Œç¡®å®šå¥½é¡µé¢æˆ–åŠŸèƒ½çš„è¿­ä»£ã€‚ç®€å•çš„åšæ³•ï¼Œè®¾ç½®ä¸€ä¸ªå…¨å±€æ–¹æ³•ç”¨æ¥æäº¤åŸ‹ç‚¹ç‚¹å‡»çš„è¡Œä¸ºï¼Œåœ¨éœ€è¦çš„åœ°æ–¹è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;// å®šä¹‰ä¸€ä¸ªå…¨å±€æ–¹æ³•
// ä¼ å…¥çš„pointä¸ºåŸ‹ç‚¹æ•°æ®
function clickPoint(point = {}) {
  const { id, name } = point
  cosnt userInfo = // é€šè¿‡å¯¹åº”çš„æ“ä½œæ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯
  // åŸºç¡€å‚æ•°
  const basicParams = {
    id: id || &#39;&#39;,
    name: name || &#39;&#39;
  }
  // ç”¨æˆ·ä¿¡æ¯
 	const userParams = {
  	name: userInfo.name || &#39;&#39;
    ......
 	}
  // åˆå¹¶å‚æ•°
  const params = {
    ...basicParams,
    ...userParams
  }
  let str = &#39;&#39;
  for (const i in params) {
    if (!params[i]) {
      params[i] = &#39;null&#39;
    }
    str += &#39;&amp;amp;&#39; + i + &#39;=&#39; + params[i].toString()
  }
  new Image().src = &#39;apiåœ°å€?msg=&#39; + str
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é€šå¸¸è¿™æ ·æ¥ç»Ÿè®¡é¡µé¢ä¸ŠæŸä¸ªåŠŸèƒ½ã€æŸä¸ªå¹¿å‘Šçš„ç‚¹å‡»é‡ï¼Œè·å–å¯¹åº”çš„ç»Ÿè®¡æ•°æ®ã€‚è¿˜æœ‰ä¸€ç§æ¯”è¾ƒå¸¸è§çš„æ–¹å¼ï¼Œä¸ºéœ€è¦æ·»åŠ åŸ‹ç‚¹çš„&lt;code&gt;html&lt;/code&gt;æ ‡ç­¾ä¸ŠåŠ ä¸ŠæŸä¸ªçº¦å®šå¥½çš„è‡ªå®šä¹‰å±æ€§ï¼Œå¦‚&lt;code&gt;&amp;lt;div data-link=&amp;quot;111&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&lt;/code&gt;ï¼Œè¿™ä¸ª&lt;code&gt;111&lt;/code&gt;å°±æ˜¯å°±æ˜¯å®ç°ç”Ÿæˆå¥½æˆ–è€…è§„åˆ’å¥½çš„åŸ‹ç‚¹ã€‚ç„¶åç»™è¿™ç§å±æ€§æ·»åŠ å…¨å±€çš„ç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»ååŒæ ·çš„å°†å¯¹åº”çš„æ•°æ®æäº¤åˆ°è‡ªå·±çš„åå°ç³»ç»Ÿå»ã€‚æœ‰äº›æ—¶å€™ä¸ºäº†æ–¹ä¾¿æŸ¥é˜…æˆ–è€…ç›´è§‚çš„è§‚çœ‹ç»Ÿè®¡æ•°æ®ï¼Œè¿˜å¯ä»¥åœ¨é¡µé¢æ¸²æŸ“çš„æ—¶å€™ï¼Œä¸ºå«æœ‰&lt;code&gt;data-link&lt;/code&gt;å±æ€§çš„æ ‡ç­¾ç”Ÿæˆå¯¹åº”çš„ä¸€äº›å›¾æ ‡æˆ–è€…æ–‡å­—æ ‡ç­¾ï¼Œä½¿ç”¨&lt;code&gt;absolute&lt;/code&gt;å®šä½æ˜¾ç¤ºåœ¨å¯¹åº”çš„å…ƒç´ ä¸Šï¼Œå½“ç„¶è¿™ç§æ–¹å¼åœ¨ä½ æ·»åŠ ä¹°ç‚¹åŸ‹ç‚¹å±æ€§çš„æ—¶å€™ï¼Œéœ€è¦ç»™è¿™ä¸ªå…ƒç´ è®¾ç½®ç›¸åº”çš„&lt;code&gt;position css&lt;/code&gt;å±æ€§ï¼›å½“ç„¶ä¹Ÿå¯èƒ½è®¾ç½®ä¸€äº›çƒ­åŠ›å›¾å•Šç­‰å…¶å®ƒå½¢å¼ï¼Œåæ­£éƒ½æ˜¯å®ç°åŒä¸€ä¸ªæ•ˆæœçš„ã€‚&lt;/p&gt;

&lt;p&gt;3.ç™½å±æ—¶é—´&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªä¹‹å‰è¯´è¿‡ï¼Œå°±ä¸è¯´åºŸè¯äº†ï¼Œç™½å±æ—¶é—´çš„ç»Ÿè®¡æ˜¯éå¸¸é‡è¦çš„ã€‚æ¯”å¦‚æœ‰äº›æ—¶å€™ï¼Œåªæœ‰æŸä¸ªç”¨æˆ·çš„æŸä¸ªè®¾å¤‡å‡ºç°äº†é¡µé¢åŠ è½½è¿‡é•¿ï¼Œé¡µé¢æ²¡å†…å®¹ï¼Œå‘ç°è¿™ä¸ªé—®é¢˜åï¼Œé€šè¿‡åˆ¤æ–­é”™è¯¯æ—¥å¿—å’Œç™½å±æ—¶é—´æ‰èƒ½æ›´å¿«çš„å®šä½é—®é¢˜ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;window.logInfo = {}
window.logInfo.openTime = window.performance &amp;amp;&amp;amp; window.performance.timing.navigationStart || 0
window.logInfo.whiteScreenTime = +new Date() - window.logInfo.openTime
window.logInfo.mobile = mobileType()

// ä½¿ç”¨ DOMContentLoaded ç»Ÿè®¡é¡µé¢æœ‰å†…å®¹çš„æ—¶é—´
document.addEventListener(&#39;DOMContentLoaded&#39;, function () {
  window.logInfo.readyTime = +new Date() - window.logInfo.openTime
})
window.onload = function () {
  window.logInfo.allloadTime = +new Date() - window.logInfo.openTime
  window.logInfo.nowTime = new Date().getTime()
  let timname = {
    whiteScreenTime: &#39;ç™½å±æ—¶é—´&#39;,
    readyTime: &#39;ç”¨æˆ·å¯æ“ä½œæ—¶é—´&#39;,
    allloadTime: &#39;æ€»ä¸‹è½½æ—¶é—´&#39;,
    mobile: &#39;ä½¿ç”¨è®¾å¤‡&#39;,
    nowTime: &#39;æ—¶é—´&#39;,
  }
  let logStr = &#39;&#39;
  for (const i in timname) {
    if (i === &#39;mobile&#39;) {
      logStr += &#39;&amp;amp;&#39; + i + &#39;=&#39; + window.logInfo[i]
    } else {
      logStr += &#39;&amp;amp;&#39; + i + &#39;=&#39; + window.logInfo[i]
    }
  }
  // è¿™é‡Œå¦‚æœéœ€è¦çš„è¯ï¼Œè¿˜å¯ä»¥æŠŠç”¨æˆ·çš„ä¸€äº›ä¿¡æ¯æ”¶é›†å‡ºæ¥
  (new Image()).src = &#39;apiåœ°å€?msg=&#39; + logStr
}

function mobileType() {
  const u = navigator.userAgent
  // ç§»åŠ¨ç»ˆç«¯æµè§ˆå™¨ç‰ˆæœ¬ä¿¡æ¯
  const type = {
    ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), // iosç»ˆç«¯
    iPad: u.indexOf(&#39;iPad&#39;) &amp;gt; -1, // æ˜¯å¦iPad
    android: u.indexOf(&#39;Android&#39;) &amp;gt; -1 || u.indexOf(&#39;Linux&#39;) &amp;gt; -1, // androidç»ˆç«¯æˆ–è€…ucæµè§ˆå™¨
    iPhone: u.indexOf(&#39;iPhone&#39;) &amp;gt; -1 || u.indexOf(&#39;Mac&#39;) &amp;gt; -1, // æ˜¯å¦ä¸ºiPhoneæˆ–è€…QQHDæµè§ˆå™¨
    trident: u.indexOf(&#39;Trident&#39;) &amp;gt; -1, // IEå†…æ ¸
    presto: u.indexOf(&#39;Presto&#39;) &amp;gt; -1, // operaå†…æ ¸
    webKit: u.indexOf(&#39;AppleWebKit&#39;) &amp;gt; -1, // è‹¹æœã€è°·æ­Œå†…æ ¸
    gecko: u.indexOf(&#39;Gecko&#39;) &amp;gt; -1 &amp;amp;&amp;amp; u.indexOf(&#39;KHTML&#39;) === -1, // ç«ç‹å†…æ ¸
    mobile: !!u.match(/AppleWebKit.*Mobile/i) || !!u.match(/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/), // æ˜¯å¦ä¸ºç§»åŠ¨ç»ˆç«¯
    webApp: u.indexOf(&#39;Safari&#39;) === -1 // æ˜¯å¦webåº”è¯¥ç¨‹åºï¼Œæ²¡æœ‰å¤´éƒ¨ä¸åº•éƒ¨
  }
  const lists = Object.keys(type)
  for (const i = 0; i &amp;lt; lists.length; i++) {
    if (type[lists[i]]) {
      return lists[i]
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>ç™½å±æ—¶é—´</title>
      <link>https://xtid.github.io/2020/%E7%99%BD%E5%B1%8F%E6%97%B6%E9%97%B4/</link>
      <pubDate>Sat, 24 Oct 2020 23:45:12 +0800</pubDate>
      
      <guid>https://xtid.github.io/2020/%E7%99%BD%E5%B1%8F%E6%97%B6%E9%97%B4/</guid>
      <description>&lt;p&gt;ç™½å±æ—¶é—´æŒ‡çš„æ˜¯ä»ç”¨æˆ·è¿›å…¥ç½‘ç«™ï¼Œä¸€ç›´åˆ°é¡µé¢æœ‰å†…å®¹å±•ç¤ºå‡ºæ¥çš„æ—¶é—´èŠ‚ç‚¹ï¼Œåœ¨è¿™æœŸé—´ç”¨æˆ·ä»€ä¹ˆä¸œè¥¿éƒ½çœ‹ä¸åˆ°ï¼Œè¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬dnsæŸ¥è¯¢ã€å»ºç«‹tcpè¿æ¥ã€å‘é€é¦–ä¸ªhttpè¯·æ±‚ã€è¿”å›htmlæ–‡æ¡£ã€htmlæ–‡æ¡£headè§£æå®Œæ¯•ã€‚ç™½å±æ—¶é—´çš„é•¿çŸ­ï¼Œå½±å“ç€ç”¨æˆ·çš„ä½“éªŒï¼Œç™½å±æ—¶é—´è¿‡é•¿ï¼Œç”¨æˆ·å¤±å»äº†è€å¿ƒç­‰å¾…ï¼Œä¹Ÿè®¸å°±å…³é—­äº†ç½‘é¡µ&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;ä¸€ä»½æ˜¯ &lt;a href=&#34;http://www.akamai.com/html/about/press/releases/2009/press_091409.html&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;Akamai&lt;/a&gt; çš„ç ”ç©¶æŠ¥å‘Šï¼Œå½“æ—¶æ€»å…±é‡‡è®¿äº†å¤§çº¦ 1048 åç½‘ä¸Šè´­ç‰©è€…ï¼Œå¾—å‡ºäº†è¿™æ ·çš„ç»“è®ºï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å¤§çº¦æœ‰ 47% çš„ç”¨æˆ·æœŸæœ›ä»–ä»¬çš„é¡µé¢åœ¨ä¸¤ç§’ä¹‹å†…åŠ è½½å®Œæˆã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœé¡µé¢åŠ è½½æ—¶é—´è¶…è¿‡ 3sï¼Œå¤§çº¦æœ‰ 40% çš„ç”¨æˆ·é€‰æ‹©ç¦»å¼€æˆ–å…³é—­é¡µé¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç™½å±æ—¶é—´çš„è®¡ç®—å°±å¦‚ä¸Šè¯‰å®šä¹‰è¯´çš„é‚£æ ·ï¼Œåªéœ€è¦è®°å½•ç”¨æˆ·è¿›å…¥é¡µé¢çš„å¼€å§‹æ—¶é—´ï¼Œè®°å½•headåŠ è½½å®Œæˆçš„æ—¶é—´ï¼Œè®°å½•ä¸¤è€…çš„å·®å€¼ï¼Œè¿™å°±æ˜¯æ‰€è¯´çš„ç™½å±æ—¶é—´ã€‚è®¡ç®—çš„æ—¶å€™å¯ä»¥åˆ†åˆ«è·å–ä¸¤ä¸ªæ—¶é—´ï¼Œè®¡ç®—ä»–ä»¬çš„å·®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨&lt;a href=&#34;https://developer.mozilla.org/zh-CN/docs/Web/API/Performance/mark&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;performance.mark&lt;/a&gt;ï¼Œåœ¨å¼€å§‹åœ°ç‚¹æ ‡è®°æˆ–è€…è¯´æ‰“ç‚¹ï¼Œåœ¨ç»“æŸåœ°ç‚¹è·å–è¿™ä¸ª&lt;code&gt;entry&lt;/code&gt;ï¼Œæ‹¿åˆ°å®ƒçš„&lt;code&gt;duration&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html lang=&amp;quot;en&amp;quot;&amp;gt;
&amp;lt;head&amp;gt;
	&amp;lt;meta charset=&amp;quot;UTF-8&amp;quot;&amp;gt;
	&amp;lt;title&amp;gt;ç™½å±æ—¶é—´&amp;lt;/title&amp;gt;
	&amp;lt;script&amp;gt;
		window.startTime = Date.now();
    // performance.mark(&amp;quot;timeStr&amp;quot;);
	&amp;lt;/script&amp;gt;
	&amp;lt;link rel=&amp;quot;stylesheet&amp;quot; href=&amp;quot;&amp;quot;&amp;gt;
	&amp;lt;script src=&amp;quot;&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
	&amp;lt;script&amp;gt;
		window.endTime = Date.now()
    // const timeStrEntries = performance.getEntriesByName(&amp;quot;timeStrEntries&amp;quot;);
    // console.log(timeStrEntries[0].duration)
	&amp;lt;/script&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;

&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦å¤–è¿˜æœ‰ä¸€ç§æ–¹å¼ï¼Œä½¿ç”¨&lt;code&gt;window.performance&lt;/code&gt;ï¼Œåœ¨&lt;code&gt;timing&lt;/code&gt;å¯¹è±¡ä¸­ï¼ŒåŒ…å«äº†å„ç§æ—¶é—´ç›¸å…³çš„å±æ€§ï¼Œå…¶ä¸­&lt;code&gt;domLoading&lt;/code&gt;å±æ€§ä»£è¡¨å¼€å§‹è§£æ&lt;code&gt;DOM&lt;/code&gt;å…ƒç´ çš„æ—¶é—´ï¼Œ&lt;code&gt;fetchStart&lt;/code&gt;å±æ€§ä»£è¡¨å‘é€è¯·æ±‚å‰çš„æ—¶é—´ï¼Œä¸¤è€…ä¹‹å·®ä¹Ÿå¯ä»¥è®¡ç®—ç™½å±æ—¶é—´&lt;/p&gt;

&lt;p&gt;å¯¹äºå…·ä½“çš„æ—¶é—´ä¼˜åŒ–ï¼Œå¯ä»¥é’ˆå¯¹æ•´ä¸ªé¡µé¢æ¸²æŸ“çš„è¿‡ç¨‹æ¥å¤„ç†ã€‚è¿™é‡Œè¯´ä¸€ä¸‹ï¼š&lt;code&gt;é¢„æ¸²æŸ“&lt;/code&gt;ã€&lt;code&gt;æœåŠ¡ç«¯æ¸²æŸ“&lt;/code&gt;ã€&lt;code&gt;ä½¿ç”¨éª¨æ¶å±&lt;/code&gt;ï¼Œè¿™ä¹Ÿå¯ä»¥è¯´æ˜¯ç”¨æˆ·çš„ä½“éªŒä¼˜åŒ–&lt;/p&gt;

&lt;p&gt;é¦–å…ˆé¢„æ¸²æŸ“ï¼Œä¸»è¦æ˜¯ç”¨&lt;code&gt;prerender-spa-plugin&lt;/code&gt;æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;prerender-spa-plugin åˆ©ç”¨äº† Puppeteer çš„çˆ¬å–é¡µé¢çš„åŠŸèƒ½ã€‚ Puppeteer æ˜¯ Google Chrome å›¢é˜Ÿå®˜æ–¹çš„æ— ç•Œé¢ï¼ˆHeadlessï¼‰Chrome å·¥å…·ï¼Œå®ƒæ˜¯ä¸€ä¸ª Node åº“ï¼Œæä¾›äº†ä¸€ä¸ªé«˜çº§çš„ API æ¥æ§åˆ¶ DevTools åè®®ä¸Šçš„æ— å¤´ç‰ˆ Chrome ã€‚prerender-spa-plugin åŸç†æ˜¯åœ¨ Webpack æ„å»ºé˜¶æ®µçš„æœ€åï¼Œåœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ª Puppeteer çš„æœåŠ¡ï¼Œè®¿é—®é…ç½®äº†é¢„æ¸²æŸ“çš„è·¯ç”±ï¼Œç„¶åå°† Puppeteer ä¸­æ¸²æŸ“çš„é¡µé¢è¾“å‡ºåˆ° HTML æ–‡ä»¶ä¸­ï¼Œå¹¶å»ºç«‹è·¯ç”±å¯¹åº”çš„ç›®å½•ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;é¦–å…ˆè¯·æ±‚åˆ°å¯¹åº”çš„è·¯ç”±æˆ–è€…é¡µé¢ä¹‹åï¼Œ&lt;code&gt;Puppeteer&lt;/code&gt;ä¼šè·å–æ¸²æŸ“çš„é¡µé¢çš„é™æ€éƒ¨åˆ†å†…å®¹å¹¶æ›¿æ¢æ‰“åŒ…å‡ºæ¥çš„&lt;code&gt;html&lt;/code&gt;æ–‡ä»¶ï¼Œè¾¾åˆ°é¢„æ¸²æŸ“çš„ç›®çš„ï¼Œé¡µé¢åŠ è½½å®Œæˆä¹‹å‰å‘ˆç°ç»™ç”¨æˆ·éƒ¨åˆ†å†…å®¹ï¼Œç»™ç”¨æˆ·ä¸€ä¸ªç›¸å¯¹å¥½çš„ä½“éªŒã€‚ä½†æ˜¯ç¼ºç‚¹æ˜¯é¢„æ¸²æŸ“å‡ºçš„å†…å®¹å¾€å¾€ä¸æœ€ç»ˆæ¸²æŸ“çš„é¡µé¢å†…å®¹ä¸åŒï¼Œå› ä¸ºé¡µé¢ä¼šæœ‰ç›¸åº”çš„äº¤äº’æˆ–è€…æ•°æ®çš„å˜åŒ–ï¼Œæ‰€ä»¥æœ€å¥½å¯¹äºä¸€äº›é™æ€é¡µé¢æ‰ç”¨è¿™ç§æ–¹å¼å¤„ç†ã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆåœ¨å¯¹åº”çš„&lt;code&gt;webpack&lt;/code&gt;é…ç½®æ–‡ä»¶ä¸­æ·»åŠ è¿™ä¸ªæ’ä»¶çš„é…ç½®&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const PrerenderSPAPlugin = require(&#39;prerender-spa-plugin&#39;);
const Renderer = PrerenderSPAPlugin.PuppeteerRenderer;
const path = require(&#39;path&#39;);

module.exports = {
  plugins: [new PrerenderSPAPlugin({
    staticDir: path.join(__dirname, &#39;dist&#39;),
    routes: [ &#39;/&#39; ], // éœ€è¦é¢„æ¸²æŸ“çš„è·¯ç”±,
    renderer: new Renderer({
        headless: true, // å¼€å¯æ— å¤´æµè§ˆå™¨
        renderAfterDocumentEvent: &#39;render-event&#39;, 
    }),
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶ååœ¨é¡µé¢è§¦å‘&lt;code&gt;render-event&lt;/code&gt;äº‹ä»¶ï¼Œå‘Šè¯‰&lt;code&gt;Puppeteer&lt;/code&gt;å»çˆ¬å–è¿™ä¸ªé¡µé¢ï¼Œè¿™é‡Œä»¥&lt;code&gt;vue&lt;/code&gt;ä¸ºä¾‹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;export default {
  mounted() {
    document.dispatchEvent(new Event(&#39;render-event&#39;));
  }
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åè®¿é—®å¯¹åº”çš„&lt;code&gt;route&lt;/code&gt;ï¼Œåœ¨&lt;code&gt;index.html&lt;/code&gt;ä¸­å°±å¯ä»¥çœ‹åˆ°ç›¸åº”çš„å†…å®¹äº†ã€‚å®é™…åº”ç”¨ä¸­åœ¨é™æ€é¡µé¢ä¸­çš„æ—¶å€™ï¼Œåº”å½“å¦å¤–æŒ‡å®šå¯¹åº”çš„&lt;code&gt;html&lt;/code&gt;æ–‡ä»¶ï¼Œå¦‚æœé…ç½®äº†&lt;code&gt;CDN&lt;/code&gt;ï¼Œé‚£ä¹ˆåœ¨æœ¬åœ°å¼€å‘çš„æ—¶å€™ï¼Œåº”è¯¥å°†&lt;code&gt;CDN&lt;/code&gt;åœ°å€æ›¿æ¢ä¸ºæœ¬åœ°åœ°å€ï¼Œè¿™ä¸ªæ’ä»¶ä¹Ÿæä¾›äº†&lt;code&gt;server&lt;/code&gt;é€‰é¡¹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;server: {
  port: 80,
  proxy: {
    ......
    target: &#39;http://localhost&#39;,
    changeOrigin: true,
    ......
  }
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æœåŠ¡ç«¯æ¸²æŸ“&lt;/p&gt;

&lt;p&gt;æœåŠ¡ç«¯æ¸²æŸ“æ˜¯ç”±æœåŠ¡ç«¯å°†æ¸²æŸ“å¥½çš„&lt;code&gt;html&lt;/code&gt;å­—ç¬¦ä¸²ç›´æ¥è¿”ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ¥å—åˆ°å¯¹åº”çš„&lt;code&gt;html&lt;/code&gt;å­—ç¬¦ä¸²åï¼Œè§£ææ¸²æŸ“å‘ˆç°å‡ºç›¸åº”çš„é¡µé¢ã€‚å®¢æˆ·ç«¯æ¸²æŸ“æ—¶ï¼Œå®¢æˆ·ç«¯éœ€è¦å»è¯·æ±‚ç›¸åº”çš„æ¥å£å–å¾—ç›¸åº”çš„æ•°æ®ç„¶åæ¸²æŸ“å‡º&lt;code&gt;html&lt;/code&gt;é¡µé¢ï¼Œå› æ­¤ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“ç™½å±æ—¶é—´ç›¸å¯¹è¾ƒçŸ­ã€‚è¿˜æœ‰ä¸ªé¢å¤–çš„å¥½å¤„å½“ç„¶æ˜¯åˆ©äºSEOï¼Œè¿™ä¸ªä½œç”¨ææ€•è¿˜åœ¨ç™½å±ä¼˜åŒ–ä¹‹ä¸Šã€‚å®¢æˆ·ç«¯æ¸²æŸ“ä¸€å¼€å§‹çš„é¡µé¢ä¸ºç©ºï¼Œåœ¨æŸäº›çˆ¬è™«æ¥çˆ¬çš„æ—¶å€™ä»€ä¹ˆä¸œè¥¿éƒ½è·å–ä¸åˆ°ï¼Œæ‰€ä»¥ä¸åˆ©äºSEOï¼Œå½“ç„¶è¿™æ˜¯åè¯äº†ã€‚ç°åœ¨æˆ‘ä»¬è¿™ç”¨çš„æ¯”è¾ƒå¤šçš„ï¼Œä¸€èˆ¬æ˜¯ä»¥&lt;code&gt;nodejs&lt;/code&gt;ä¸ºä¸­é—´å±‚ï¼Œæ¥å—åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œå‘é€çœŸæ­£çš„è¯·æ±‚åˆ°åå°ï¼Œéšååœ¨&lt;code&gt;nodejs&lt;/code&gt;ä¸­å¤„ç†å®Œå¯¹åº”çš„æ•°æ®ï¼Œæ¸²æŸ“é¡µé¢ã€‚ç°åœ¨ä»¥&lt;code&gt;react&lt;/code&gt;ã€&lt;code&gt;vue&lt;/code&gt;ä¸ºåŸºç¡€ï¼Œä¹Ÿæœ‰å„è‡ªå¯¹åº”çš„æœåŠ¡ç«¯æ¸²æŸ“æ–¹æ¡ˆï¼Œå¦‚&lt;code&gt;next.js&lt;/code&gt;ã€&lt;code&gt;nuxt.js&lt;/code&gt;è¿™é‡Œå°±ä¸ä»‹ç»äº†&lt;/p&gt;

&lt;p&gt;éª¨æ¶å±&lt;/p&gt;

&lt;p&gt;éª¨æ¶å±å¯ä»¥çœ‹åšç”¨æ¥ä»£æ›¿é¡µé¢&lt;code&gt;loading&lt;/code&gt;æ•ˆæœçš„ä¸€ç§æ–¹æ¡ˆï¼Œåœ¨é¡µé¢åŠ è½½å®Œæˆä¹‹å‰ï¼Œå‘ˆç°å‡ºé¡µé¢çš„ä¸€ä¸ªå¤§è‡´ç»“æ„ï¼Œç»™ç”¨æˆ·ä¸€ä¸ªè‰¯å¥½çš„ä½“éªŒï¼Œè®©ä»–è§‰å¾—è¿™ä¸ªé¡µé¢æ­£åœ¨ç¼“æ…¢åŠ è½½ï¼Œè¿™ç§æ•ˆæœçœ‹èµ·æ¥ä¹Ÿæ¯”å•çº¯çš„æ”¾ä¸€å¼ èŠèŠ±å›¾ã€ä¸€å¼ åŠ è½½åŠ¨ç”»å¥½ä¸€äº›ã€‚è¿™ä¸ªæ–¹æ¡ˆæ›´å¤šçš„æ˜¯å¸¦æ¥æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚æ‰‹å†™éª¨æ¶å±ï¼Œé¦–å…ˆç¡®å®šé¡µé¢çš„åŸºæœ¬ç»“æ„ï¼Œç„¶åæŒ‰ç…§è¿™ä¸ªç»“æ„å†™ä¸€ä¸ªç±»ä¼¼çš„åŠ è½½é¡µé¢ï¼Œè¿™ä¸ªç”±è®¾è®¡æ¥å®šã€‚ä»¥ä¸‹ä»‹ç»ä½¿ç”¨&lt;code&gt;webpack(4.0+)&lt;/code&gt;æ¥å†™ä¸€ä¸ªç®€å•çš„éª¨æ¶å±æ’ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆå®šä¹‰ä¸€ä¸ªéª¨æ¶å±æ’ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const HtmlWebpackPlugin = require(&#39;html-webpack-plugin&#39;)

let Skeleton = function (options) {
  // æ¥æ”¶ä¼ å…¥çš„å‚æ•°
}

Skeleton.prototype.apply = function (compiler) {
  compiler.plugin(&#39;compilation&#39;, compilation =&amp;gt; {
    HtmlWebpackPlugin.getHooks(compilation).beforeEmit.tapAsync(
      &#39;Skeleton&#39;,
      (htmlData, cb) =&amp;gt; {
        htmlData.html = htmlData.html.replace(&#39;&amp;lt;div id=&amp;quot;root&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&#39;, `éª¨æ¶å±ä»£ç `)
        cb(null, htmlData)
      }
    )
  })
}

module.exports = Skeleton
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶å&lt;code&gt;webpack&lt;/code&gt;é…ç½®æ–‡ä»¶ä¸­å¼•å…¥å³å¯&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;...
new HtmlWebPackPlugin({
  template: &#39;public/index.html&#39;,
  filename: &#39;index.html&#39;,
  inject: true
}),
new Skeleton({
  template: &#39;public/index.html&#39;
})
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;1.ä»¥ä¸Šé¦–å…ˆå®šä¹‰ä¸€ä¸ªæ’ä»¶å¯¹è±¡&lt;code&gt;Skeleton&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;2.å¼•å…¥&lt;code&gt;html-webpack-plugin&lt;/code&gt;ï¼Œåœ¨&lt;code&gt;html-webpack-plugin&lt;/code&gt;çš„é’©å­å‡½æ•°&lt;code&gt;beforeEmit&lt;/code&gt;ä¸­ï¼Œè°ƒç”¨è¿™ä¸ª&lt;code&gt;Skeleton&lt;/code&gt;å¯¹è±¡ï¼Œ&lt;/p&gt;

&lt;p&gt;&lt;code&gt;beforeEmit&lt;/code&gt;è¿™ä¸ªé’©å­å‡½æ•°çš„ä½œç”¨åœ¨äº&lt;code&gt;html-webpack-plugin&lt;/code&gt;æ’ä»¶å°†ç”Ÿæˆçš„&lt;code&gt;html&lt;/code&gt;æ’å…¥æ¨¡æ¿æ–‡ä»¶å‰è¿›è¡Œçš„æ“ä½œã€‚è¿™é‡Œå°±ç›¸å½“äºåœ¨ç”ŸæˆçœŸæ­£çš„&lt;code&gt;html&lt;/code&gt;ä»£ç ä¹‹å‰è°ƒç”¨ç”Ÿæˆéª¨æ¶å±é¡µé¢ã€‚&lt;/p&gt;

&lt;p&gt;3.è°ƒç”¨&lt;code&gt;cb&lt;/code&gt;ï¼Œä¼ å›&lt;code&gt;html&lt;/code&gt;å†…å®¹&lt;/p&gt;

&lt;p&gt;4.éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ&lt;code&gt;replace&lt;/code&gt;ä¸­çš„éœ€è¦æ›¿æ¢çš„æ ¹å…ƒç´ ã€ç±»åä¸è¦æé”™äº†ã€‚&lt;/p&gt;

&lt;p&gt;å…¶ä½™çš„ï¼Œæ ¹æ®ä¸åŒçš„è·¯å¾„ï¼Œå…¥å£å¯ä»¥å°†å‚æ•°ä¼ å…¥è¿™ä¸ªæ„é€ å‡½æ•°ä¸­ï¼Œç„¶ååˆ¤æ–­æ˜¾ç¤ºä¸åŒçš„éª¨æ¶å±ã€‚æœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯å¤ç”¨æ€§ä¸å¼ºï¼Œä¹Ÿè®¸ä¼šéšç€é¡µé¢çš„è¿­ä»£è€Œç»å¸¸å˜åŠ¨ï¼Œç»´æŠ¤èµ·æ¥ä¹Ÿå¾ˆéº»çƒ¦ã€‚&lt;/p&gt;

&lt;p&gt;è¿˜æœ‰äº›å…¶ä»–è‡ªåŠ¨ç”Ÿæˆéª¨æ¶å±çš„å¼€æºæ–¹æ¡ˆã€‚æ¯”å¦‚é¥¿äº†ä¹ˆå¼€æºçš„&lt;code&gt;page-skeleton-webpack-plugin&lt;/code&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡ &lt;a href=&#34;https://link.zhihu.com/?target=https%3A//github.com/GoogleChrome/puppeteer&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;puppeteer&lt;/a&gt; åœ¨æœåŠ¡ç«¯æ“æ§ &lt;a href=&#34;https://link.zhihu.com/?target=https%3A//developers.google.com/web/updates/2017/04/headless-chrome&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;headless Chrome&lt;/a&gt; æ‰“å¼€å¼€å‘ä¸­çš„éœ€è¦ç”Ÿæˆéª¨æ¶å±çš„é¡µé¢ï¼Œåœ¨ç­‰å¾…é¡µé¢åŠ è½½æ¸²æŸ“å®Œæˆä¹‹åï¼Œåœ¨ä¿ç•™é¡µé¢å¸ƒå±€æ ·å¼çš„å‰æä¸‹ï¼Œé€šè¿‡å¯¹é¡µé¢ä¸­å…ƒç´ è¿›è¡Œåˆ å‡æˆ–å¢æ·»ï¼Œå¯¹å·²æœ‰å…ƒç´ é€šè¿‡å±‚å æ ·å¼è¿›è¡Œè¦†ç›–ï¼Œè¿™æ ·è¾¾åˆ°åœ¨ä¸æ”¹å˜é¡µé¢å¸ƒå±€ä¸‹ï¼Œéšè—å›¾ç‰‡å’Œæ–‡å­—ï¼Œé€šè¿‡æ ·å¼è¦†ç›–ï¼Œä½¿å¾—å…¶å±•ç¤ºä¸ºç°è‰²å—ã€‚ç„¶åå°†ä¿®æ”¹åçš„ HTML å’Œ CSS æ ·å¼æå–å‡ºæ¥ï¼Œè¿™æ ·å°±æ˜¯éª¨æ¶å±äº†&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å®ƒçš„å¤§è‡´åŸç†ï¼Œå°±æ˜¯åˆ©ç”¨&lt;code&gt;puppeteer&lt;/code&gt;è·å–é¡µé¢ç»“æ„ï¼Œå°†ä¸åŒçš„èŠ‚ç‚¹åˆ†ç±»å¤„ç†ï¼Œå±•ç°ä¸åŒçš„&amp;rsquo;éª¨æ¶æ•ˆæœ&amp;rsquo;ï¼Œæœ€åå®é™…æ¸²æŸ“çš„æ—¶å€™ï¼Œè¿›è¡Œç›¸åº”çš„æ›¿æ¢ã€‚ä½†æ˜¯å°±é’ˆå¯¹äºè¿™ä¸ªé¡¹ç›®&lt;code&gt;page-skeleton-webpack-plugin&lt;/code&gt;æ¥è¯´ï¼Œå‘æ¯”è¾ƒå¤šï¼Œè€Œä¸”ä¸æ”¯æŒ&lt;code&gt;webpack4&lt;/code&gt;ï¼Œæ…é‡ä½¿ç”¨ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Webpackæ‰“åŒ…ä¼˜åŒ–</title>
      <link>https://xtid.github.io/2020/webpack%E6%89%93%E5%8C%85%E4%BC%98%E5%8C%96/</link>
      <pubDate>Mon, 07 Sep 2020 22:03:34 +0800</pubDate>
      
      <guid>https://xtid.github.io/2020/webpack%E6%89%93%E5%8C%85%E4%BC%98%E5%8C%96/</guid>
      <description>&lt;p&gt;ä¹‹å‰äº†è§£äº†&lt;code&gt;webpack&lt;/code&gt;çš„åŸºæœ¬æ‰“åŒ…æµç¨‹æˆ–è€…è¯´åŸç†ï¼Œå¦‚æœåªæ˜¯é…ç½®ä¸€ä¸ªåŸºæœ¬çš„&lt;code&gt;webpack&lt;/code&gt;æ‰“åŒ…é…ç½®ï¼Œ
æ‰“åŒ…åçš„æ–‡ä»¶ä¼šå˜å¾—å¾ˆå¤§ï¼Œå½“ä½ é¡¹ç›®éƒ¨ç½²åï¼Œç”¨æˆ·æ‰“å¼€å¯¹åº”çš„ç•Œé¢ï¼Œä¹Ÿè®¸ä¼šå¾ˆé•¿æ—¶é—´æ‰åŠ è½½å®Œ(å½“ç„¶å’Œç½‘ç»œç¯å¢ƒæˆ–ç¡¬ä»¶è®¾å¤‡ä¹Ÿæœ‰å…³ç³»)ï¼Œå°¤å…¶æ˜¯å•é¡µé¢åº”ç”¨æ•ˆæœå¾ˆæ˜æ˜¾ï¼Œè¿™æ ·çš„ç”¨æˆ·ä½“éªŒè‡ªç„¶æ˜¯ä¸å¥½çš„ï¼Œæ‰€ä»¥æ­¤æ–‡ç« ä¸»è¦æ˜¯å¯¹&lt;code&gt;webpack&lt;/code&gt;æ‰“åŒ…ä¼˜åŒ–çš„ä¸€ä¸ªå°å°æ€»ç»“&lt;/p&gt;

&lt;p&gt;é¦–å…ˆæ­å»ºå¥½ä¸€ä¸ªåŸºæœ¬çš„é¡¹ç›®ï¼Œç›®å½•ç»“æ„&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;â”œâ”€â”€ dist // æ‰“åŒ…ç›®å½•
â”‚Â Â  â”œâ”€â”€ bundle.js // æ‰“åŒ…åçš„js
â”‚Â Â  â””â”€â”€ index.html // å…¥å£htmlæ–‡ä»¶
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ public
â”‚Â Â  â””â”€â”€ index.html // htmlæ¨¡æ¿æ–‡ä»¶
â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ actions // redux actionsæ–‡ä»¶
â”‚Â Â  â”‚Â Â  â””â”€â”€ index.js
â”‚Â Â  â”œâ”€â”€ app.js // webpackæ‰“åŒ…å…¥å£æ–‡ä»¶ï¼Œä¹Ÿæ˜¯é¡¹ç›®çš„å…¥å£æ–‡ä»¶
â”‚Â Â  â”œâ”€â”€ assets // scss
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ about.scss
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ title.scss
â”‚Â Â  â”‚Â Â  â””â”€â”€ user.scss
â”‚Â Â  â”œâ”€â”€ dev.js // å¼€å‘æ—¶çš„ä¸€äº›é…ç½®
â”‚Â Â  â”œâ”€â”€ pages // pageé¡µé¢
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ about.jsx
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.jsx
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ title.jsx
â”‚Â Â  â”‚Â Â  â””â”€â”€ user.jsx
â”‚Â Â  â”œâ”€â”€ reducers // reduxä¸­çš„reducer
â”‚Â Â  â”‚Â Â  â””â”€â”€ index.js
â”‚Â Â  â””â”€â”€ store.js
â””â”€â”€ webpack.config.js
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;webpack&lt;/code&gt;åŸºæœ¬é…ç½®å¦‚ä¸‹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const path = require(&#39;path&#39;)
const HtmlWebPackPlugin = require(&#39;html-webpack-plugin&#39;)

module.exports = {
  entry: &#39;./src/app.js&#39;,
  output: {
    path: path.resolve(__dirname, &#39;./dist/&#39;),
    filename: &#39;bundle.js&#39;
  },
  resolve: {
    extensions: [&#39;.wasm&#39;, &#39;.mjs&#39;, &#39;.js&#39;, &#39;.json&#39;, &#39;.jsx&#39;]
  },

  devServer: {
    contentBase: path.join(__dirname, &#39;./src/&#39;),
    publicPath: &#39;/&#39;,
    host: &#39;127.0.0.1&#39;,
    port: 3000,
    hot: true,
    stats: {
      colors: true
    }
  },
  module: {
    rules: [{
      test: /\.jsx?$/,
      exclude: /node_modules/,
      use: {
        loader: &#39;babel-loader&#39;
      }
    }, {
      test: /\.scss$/,
      use: [&#39;style-loader&#39;, &#39;css-loader&#39;, &#39;sass-loader&#39;]
    }]
  },
  plugins: [
    new HtmlWebPackPlugin({
      template: &#39;public/index.html&#39;,
      filename: &#39;index.html&#39;,
      inject: true
    })
  ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¼˜åŒ–ï¼š&lt;/p&gt;

&lt;p&gt;1.åŸºç¡€ä¼˜åŒ–&lt;/p&gt;

&lt;p&gt;é…ç½®&lt;code&gt;loader&lt;/code&gt;ï¼Œæ·»åŠ &lt;code&gt;exclude&lt;/code&gt;ã€&lt;code&gt;include&lt;/code&gt;ç¼©å°æœç´¢èŒƒå›´ï¼Œæ¯”å¦‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;{
  test: /\.jsx?$/,
    exclude: /node_modules/, // è¿‡æ»¤node_modules
    use: {
    	loader: &#39;babel-loader&#39;
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;2.ä½¿ç”¨&lt;code&gt;DllPlugin&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;å°†ä¸€äº›å˜åŠ¨è¾ƒå°‘æˆ–è€…æ ¹æœ¬ä¸ä¼šå˜åŠ¨çš„åº“å…ˆæ‰“åŒ…ç”Ÿæˆå¯¹åº”çš„&lt;code&gt;.dll.js&lt;/code&gt;ï¼Œåœ¨&lt;code&gt;webpack&lt;/code&gt;æ‰“åŒ…çš„æ—¶å€™ï¼Œå°†è¿™äº›èµ„æºå¼•å…¥&lt;/p&gt;

&lt;p&gt;é¦–å…ˆæ–°å»ºä¸€ä¸ª&lt;code&gt;webpack.config.dll.js&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const path = require(&#39;path&#39;);
const DllPlugin = require(&#39;webpack/lib/DllPlugin&#39;);

module.exports = {
  entry: {
    react: [&#39;react&#39;, &#39;react-dom&#39;]
  },
  output: {
    filename: &#39;[name].dll.js&#39;,
    // ç”Ÿæˆçš„æ–‡ä»¶ç›®å½•
    path: path.resolve(__dirname, &#39;dist&#39;),
    // åŠ¨æ€é“¾æ¥åº“åç§°
    library: &#39;_dll_[name]&#39;
  },
  plugins: [
    new DllPlugin({
      name: &#39;_dll_[name]&#39;,
      path: path.join(__dirname, &#39;dist&#39;, &#39;[name].manifest.json&#39;),
      context: __dirname, 
    })
  ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶ååœ¨&lt;code&gt;package.json&lt;/code&gt;çš„&lt;code&gt;scripts&lt;/code&gt;ä¸­æ·»åŠ dllæ‰“åŒ…å‘½ä»¤&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;webpack --config webpack.config.dll.js
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åè¿è¡Œæ­¤å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°ä¼šåœ¨&lt;code&gt;dist&lt;/code&gt;ç›®å½•ä¸‹é¢ç”Ÿæˆ&lt;code&gt;react.dll&lt;/code&gt;ï¼Œ&lt;code&gt;react.manifest.json&lt;/code&gt;ä¸¤ä¸ªæ–‡ä»¶ï¼Œè¿™å°±æ˜¯ç”Ÿæˆçš„&lt;code&gt;dll&lt;/code&gt;æ–‡ä»¶ï¼Œç„¶å&lt;code&gt;webpack.config.js&lt;/code&gt;é‡Œé¢æ·»åŠ é…ç½®ï¼Œæ‰“åŒ…æ—¶å¼•å…¥è¿™äº›çš„&lt;code&gt;dll&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆå®‰è£…æ’ä»¶&lt;code&gt;add-asset-html-webpack-plugin&lt;/code&gt;ï¼Œå¼•å…¥&lt;code&gt;DllReferencePlugin&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const DllReferencePlugin = require(&#39;webpack/lib/DllReferencePlugin&#39;)
const AddAssetHtmlPlugin = require(&#39;add-asset-html-webpack-plugin&#39;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ’ä»¶é‡Œé¢é…ç½®(webpack4+)&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;new DllReferencePlugin({
  context: __dirname,
  manifest: require(&#39;./dist/react.manifest.json&#39;),
}),
new AddAssetHtmlPlugin({
  filepath: path.resolve(__dirname, &#39;./dist/react.dll.js&#39;)
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ ·æ‰“åŒ…æ—¶é¡µé¢å°±ä¼šå¼•å…¥&lt;code&gt;react.dll.js&lt;/code&gt;èµ„æºäº†ï¼Œä»è€Œå‡å°‘é‡å¤çš„èµ„æºæ‰“åŒ…ã€‚è¿™ç§æ–¹å¼å¯ä»¥ç®€å•çš„ç†è§£ä¸ºï¼ŒæŠ½å‡ºå…¬å…±æ¨¡å—æ‰“åŒ…ï¼Œç„¶åå¼•å…¥&lt;/p&gt;

&lt;p&gt;3.&lt;code&gt;splitChunks&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ä»¥å‰&lt;code&gt;webpack&lt;/code&gt;æ‹†åˆ†æ¨¡å—è¿˜ä¼šç”¨&lt;code&gt;CommonsChunkPlugin&lt;/code&gt;ï¼Œåœ¨&lt;code&gt;webpack4&lt;/code&gt;åï¼Œå¯ä»¥ç›´æ¥ç”¨&lt;code&gt;splitChunks&lt;/code&gt;æ¥ä»£æ›¿å®Œæˆè¿™é¡¹å·¥ä½œï¼Œåœ¨&lt;code&gt;optimization&lt;/code&gt;é‡Œé¢è®¾ç½®äº†&lt;code&gt;splitChunks&lt;/code&gt;åï¼Œæ‰“åŒ…åˆ†å‰²å‡ºæ¥çš„æ–‡ä»¶æ˜¯é»˜è®¤å‹ç¼©è¿‡çš„&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;splitChunks: {
  chunks: &amp;quot;async&amp;quot;, // &amp;quot;initial&amp;quot; | &amp;quot;all&amp;quot; | &amp;quot;async&amp;quot;ï¼Œå¯¹å“ªç§ä»£ç è¿›è¡Œåˆ†å‰²
  minSize: 30000, // è¶…è¿‡minSizeçš„åŒ…æ‰åšä»£ç åˆ†å‰²
  minChunks: 1, // ä¸€ä¸ªåŒ…è‡³å°‘è¢«ç”¨äº†å¤šå°‘æ¬¡çš„æ—¶å€™æ‰è¿›è¡Œä»£ç åˆ†å‰²
  maxAsyncRequests: 5, // æŒ‰éœ€åŠ è½½æœ€å¤šèƒ½åŠ è½½å¤šå°‘ä¸ªæ¨¡å—
  maxInitialRequests: 3, // å¯¹äºentryé‡Œé¢çš„æ–‡ä»¶åšä»£ç åˆ†å‰²æœ€å¤šèƒ½ç”Ÿæˆå¤šå°‘ä¸ªjsæ–‡ä»¶
  automaticNameDelimiter: &#39;~&#39;, // æ–‡ä»¶ç”Ÿæˆæ—¶çš„è¿æ¥ç¬¦
  name: true, // ä¸ºtrueçš„æ—¶å€™ï¼Œæ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶åç”±cacheGroupsé‡Œé¢è®¾ç½®çš„ä¸ºå‡†
  cacheGroups: {
    vendors: {
      test: /[\\/]node_modules[\\/]/, // åŒ¹é…å“ªäº›éœ€è¦åˆ†å‰²çš„æ¨¡å—
      priority: -10, // ä¼˜å…ˆçº§
     	filename: &#39;vendors.js&#39;// æ‰“åŒ…åˆ°ä¸€ä¸ªå«vendors.jsçš„æ–‡ä»¶
    },
    default: {
      minChunks: 2,
      priority: -20,
      reuseExistingChunk: true
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;4.&lt;code&gt;catch-loader&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ä¸€äº›æ€§èƒ½å¼€é”€è¾ƒå¤§çš„&lt;code&gt;loader&lt;/code&gt;ä¹‹å‰æ·»åŠ æ­¤ &lt;code&gt;loader&lt;/code&gt;ï¼Œä»¥å°†ç»“æœç¼“å­˜åˆ°ç£ç›˜é‡Œï¼Œä¸åšè¿‡å¤šä»‹ç»&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;module.exports = {
  module: {
    rules: [
      {
        test: /\.ext$/,
        use: [
          &#39;cache-loader&#39;,
          ...loaders
        ],
        include: path.resolve(&#39;src&#39;)
      }
    ]
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;5.&lt;code&gt;HappyPack&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;HappyPack&lt;/code&gt;ä½¿ç”¨&lt;code&gt;node&lt;/code&gt;å¤šçº¿ç¨‹è¿›è¡Œæ„å»ºæ¥æå‡æ„å»ºçš„é€Ÿåº¦ï¼Œä½¿ç”¨æƒ…å†µè¾ƒå°‘&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const HappyPack = require(&#39;happypack&#39;)
const os = require(&#39;os&#39;)
const happyThreadPool = HappyPack.ThreadPool({
  size: os.cpus().length
})

......
plugins: [
  new HtmlWebPackPlugin({
    template: &#39;public/index.html&#39;,
    filename: &#39;index.html&#39;,
    inject: true
  }),
  new HappyPack({
    id: &#39;happyBabel&#39;,
    loaders: [{
      loader: &#39;babel-loader?cacheDirectory=true&#39;,
    }],
    threadPool: happyThreadPool,
    verbose: true,
  })
],
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;6.&lt;code&gt;css&lt;/code&gt;çš„å‹ç¼©&lt;/p&gt;

&lt;p&gt;å¯¹äº&lt;code&gt;scss&lt;/code&gt;æ–‡ä»¶ï¼Œä¸€èˆ¬æ¥è®²ï¼Œä¾æ¬¡é…ç½®&lt;code&gt;sass-loader&lt;/code&gt;ã€&lt;code&gt;css-loader&lt;/code&gt;ã€&lt;code&gt;style-loader&lt;/code&gt;æ¥è¿›è¡Œå¤„ç†&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;{
  test: /\.scss$/,
  use: [&#39;style-loader&#39;, &#39;css-loader&#39;, &#39;sass-loader&#39;]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æœ€ååŠ è½½å®Œåçš„é¡µé¢&lt;code&gt;css&lt;/code&gt;ä¼šä»¥å†…è”æ ·å¼çš„å½¢å¼ç­¾å…¥åˆ°é¡µé¢ä¸­ã€‚åœ¨&lt;code&gt;webpack4&lt;/code&gt;ä¸­ä½¿ç”¨&lt;code&gt;mini-css-extract-plugin&lt;/code&gt;æ’ä»¶æ¥æå–ã€å‹ç¼©&lt;code&gt;css&lt;/code&gt;ã€‚é¦–å…ˆå°†&lt;code&gt;style-loade&lt;/code&gt;ç”¨&lt;code&gt;MiniCssExtractPlugin.loader&lt;/code&gt;ä»£æ›¿ï¼Œç„¶åä½¿ç”¨&lt;code&gt;MiniCssExtractPlugin&lt;/code&gt;æ’ä»¶ï¼Œæ‰“åŒ…å‡ºå¯¹åº”çš„æ–‡ä»¶ï¼Œå¹¶åœ¨é¡µé¢ä¸­å¼•å…¥å¯¹åº”çš„&lt;code&gt;css&lt;/code&gt;æ–‡ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const MiniCssExtractPlugin = require(&#39;mini-css-extract-plugin&#39;)

......

{
  test: /\.scss$/,
  use: [MiniCssExtractPlugin.loader, &#39;css-loader&#39;, &#39;sass-loader&#39;]
}

new MiniCssExtractPlugin({
  filename: &#39;[name].[hash:5].css&#39;,
  chunkFilename: &#39;[id].[hash:5].css&#39;
})

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;7.å›¾ç‰‡çš„å¤„ç†&lt;/p&gt;

&lt;p&gt;åŒæ ·çš„ï¼Œå…ˆç”¨&lt;code&gt;file-loader&lt;/code&gt;è§£æå›¾ç‰‡ä¿è¯webpackèƒ½å¤„ç†ï¼Œç„¶åå¯ä»¥ç”¨&lt;code&gt;image-webpack-loader&lt;/code&gt;å‹ç¼©å›¾ç‰‡ï¼Œæˆ–è€…è¯´ç”¨&lt;code&gt;url-loader&lt;/code&gt;å°†å›¾ç‰‡è½¬ä¸º&lt;code&gt;base64&lt;/code&gt;ç¼–ç çš„å½¢å¼ï¼Œä¸å¤šèµ˜è¿°&lt;/p&gt;

&lt;p&gt;8.CDNåŠ é€Ÿ
é€šå¸¸åœ¨æ‰“åŒ…ä¸­ï¼ŒæŠŠä¸å˜çš„ä¸€äº›é™æ€æ–‡ä»¶æ”¾åˆ°&lt;code&gt;CDN&lt;/code&gt;ä¸Šï¼Œå¯ä»¥ç›´è§‚åœ°å‡å°èµ„æºåŒ…å¤§å°ï¼Œæ¯”å¦‚é¡¹ç›®ä¸­ç”¨åˆ°äº†&lt;code&gt;clipboard.js&lt;/code&gt;ï¼Œç„¶ååœ¨æ¨¡æ¿&lt;code&gt;html&lt;/code&gt;ä¸­å¼•å…¥è¿™ä¸ªæ–‡ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;&amp;lt;script src=&amp;quot;https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.6/clipboard.min.js&amp;quot; defer&amp;gt;&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸€èˆ¬æ¥è®²ï¼Œè¿™ç§æ–¹å¼å¼•å…¥jsé™æ€æ–‡ä»¶ï¼Œé‚£ä¹ˆå…¨å±€å¯¹è±¡(å¦‚window)é‡Œé¢æ˜¯ä¼šæœ‰å¯¹åº”çš„å¯¹è±¡çš„ï¼Œå°±å¯ä»¥ç›´æ¥å¼•ç”¨å¯¹åº”çš„å¯¹è±¡ã€‚å½“ç„¶è¿˜å¯ä»¥åŠ ä¸Š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;externals: {
  clipboard: &#39;clipboard&#39;
},
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ ·å°±ä¿è¯äº†æ‰“åŒ…æ—¶ä¸æ‰“åŒ…&lt;code&gt;clipboard&lt;/code&gt;ï¼Œä¼˜åŒ–æ‰“åŒ…åçš„æ–‡ä»¶ä½“ç§¯&lt;/p&gt;

&lt;p&gt;è¿˜æœ‰ä¸€ç§æ–¹å¼å°±æ˜¯æŠŠæ‰€æœ‰çš„é™æ€èµ„æºï¼Œå¦‚&lt;code&gt;js&lt;/code&gt;ã€&lt;code&gt;css&lt;/code&gt;éƒ½æ”¾åœ¨ç›¸åº”çš„&lt;code&gt;CDN&lt;/code&gt;ä¸Šï¼Œåœ¨æ‰“åŒ…çš„&lt;code&gt;config&lt;/code&gt;ä¸­æŒ‡å®šå¯¹åº”èµ„æºçš„&lt;code&gt;CDN&lt;/code&gt;åŸŸåï¼ŒåŒæ ·é…ç½®&lt;code&gt;externals&lt;/code&gt;ã€‚ä½†å…¶å®è¿™ç§æ–¹å¼æœ‰ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹å°±æ˜¯ï¼Œå¦‚æœå…¨éƒ¨è¿™æ ·åšçš„è¯ï¼Œä¸‡ä¸€&lt;code&gt;CDN&lt;/code&gt;æŒ‚äº†ï¼Œæ•´ä¸ªé¡µé¢ä¹Ÿå°±æŒ‚äº†&lt;/p&gt;

&lt;p&gt;9.æŒ‰éœ€åŠ è½½&lt;/p&gt;

&lt;p&gt;ä»¥&lt;code&gt;react&lt;/code&gt;ä¸ºä¾‹ï¼Œä½¿ç”¨&lt;code&gt;react-loadable&lt;/code&gt;æ¥åšæŒ‰éœ€åŠ è½½ï¼Œä»¥å‰è¿˜æœ‰äº›å…¶å®ƒæ–¹æ³•è¿™é‡Œå°±ä¸èµ˜è¿°ã€‚ä¸»è¦æ˜¯é’ˆå¯¹&lt;code&gt;react-router&lt;/code&gt;åšä¸€ä¸ªå¤„ç†ï¼Œé¦–å…ˆå®‰è£…ä¾èµ–&lt;code&gt;react-loadable&lt;/code&gt;ï¼Œå…¥å£æ–‡ä»¶ä¸­å°è£…ä¸€ä¸ª&lt;code&gt;loading&lt;/code&gt;ç»„ä»¶ï¼Œç”¨äºé¡µé¢åŠ è½½æ—¶ç»™ä¸€ä¸ªæç¤ºï¼Œç„¶åå°è£…ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå¼‚æ­¥åŠ è½½è¿™äº›ç»„ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;import Loadable from &#39;react-loadable&#39;
const Loading = (props) =&amp;gt; {
  return &amp;lt;div&amp;gt;è¿™æ˜¯ä¸€ä¸ªloadingç»„ä»¶&amp;lt;/div&amp;gt;
};
const asyncLoad = loader =&amp;gt; Loadable({
  loader,
  loading: Loading
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»¥ä¸‹æœ‰ä¸‰ä¸ªé¡µé¢ï¼Œ&lt;code&gt;index&lt;/code&gt;ã€&lt;code&gt;about&lt;/code&gt;ã€&lt;code&gt;user&lt;/code&gt;ï¼Œè°ƒç”¨&lt;code&gt;asyncLoad&lt;/code&gt;ï¼Œå¼•å…¥è¿™äº›æ–‡ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const Index = asyncLoad(() =&amp;gt; import(&#39;./pages/index&#39;))
const About = asyncLoad(() =&amp;gt; import(&#39;./pages/about&#39;))
const User = asyncLoad(() =&amp;gt; import(&#39;./pages/user&#39;))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å†é…ç½®å¥½è·¯ç”±ï¼Œè¿™æ ·æ‰“åŒ…å‡ºæ¥çš„&lt;code&gt;js&lt;/code&gt;æ–‡ä»¶å°±åªä¼šåœ¨å¯¹åº”é¡µé¢æˆ–è€…è¯´å¯¹åº”è·¯ç”±å‘½ä¸­æ—¶åŠ è½½äº†ï¼Œä»è€Œæå‡é¡µé¢çš„ä¸€ä¸ªåŠ è½½é€Ÿåº¦ï¼Œå½“ç„¶ä¹ŸæŠŠæ‰“åŒ…å‡ºæ¥çš„jsæ–‡ä»¶è¿›ä¸€æ­¥çš„åˆ†å‰²ï¼Œå‡å°ä½“ç§¯ï¼Œå½“ç„¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦åœ¨&lt;code&gt;webpack.config&lt;/code&gt;é‡Œé¢é…ç½®å¥½&lt;code&gt;chunFilename(æŒ‰éœ€åŠ è½½çš„chunkåå­—)&lt;/code&gt;ï¼Œèµ„æºçš„&lt;code&gt;publickPath&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;&amp;lt;Router&amp;gt;
  &amp;lt;Switch&amp;gt;
  	&amp;lt;Route path=&amp;quot;/&amp;quot; exact component={Index} /&amp;gt;
    &amp;lt;Route path=&amp;quot;/about/&amp;quot; component={About} /&amp;gt;
    &amp;lt;Route path=&amp;quot;/users/&amp;quot; component={User} /&amp;gt;
  &amp;lt;/Switch&amp;gt;
&amp;lt;/Router&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;webpack.config.js&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;output: {
  path: path.resolve(__dirname, &#39;./dist/&#39;),
  filename: &#39;[name].[hash:5].bundle.js&#39;,
  chunkFilename: &#39;[name].[hash:5].bundle.js&#39;,
  publicPath: &#39;/&#39;
},
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Webpackç†è§£</title>
      <link>https://xtid.github.io/2020/webpack%E7%90%86%E8%A7%A3/</link>
      <pubDate>Sun, 23 Aug 2020 21:36:20 +0800</pubDate>
      
      <guid>https://xtid.github.io/2020/webpack%E7%90%86%E8%A7%A3/</guid>
      <description>&lt;p&gt;&lt;code&gt;webpack&lt;/code&gt;æ˜¯ä¸€ä¸ªæ¨¡å—æ‰“åŒ…å™¨ï¼Œè€ä¸€ç‚¹çš„è¿˜æœ‰&lt;code&gt;gulp&lt;/code&gt;ã€&lt;code&gt;grunt&lt;/code&gt;ç­‰ç­‰ï¼Œ
ä»–æœ€æ˜¾è‘—çš„ç‰¹ç‚¹å°±æ˜¯å°†æ–‡ä»¶è§†ä¸ºä¸€ä¸ªä¸ªæ¨¡å—ï¼Œé€šè¿‡è®¾ç½®å…¥å£æ–‡ä»¶&lt;code&gt;entry&lt;/code&gt;ï¼ŒåŠ è½½ä¸åŒç±»å‹çš„æ–‡ä»¶ç”¨ä¸åŒ&lt;code&gt;loader&lt;/code&gt;è½¬æ¢æ–‡ä»¶ï¼Œ
ç„¶åä½¿ç”¨ä¸åŒ&lt;code&gt;plugin&lt;/code&gt;å¯¹æ–‡ä»¶å¤„ç†ï¼Œæœ€åè¾“å‡ºå¤šä¸ªæ‰“åŒ…ã€åˆ†å‰²åçš„æ–‡ä»¶&lt;/p&gt;

&lt;p&gt;é¦–å…ˆæœ‰å‡ ä¸ªæ¦‚å¿µ
1.entryï¼šå³&lt;code&gt;webpack&lt;/code&gt;æ‰“åŒ…çš„å…¥å£ï¼Œå‘Šè¯‰å®ƒåº”è¯¥ä»é‚£ä¸ªæ–‡ä»¶å¼€å§‹è¿›è¡Œæ„å»º
2.outputï¼šè®¾ç½®æ‰“åŒ…åæ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ä»¥åŠå¦‚ä½•å‘½åè¿™äº›æ–‡ä»¶
3.loaderï¼šå¤„ç†é‚£äº›é&lt;code&gt;javaScript&lt;/code&gt;æ–‡ä»¶ï¼Œé€šè¿‡æŒ‡å®šå¯¹åº”æ–‡ä»¶æ‰€éœ€çš„å¯¹åº”&lt;code&gt;loader&lt;/code&gt;çš„å¤„ç†ï¼Œå°†æ–‡ä»¶è½¬æ¢ä¸º&lt;code&gt;webpack&lt;/code&gt;èƒ½å¤Ÿå¤„ç†çš„æœ‰æ•ˆæ¨¡å—
4.pluginsï¼šè½¬æ¢æŸäº›ç±»å‹çš„æ¨¡å—ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œå¯ä»¥åšåˆ°æ‰“åŒ…ä¼˜åŒ–ï¼Œå‹ç¼©ä»¥åŠå„ç§å„æ ·çš„å…¶å®ƒä»»åŠ¡&lt;/p&gt;

&lt;p&gt;&lt;code&gt;bundle&lt;/code&gt;ï¼šè§†ä¸º&lt;code&gt;webpack&lt;/code&gt;æ‰“åŒ…æå–çš„æ¨¡å—ç”Ÿæˆçš„&lt;code&gt;js&lt;/code&gt;æ–‡ä»¶ï¼Œå°†å…¶å®ƒå…·ä½“æ¨¡å—çš„ä»£ç ä¼ å…¥å…¶ä¸­æ‰§è¡Œï¼ŒåŸæœ¬ç‹¬ç«‹çš„æ¨¡å—æ–‡ä»¶ï¼Œé€šè¿‡è°ƒç”¨&lt;code&gt;__webpack_require__&lt;/code&gt;ï¼Œåˆå¹¶åˆ°äº†&lt;code&gt;bundle&lt;/code&gt;ä¸­&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;(function(modules) {
/******/    var installedModules = {};
/******/
/******/    var installedChunks = {
/******/        2: 0
/******/    };
/******/
/******/    function __webpack_require__(moduleId) {
/******/
/******/        if(installedModules[moduleId]) {
/******/            return installedModules[moduleId].exports;
/******/        }
/******/        var module = installedModules[moduleId] = {
/******/            i: moduleId,
/******/            l: false,
/******/            exports: {}
/******/        };
/******/
/******/        modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/        module.l = true;
/******/
/******/        return module.exports;
/******/    }
/******/ })
/************************************************************************/
/******/ ({
	// ä¼ å…¥çš„æ¨¡å—
	......
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰“åŒ…åçš„&lt;code&gt;bundle&lt;/code&gt;æ˜¯ä¸€ä¸ªç«‹å³æ‰§è¡Œçš„åŒ¿åå‡½æ•°ï¼Œå…¶å‚æ•°å°±æ˜¯æ‰“åŒ…åçš„æ¨¡å—ï¼Œä¸Šé¢&lt;code&gt;__webpack_require__&lt;/code&gt;æ–¹æ³•ä¼šé¦–å…ˆåˆ¤æ–­å½“å‰æ¨¡å—&lt;code&gt;moduleId&lt;/code&gt;æ˜¯å¦å·²ç»å­˜åœ¨ç¼“å­˜&lt;code&gt;installedModules&lt;/code&gt;ä¸­ï¼Œè‹¥æ˜¯å­˜åœ¨åˆ™ç›´æ¥è¿”å›ã€‚è‹¥æ˜¯ä¸å­˜åœ¨ï¼Œåˆ™ä¼šæ„é€ ä¸€ä¸ªå¯¹è±¡å¹¶å°†å…¶åŒæ—¶å­˜åˆ°&lt;code&gt;installedModules&lt;/code&gt;ä¸­å’Œ&lt;code&gt;module&lt;/code&gt;ä¸­&lt;/p&gt;

&lt;p&gt;&lt;code&gt;modules[moduleId].call(module.exports, module, module.exports, __webpack_require__)&lt;/code&gt;
è¿™æ®µä»£ç é¦–å…ˆæ‰§è¡Œå½“å‰æ¨¡å—çš„å…·ä½“ä»£ç ï¼Œä¼ å…¥&lt;code&gt;module&lt;/code&gt;ï¼Œ&lt;code&gt;module.exports&lt;/code&gt;ï¼Œ&lt;code&gt;__webpack_require__&lt;/code&gt;ï¼Œé€’å½’è°ƒç”¨&lt;code&gt;__webpack_require__&lt;/code&gt;å¤„ç†æ¯ä¸ªæ¨¡å—ç§å¼•å…¥çš„å…¶å®ƒæ¨¡å—
å¦‚ä»¥ä¸‹å½¢å¼&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;/***/ 0:
/***/ (function(module, exports, __webpack_require__) {
	......
	__webpack_require__(1);
	module.exports = __webpack_require__(2);
	......

/***/ })
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸€ä¸ªç®€å•çš„bundleæ„å»ºè¿‡ç¨‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;// å¼•å…¥ç›¸å…³ä¾èµ–ï¼Œå¯¹æ–‡ä»¶è¿›è¡Œç¼–è¯‘è½¬æ¢è¾“å‡ºå¤„ç†
const fs = require(&#39;fs&#39;);
const path = require(&#39;path&#39;);
const parse = require(&#39;@babel/parser&#39;);
const traverse = require(&#39;@babel/traverse&#39;).default;
const babel = require(&#39;@babel/core&#39;);


let ID = 0;
// è¯»å–æ–‡ä»¶ä¿¡æ¯ï¼Œå¹¶è·å¾—å½“å‰jsæ–‡ä»¶çš„ä¾èµ–å…³ç³»
function createAsset(filename) {
  // è·å–æ–‡ä»¶ï¼Œè¿”å›å€¼æ˜¯å­—ç¬¦ä¸²
  const content = fs.readFileSync(filename, &#39;utf-8&#39;);

  // å°†å­—ç¬¦ä¸²è½¬ä¸ºast
  const ast = parse.parse(content, {
    sourceType: &#39;module&#39;
  });

  //ç”¨æ¥å­˜å‚¨ æ–‡ä»¶æ‰€ä¾èµ–çš„æ¨¡å—ï¼Œç®€å•æ¥è¯´å°±æ˜¯ï¼Œå½“å‰jsæ–‡ä»¶ import äº†å“ªäº›æ–‡ä»¶ï¼Œéƒ½ä¼šä¿å­˜åœ¨è¿™ä¸ªæ•°ç»„é‡Œ
  const dependencies = [];

  //éå†å½“å‰astï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰
  traverse(ast, {
    //æ‰¾åˆ°æœ‰ importè¯­æ³• çš„å¯¹åº”èŠ‚ç‚¹
    ImportDeclaration: ({ node }) =&amp;gt; {
      //æŠŠå½“å‰ä¾èµ–çš„æ¨¡å—åŠ å…¥åˆ°æ•°ç»„ä¸­
      dependencies.push(node.source.value);
    }
  });

  //æ¨¡å—çš„id ä»0å¼€å§‹ï¼Œ ç›¸å½“ä¸€ä¸ªjsæ–‡ä»¶ å¯ä»¥çœ‹æˆä¸€ä¸ªæ¨¡å—
  const id = ID++;

  //è¿™è¾¹ä¸»è¦æŠŠES6 çš„ä»£ç è½¬æˆ ES5
  const { code } = babel.transformFromAstSync(ast, null, {
    presets: [&#39;@babel/preset-env&#39;]
  });

  return {
    id,
    filename,
    dependencies,
    code
  };
}

// ä»å…¥å£å¼€å§‹åˆ†ææ‰€æœ‰ä¾èµ–é¡¹ï¼Œå½¢æˆä¾èµ–å›¾ï¼Œé‡‡ç”¨å¹¿åº¦éå†
function createGraph(entry) {
  const mainAsset = createAsset(entry);
    
  const queue = [mainAsset];

  for (const asset of queue) {
    const dirname = path.dirname(asset.filename);
    // æ–°å¢ä¸€ä¸ªå±æ€§æ¥ä¿å­˜å­ä¾èµ–é¡¹çš„æ•°æ®
    asset.mapping = {};
    asset.dependencies.forEach(relativePath =&amp;gt; {
      const absolutePath = path.join(dirname, relativePath);
      //è·å¾—å­ä¾èµ–ï¼ˆå­æ¨¡å—ï¼‰çš„ä¾èµ–é¡¹ã€ä»£ç ã€æ¨¡å—idï¼Œæ–‡ä»¶å
      const child = createAsset(absolutePath);
      //ç»™å­ä¾èµ–é¡¹èµ‹å€¼ï¼Œ
      asset.mapping[relativePath] = child.id;
      //å°†å­ä¾èµ–ä¹ŸåŠ å…¥é˜Ÿåˆ—ä¸­ï¼Œå¹¿åº¦éå†
      queue.push(child);
    });
  }
  return queue;
}

//æ ¹æ®ç”Ÿæˆçš„ä¾èµ–å…³ç³»å›¾ï¼Œç”Ÿæˆå¯¹åº”ç¯å¢ƒèƒ½æ‰§è¡Œçš„ä»£ç ï¼Œç›®å‰æ˜¯ç”Ÿäº§æµè§ˆå™¨å¯ä»¥æ‰§è¡Œçš„
function bundle(graph) {
  let modules = &#39;&#39;;

  //å¾ªç¯ä¾èµ–å…³ç³»ï¼Œå¹¶æŠŠæ¯ä¸ªæ¨¡å—ä¸­çš„ä»£ç å­˜åœ¨functionä½œç”¨åŸŸé‡Œ
  graph.forEach(mod =&amp;gt; {
    modules += `${mod.id}:[
      function (require, module, exports){
        ${mod.code}
      },
      ${JSON.stringify(mod.mapping)},
    ],`;
  });

  //require, module, exports æ˜¯ cjsçš„æ ‡å‡†ä¸èƒ½å†æµè§ˆå™¨ä¸­ç›´æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œæ¨¡æ‹Ÿcjsæ¨¡å—åŠ è½½ï¼Œæ‰§è¡Œï¼Œå¯¼å‡ºæ“ä½œã€‚
  const result = `
    (function(modules){
      //åˆ›å»ºrequireå‡½æ•°ï¼Œ å®ƒæ¥å—ä¸€ä¸ªæ¨¡å—IDï¼ˆè¿™ä¸ªæ¨¡å—idæ˜¯æ•°å­—0ï¼Œ1ï¼Œ2ï¼‰ ï¼Œå®ƒä¼šåœ¨æˆ‘ä»¬ä¸Šé¢å®šä¹‰ modules ä¸­æ‰¾åˆ°å¯¹åº”æ˜¯æ¨¡å—.
      function __webpack_require__(id){
        const [fn, mapping] = modules[id];
        function localRequire(relativePath){
          //æ ¹æ®æ¨¡å—çš„è·¯å¾„åœ¨mappingä¸­æ‰¾åˆ°å¯¹åº”çš„æ¨¡å—id
          return __webpack_require__(mapping[relativePath]);
        }
        const module = {exports:{}};
        //æ‰§è¡Œæ¯ä¸ªæ¨¡å—çš„ä»£ç ã€‚
        fn(localRequire,module,module.exports);
        return module.exports;
      }
      //æ‰§è¡Œå…¥å£æ–‡ä»¶ï¼Œ
      __webpack_require__(0);
    })({${modules}})
  `;

  return result;
}

// å…¥å£æ–‡ä»¶
const graph = createGraph(&#39;./entry.js&#39;);
// æ–‡ä»¶å†…å®¹
const ret = bundle(graph);

// æ‰“åŒ…ç”Ÿæˆæ–‡ä»¶
fs.writeFileSync(&#39;./bundle.js&#39;, ret);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;loader&lt;/code&gt;ï¼Œé€šè¿‡è®¾ç½®å¯¹åº”çš„&lt;code&gt;rule&lt;/code&gt;ï¼Œä½¿ç”¨ä¸åŒçš„&lt;code&gt;loader&lt;/code&gt;æ¥è½¬æ¢ã€å¤„ç†ä¸åŒçš„ç»„ä»¶ï¼Œæ¯”å¦‚&lt;code&gt;css&lt;/code&gt;æ–‡ä»¶ä½¿ç”¨&lt;code&gt;css-loader&lt;/code&gt;ä»¥åŠ&lt;code&gt;style-loader&lt;/code&gt;æ¥å¤„ç†&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;{
  test: /\.css$/,
  loader: &#39;style-loader!css-loader&#39;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§å†…è”&lt;code&gt;loader&lt;/code&gt;çš„å½¢å¼ï¼Œå³&lt;code&gt;import loader from &#39;......&#39;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ä¸¤ç§æ–¹å¼å¤„ç†çš„é¡ºåºä¹Ÿä¸åŒï¼Œå¤§è‡´æµç¨‹ä¸º
1.&lt;code&gt;webpack&lt;/code&gt;å¯åŠ¨åï¼Œåˆ›å»ºæ–°çš„&lt;code&gt;compilation&lt;/code&gt;
2.å®ä¾‹åŒ–&lt;code&gt;rules&lt;/code&gt;
3.è§£æ&lt;code&gt;inline loaders&lt;/code&gt;
4.è§£æ&lt;code&gt;config&lt;/code&gt;é…ç½®é‡Œé¢çš„&lt;code&gt;loaders&lt;/code&gt;
5.ç»„åˆè¿™ä¸¤ç§å½¢å¼çš„&lt;code&gt;loader&lt;/code&gt;ï¼Œæœ€ç»ˆè¾“å‡ºä¸Šè¯‰ç¬¬ä¸€ç§å½¢å¼çš„é…ç½®
6.ä½¿ç”¨&lt;code&gt;Loader-runner&lt;/code&gt;æŒ‰é…ç½®æ‰§è¡Œ&lt;code&gt;loader&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ä»¥ä¸‹ç®€å•å†™ä¸€ä¸ª&lt;code&gt;loader&lt;/code&gt;ï¼Œé¦–å…ˆå†™ä¸€ä¸ªæ–¹æ³•ç”¨äºåŠ è½½&lt;code&gt;loader&lt;/code&gt;ï¼Œå¹¶å¤„ç†ä¼ å…¥çš„æ¨¡å—ï¼Œç„¶åè¿”å›å¤„ç†å®Œäº†ä¹‹åçš„ä»£ç &lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;let source = ...... // sourceä¸ºè·å–åˆ°çš„æ¨¡å—çš„ä»£ç 
function loaderModule(loaderName) {
  // è·å–loaderè·¯å¾„
  const loaderPath = path.join(process.cwd(), loaderName)
  const loader = require(loaderPath)
  source = loader.call(_this, source)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®šä¹‰ä¸€ä¸ªè§„åˆ™&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;rules: [{
  test:/\.js/,
  use:[
    &#39;./loaderModule.js&#39;, // loaderçš„è·¯å¾„
  ]
}]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰§è¡Œçš„æ—¶å€™éå†&lt;code&gt;rules&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;for (let i = rules.length - 1; i &amp;gt;= 0; i--) {
  const { test, use } = rules[i]
  if (test.test(modulePath)) {
    // ä½¿ç”¨å¤šä¸ªloader
    if (Array.isArray(use)) {
      for (let j = use.length - 1; j &amp;gt;= 0; j--) {
        loaderModule(use[j])
      }
    } else if (typeof use === &#39;string&#39;) {
      loaderModule(use)
      // å¸¦å‚æ•°å‹çš„loader
    } else if (use instanceof Object) {
      loaderModule(use.loader, {
        query: use.options
      })
    }
  }
}

// loaderModule.jså†…å®¹
// loader-utilsæ˜¯webpackä¸€ä¸ªå·¥å…·ç±»ï¼Œç”¨äºè§£æloaderï¼Œè·å–é…ç½®çš„ä¸€äº›loaderå‚æ•°
const loaderUtils = require(&#39;loader-utils&#39;)

// è¿™ä¸ªç®€å•çš„loaderä¼šå°†jsæ–‡ä»¶é‡Œé¢çš„helloå­—ç¬¦ä¸²æ›¿æ¢æˆword
module.exports = function (source) {
  const optionsName = loaderUtils.getOptions(this) &amp;amp;&amp;amp; loaderUtils.getOptions(this).name || &#39;world&#39;
  return source.replace(/hello/g, optionsName)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å‰é¢æ˜¯ä¸€ä¸ªåŒæ­¥çš„&lt;code&gt;loader&lt;/code&gt;ï¼Œå¦‚æœæƒ³å†™ä¸€ä¸ªå¼‚æ­¥çš„&lt;code&gt;loader&lt;/code&gt;ï¼Œå¯ä»¥åœ¨&lt;code&gt;loader&lt;/code&gt;å†…éƒ¨è°ƒç”¨&lt;code&gt;async&lt;/code&gt;æ–¹æ³•ï¼Œç„¶ååœ¨å¤„ç†ä¹‹åè°ƒç”¨å¯¹åº”çš„å›è°ƒæ–¹æ³•å¤„ç†&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;module.exports = function (source) {
  const optionsName = loaderUtils.getOptions(this) &amp;amp;&amp;amp; loaderUtils.getOptions(this).name || &#39;world&#39;
  cosnt callback = this.async()

  // æ“ä½œå®Œäº†ä¹‹åï¼Œè°ƒç”¨callbackè¿”å›ç»“æœè¿›å…¥ä¸‹ä¸€ä¸ªloader
  asyncOperation(source, optionsName, function(err, result) {
    ifï¼ˆerrï¼‰return callback(err)
    callback(err, result)
  })
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœä¸ç”¨ä¸Šé¢çš„æ–¹å¼ï¼Œè¿”å›ä¸€ä¸ª&lt;code&gt;promise&lt;/code&gt;ä¹Ÿæ˜¯å¯ä»¥çš„&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;module.exports = function (source) {
  const optionsName = loaderUtils.getOptions(this) &amp;amp;&amp;amp; loaderUtils.getOptions(this).name || &#39;world&#39;
  return new Promise(resolve =&amp;gt; {
    asyncOperation(source, function(err, result) {
      if (err) resolve(err)
      resolve(err, result)
    })
  })
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;plugin&lt;/code&gt;
&lt;code&gt;plugin&lt;/code&gt;è¿›ä¸€æ­¥æ‹“å±•äº†&lt;code&gt;webpack&lt;/code&gt;çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æ‰“åŒ…ä¼˜åŒ–å’Œå‹ç¼©ï¼Œæ¸…ç©ºå½“å‰é¡¹ç›®çš„ç›®å½•ï¼Œé‡æ–°å®šä¹‰ç¯å¢ƒå˜é‡ï¼Œå°†ä»£ç è¾“å‡ºåˆ°æŸä¸ªæ–‡ä»¶ï¼Œæå–åŠŸèƒ½æ¨¡å—ç­‰ç­‰&lt;/p&gt;

&lt;p&gt;å®šä¹‰ä¸€ä¸ª&lt;code&gt;plugin&lt;/code&gt;çš„æ—¶å€™ï¼Œé¦–å…ˆè¦æä¾›ä¸€ä¸ª&lt;code&gt;apply&lt;/code&gt;æ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ª&lt;code&gt;compiler&lt;/code&gt;å¯¹è±¡ï¼Œç„¶åæ³¨å†Œå¯¹åº”çš„é’©å­å‡½æ•°ï¼Œåœ¨å›è°ƒé‡Œé¢æ‹¿åˆ°å¯¹åº”å‚æ•°ï¼Œç„¶åå¤„ç†
ä»¥ä¸‹å®šä¹‰ä¸€ä¸ª&lt;code&gt;plugin&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const path = require(&#39;path&#39;)
const fs = require(&#39;fs&#39;)
const cheerio = require(&#39;cheerio&#39;)

class BasePlugin {
  constructor(options){
    // æ’ä»¶çš„å‚æ•°ï¼Œfilenameã€templateç­‰
    this.options = options
  }
  apply(compiler) {
    // æ³¨å†ŒafterEmité’©å­å‡½æ•°
    compiler.hooks.afterEmit.tap(&#39;BasePlugin&#39;, (compilation) =&amp;gt; {
      // 2. æ ¹æ®æ¨¡æ¿è¯»å–htmlæ–‡ä»¶å†…å®¹
      const result = fs.readFileSync(this.options.template, &#39;utf-8&#39;)
      
      // 3. ä½¿ç”¨ cheerio æ¥åˆ†æ HTML
      let $ = cheerio.load(result)
    
      // 4. åˆ›å»º script æ ‡ç­¾åæ’å…¥HTMLä¸­
      // compilation.assetsä»£è¡¨æ‰€æœ‰è¾“å‡ºçš„èµ„æºæ–‡ä»¶
      Object.keys(compilation.assets).forEach(item =&amp;gt; {
        $(`&amp;lt;script src=&amp;quot;/${item}&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;`).appendTo(&#39;body&#39;)
      })
    
      // 5. è½¬æ¢æˆæ–°çš„HTMLå¹¶å†™å…¥åˆ° dist ç›®å½•ä¸­
      fs.writeFileSync(path.join(process.cwd(), &#39;dist&#39;, this.options.filename), $.html())
    })
  } 
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;compiler&lt;/code&gt;å¯¹è±¡åŒ…å«äº†&lt;code&gt;webpack&lt;/code&gt;ç¯å¢ƒæ‰€æœ‰çš„çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…å«&lt;code&gt;options&lt;/code&gt;ï¼Œ&lt;code&gt;loaders&lt;/code&gt;ï¼Œ&lt;code&gt;plugins&lt;/code&gt;è¿™äº›ä¿¡æ¯ï¼Œè¿™ä¸ªå¯¹è±¡åœ¨&lt;code&gt;webpack&lt;/code&gt;å¯åŠ¨æ—¶å€™è¢«å®ä¾‹åŒ–ï¼Œå®ƒæ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œå¯ä»¥ç®€å•åœ°æŠŠå®ƒç†è§£ä¸º&lt;code&gt;webpack&lt;/code&gt;å®ä¾‹ï¼Œ&lt;code&gt;compilation&lt;/code&gt;å¯¹è±¡åŒ…å«äº†å½“å‰çš„æ¨¡å—èµ„æºã€ç¼–è¯‘ç”Ÿæˆèµ„æºã€å˜åŒ–çš„æ–‡ä»¶ç­‰ã€‚å½“&lt;code&gt;webpack&lt;/code&gt;ä»¥å¼€å‘æ¨¡å¼è¿è¡Œæ—¶ï¼Œæ¯å½“æ£€æµ‹åˆ°ä¸€ä¸ªæ–‡ä»¶å˜åŒ–ï¼Œ&lt;code&gt;compilation&lt;/code&gt;å°±ä¼šè¢«é‡æ–°æ„å»ºï¼Œå…¶å®ƒçš„ä¸€äº›&lt;a href=&#34;https://www.webpackjs.com/api/compiler-hooks/#hooks&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;é’©å­å‡½æ•°&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;é¡ºä¾¿æ€»ç»“ä¸€ä¸‹ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„&lt;code&gt;webpack&lt;/code&gt;çš„æ­¥éª¤
1.å®šä¸€ä¸ªåŸºç¡€å¯¹è±¡ï¼Œæ„é€ æ–¹æ³•é‡Œé¢ä¼ å…¥&lt;code&gt;entry&lt;/code&gt;ã€&lt;code&gt;output&lt;/code&gt;ã€&lt;code&gt;rules&lt;/code&gt;ã€&lt;code&gt;plugins&lt;/code&gt;ç­‰å±æ€§
2.ç„¶åå®šä¹‰ä¸€ç³»åˆ—é’©å­å‡½æ•°ï¼Œåœ¨&lt;code&gt;webpack&lt;/code&gt;æ‰§è¡Œä¸­å¯ä»¥è°ƒç”¨è¿™äº›é’©å­å‡½æ•°åšå¤„ç†ï¼Œ
3.å¼€å§‹æ‰§è¡Œï¼Œåˆå§‹åŒ–å¯¹åº”çš„é’©å­å‡½æ•°ï¼Œä¼ å…¥&lt;code&gt;entry&lt;/code&gt;ç­‰ç›¸å…³ä¿¡æ¯
4.æ‹¿åˆ°æ–‡ä»¶æºç ä¿¡æ¯ï¼Œä½¿ç”¨&lt;code&gt;loader&lt;/code&gt;å¤„ç†ï¼Œå°†ä»£ç è½¬æ¢æˆ&lt;code&gt;ast&lt;/code&gt;å½¢å¼
5.&lt;code&gt;traverse&lt;/code&gt;å°†&lt;code&gt;ast&lt;/code&gt;ä»£ç ä¸­çš„&lt;code&gt;require&lt;/code&gt;æ›¿æ¢ä¸º&lt;code&gt;__webpack_require__&lt;/code&gt;ï¼Œæ·»åŠ æ–°çš„&lt;code&gt;module&lt;/code&gt;ä¿¡æ¯
6.é€’å½’å¤„ç†æ¯ä¸€ä¸ªä¾èµ–ï¼Œé‡å¤ä¸Šé¢çš„æ­¥éª¤
7.åˆå§‹åŒ–&lt;code&gt;plugin&lt;/code&gt;ï¼Œå¹¶å¯¹æ–‡ä»¶åšå¤„ç†
8.è¾“å…¥åˆ°æŒ‡å®šç›®å½•
9.å®¢æˆ·ç«¯/æµè§ˆå™¨è¿è¡Œæ—¶æ‰§è¡Œ&lt;/p&gt;

&lt;p&gt;å‚è€ƒé“¾æ¥&lt;/p&gt;

&lt;p&gt;1.&lt;a href=&#34;https://juejin.im/post/6844903957769224206&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;webpackåŸç†&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;2.&lt;a href=&#34;https://www.webpackjs.com/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;webpackå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Babelç®€ä»‹</title>
      <link>https://xtid.github.io/2020/babel%E7%AE%80%E4%BB%8B/</link>
      <pubDate>Sun, 23 Aug 2020 21:32:52 +0800</pubDate>
      
      <guid>https://xtid.github.io/2020/babel%E7%AE%80%E4%BB%8B/</guid>
      <description>

&lt;h3 id=&#34;1-babel-ç®€ä»‹&#34;&gt;1.babel ç®€ä»‹&lt;/h3&gt;

&lt;blockquote&gt;
&lt;p&gt;Babelæ˜¯ç°ä»£JavaScriptè¯­æ³•è½¬æ¢å™¨ï¼Œä¸»è¦ç”¨äºå°† ECMAScript 2015+ ç‰ˆæœ¬çš„ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„ JavaScript è¯­æ³•ï¼Œä»¥ä¾¿èƒ½å¤Ÿè¿è¡Œåœ¨å½“å‰å’Œæ—§ç‰ˆæœ¬çš„æµè§ˆå™¨æˆ–å…¶ä»–ç¯å¢ƒä¸­ï¼ŒåŒ…æ‹¬ä¸é™äº: eslint jsx vue-templateç­‰ç­‰ã€‚ä»–èƒ½ä¸ºä½ åšçš„ï¼šè¯­æ³•è½¬æ¢ã€é€šè¿‡ Polyfill æ–¹å¼åœ¨ç›®æ ‡ç¯å¢ƒä¸­æ·»åŠ ç¼ºå¤±çš„ç‰¹æ€§ã€æºç è½¬æ¢ã€‚å¯ä»¥è¯´ï¼Œé€šè¿‡babelï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ€æ–°çš„è¯­æ³•æˆ–è€…ç‰¹æ€§ä¸“æ³¨çš„å¼€å‘ä¸šåŠ¡ï¼Œè€Œä¸ç”¨å°†ç²¾åŠ›èŠ±åœ¨ä»£ç çš„å…¼å®¹ä¸Š&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;2-babelçš„è§£ææµç¨‹&#34;&gt;2.babelçš„è§£ææµç¨‹&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;https://github.com/xtid/blog/blob/master/static/img/deal_process.png&#34; alt=&#34;babelå¤„ç†æµç¨‹&#34; /&gt;&lt;/p&gt;

&lt;h4 id=&#34;2-1è¯æ³•è§£æ&#34;&gt;2.1è¯æ³•è§£æ&lt;/h4&gt;

&lt;p&gt;é¦–å…ˆç”±å…¥å£æ–‡ä»¶&lt;code&gt;@babel/core&lt;/code&gt;å¼•å…¥å„ç§é…ç½®æ–‡ä»¶ä»¥åŠè§£æçš„æ¨¡å—ï¼Œå…¶ä¸­è´Ÿè´£è§£æåŸºæœ¬è¯­æ³•çš„ä¸º&lt;code&gt;parse&lt;/code&gt;æ¨¡å—ï¼Œå…¶ä¸­å°±å®šä¹‰äº†&lt;code&gt;è¯æ³•è§£æå™¨Tokenizer&lt;/code&gt;ï¼Œå¯ä»¥çœ‹å‡ºåˆå§‹åŒ–æ—¶ä¼šæœ‰ä¸€ä¸ª&lt;code&gt;tokens&lt;/code&gt;æ•°ç»„ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µä¼šæŠŠå­—ç¬¦ä¸²å½¢å¼çš„ä»£ç è½¬æ¢ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œ&lt;code&gt;tokenså¯ä»¥è§†ä¸ºç”±æ‹†åˆ†ä¸ºå„ä¸ªç‰‡æ®µç»„æˆçš„æ•°ç»„&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;class Tokenizer extends LocationParser {
  constructor(options, input) {
    super();
    this.tokens = [];
    this.state = new State();
    this.state.init(options);
    this.input = input;
    this.length = input.length;
    this.isLookahead = false;
  }
	
  ....
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨&lt;code&gt;Tokenizer&lt;/code&gt;å®šä¹‰ä¸­è¿˜æœ‰ä¸€äº›å…¶å®ƒçš„æ–¹æ³•ï¼Œä»–ä»¬ä¼šå¯¹å„ç§è¯­æ³•å­—ç¬¦ä¸²è¿›è¡Œä¸€ä¸ªéå†è¿‡æ»¤ï¼Œæ¯”å¦‚è·³è¿‡ç©ºæ ¼å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚è·³è¿‡æ³¨é‡Šç­‰ç­‰&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;skipSpace() {
  loop: while (this.state.pos &amp;lt; this.length) {
    const ch = this.input.charCodeAt(this.state.pos);
    .
    .
    .
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æœ€åä¼šæŠŠç¬¦åˆè§„åˆ™çš„è¯­æ³•å­—ç¬¦ä¸²åŠ å…¥åˆ°&lt;code&gt;tokens&lt;/code&gt;æ•°ç»„ä¸­ï¼Œä¹Ÿå°±ç”Ÿæˆä»£ç æ‹†åˆ†ä¸ºå„ä¸ªç‰‡æ®µç»„æˆçš„æ•°ç»„&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;pushToken(token) {
  this.tokens.length = this.state.tokensLength;
  this.tokens.push(token);
  ++this.state.tokensLength;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;console.log(&#39;æˆ‘æ˜¯ä¸€æ®µè¯­æ³•&#39;) =&amp;gt; [&#39;console&#39;, &#39;log&#39;, &#39;(&#39;, &#39;&amp;quot;æˆ‘æ˜¯ä¸€æ®µè¯­æ³•&amp;quot;&#39;, &#39;)&#39;]
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;2-2è¯­æ³•è§£æ&#34;&gt;2.2è¯­æ³•è§£æ&lt;/h4&gt;

&lt;p&gt;å½“ç”Ÿæˆå®Œ&lt;code&gt;tokens&lt;/code&gt;ï¼Œåˆ™è¿›å…¥åˆ°è¯­æ³•è§£æé˜¶æ®µï¼ŒåŒæ ·å¯ä»¥çœ‹è§åœ¨&lt;code&gt;parse&lt;/code&gt;æ¨¡å—ä¸­å®šä¸€ä¸ªäº†ä¸€ä¸ª&lt;code&gt;Node&lt;/code&gt;å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å®šä¹‰äº†ä¸€äº›å±æ€§ï¼Œå½“ç„¶è¿˜æœ‰ä¸ªç§æœ‰çš„&lt;code&gt;_clone&lt;/code&gt;æ–¹æ³•ï¼Œç”¨äºè¡¨ç¤ºå°†è¦ç”Ÿæˆçš„&lt;code&gt;AST&lt;/code&gt;ä¸­èŠ‚ç‚¹çš„ä½ç½®ã€åç§°ã€ç±»å‹ç­‰ç­‰ä¿¡æ¯&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;class Node {
  constructor(parser, pos, loc) {
    this.type = &amp;quot;&amp;quot;;
    this.start = pos;
    this.end = 0;
    this.loc = new SourceLocation(loc);
    if (parser &amp;amp;&amp;amp; parser.options.ranges) this.range = [pos, 0];
    if (parser &amp;amp;&amp;amp; parser.filename) this.loc.filename = parser.filename;
  }

  __clone() {
    .
    .
    .
  }

}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åä¼šå®šä¹‰ç›¸åº”çš„&lt;code&gt;Parse&lt;/code&gt;ï¼Œéå†å¤„ç†ä¸åŒçš„&lt;code&gt;tokens&lt;/code&gt;å­—æ®µï¼Œæ¯”å¦‚&lt;code&gt;ImportDeclaration&lt;/code&gt;ç”¨äºimportè¯­æ³•ï¼Œå¯¼å…¥æ¨¡å—ï¼›&lt;code&gt;VariableDeclarator&lt;/code&gt;ç”¨äºå¤„ç†è¡¨ç¤ºæ˜¯ä»€ä¹ˆç±»å‹çš„å˜é‡å£°æ˜ï¼Œæ¯”å¦‚&lt;code&gt;varã€letã€const&lt;/code&gt;ï¼›&lt;code&gt;FunctionDeclaration&lt;/code&gt;ç”¨äºå¤„ç†å‡½æ•°å£°æ˜ï¼Œéå‡½æ•°è¡¨è¾¾å¼ï¼Œå…¶å®ƒçš„å°±ä¸å¤šèµ˜è¿°ã€‚æœ€ååˆ™ä¼šå°†è¿™ä¸ªè¯æ³•æ•°ç»„è½¬æ¢ä¸º&lt;code&gt;AST(æŠ½è±¡è¯­æ³•æ ‘)&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;var add = function(a, b) {
  return  a + b
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æœ€åç”Ÿæˆçš„&lt;code&gt;AST&lt;/code&gt;ç®€æ˜“ç‰ˆæœ¬å¦‚ä¸‹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;{
  &amp;quot;type&amp;quot;: &amp;quot;Program&amp;quot;,
  &amp;quot;body&amp;quot;: [{
    &amp;quot;type&amp;quot;: &amp;quot;VariableDeclaration&amp;quot;,
    &amp;quot;identifierName&amp;quot;: &amp;quot;add&amp;quot;,
    &amp;quot;init&amp;quot;: {
      &amp;quot;type&amp;quot;: &amp;quot;ArrowFunctionExpression&amp;quot;,
      &amp;quot;params&amp;quot;: [{
          &amp;quot;type&amp;quot;: &amp;quot;identifier&amp;quot;,
          &amp;quot;identifierName&amp;quot;: &amp;quot;a&amp;quot;
        },
        {
          &amp;quot;type&amp;quot;: &amp;quot;identifier&amp;quot;,
          &amp;quot;identifierName&amp;quot;: &amp;quot;b&amp;quot;
        }
      ],
      &amp;quot;body&amp;quot;: {
        &amp;quot;type&amp;quot;: &amp;quot;BinaryExpression&amp;quot;,
        &amp;quot;left&amp;quot;: {
          &amp;quot;type&amp;quot;: &amp;quot;identifier&amp;quot;,
          &amp;quot;identifierName&amp;quot;: &amp;quot;a&amp;quot;
        },
        &amp;quot;operator&amp;quot;: &amp;quot;+&amp;quot;,
        &amp;quot;right&amp;quot;: {
          &amp;quot;type&amp;quot;: &amp;quot;identifier&amp;quot;,
          &amp;quot;identifierName&amp;quot;: &amp;quot;b&amp;quot;
        }
      }
    }
  }]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯ä»¥çœ‹å‡ºè¿™ä¸ªè¯­æ³•æ ‘åŒ…å«äº†æ•´ä¸ªè¯­æ³•çš„ä¸€ä¸ªå±‚çº§å…³ç³»ï¼Œå¹¶ä¸”æ ‡æ³¨äº†ä»–ä»¬çš„åç§°ã€ç±»å‹ä»¥åŠä½ç½®&lt;/p&gt;

&lt;h4 id=&#34;2-3traverser&#34;&gt;2.3Traverser&lt;/h4&gt;

&lt;p&gt;&lt;code&gt;Traverser&lt;/code&gt;ä¼šå¯¹ç”Ÿæˆå¥½&lt;code&gt;AST&lt;/code&gt;è¿›è¡Œä¸€ä¸ªéå†ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­å¯¹èŠ‚ç‚¹è¿›è¡Œæ·»åŠ ã€åˆ é™¤ç­‰ç­‰æ“ä½œï¼Œè¿™ä¹Ÿæ˜¯å…¶ä»–æ’ä»¶å°†è¦å¤„ç†çš„åœ°æ–¹ï¼Œé€šè¿‡è¿™äº›æ’ä»¶ï¼Œä¹Ÿå¯ä»¥å¤„ç†ä¸åŒçš„&lt;code&gt;AST&lt;/code&gt;è¯­æ³•æ ‘ï¼Œç„¶åè½¬æ¢ç¬¦åˆç›¸åº”è§„åˆ™çš„ä»£ç ï¼Œæ¯”å¦‚&lt;code&gt;Taro&lt;/code&gt;ï¼Œå°±å¯ä»¥è§†ä¸ºå°†&lt;code&gt;React&lt;/code&gt;ä»£ç è½¬æ¢æˆå°ç¨‹åºå¯¹åº”ä»£ç çš„ä¸€ä¸ªæ’ä»¶ã€‚&lt;code&gt;Traverser&lt;/code&gt;ä¸­ä¼šå¼•å…¥&lt;code&gt;visitors&lt;/code&gt;ï¼Œç”¨å®ƒæ¥è¿›è¡Œä¸€ä¸ªæ·±åº¦éå†æ“ä½œï¼›&lt;code&gt;Path&lt;/code&gt;ç”¨äºå…³è”å„ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ ·ä½¿å¾—èŠ‚ç‚¹æ“ä½œç®€å•ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸‹é¢è¿™æ ·ä¸€ä¸ªèŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹ï¸°&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;{
  type: &amp;quot;ArrowFunctionExpression&amp;quot;,
  id: {
    type: &amp;quot;Identifier&amp;quot;,
    name: &amp;quot;a&amp;quot;
  },
  ...
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å°†å­èŠ‚ç‚¹ &lt;code&gt;Identifier&lt;/code&gt; è¡¨ç¤ºä¸ºä¸€ä¸ªè·¯å¾„ï¼ˆPathï¼‰çš„è¯ï¼Œçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;{
  &amp;quot;parent&amp;quot;: {
    &amp;quot;type&amp;quot;: &amp;quot;ArrowFunctionExpression&amp;quot;,
    &amp;quot;id&amp;quot;: {...},
    ....
  },
  &amp;quot;node&amp;quot;: {
    &amp;quot;type&amp;quot;: &amp;quot;Identifier&amp;quot;,
    &amp;quot;name&amp;quot;: &amp;quot;a&amp;quot;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;Scope&lt;/code&gt;ç”¨æ¥è¡¨ç¤ºæ ‘ä¸­å„ä¸ªèŠ‚ç‚¹çš„ä¸€ä¸ªä½œç”¨åŸŸå…³ç³»ï¼Œå°±å¥½åƒ&lt;code&gt;js&lt;/code&gt;è¯­æ³•ä¸­ï¼Œåˆ›å»ºå˜é‡ã€å‡½æ•°æ—¶æ‰€å‘ˆç°çš„ä¸€ä¸ªä½œç”¨åŸŸæ•ˆæœï¼Œåœ¨&lt;code&gt;babel&lt;/code&gt;ä¸­ï¼Œæ–°æ·»åŠ çš„å¼•ç”¨æˆ–è€…å˜é‡åï¼Œ&lt;code&gt;Scope&lt;/code&gt;è¡¨ç¤ºçš„æ—¶å€™éœ€è¦ä½“ç°å‡ºèŠ‚ç‚¹çš„è·¯å¾„ï¼ŒèŠ‚ç‚¹é—´çš„å…³ç³»ï¼Œå¦‚ä»¥ä¸‹å½¢å¼:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;{
  path: path,
  block: path.node,
  parentBlock: path.parent,
  parent: parentScope,
  bindings: [...]
  .
  .
  .
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿˜æœ‰ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µ&lt;code&gt;Bindings&lt;/code&gt;ï¼Œ&lt;code&gt;Bindings&lt;/code&gt;å¯ä»¥è·å–å½“å‰ä½œç”¨åŸŸä¸‹æ‰€æœ‰çš„æ ‡è¯†ç¬¦ï¼Œå…¶è¿”å›çš„ä¿¡æ¯åŒ…æ‹¬èŠ‚ç‚¹çš„&lt;code&gt;æ ‡è¯†ç¬¦&lt;/code&gt;ã€&lt;code&gt;scope&lt;/code&gt;ã€&lt;code&gt;path&lt;/code&gt;ã€&lt;code&gt;å¼•ç”¨&lt;/code&gt;ç­‰ç­‰ä¿¡æ¯ï¼Œé€šè¿‡å¯¹è¿™äº›å±æ€§çš„æ“ä½œï¼Œè¾¾åˆ°å¯¹èŠ‚ç‚¹ä¿¡æ¯çš„ä¸€ä¸ªæ›´æ”¹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;export class Binding {
  identifier: t.Identifier;
  scope: Scope;
  path: NodePath;
  kind: &amp;quot;var&amp;quot; | &amp;quot;let&amp;quot; | &amp;quot;const&amp;quot; | &amp;quot;module&amp;quot;;
  referenced: boolean;
  references: number;              // è¢«å¼•ç”¨çš„æ•°é‡
  referencePaths: NodePath[];      // è·å–æ‰€æœ‰åº”ç”¨è¯¥æ ‡è¯†ç¬¦çš„èŠ‚ç‚¹è·¯å¾„
  constant: boolean;               // æ˜¯å¦æ˜¯å¸¸é‡
  constantViolations: NodePath[];
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;2-4transform&#34;&gt;2.4Transform&lt;/h4&gt;

&lt;p&gt;&lt;code&gt;transform&lt;/code&gt;ä¼šå¯¹æŠ½è±¡è¯­æ³•æ ‘è¿›è¡Œåˆä¸€æ¬¡éå†ï¼Œé’ˆå¯¹å·²ç»å¤„ç†å¥½çš„&lt;code&gt;AST&lt;/code&gt;åšè¿›ä¸€æ­¥å¤„ç†ï¼Œå¦‚å¯¹ä»£ç çš„æ›´æ”¹ï¼Œå¯¹èŠ‚ç‚¹çš„æ“ä½œã€èŠ‚ç‚¹çš„å¢åˆ æ”¹æŸ¥ã€å‹ç¼©ä»£ç ã€åˆ é™¤æ³¨é‡Šç­‰ç­‰ã€‚å¾—åˆ°æœ€ç»ˆçš„ä¸€ä¸ª&lt;code&gt;AST&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&#34;2-5ç”Ÿæˆä»£ç &#34;&gt;2.5ç”Ÿæˆä»£ç &lt;/h4&gt;

&lt;p&gt;å¾—åˆ°ä¸Šä¸€æ­¥ç”Ÿæˆçš„&lt;code&gt;AST&lt;/code&gt;ä¹‹åï¼Œä¼šè°ƒç”¨å¯¹åº”çš„ä»£ç ç”Ÿæˆå™¨ä»£ç ï¼Œé€šè¿‡é€’å½’éå†ç”Ÿæˆæœ€ç»ˆçš„ä»£ç ï¼Œå…¶ä¸­é‡åˆ°ä¸åŒçš„èŠ‚ç‚¹ç±»å‹æ—¶ï¼Œä¼šåšä¸åŒçš„å¤„ç†ï¼Œæ¯”å¦‚å‡½æ•°ç±»å‹ã€å‚æ•°å®šä¹‰ç±»å‹ã€ä»£ç å—ç±»å‹ç­‰ç­‰&lt;/p&gt;

&lt;h3 id=&#34;3-babelé‡Œé¢çš„ä¸€äº›ä¾èµ–åŒ…&#34;&gt;3.babelé‡Œé¢çš„ä¸€äº›ä¾èµ–åŒ…&lt;/h3&gt;

&lt;h4 id=&#34;3-1-babel-core&#34;&gt;3.1@babel/core&lt;/h4&gt;

&lt;p&gt;&lt;code&gt;@babel/core&lt;/code&gt;æ•´ä¸ª&lt;code&gt;babel&lt;/code&gt;çš„ä¸€ä¸ªæ ¸å¿ƒï¼Œä¹Ÿç®—æ˜¯&lt;code&gt;babel&lt;/code&gt;çš„ä¸€ä¸ªå…¥å£ï¼Œå®ƒä¼šåŠ è½½å’Œå¤„ç†ç”¨æˆ·å®šä¹‰çš„é…ç½®ï¼ŒåŠ è½½å„ç§å„æ ·çš„æ’ä»¶ï¼›è°ƒç”¨&lt;code&gt;Parser&lt;/code&gt;è¿›è¡Œè¯­æ³•è§£æï¼Œç”Ÿæˆ&lt;code&gt;Tokens&lt;/code&gt;ä»¥åŠ&lt;code&gt;AST&lt;/code&gt;ï¼›è°ƒç”¨&lt;code&gt;Traverser&lt;/code&gt;éå†&lt;code&gt;AST&lt;/code&gt;ï¼Œè¿›è¡Œä¸€ä¸ªè½¬æ¢ï¼›æœ€å&lt;code&gt;generator&lt;/code&gt;ç”Ÿæˆæºä»£ç &lt;/p&gt;

&lt;h4 id=&#34;3-2æ’ä»¶&#34;&gt;3.2æ’ä»¶&lt;/h4&gt;

&lt;p&gt;è¯­æ³•æ’ä»¶ï¼š&lt;code&gt;babel&lt;/code&gt;æœ‰å¾ˆå¤šè¯­æ³•æ’ä»¶ï¼Œç”¨äºæ”¯æŒ&lt;code&gt;JavaScript&lt;/code&gt;çš„å„ç§è¯­æ³•ç‰¹æ€§ï¼Œåœ¨è§£æçš„æ—¶å€™ä¼šç”¨çš„åˆ°ï¼Œé€šå¸¸å…¶å½¢å¼ä¸º&lt;code&gt;@babel/plugin-syntax-*&lt;/code&gt;ï¼Œæ¯”å¦‚&lt;code&gt;babel-plugin-syntax-dynamic-import&lt;/code&gt;å°±æ˜¯ç”¨æ¥å¤„ç†&lt;code&gt;import&lt;/code&gt;è¯­æ³•çš„ä¸€ä¸ªæ’ä»¶&lt;/p&gt;

&lt;p&gt;è½¬æ¢æ’ä»¶ï¼š ç”¨äºå¯¹ &lt;code&gt;AST&lt;/code&gt; è¿›è¡Œè½¬æ¢, å®ç°è½¬æ¢ä¸º&lt;code&gt;ES5&lt;/code&gt;ä»£ç ã€å‹ç¼©ã€åŠŸèƒ½å¢å¼ºç­‰ç›®çš„ï¼Œ&lt;code&gt;babel&lt;/code&gt;ä»“åº“å°†è½¬æ¢æ’ä»¶åˆ’åˆ†ä¸ºä¸¤ç§(åªæ˜¯å‘½åä¸Šçš„åŒºåˆ«)ï¼š&lt;/p&gt;

&lt;p&gt;å¦‚&lt;code&gt;@babel/plugin-transform-*&lt;/code&gt;ï¼š &lt;code&gt;babel&lt;/code&gt;ä¸­çš„ä¸€ä¸ªè½¬æ¢æ’ä»¶&lt;/p&gt;

&lt;p&gt;é¢„å®šä¹‰çš„æ’ä»¶ï¼šæ’ä»¶é›†åˆæˆ–è€…åˆ†ç»„ï¼Œå¯è®¾ç½®é¡¹ç›®å†…æ‰€ç”¨æ’ä»¶çš„ä½¿ç”¨åœºæ™¯ï¼Œä¸»è¦æ–¹ä¾¿ç”¨æˆ·å¯¹æ’ä»¶è¿›è¡Œç®¡ç†å’Œä½¿ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;@babel/preset-env&lt;/code&gt;ï¼š&lt;code&gt;preset-env&lt;/code&gt;æ˜¯ESè¯­æ³•æ’ä»¶çš„åˆé›†ï¼Œåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º&lt;code&gt;.babelrc&lt;/code&gt;é…ç½®æ–‡ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt; {
   &amp;quot;presets&amp;quot;: [
     [&amp;quot;@babel/preset-env&amp;quot;, {
       &amp;quot;modules&amp;quot;: false,
       &amp;quot;targets&amp;quot;: {
         &amp;quot;browsers&amp;quot;: [&amp;quot;&amp;gt; 1%&amp;quot;, &amp;quot;last 2 versions&amp;quot;, &amp;quot;not ie &amp;lt;= 8&amp;quot;]
       },
       &amp;quot;useBuiltIns&amp;quot;: false,
       &amp;quot;corejs&amp;quot;: false
     }]
   ]
 }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;targets&lt;/code&gt;ç”ŸæˆæŒ‡å®šç¯å¢ƒçš„ä»£ç ï¼Œ&lt;code&gt;useBuiltIns&lt;/code&gt;é…åˆ&lt;code&gt;@babel/polyfill&lt;/code&gt;ä½¿ç”¨ï¼Œå½“ç„¶æœ€æ–°ç‰ˆçš„&lt;code&gt;babel&lt;/code&gt;å¯ç›´æ¥ä½¿ç”¨&lt;code&gt;corejs&lt;/code&gt;ï¼Œå¡«ä¸Šå¯¹åº”çš„æ•°å€¼å°±è¡Œï¼Œ&lt;code&gt;modules&lt;/code&gt;è¡¨ç¤ºæ˜¯å¦å°†ä»£ç ES6çš„æ¨¡å—è¯­æ³•è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹æˆ–æ ‡å‡†ï¼Œæ¯”å¦‚&lt;code&gt;amd&lt;/code&gt;ã€&lt;code&gt;commonjs&lt;/code&gt;ç­‰&lt;/p&gt;

&lt;p&gt;&lt;code&gt;@babel/polyfill&lt;/code&gt;é¡¾åæ€ä¹‰ï¼Œåœ¨&lt;code&gt;babel&lt;/code&gt;è½¬åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹äºä¸€äº›æ— æ³•å¤„ç†çš„ç‰¹æ€§æˆ–è€…å±æ€§ï¼Œä½¿ç”¨&lt;code&gt;@babel/polyfill&lt;/code&gt;æ¥å¯¹è¿™äº›åŠŸèƒ½è¿›è¡Œå¤„ç†ï¼›&lt;/p&gt;

&lt;p&gt;&lt;code&gt;@babel/runtime&lt;/code&gt;ä¸€èˆ¬åº”ç”¨äºä¸¤ç§åœºæ™¯ï¼šå¼€å‘ç±»åº“/å·¥å…·ï¼ˆç”Ÿæˆä¸æ±¡æŸ“å…¨å±€ç©ºé—´å’Œå†…ç½®å¯¹è±¡åŸå‹çš„ä»£ç ï¼‰ã€å€ŸåŠ© &lt;code&gt;@babel/runtime&lt;/code&gt; ä¸­å¸®åŠ©å‡½æ•°ï¼ˆhelper functionï¼‰ç§»é™¤å†—ä½™å·¥å…·å‡½æ•°ï¼Œåœ¨æœ€æ–°çš„ç‰ˆæœ¬ä¸­ï¼Œå®Œå…¨å¯ä»¥ç”¨&lt;code&gt;@babel/runtime&lt;/code&gt;ä»£æ›¿&lt;code&gt;@babel/polyfill&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&#34;3-3è¾…åŠ©å¼€å‘å·¥å…·&#34;&gt;3.3è¾…åŠ©å¼€å‘å·¥å…·&lt;/h4&gt;

&lt;p&gt;&lt;code&gt;@babel/template&lt;/code&gt;ï¼š æŸäº›åœºæ™¯ç›´æ¥æ“ä½œ&lt;code&gt;AST&lt;/code&gt;å¤ªéº»çƒ¦ï¼Œå°±æ¯”å¦‚æˆ‘ä»¬ç›´æ¥æ“ä½œ&lt;code&gt;DOM&lt;/code&gt;ä¸€æ ·ï¼Œæ‰€ä»¥&lt;code&gt;babel&lt;/code&gt;å®ç°äº†è¿™ä¹ˆä¸€ä¸ªç®€å•çš„æ¨¡æ¿å¼•æ“ï¼Œå¯ä»¥å°†å­—ç¬¦ä¸²ä»£ç è½¬æ¢ä¸º&lt;code&gt;AST&lt;/code&gt;ã€‚æ¯”å¦‚åœ¨ç”Ÿæˆä¸€äº›è¾…åŠ©ä»£ç &lt;code&gt;(helper)&lt;/code&gt;æ—¶ä¼šç”¨åˆ°è¿™ä¸ªåº“&lt;/p&gt;

&lt;p&gt;&lt;code&gt;@babel/types&lt;/code&gt;ï¼š ä¸»è¦ç”¨é€”æ˜¯åœ¨åˆ›å»º&lt;code&gt;AST&lt;/code&gt;çš„è¿‡ç¨‹ä¸­åˆ¤æ–­å„ç§è¯­æ³•çš„ç±»å‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;@babel/helper-*&lt;/code&gt;ï¼š ä¸€äº›è¾…åŠ©å™¨ï¼Œç”¨äºè¾…åŠ©æ’ä»¶å¼€å‘ï¼Œä¾‹å¦‚ç®€åŒ–&lt;code&gt;AST&lt;/code&gt;æ“ä½œ&lt;/p&gt;

&lt;p&gt;&lt;code&gt;@babel/helper&lt;/code&gt;ï¼š è¾…åŠ©ä»£ç ï¼Œå•çº¯çš„è¯­æ³•è½¬æ¢å¯èƒ½æ— æ³•è®©ä»£ç è¿è¡Œèµ·æ¥ï¼Œæ¯”å¦‚ä½ç‰ˆæœ¬æµè§ˆå™¨æ— æ³•è¯†åˆ«&lt;code&gt;class&lt;/code&gt;å…³é”®å­—ï¼Œè¿™æ—¶å€™éœ€è¦æ·»åŠ è¾…åŠ©ä»£ç ï¼Œå¯¹&lt;code&gt;class&lt;/code&gt;è¿›è¡Œæ¨¡æ‹Ÿã€‚&lt;/p&gt;

&lt;h4 id=&#34;4-å‚è€ƒé“¾æ¥&#34;&gt;4.å‚è€ƒé“¾æ¥&lt;/h4&gt;

&lt;p&gt;1.&lt;a href=&#34;https://juejin.im/post/5d94bfbf5188256db95589be&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;æ·±å…¥æµ…å‡ºBabel&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;2.&lt;a href=&#34;https://www.babeljs.cn/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;babelä¸­æ–‡ç½‘&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;3.&lt;a href=&#34;https://github.com/jamiebuilds/babel-handbook&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;babel-handbook&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Vueçš„åˆå§‹åŒ–æ¸²æŸ“è¿‡ç¨‹ç®€ä»‹</title>
      <link>https://xtid.github.io/2020/vue2.x%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B%E7%AE%80%E4%BB%8B/</link>
      <pubDate>Mon, 27 Jul 2020 22:25:56 +0800</pubDate>
      
      <guid>https://xtid.github.io/2020/vue2.x%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B%E7%AE%80%E4%BB%8B/</guid>
      <description>&lt;p&gt;é¦–å…ˆè¿›å…¥åˆ°&lt;code&gt;src/core/instance/index.js&lt;/code&gt;ï¼Œå¯ä»¥çœ‹åˆ°å®šä¹‰äº†ä¸€ä¸ª&lt;code&gt;Vue&lt;/code&gt;æ„é€ å‡½æ•°ï¼Œå†…å®¹å¾ˆç®€å•ï¼Œå¦‚æœä¸æ˜¯ç”Ÿäº§ç¯å¢ƒå¹¶ä¸”ä¸æ˜¯é€šè¿‡&lt;code&gt;new&lt;/code&gt;å…³é”®å­—åˆ›å»ºå¯¹è±¡çš„è¯ï¼Œå°±åœ¨æ§åˆ¶å°æ‰“å°ä¸€ä¸ª&lt;code&gt;warn&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;function Vue (options) {
  if (process.env.NODE_ENV !== &#39;production&#39; &amp;amp;&amp;amp;
    !(this instanceof Vue)
  ) {
    warn(&#39;Vue is a constructor and should be called with the `new` keyword&#39;)
  }
  this._init(options)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åé¢è°ƒç”¨äº†å‡ ä¸ªå‡½æ•°ï¼Œç”¨æ¥åœ¨&lt;code&gt;Vue&lt;/code&gt;å¯¹è±¡ä¸Šåˆ›å»ºå„ç§å±æ€§æˆ–è€…æ–¹æ³•&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;initMixin(Vue)
stateMixin(Vue)
eventsMixin(Vue)
lifecycleMixin(Vue)
renderMixin(Vue)
&lt;/code&gt;&lt;/pre&gt;

&lt;h2&gt;1.initMixin&lt;/h2&gt;

&lt;p&gt;åˆå§‹åŒ–æ–¹æ³•ï¼Œé¦–å…ˆä¸ºå½“å‰&lt;code&gt;vm&lt;/code&gt;è®¾ç½®ä¸€ä¸ª&lt;code&gt;_uid&lt;/code&gt;ï¼Œç„¶åæ·»åŠ å±æ€§&lt;code&gt;_isVue&lt;/code&gt;ï¼Œå…¶ç›®çš„åœ¨äºç›‘å¬æ•°æ®å˜åŒ–æ—¶è¿‡æ»¤&lt;code&gt;vm&lt;/code&gt;ï¼Œ&lt;code&gt;_isComponent&lt;/code&gt;æ˜¯å†…éƒ¨åˆ›å»ºå­ç»„ä»¶æ—¶æ‰ä¼šæ·»åŠ ä¸º&lt;code&gt;true&lt;/code&gt;çš„å±æ€§ï¼Œç„¶åèµ°åˆ°&lt;code&gt;else&lt;/code&gt;åˆ†æ”¯ï¼Œè°ƒç”¨&lt;code&gt;resolveConstructorOptions&lt;/code&gt;ä¼šè·å–æ„é€ å™¨çˆ¶çº§çš„&lt;code&gt;options&lt;/code&gt;ï¼Œç„¶åè°ƒç”¨&lt;code&gt;mergeOptions&lt;/code&gt;åˆå¹¶çˆ¶çº§çš„&lt;code&gt;options&lt;/code&gt;ä»¥åŠæœ¬èº«ä¼ å…¥çš„&lt;code&gt;options&lt;/code&gt;ï¼Œæœ€åç”Ÿæˆçš„&lt;code&gt;options&lt;/code&gt;åŒ…å«&lt;code&gt;componentsã€directives&lt;/code&gt;ç­‰å±æ€§&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;export function initMixin (Vue: Class&amp;lt;Component&amp;gt;) {
  Vue.prototype._init = function (options?: Object) {
    const vm: Component = this
    // a uid
    vm._uid = uid++

    let startTag, endTag
    /* istanbul ignore if */
    if (process.env.NODE_ENV !== &#39;production&#39; &amp;amp;&amp;amp; config.performance &amp;amp;&amp;amp; mark) {
      startTag = `vue-perf-start:${vm._uid}`
      endTag = `vue-perf-end:${vm._uid}`
      mark(startTag)
    }

    // a flag to avoid this being observed
    vm._isVue = true
    // merge options
    if (options &amp;amp;&amp;amp; options._isComponent) {
      // optimize internal component instantiation
      // since dynamic options merging is pretty slow, and none of the
      // internal component options needs special treatment.
      initInternalComponent(vm, options)
    } else {
      vm.$options = mergeOptions(
        resolveConstructorOptions(vm.constructor),
        options || {},
        vm
      )
    }
    /* istanbul ignore else */
    if (process.env.NODE_ENV !== &#39;production&#39;) {
      initProxy(vm)
    } else {
      vm._renderProxy = vm
    }
    // expose real self
    vm._self = vm
    initLifecycle(vm)
    initEvents(vm)
    initRender(vm)
    callHook(vm, &#39;beforeCreate&#39;)
    initInjections(vm) // resolve injections before data/props
    initState(vm)
    initProvide(vm) // resolve provide after data/props
    callHook(vm, &#39;created&#39;)

    /* istanbul ignore if */
    if (process.env.NODE_ENV !== &#39;production&#39; &amp;amp;&amp;amp; config.performance &amp;amp;&amp;amp; mark) {
      vm._name = formatComponentName(vm, false)
      mark(endTag)
      measure(`vue ${vm._name} init`, startTag, endTag)
    }

    if (vm.$options.el) {
      vm.$mount(vm.$options.el)
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3&gt; 1.1initLifecycle &lt;/h3&gt;

&lt;p&gt;è¿™ä¸ªæ–¹æ³•é¦–å…ˆä¼šè®¾ç½®&lt;code&gt;vm&lt;/code&gt;çš„ä¸€ä¸ªçˆ¶å­èŠ‚ç‚¹ã€æ ¹èŠ‚ç‚¹ä¿¡æ¯ï¼Œç„¶åä¼šå®šä¹‰ä¸€äº›ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„å±æ€§ï¼Œæ¯”å¦‚&lt;code&gt;_isMountedã€_isDestroyedã€_isBeingDestroyed&lt;/code&gt;ç­‰&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;export function initLifecycle (vm: Component) {
  const options = vm.$options

  // locate first non-abstract parent
  let parent = options.parent
  if (parent &amp;amp;&amp;amp; !options.abstract) {
    while (parent.$options.abstract &amp;amp;&amp;amp; parent.$parent) {
      parent = parent.$parent
    }
    parent.$children.push(vm)
  }

  vm.$parent = parent
  vm.$root = parent ? parent.$root : vm

  vm.$children = []
  vm.$refs = {}

  vm._watcher = null
  vm._inactive = null
  vm._directInactive = false
  vm._isMounted = false
  vm._isDestroyed = false
  vm._isBeingDestroyed = false
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3&gt; 1.2initEvents &lt;/h3&gt;

&lt;p&gt;é€šè¿‡åå­—å¯ä»¥çœ‹å‡ºæ˜¯ä¸€ä¸ªåˆå§‹åŒ–äº‹ä»¶ç›¸å…³çš„æ–¹æ³•&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;export function initEvents (vm: Component) {
  // eventsè¡¨ç¤ºçˆ¶ç»„ä»¶ç»‘å®šåœ¨å½“å‰ç»„ä»¶ä¸Šçš„äº‹ä»¶
  vm._events = Object.create(null)
  // å±æ€§è¡¨ç¤ºçˆ¶ç»„ä»¶æ˜¯å¦é€šè¿‡&amp;quot;@hook:&amp;quot;æŠŠé’©å­å‡½æ•°ç»‘å®šåœ¨å½“å‰ç»„ä»¶ä¸Š
  vm._hasHookEvent = false
  // init parent attached events
  // åŒæ ·æ˜¯æ¥è¡¨ç¤ºçˆ¶ç»„ä»¶ç»‘å®šåœ¨å½“å‰ç»„ä»¶ä¸Šçš„äº‹ä»¶
  const listeners = vm.$options._parentListeners
  if (listeners) {
    updateComponentListeners(vm, listeners)
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœ&lt;code&gt;listeners&lt;/code&gt;æœ‰å€¼ï¼Œåˆ™è°ƒç”¨&lt;code&gt;updateComponentListeners&lt;/code&gt;è¿™ä¸ªæ–¹æ³•ï¼Œå…¶å†…éƒ¨è°ƒç”¨äº†&lt;code&gt;updateListeners&lt;/code&gt;ï¼Œå…¶ä¸­çš„&lt;code&gt;add&lt;/code&gt;æ–¹æ³•ä¼šè°ƒç”¨&lt;code&gt;vm.$on&lt;/code&gt;ï¼Œ&lt;code&gt;vm.$on&lt;/code&gt;ä¼šç›‘å¬å½“å‰å®ä¾‹ä¸Šçš„è‡ªå®šä¹‰äº‹ä»¶ï¼Œ&lt;code&gt;remove&lt;/code&gt;ä¼šè°ƒç”¨&lt;code&gt;vm.$off&lt;/code&gt;ï¼Œç§»å‡ºè¿™ä¸ªäº‹ä»¶ç›‘å¬&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;function add (event, fn) {
  target.$on(event, fn)
}

function remove (event, fn) {
  target.$off(event, fn)
}

export function updateComponentListeners (
  vm: Component,
  listeners: Object,
  oldListeners: ?Object
) {
  // ä¿å­˜å½“å‰çš„vmå¼•ç”¨
  target = vm
  // ä¼ å…¥listenersï¼Œçˆ¶ç»„ä»¶ç»‘å®šåœ¨å½“å‰ç»„ä»¶ä¸Šçš„äº‹ä»¶ï¼ŒoldListenersåŒç†ï¼Œä¸è¿‡åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–çš„æ—¶å€™ä¸ºç©º
  // å…¶å†…éƒ¨ä¼šéå†listenersè°ƒç”¨addæ–¹æ³•æ·»åŠ ç›‘å¬äº‹ä»¶ï¼ŒåŒæ—¶ç§»å‡ºoldListeners
  updateListeners(listeners, oldListeners || {}, add, remove, createOnceHandler, vm)
  target = undefined
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3&gt; 1.3initRender &lt;/h3&gt;

&lt;p&gt;ä¸»è¦æ˜¯æ·»åŠ äº†ä¸€äº›è™šæ‹Ÿdomã€&lt;code&gt;slot&lt;/code&gt;ç­‰ç›¸å…³çš„å±æ€§å’Œæ–¹æ³•&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;export function initRender (vm: Component) {
  // è¡¨ç¤ºè™šæ‹ŸdomèŠ‚ç‚¹
  vm._vnode = null 
  // è¡¨ç¤ºå½“å‰å®ä¾‹renderå¾—åˆ°çš„Vnode
  vm._staticTrees = null 
  const options = vm.$options
  const parentVnode = vm.$vnode = options._parentVnode  tree
  const renderContext = parentVnode &amp;amp;&amp;amp; parentVnode.context
  // ç”Ÿæˆæ’æ§½å†…å®¹
  vm.$slots = resolveSlots(options._renderChildren, renderContext)
  // ä½œç”¨åŸŸæ’æ§½ï¼Œæ­¤æ—¶ä¸ºç©º
  vm.$scopedSlots = emptyObject
  vm._c = (a, b, c, d) =&amp;gt; createElement(vm, a, b, c, d, false)
  vm.$createElement = (a, b, c, d) =&amp;gt; createElement(vm, a, b, c, d, true)
  const parentData = parentVnode &amp;amp;&amp;amp; parentVnode.data
	......
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;resolveSlots&lt;/code&gt;æ–¹æ³•&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;export function resolveSlots (
  children: ?Array&amp;lt;VNode&amp;gt;,
  context: ?Component
): { [key: string]: Array&amp;lt;VNode&amp;gt; } {
  if (!children || !children.length) {
    return {}
  }
  const slots = {}
  // éå†å½“å‰èŠ‚ç‚¹chilren
  for (let i = 0, l = children.length; i &amp;lt; l; i++) {
    const child = children[i]
    // è·å–data
    const data = child.data
    if (data &amp;amp;&amp;amp; data.attrs &amp;amp;&amp;amp; data.attrs.slot) {
      delete data.attrs.slot
    }
    if ((child.context === context || child.fnContext === context) &amp;amp;&amp;amp;
      data &amp;amp;&amp;amp; data.slot != null
    ) {
      // æ‹¿åˆ°æ’æ§½åç§°
      const name = data.slot
      const slot = (slots[name] || (slots[name] = []))
      if (child.tag === &#39;template&#39;) {
        slot.push.apply(slot, child.children || [])
      } else {
        slot.push(child)
      }
    } else {
      // å¦‚æœ data.slot ä¸å­˜åœ¨ï¼Œåˆ™æ˜¯é»˜è®¤æ’æ§½çš„å†…å®¹ï¼Œåˆ™æŠŠå¯¹åº”çš„ child æ·»åŠ åˆ° slots.defaults ä¸­
      (slots.default || (slots.default = [])).push(child)
    }
  }
  // æœ€åè¿‡æ»¤ä¸€äº›ç©ºå†…å®¹
  for (const name in slots) {
    if (slots[name].every(isWhitespace)) {
      delete slots[name]
    }
  }
  return slots
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è°ƒç”¨é’©å­å‡½æ•°&lt;code&gt;beforeCreate&lt;/code&gt;&lt;/p&gt;

&lt;h3&gt; 1.4initProvideå’ŒinitInjection &lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;function initProvide (vm) {
  var provide = vm.$options.provide;
  if (provide) {
    vm._provided = typeof provide === &#39;function&#39;
      ? provide.call(vm)
    : provide;
  }
}
function initInjections (vm) {
  // è·å–å½“å‰èŠ‚ç‚¹ä¸Šçš„injectå±æ€§
  var result = resolveInject(vm.$options.inject, vm);
  if (result) {
    toggleObserving(false);
    // éå†è¿™äº›å±æ€§ï¼ŒdefineReactiveï¼Œå°†è¿™äº›å±æ€§å˜æˆå“åº”å¼çš„
    Object.keys(result).forEach(function (key) {
      /* istanbul ignore else */
      {
        defineReactive$$1(vm, key, result[key], function () {
          warn(
            &amp;quot;Avoid mutating an injected value directly since the changes will be &amp;quot; +
            &amp;quot;overwritten whenever the provided component re-renders. &amp;quot; +
            &amp;quot;injection being mutated: \&amp;quot;&amp;quot; + key + &amp;quot;\&amp;quot;&amp;quot;,
            vm
          );
        });
      }
    });
    toggleObserving(true);
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3&gt; 1.5initState &lt;/h3&gt;

&lt;p&gt;ä¸»è¦æ˜¯åˆå§‹åŒ–ä¸€äº›æ•°æ®å’Œå±æ€§ï¼Œæ¯”å¦‚&lt;code&gt;props&lt;/code&gt;ã€&lt;code&gt;methods&lt;/code&gt;ã€&lt;code&gt;data&lt;/code&gt;ã€&lt;code&gt;computed&lt;/code&gt;ã€&lt;code&gt;watch&lt;/code&gt;,&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;function initState (vm) {
  vm._watchers = [];
  var opts = vm.$options;
  if (opts.props) { initProps(vm, opts.props); }
  if (opts.methods) { initMethods(vm, opts.methods); }
  if (opts.data) {
    initData(vm);
  } else {
    observe(vm._data = {}, true /* asRootData */);
  }
  if (opts.computed) { initComputed(vm, opts.computed); }
  if (opts.watch &amp;amp;&amp;amp; opts.watch !== nativeWatch) {
    initWatch(vm, opts.watch);
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åˆå§‹åŒ–&lt;code&gt;props&lt;/code&gt;å±æ€§&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;function initProps (vm, propsOptions) {
  // è·å–å½“å‰èŠ‚ç‚¹çš„propså±æ€§å€¼
  var propsData = vm.$options.propsData || {};
  var props = vm._props = {};
  var isRoot = !vm.$parent;
  // ç”¨äºä¿å­˜å½“å‰ç»„ä»¶çš„propsé‡Œçš„keyï¼Œä»¥ä¾¿ä¹‹ååœ¨çˆ¶ç»„ä»¶æ›´æ–°propsæ—¶å¯ä»¥ç›´æ¥ä½¿ç”¨æ•°ç»„è¿­ä»£
  var keys = vm.$options._propKeys = [];
  var isRoot = !vm.$parent;
  if (!isRoot) {
    toggleObserving(false);
  }
  var loop = function ( key ) {
    keys.push(key);
    // validatePropéªŒè¯å½“å‰prop[key]æ˜¯å¦propsOptionså®šä¹‰çš„è¦æ±‚
    var value = validateProp(key, propsOptions, propsData, vm);
    {
      var hyphenatedKey = hyphenate(key);
      if (isReservedAttribute(hyphenatedKey) ||
          config.isReservedAttr(hyphenatedKey)) {
        warn(
          (&amp;quot;\&amp;quot;&amp;quot; + hyphenatedKey + &amp;quot;\&amp;quot; is a reserved attribute and cannot be used as component prop.&amp;quot;),
          vm
        );
      }
      // æ·»åŠ å“åº”å¼å±æ€§ï¼Œè¿™æ ·propsé‡Œé¢çš„å€¼æ”¹å˜ä¹‹åï¼Œç»„ä»¶ä¼šè‡ªåŠ¨æ›´æ–°è§†å›¾
      defineReactive$$1(props, key, value, function () {
        if (!isRoot &amp;amp;&amp;amp; !isUpdatingChildComponent) {
          warn(
            &amp;quot;Avoid mutating a prop directly since the value will be &amp;quot; +
            &amp;quot;overwritten whenever the parent component re-renders. &amp;quot; +
            &amp;quot;Instead, use a data or computed property based on the prop&#39;s &amp;quot; +
            &amp;quot;value. Prop being mutated: \&amp;quot;&amp;quot; + key + &amp;quot;\&amp;quot;&amp;quot;,
            vm
          );
        }
      });
    }
    // static props are already proxied on the component&#39;s prototype
    // during Vue.extend(). We only need to proxy props defined at
    // instantiation here.
    if (!(key in vm)) {
      proxy(vm, &amp;quot;_props&amp;quot;, key);
    }
  };
	// å¾ªç¯éå†key
  for (var key in propsOptions) loop( key );
  toggleObserving(true);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åˆå§‹åŒ–&lt;code&gt;methods&lt;/code&gt;å±æ€§&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;function initMethods (vm, methods) {
  // propså±æ€§ç”¨äºåˆ¤æ–­methodsä¸­çš„æ–¹æ³•åæ˜¯å¦å’Œpropsçš„å±æ€§é‡å
  var props = vm.$options.props;
  for (var key in methods) {
    {
      if (typeof methods[key] !== &#39;function&#39;) {
        warn(
          &amp;quot;Method \&amp;quot;&amp;quot; + key + &amp;quot;\&amp;quot; has type \&amp;quot;&amp;quot; + (typeof methods[key]) + &amp;quot;\&amp;quot; in the component definition. &amp;quot; +
          &amp;quot;Did you reference the function correctly?&amp;quot;,
          vm
        );
      }
      // å¦‚æœpropsä¸­æœ‰åŒåå±æ€§ï¼Œåˆ™æŠ¥é”™
      if (props &amp;amp;&amp;amp; hasOwn(props, key)) {
        warn(
          (&amp;quot;Method \&amp;quot;&amp;quot; + key + &amp;quot;\&amp;quot; has already been defined as a prop.&amp;quot;),
          vm
        );
      }
      // å¦‚æœkeyæ˜¯ä»¥$æˆ–_å¼€å¤´åˆ™ï¼Œä¹ŸæŠ¥é”™
      if ((key in vm) &amp;amp;&amp;amp; isReserved(key)) {
        warn(
          &amp;quot;Method \&amp;quot;&amp;quot; + key + &amp;quot;\&amp;quot; conflicts with an existing Vue instance method. &amp;quot; +
          &amp;quot;Avoid defining component methods that start with _ or $.&amp;quot;
        );
      }
    }
    vm[key] = typeof methods[key] !== &#39;function&#39; ? noop : bind(methods[key], vm);
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åˆå§‹åŒ–&lt;code&gt;data&lt;/code&gt;å±æ€§&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;function initData (vm) {
  // è·å–dataå±æ€§
  var data = vm.$options.data;
  // å¦‚æœdataæ˜¯ä¸€ä¸ªfunctionï¼Œåˆ™è°ƒç”¨getDataè¿”å›é‡Œé¢çš„å€¼ï¼Œå¦åˆ™ç›´æ¥å°†dataå±æ€§èµ‹ç»™_data
  data = vm._data = typeof data === &#39;function&#39;
    ? getData(data, vm)
  : data || {};
  // å¦‚æœdataå±æ€§ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè®¾ç½®dataä¸ºç©ºå¯¹è±¡ï¼Œå¹¶æ‰“å°ä¸€ä¸ªwarn
  if (!isPlainObject(data)) {
    data = {};
    warn(
      &#39;data functions should return an object:\n&#39; +
      &#39;https://vuejs.org/v2/guide/components.html#data-Must-Be-a-Function&#39;,
      vm
    );
  }
  // è·å–data keysï¼Œpropså±æ€§ï¼Œmethodså±æ€§
  var keys = Object.keys(data);
  var props = vm.$options.props;
  var methods = vm.$options.methods;
  var i = keys.length;
  while (i--) {
    var key = keys[i];
    {
      // å½“å‰dataçš„keyå¦‚æœå’Œmethodsä¸­çš„æ–¹æ³•é‡åï¼ŒæŠ›å‡ºè­¦å‘Š
      if (methods &amp;amp;&amp;amp; hasOwn(methods, key)) {
        warn(
          (&amp;quot;Method \&amp;quot;&amp;quot; + key + &amp;quot;\&amp;quot; has already been defined as a data property.&amp;quot;),
          vm
        );
      }
    }
    // å½“å‰dataçš„keyå¦‚æœå’Œpropsä¸­çš„å±æ€§é‡åï¼ŒæŠ›å‡ºè­¦å‘Š
    if (props &amp;amp;&amp;amp; hasOwn(props, key)) {
      warn(
        &amp;quot;The data property \&amp;quot;&amp;quot; + key + &amp;quot;\&amp;quot; is already declared as a prop. &amp;quot; +
        &amp;quot;Use prop default value instead.&amp;quot;,
        vm
      );
    } else if (!isReserved(key)) {
      proxy(vm, &amp;quot;_data&amp;quot;, key);
    }
  }
  // åŒå‘æ•°æ®ç»‘å®šdata
  observe(data, true /* asRootData */);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åˆå§‹åŒ–&lt;code&gt;computed&lt;/code&gt;å±æ€§&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;function initComputed (vm, computed) {
  // $flow-disable-line
  var watchers = vm._computedWatchers = Object.create(null);
  // computed properties are just getters during SSR
  var isSSR = isServerRendering();

  for (var key in computed) {
    // æ¯ä¸ªcomputed keyæ‰€å®šä¹‰çš„æ–¹æ³•
    var userDef = computed[key];
    // å°†è¯¥æ–¹æ³•èµ‹å€¼ç»™getterå˜é‡
    var getter = typeof userDef === &#39;function&#39; ? userDef : userDef.get;
    if (getter == null) {
			// å¦‚æœä¸ºç©ºï¼Œæ‰“å°é”™è¯¯
      warn(
        (&amp;quot;Getter is missing for computed property \&amp;quot;&amp;quot; + key + &amp;quot;\&amp;quot;.&amp;quot;),
        vm
      );
    }

    if (!isSSR) {
      // create internal watcher for the computed property.
      watchers[key] = new Watcher(
        vm,
        getter || noop,
        noop,
        computedWatcherOptions
      );
    }

    // å¦‚æœå½“å‰èŠ‚ç‚¹computedä¸Šæœªæœ‰keyè¿™ä¸ªæ–¹æ³•
    if (!(key in vm)) {
      // defineComputedæ–¹æ³•ä¸»è¦æ˜¯ä¸ºå½“å‰èŠ‚ç‚¹çš„computedå±æ€§æ·»åŠ å“åº”å¼æ›´æ–°æ–¹æ³•
      // å¯ä»¥åœ¨defineComputedå®šä¹‰æœ€åçœ‹åˆ° Object.defineProperty(target, key, sharedPropertyDefinition) 
      defineComputed(vm, key, userDef);
    } else {
      if (key in vm.$data) {
        warn((&amp;quot;The computed property \&amp;quot;&amp;quot; + key + &amp;quot;\&amp;quot; is already defined in data.&amp;quot;), vm);
      } else if (vm.$options.props &amp;amp;&amp;amp; key in vm.$options.props) {
        warn((&amp;quot;The computed property \&amp;quot;&amp;quot; + key + &amp;quot;\&amp;quot; is already defined as a prop.&amp;quot;), vm);
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åˆå§‹åŒ–&lt;code&gt;watch&lt;/code&gt;å±æ€§æ¯”è¾ƒç®€å•ï¼Œåœ¨åšäº†ç›¸åº”çš„åˆ¤æ–­åç›´æ¥æ·»åŠ ä¸€ä¸ªå“åº”å¼æ›´æ–°å±æ€§ï¼Œè¿™é‡Œä¸å¤šèµ˜è¿°ï¼Œè°ƒç”¨å®Œ&lt;code&gt;initState&lt;/code&gt;ä¹‹åï¼Œä¼šè°ƒç”¨&lt;code&gt;created&lt;/code&gt;é’©å­å‡½æ•°ï¼Œæ­¤æ—¶&lt;code&gt;vm&lt;/code&gt;ä¸Šçš„å±æ€§&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;// _init
vm._uid = 0
vm._isVue = true
vm.$options = {
  components: {
    KeepAlive,
    Transition,
    TransitionGroup
  },
  directives: {
    model,
    show
  },
  methods: {},
  computed: {},
  watch: {},
  filters: {},
  _base: Vue,
  el: &#39;#app&#39;,
  data: function mergedInstanceDataFn(){}
}
vm._renderProxy = vm
vm._self = vm

// initLifecycle
vm.$parent = parent
vm.$root = parent ? parent.$root : vm

vm.$children = []
vm.$refs = {}

vm._watcher = null
vm._inactive = null
vm._directInactive = false
vm._isMounted = false
vm._isDestroyed = false
vm._isBeingDestroyed = false

// initEvents	
vm._events = Object.create(null)
vm._hasHookEvent = false

// initRender
vm.$vnode = null  
vm._vnode = null
vm._staticTrees = null
vm.$slots = resolveSlots(vm.$options._renderChildren, renderContext)
vm.$scopedSlots = emptyObject

vm._c = (a, b, c, d) =&amp;gt; createElement(vm, a, b, c, d, false)

vm.$createElement = (a, b, c, d) =&amp;gt; createElement(vm, a, b, c, d, true)
// åœ¨ initState ä¸­æ·»åŠ çš„å±æ€§
vm._watchers = []
vm._data
vm.message
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰§è¡Œå®Œä¸Šé¢æ­¥éª¤åï¼Œä¼šè°ƒç”¨&lt;code&gt;vm.$mount&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;// ä¿å­˜ä¹‹å‰å®šä¹‰çš„$mountæ–¹æ³•ï¼Œç„¶åé‡å†™Vue.prototype.$mount
const mount = Vue.prototype.$mount
Vue.prototype.$mount = function (
  el?: string | Element,
  hydrating?: boolean
): Component {
  // æŸ¥æ‰¾å½“å‰èŠ‚ç‚¹
  el = el &amp;amp;&amp;amp; query(el)

 	// å¦‚æœäº‹bodyå…ƒç´ æˆ–è€…documentElementå…ƒç´ åˆ™æŠ›é”™
  if (el === document.body || el === document.documentElement) {
    process.env.NODE_ENV !== &#39;production&#39; &amp;amp;&amp;amp; warn(
      `Do not mount Vue to &amp;lt;html&amp;gt; or &amp;lt;body&amp;gt; - mount to normal elements instead.`
    )
    return this
  }
	
  // æ‹¿åˆ°options
  const options = this.$options
  // å¦‚æœèŠ‚ç‚¹ä¸Šæ²¡æœ‰renderå‡½æ•°
  if (!options.render) {
    // è·å–templateï¼Œtemplateå¯ä»¥æ˜¯#idã€æ¨¡æ¿å­—ç¬¦ä¸²ã€domå…ƒç´ 
    let template = options.template
    if (template) {
      if (typeof template === &#39;string&#39;) {
        if (template.charAt(0) === &#39;#&#39;) {
          // è·å–templatge innerHTML
          template = idToTemplate(template)
          /* istanbul ignore if */
          if (process.env.NODE_ENV !== &#39;production&#39; &amp;amp;&amp;amp; !template) {
            warn(
              `Template element not found or is empty: ${options.template}`,
              this
            )
          }
        }
      } else if (template.nodeType) {
        // å¦‚æœä¸æ˜¯#idã€æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œç›´æ¥è·å–å…¶innerHTML
        template = template.innerHTML
      } else {
        if (process.env.NODE_ENV !== &#39;production&#39;) {
          warn(&#39;invalid template option:&#39; + template, this)
        }
        return this
      }
    } else if (el) {
      // å¦‚æœæ²¡æœ‰templateï¼Œåˆ™è·å–elä»¥åŠå…¶å­å†…å®¹ä½œä¸ºæ¨¡æ¿
      template = getOuterHTML(el)
    }
    if (template) {
      ......
    }
  }
  // æœ‰renderå‡½æ•°ï¼Œç›´æ¥æ‰§è¡Œmount.call(this, el, hydrating)
  return mount.call(this, el, hydrating)
}

function getOuterHTML (el: Element): string {
  if (el.outerHTML) {
    return el.outerHTML
  } else {
    const container = document.createElement(&#39;div&#39;)
    container.appendChild(el.cloneNode(true))
    return container.innerHTML
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸Šé¢æœ€åè°ƒç”¨äº†&lt;code&gt;mount.call(this, el, hydrating)&lt;/code&gt;ï¼Œå…¶æ–¹æ³•å¯¹åº”äº&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;Vue.prototype.$mount = function (
  el?: string | Element,
  hydrating?: boolean
): Component {
  el = el &amp;amp;&amp;amp; inBrowser ? query(el) : undefined
  return mountComponent(this, el, hydrating)
}

  vm: Component,
  el: ?Element,
  hydrating?: boolean
): Component {
  vm.$el = el
	......
  // è°ƒç”¨beforeMounté’©å­å‡½æ•°
  callHook(vm, &#39;beforeMount&#39;)

  let updateComponent
	
  ......
  
  // æ›´æ–°å½“å‰èŠ‚ç‚¹çš„æ–¹æ³•
  updateComponent = () =&amp;gt; {
    // vm._renderä¼šè¿”å›ä¸€ä¸ªrenderå­—ç¬¦ä¸²ï¼Œ_updateå…¶å†…éƒ¨ä¼šè°ƒç”¨patchæ–¹æ³•æ¥è¿›è¡ŒèŠ‚ç‚¹çš„å¢åˆ æ”¹
    vm._update(vm._render(), hydrating)
  }

	// åˆ›å»ºä¸€ä¸ªwatchå¯¹è±¡ï¼Œåœ¨è°ƒç”¨updateComponentä¹‹å‰ä¼šå…ˆè°ƒç”¨beforeæ–¹æ³•
  new Watcher(vm, updateComponent, noop, {
    before () {
      if (vm._isMounted &amp;amp;&amp;amp; !vm._isDestroyed) {
        // å¦‚æœæ˜¯æ›´æ–°èŠ‚ç‚¹ï¼Œè°ƒç”¨beforeUpdateé’©å­å‡½æ•°
        callHook(vm, &#39;beforeUpdate&#39;)
      }
    }
  }, true /* isRenderWatcher */)
  hydrating = false

   // å½“é¡µé¢æ¸²æŸ“å®Œæˆåï¼Œè°ƒç”¨é’©å­å‡½æ•°mounted
  if (vm.$vnode == null) {
    vm._isMounted = true
    callHook(vm, &#39;mounted&#39;)
  }
  return vm
}
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>about</title>
      <link>https://xtid.github.io/about/</link>
      <pubDate>Wed, 24 Jun 2020 00:08:20 +0800</pubDate>
      
      <guid>https://xtid.github.io/about/</guid>
      <description>&lt;p&gt;å°å°ç å†œå¯ç¬‘å¯ç¬‘&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨Canvaså®ç°ä¸€ä¸ªçº¢åŒ…é›¨çš„æ•ˆæœ</title>
      <link>https://xtid.github.io/2020/%E4%BD%BF%E7%94%A8canvas%E5%81%9A%E4%B8%80%E4%B8%AA%E7%BA%A2%E5%8C%85%E9%9B%A8%E7%9A%84%E6%95%88%E6%9E%9C/</link>
      <pubDate>Mon, 15 Jun 2020 18:12:19 +0700</pubDate>
      
      <guid>https://xtid.github.io/2020/%E4%BD%BF%E7%94%A8canvas%E5%81%9A%E4%B8%80%E4%B8%AA%E7%BA%A2%E5%8C%85%E9%9B%A8%E7%9A%84%E6%95%88%E6%9E%9C/</guid>
      <description>

&lt;p&gt;ä¹‹å‰ä½¿ç”¨jQueryåšäº†ä¸€ä¸ªçº¢åŒ…é›¨çš„æ•ˆæœï¼Œæ„Ÿè§‰ä¸æ˜¯å¾ˆç†æƒ³ï¼Œåˆ›å»ºè¿‡å¤šDOMå…ƒç´ é€ æˆæ€§èƒ½ä¸Šçš„æµªè´¹ï¼Œæ•´ä¸ªé¡µé¢ä¹Ÿä¸å¤Ÿä¸æ»‘æµç•…ï¼Œè¿™æ¬¡è¯¥ç”¨Canvasåšä¸€ä¸ªçº¢åŒ…é›¨çš„æ•ˆæœ&lt;/p&gt;

&lt;h3 id=&#34;1-æ ¸å¿ƒåŸç†&#34;&gt;1.æ ¸å¿ƒåŸç†&lt;/h3&gt;

&lt;p&gt;1.ç”Ÿæˆçº¢åŒ…ï¼Œè®¾ç½®å¥½é»˜è®¤çš„èƒŒæ™¯å›¾åƒï¼Œä¼ å…¥é¡µé¢ä¸Šæ‰€éœ€çš„çº¢åŒ…æ•°é‡&lt;/p&gt;

&lt;p&gt;2.ä¿å­˜çŠ¶æ€ï¼Œåˆ©ç”¨Canvasçš„åŸç”ŸAPIå®ç°é¡µé¢çš„æ¸²æŸ“ï¼Œæ¯æ¬¡ç§»åŠ¨å„ä¸ªçº¢åŒ…åˆ°ä¸åŒä½ç½®ï¼Œåˆ©ç”¨&lt;code&gt;window.requestAnimationFrame&lt;/code&gt;å®ç°æ¯ä¸€å¸§çš„åŠ¨ç”»ç»˜åˆ¶ï¼Œä½¿æ•´ä¸ªé¡µé¢ä¸ä¼šå¡é¡¿&lt;/p&gt;

&lt;p&gt;3.ç‚¹å‡»çº¢åŒ…ï¼Œè®¡ç®—æ˜¯å¦ç‚¹ä¸­çº¢åŒ…ï¼Œå¦‚æœç‚¹ä¸­ï¼Œåˆ™è¿›è¡Œç›¸åº”çš„äº‹ä»¶å¤„ç†&lt;/p&gt;

&lt;h3 id=&#34;2-å…·ä½“å®ç°&#34;&gt;2.å…·ä½“å®ç°&lt;/h3&gt;

&lt;p&gt;2.1å®šä¹‰ä¸€äº›åŸºæœ¬å˜é‡&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;redEnvelopeArr: [], // å½“å‰æ•´ä¸ªçº¢åŒ…å¯¹è±¡æ•°ç»„
itemSpeed: [], // æ¯ä¸ªçº¢åŒ…å¯¹è±¡å¯¹åº”çš„ä¸€äº›å±æ€§ï¼Œå¦‚ä¸‹è½é€Ÿåº¦ï¼Œé¡µé¢ä¸Šæ‰€åœ¨çš„ä½ç½®
count: 0, // åŠ è½½å¥½çš„çº¢åŒ…å›¾ç‰‡çš„æ•°é‡
ctx: null, // Canvas contextå¯¹è±¡
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;2.2åŠ è½½çº¢åŒ…å›¾ç‰‡&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;loadImgs(totalCount) {
  const self = this
  const canvas = document.getElementById(&#39;canvas&#39;)
  if (canvas.width &amp;lt; window.innerWidth) {
    canvas.width = window.innerWidth
  }
  if (canvas.height &amp;lt; window.innerHeight) {
    canvas.height = window.innerHeight
  }
  return new Promise(resolve =&amp;gt; {
    for (let index = 0; index &amp;lt; totalCount; index++) {
      const image = new Image()
      image.src = &#39;&#39; // å›¾ç‰‡åœ°å€
      image.onload = () =&amp;gt; {
        self.count++
        self.itemSpeed.push({
          speed: 0, // å¼€å§‹ä¸‹è½çš„ä½ç½®
          step: self.randomFloat(2, 6) // æ¯ä¸ªçº¢åŒ…ä¸‹è½çš„é€Ÿåº¦
        })
        self.redEnvelopeArr.push({
          x: self.randomFloat(0, window.innerWidth - 100),
          y: 0,
          img: image
        })
        if (self.count === totalCount) resolve() // æ‰€æœ‰å›¾ç‰‡åŠ è½½å®Œæˆè·³å‡º
      }
    }
  })
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;2.2ç”Ÿæˆéšæœºæ•°çš„ä¸€ä¸ªæ–¹æ³•&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;randomFloat(low, high) {
  return low + Math.random() * (high - low)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;2.3ç»˜åˆ¶çº¢åŒ…å›¾ç‰‡ä¸‹è½ï¼Œè¿™é‡Œåšäº†ä¸€ä¸ªæ—‹è½¬ä¸‹è½çš„æ•ˆæœï¼Œä¸»è¦åŸç†æ˜¯åˆ©ç”¨&lt;code&gt;translate&lt;/code&gt;ç§»åŠ¨contextä½ç½®ï¼Œæ—‹è½¬ä¸€å®šè§’åº¦åï¼Œå°†åŸç‚¹ç§»åŠ¨åˆ°ä¹‹å‰ä½ç½®ï¼Œåšä¸€ä¸ªæ—‹è½¬çš„æ•ˆæœï¼Œæ¯æ¬¡æ“ä½œçš„æ—¶å€™è®°å¾—&lt;code&gt;sava&lt;/code&gt;ã€&lt;code&gt;restore&lt;/code&gt;ã€‚å½“ç„¶å¦‚æœä¸æƒ³åšæ—‹è½¬æ•ˆæœï¼Œé‚£ç›´æ¥ç”¨&lt;code&gt;drawImage&lt;/code&gt;æ¯æ¬¡ç”»ä¸åŒä½ç½®çš„çº¢åŒ…å°±è¡Œäº†&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;drawRedEnvelope() {
  const self = this
  self.ctx.width = 100 // çº¢åŒ…çš„å®½åº¦
  self.ctx.height = 120 // çº¢åŒ…çš„é«˜åº¦
  self.redEnvelopeArr.forEach((item, index) =&amp;gt; {
    const newRedEnvelope = {
      x: item.x, // çº¢åŒ…æ‰€åœ¨çš„xè½´ä½ç½®
      y: item.y + self.itemSpeed[index].step, // çº¢åŒ…æ‰€åœ¨çš„yè½´ä½ç½®ï¼Œä¸»è¦ç”±ä¸‹è½é€Ÿåº¦å†³å®š
      img: item.img,
      speed: item.speed
    }
    self.ctx.save()
    self.redEnvelopeArr.splice(index, 1, newRedEnvelope)
    self.ctx.translate(item.x + 50, 60 + self.itemSpeed[index].speed)
    self.ctx.rotate(self.itemSpeed[index].speed * Math.PI / 180)
    self.ctx.translate(-item.x - 50, -60 - self.itemSpeed[index].speed)
    self.ctx.drawImage(item.img, item.x, self.itemSpeed[index].speed)
    self.ctx.restore()
    self.itemSpeed[index].speed += self.itemSpeed[index].step
    // self.ctx.drawImage(item.img, item.x, item.y, self.ctx.width, self.ctx.height)
  })
},
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;2.4ä½¿ç”¨&lt;code&gt;clearRect&lt;/code&gt;æ¸…é™¤ä¸Šä¸€å¸§çš„æ•ˆæœï¼Œåœ¨è°ƒç”¨&lt;code&gt;drawRedEnvelope&lt;/code&gt;ç»˜åˆ¶æ–°ä¸€å¸§çš„æ•ˆæœï¼Œä½¿ç”¨&lt;code&gt;requestAnimationFrame&lt;/code&gt;é‡å¤æ‰§è¡Œ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;moveRedEnvelope() {
  const self = this
  self.ctx.clearRect(0, 0, window.innerWidth, window.innerHeight)
  self.drawRedEnvelope()
  window.requestAnimationFrame(self.moveRedEnvelope.bind(this))
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;2.5ç‚¹å‡»çº¢åŒ…æ—¶ï¼Œå¾ªç¯éå†åˆ¤æ–­å½“å‰ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨æŸä¸ªçº¢åŒ…å†…ï¼Œå¦‚æœé‡åˆ°å¤šä¸ªçº¢åŒ…é‡å çš„æƒ…å†µï¼Œåªéœ€å–æœ€ä¸Šé¢ä¸€ä¸ªå°±è¡Œäº†&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;redEnvelopeClick() {
  const self = this
  const canvas = document.getElementById(&#39;canvas&#39;)
  canvas.addEventListener(&#39;click&#39;, e =&amp;gt; {
    let result = {}
    this.redEnvelopeArr.forEach((item, index) =&amp;gt; {
      const distanceX = e.clientX - item.x
      const distanceY = e.clientY - item.y
      const withinX = distanceX &amp;gt; 0
      const withinY = distanceY &amp;gt; 0
      if (withinX &amp;amp;&amp;amp; withinY) {
        result = item // æœ€åçš„resultè¿”å›ï¼Œç„¶ååšä¸€äº›å¤„ç†
      }
    })
  })
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;åè¨€&#34;&gt;åè¨€&lt;/h3&gt;

&lt;p&gt;ä»¥ä¸Šå°±æ˜¯ä¸»è¦å†…å®¹ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œç‚¹å‡»å®Œäº†æŸä¸ªçº¢åŒ…éœ€è¦æ‰¾ä¸ªæ—¶é—´ç‚¹æ¸…ç©ºæ•´ä¸ªé¡µé¢ä¸Šçš„åŠ¨ç”»ï¼Œè¿˜æœ‰å°±æ˜¯å…·ä½“çš„ç‚¹å‡»å®ç°çš„ä¸šåŠ¡é€»è¾‘éœ€è‡ªå·±å»å¤„ç†&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>