<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  
  
  
  
  <link rel="prev" href="https://xtid.github.io/2020/%E6%B5%85%E8%B0%88%E5%89%8D%E7%AB%AF%E7%BB%9F%E8%AE%A1/" />
  
  <link rel="canonical" href="https://xtid.github.io/2020/%E8%BE%93%E5%85%A5%E4%B8%80%E4%B8%AAurl%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%91%88%E7%8E%B0%E7%9A%84%E8%BF%87%E7%A8%8B/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" sizes="32x32" href="/favicon.ico">
  <link rel="icon" sizes="16x16" href="/favicon.ico">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           输入一个URL到页面呈现的过程 | 👨🏻‍💻
       
  </title>
  <meta name="title" content="输入一个URL到页面呈现的过程 | 👨🏻‍💻">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/xtid.github.io"
    },
    "articleSection" : "posts",
    "name" : "输入一个URL到页面呈现的过程",
    "headline" : "输入一个URL到页面呈现的过程",
    "description" : "1.DNS解析 平时在浏览器中输入的域名并非是网址或资源真实所在的服务器地址或资源，域名只是与ip地址的一个映射。在进行正式的请求之前，就会先",
    "inLanguage" : "zh-CN",
    "author" : "",
    "creator" : "",
    "publisher": "",
    "accountablePerson" : "",
    "copyrightHolder" : "",
    "copyrightYear" : "2020",
    "datePublished": "2020-11-15 15:21:34 \x2b0800 CST",
    "dateModified" : "2020-11-15 15:21:34 \x2b0800 CST",
    "url" : "https:\/\/xtid.github.io\/2020\/%E8%BE%93%E5%85%A5%E4%B8%80%E4%B8%AAurl%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%91%88%E7%8E%B0%E7%9A%84%E8%BF%87%E7%A8%8B\/",
    "wordCount" : "3327",
    "keywords" : [  "👨🏻‍💻"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://xtid.github.io">👨🏻‍💻</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://xtid.github.io">👨🏻‍💻</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">输入一个URL到页面呈现的过程</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://xtid.github.io" rel="author"></a> with ♥ 
                <span class="post-time">
                on <time datetime=2020-11-15 itemprop="datePublished">November 15, 2020</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://xtid.github.io/categories/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/"> 日常学习 </a>
                        
                </span>
        </div>
    </header>
    <div class="post-content">
        

        
            
        

        
        
     
          
          
          

          
          
          

          

<h4 id="1-dns解析">1.DNS解析</h4>

<p>平时在浏览器中输入的域名并非是网址或资源真实所在的服务器地址或资源，域名只是与<code>ip</code>地址的一个映射。在进行正式的请求之前，就会先有这个过程：<code>DNS</code>服务将域名解析成对应的<code>ip</code>地址。其解析过程：</p>

<p>1.检查本机<code>host</code>中是否有配置相应的<code>ip</code>映射关系，如果有则使用这个<code>ip</code>地址，完成域名解析
2.检查浏览器缓存中是否缓存过该域名对应的<code>ip</code>地址
3.检查找本机系统中是否缓存过<code>ip</code>
4.向本地域名解析服务发起域名解析的请求
5.向根域名解析服务器发起域名解析请求
6.按照根域名<code>(.)</code> -&gt; 顶级域<code>(如：.com)</code> -&gt; 第二层域<code>(如：xxx.com)</code> -&gt; 子域<code>(如：www.xxx.com)</code>的顺序查找到ip地址
8.返回解析结果给用户</p>

<h4 id="2-建立-tcp-连接">2.建立<code>TCP</code>连接</h4>

<p>经典的三次握手</p>

<blockquote>
<p>第一次握手： 建立连接时，客户端发送syn包（syn=j）到服务器，并进入SYN_SENT状态，等待服务器确认；</p>

<p>第二次握手： 服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包（syn=k），即SYN+ACK包，此时服务器进入SYN_RECV状态；</p>

<p>第三次握手： 客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=k+1），此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态，完成三次握手。</p>
</blockquote>

<p>简单来说其步骤就是，客户端发送数据包告诉服务端连接请求，服务端返回数据包响应表示可以收到建立连接请求并且返回数据包通知客户端，客服端再次发送数据包确认并建立<code>TCP</code>连接</p>

<h4 id="3-发送-http-请求">3.发送<code>HTTP</code>请求</h4>

<p>一个<code>HTTP</code>请求包含请求行，请求头，请求主体</p>

<h5 id="3-1请求行">3.1请求行</h5>

<p>常见的信息有请求地址、请求方法<code>GET、POST、PUT、DELETE、PATCH、HEAD、OPTIONS、TRACE</code>、<code>Http</code>协议信息</p>

<h5 id="3-2请求头">3.2请求头</h5>

<p>常见的请求头信息有</p>

<p><code>Host</code>：主机名
<code>Connection</code>：<code>HTTP/1.1</code>增加的，使用<code>keepalive</code>，一个连接可以发多个请求
<code>User-Agent</code>：客户端程序的信息，就是发送请求的浏览器信息，可根据这个信息来对不同设备进行处理
<code>Accept</code>：浏览器可以接收的媒体数据类型
<code>Accept-Encoding</code>：是浏览器用来告知服务器它能够支持的内容编码及内容编码的优先级顺序，可一次性指定多种内容编码
<code>Accept-Language</code>：告诉服务器浏览器能够处理的自然语言集
<code>Content-Type</code>：请求中的数据的媒体类型
<code>Cookie</code>：浏览器记录的用户相关信息</p>

<p>当然还有很多其他的，这里就不罗列完了，另外还可以自己添加一些自定义请求头，在服务端手动获取处理就行了</p>

<h5 id="3-3请求主体">3.3请求主体</h5>

<p>主要是请求所带的一些参数信息，这里就不多赘述</p>

<h4 id="4-使用浏览器缓存">4.使用浏览器缓存</h4>

<p>浏览器缓存主要<code>强缓存</code>和<code>协商缓存</code>，具体使用哪一种缓存，强缓存的优先级比协商缓存高，怎么设置还是得从实际出发</p>

<h5 id="4-1强缓存">4.1强缓存</h5>

<p>强缓存可以用<code>Expires</code>和<code>Cache-Control</code>来控制，强缓存最大的特点就是通过服务器返回的过期时间来判断缓存是否过期，不会再去和服务端做校验看资源是否真正更新了</p>

<p><code>Expires</code>：主由服务端返给客户端，在过期时间内，浏览器可直接使用缓存而不需要重新请求，但它也有不少局限，首先它只能精确到秒，对于那种毫秒级更新的资源它没办法判断，其次它受限于本地时间，如果修改了本地时间，可能会造成缓存失效。<code>Expires</code>是<code>Http/1</code>时候的请求头，现在这样设置通常也是为了兼容</p>

<p><code>Cache-Control</code>：是现在主要使用的方式，可以在请求头以及响应头中设置，常见设置有<code>max-age(表示缓存在多少秒后过期)</code>，<code>no-cache(表示使用Etag或者Last-Modified字段来控制缓存，即协商缓存)</code>，通常来讲，<code>Cache-control</code>的优先级是要高于<code>Expires</code>的</p>

<h5 id="4-2协商缓存">4.2协商缓存</h5>

<p>在强缓存失效后就会用协商缓存，协商缓存主要使用<code>Last-Modified 和 ETag</code>请求头控制，这两个字段都是由服务端返回的。如果说缓存还生效，那么这次请求的状态码会返回<code>304</code>，表示资源未改动，如果缓存失效，返回新的资源并设置缓存，返回<code>200</code>状态码</p>

<p><code>Last-Modified</code>：在设置<code>Last-Modified</code>后，下次请求时请求头会带上<code>If-Modified-Since</code>这个字段，然后服务器会用这个时间与资源修改时间做对比，然后就是返回<code>304</code>还是<code>200</code>的问题了，同样它也只能精确到秒，所以一些需要毫秒级更新的资源使用这个并不准确</p>

<p><code>ETag</code>：通常与<code>If-None-Match</code>配合使用，<code>Etag</code>为服务端为这资源生成的唯一标识，下次客户端请求的时候，带上这个值，由服务端再做校验，如果资源未改动，返回<code>304</code>，使用原来的缓存，反之返回<code>200</code>，设置缓存</p>

<p><figure><img src="/images/ring.svg" data-sizes="auto" data-src="https://i.loli.net/2020/10/28/O2gaJWm8jYPeI7c.png" alt="浏览器缓存.png" class="lazyload"><figcaption class="image-caption">浏览器缓存.png</figcaption></figure></p>

<p>图出自<a href="https://github.com/ljianshu/Blog" rel="nofollow noreferrer" target="_blank">博客</a></p>

<h4 id="5-浏览器接收响应">5.浏览器接收响应</h4>

<p>响应分为状态码，响应头，响应主体组成，响应主体通常是一些文件<code>如(HTML、JS、CSS文件)</code>或者说是一些响应数据<code>(请求的响应数据)</code>，状态码和响应头这里就不罗列了。有个特别的通常为了提升响应的效率，服务端会将一些进行<code>gzip</code>压缩，然后响应头里面会有个响应头<code>content-encoding:gzip</code>，然后浏览器会再进行解压</p>

<h4 id="6-页面渲染">6.页面渲染</h4>

<p>在接收响应成功之后，浏览器就开始渲染页面了。其步骤包括：1.解析<code>HTML</code>为<code>DOM</code>树、2.解析<code>CSS</code>为<code>CSS</code>树、3.合并<code>DOM</code>树已经<code>CSS</code>树、4.遍历整个节点、5.按照<code>CSS</code>的优先级渲染每个节点的样式，呈现在屏幕上。当浏览器遇到一个<code>script</code>标记时，<code>DOM</code>构建将暂停，直至脚本完成执行，然后继续构建<code>DOM</code>。每次去执行<code>JS</code>脚本都会严重阻塞<code>DOM</code>树的构建，如果<code>JS</code>脚本还操作的<code>CSSOM</code>，而正好这个<code>CSSOM</code>还没有下载和构建，浏览器甚至会延迟脚本执行和构建<code>DOM</code>，直至完成其<code>CSSOM</code>的下载和构建。所以这里通常会有个常见的小优化，<code>CSS</code>放在顶部，<code>JS</code>放在底部，并且减少使用在加载的过程中操作<code>DOM</code>，当然这也是比较老的做法了。在页面加载的过程中，所写的<code>CSS</code>和<code>JS</code>也要尽量避免重绘和回流</p>

<h4 id="7-四次握手">7.四次握手</h4>

<p>四次握手用于断开<code>Tcp</code>连接，客户端发送请求表示要断开连接，服务接受到请求后响应，客户端收到响应准备断开连接，服务端将其余数据或没响应的数据全部返给客户端(即又一次握手)，客户端收到后响应后再发送请求确认关闭，服务端收到后断开连接</p>

<blockquote>
<p>1）客户端进程发出连接释放报文，并且停止发送数据。释放数据报文首部，FIN=1，其序列号为seq=u（等于前面已经传送过来的数据的最后一个字节的序号加1），此时，客户端进入FIN-WAIT-1（终止等待1）状态。 TCP规定，FIN报文段即使不携带数据，也要消耗一个序号。
2）服务器收到连接释放报文，发出确认报文，ACK=1，ack=u+1，并且带上自己的序列号seq=v，此时，服务端就进入了CLOSE-WAIT（关闭等待）状态。TCP服务器通知高层的应用进程，客户端向服务器的方向就释放了，这时候处于半关闭状态，即客户端已经没有数据要发送了，但是服务器若发送数据，客户端依然要接受。这个状态还要持续一段时间，也就是整个CLOSE-WAIT状态持续的时间。
3）客户端收到服务器的确认请求后，此时，客户端就进入FIN-WAIT-2（终止等待2）状态，等待服务器发送连接释放报文（在这之前还需要接受服务器发送的最后的数据）。
4）服务器将最后的数据发送完毕后，就向客户端发送连接释放报文，FIN=1，ack=u+1，由于在半关闭状态，服务器很可能又发送了一些数据，假定此时的序列号为seq=w，此时，服务器就进入了LAST-ACK（最后确认）状态，等待客户端的确认。
5）客户端收到服务器的连接释放报文后，必须发出确认，ACK=1，ack=w+1，而自己的序列号是seq=u+1，此时，客户端就进入了TIME-WAIT（时间等待）状态。注意此时TCP连接还没有释放，必须经过2∗∗MSL（最长报文段寿命）的时间后，当客户端撤销相应的TCB后，才进入CLOSED状态。
6）服务器只要收到了客户端发出的确认，立即进入CLOSED状态。同样，撤销TCB后，就结束了这次的TCP连接。可以看到，服务器结束TCP连接的时间要比客户端早一些。</p>
</blockquote>

<h6 id="参考链接">参考链接</h6>

<p><a href="https://github.com/ljianshu/Blog" rel="nofollow noreferrer" target="_blank">博客</a></p>

    </div>

    

  
    <div class="post-tags">
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://xtid.github.io">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://xtid.github.io/2020/%E6%B5%85%E8%B0%88%E5%89%8D%E7%AB%AF%E7%BB%9F%E8%AE%A1/" class="prev" rel="prev" title="浅谈前端统计"><i class="iconfont icon-left"></i>&nbsp;浅谈前端统计</a>
         
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2019 - 2020</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
     <link href="//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css" rel="stylesheet">  
      
     <script src="/js/vendor_gallery.min.js" async="" ></script>
    
  



     </div>
  </body>
</html>
