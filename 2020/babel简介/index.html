<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  
  
  
  
  <link rel="prev" href="https://xtid.github.io/2020/vue2.x%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B%E7%AE%80%E4%BB%8B/" />
  <link rel="next" href="https://xtid.github.io/2020/webpack%E7%90%86%E8%A7%A3/" />
  <link rel="canonical" href="https://xtid.github.io/2020/babel%E7%AE%80%E4%BB%8B/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" sizes="32x32" href="/favicon.ico">
  <link rel="icon" sizes="16x16" href="/favicon.ico">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           Babel简介 | 👨🏻‍💻
       
  </title>
  <meta name="title" content="Babel简介 | 👨🏻‍💻">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/xtid.github.io"
    },
    "articleSection" : "posts",
    "name" : "Babel简介",
    "headline" : "Babel简介",
    "description" : "1.babel 简介 Babel是现代JavaScript语法转换器，主要用于将 ECMAScript 2015\x2b 版本的代码转换为向后兼容的 JavaScript 语法，以便能够运行在当前和旧版本的浏览器或其",
    "inLanguage" : "zh-CN",
    "author" : "",
    "creator" : "",
    "publisher": "",
    "accountablePerson" : "",
    "copyrightHolder" : "",
    "copyrightYear" : "2020",
    "datePublished": "2020-08-23 21:32:52 \x2b0800 CST",
    "dateModified" : "2020-08-23 21:32:52 \x2b0800 CST",
    "url" : "https:\/\/xtid.github.io\/2020\/babel%E7%AE%80%E4%BB%8B\/",
    "wordCount" : "2915",
    "keywords" : [  "👨🏻‍💻"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://xtid.github.io">👨🏻‍💻</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/links/" title="">Links</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://xtid.github.io">👨🏻‍💻</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/links/" title="">Links</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Babel简介</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://xtid.github.io" rel="author"></a> with ♥ 
                <span class="post-time">
                on <time datetime=2020-08-23 itemprop="datePublished">August 23, 2020</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://xtid.github.io/categories/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/"> 日常学习 </a>
                        
                </span>
        </div>
    </header>
    <div class="post-content">
        

        
            
        

        
        
     
          
          
          

          
          
          

          

<h3 id="1-babel-简介">1.babel 简介</h3>

<blockquote>
<p>Babel是现代JavaScript语法转换器，主要用于将 ECMAScript 2015+ 版本的代码转换为向后兼容的 JavaScript 语法，以便能够运行在当前和旧版本的浏览器或其他环境中，包括不限于: eslint jsx vue-template等等。他能为你做的：语法转换、通过 Polyfill 方式在目标环境中添加缺失的特性、源码转换。可以说，通过babel，我们可以使用最新的语法或者特性专注的开发业务，而不用将精力花在代码的兼容上</p>
</blockquote>

<h3 id="2-babel的解析流程">2.babel的解析流程</h3>

<p><figure><img src="/images/ring.svg" data-sizes="auto" data-src="https://github.com/xtid/blog/blob/master/static/img/deal_process.png" alt="babel处理流程" class="lazyload"><figcaption class="image-caption">babel处理流程</figcaption></figure></p>

<h4 id="2-1词法解析">2.1词法解析</h4>

<p>首先由入口文件<code>@babel/core</code>引入各种配置文件以及解析的模块，其中负责解析基本语法的为<code>parse</code>模块，其中就定义了<code>词法解析器Tokenizer</code>，可以看出初始化时会有一个<code>tokens</code>数组，在这个阶段会把字符串形式的代码转换为一个数组，<code>tokens可以视为由拆分为各个片段组成的数组</code>。</p>

<pre><code class="language-javascript">class Tokenizer extends LocationParser {
  constructor(options, input) {
    super();
    this.tokens = [];
    this.state = new State();
    this.state.init(options);
    this.input = input;
    this.length = input.length;
    this.isLookahead = false;
  }
	
  ....
}
</code></pre>

<p>在<code>Tokenizer</code>定义中还有一些其它的方法，他们会对各种语法字符串进行一个遍历过滤，比如跳过空格字符串，比如跳过注释等等</p>

<pre><code class="language-javascript">skipSpace() {
  loop: while (this.state.pos &lt; this.length) {
    const ch = this.input.charCodeAt(this.state.pos);
    .
    .
    .
  }
}
</code></pre>

<p>最后会把符合规则的语法字符串加入到<code>tokens</code>数组中，也就生成代码拆分为各个片段组成的数组</p>

<pre><code class="language-javascript">pushToken(token) {
  this.tokens.length = this.state.tokensLength;
  this.tokens.push(token);
  ++this.state.tokensLength;
}
</code></pre>

<p>如下所示：</p>

<pre><code class="language-javascript">console.log('我是一段语法') =&gt; ['console', 'log', '(', '&quot;我是一段语法&quot;', ')']
</code></pre>

<h4 id="2-2语法解析">2.2语法解析</h4>

<p>当生成完<code>tokens</code>，则进入到语法解析阶段，同样可以看见在<code>parse</code>模块中定一个了一个<code>Node</code>对象，这个对象定义了一些属性，当然还有个私有的<code>_clone</code>方法，用于表示将要生成的<code>AST</code>中节点的位置、名称、类型等等信息</p>

<pre><code class="language-javascript">class Node {
  constructor(parser, pos, loc) {
    this.type = &quot;&quot;;
    this.start = pos;
    this.end = 0;
    this.loc = new SourceLocation(loc);
    if (parser &amp;&amp; parser.options.ranges) this.range = [pos, 0];
    if (parser &amp;&amp; parser.filename) this.loc.filename = parser.filename;
  }

  __clone() {
    .
    .
    .
  }

}
</code></pre>

<p>然后会定义相应的<code>Parse</code>，遍历处理不同的<code>tokens</code>字段，比如<code>ImportDeclaration</code>用于import语法，导入模块；<code>VariableDeclarator</code>用于处理表示是什么类型的变量声明，比如<code>var、let、const</code>；<code>FunctionDeclaration</code>用于处理函数声明，非函数表达式，其它的就不多赘述。最后则会将这个词法数组转换为<code>AST(抽象语法树)</code></p>

<pre><code class="language-javascript">var add = function(a, b) {
  return  a + b
}
</code></pre>

<p>最后生成的<code>AST</code>简易版本如下</p>

<pre><code class="language-javascript">{
  &quot;type&quot;: &quot;Program&quot;,
  &quot;body&quot;: [{
    &quot;type&quot;: &quot;VariableDeclaration&quot;,
    &quot;identifierName&quot;: &quot;add&quot;,
    &quot;init&quot;: {
      &quot;type&quot;: &quot;ArrowFunctionExpression&quot;,
      &quot;params&quot;: [{
          &quot;type&quot;: &quot;identifier&quot;,
          &quot;identifierName&quot;: &quot;a&quot;
        },
        {
          &quot;type&quot;: &quot;identifier&quot;,
          &quot;identifierName&quot;: &quot;b&quot;
        }
      ],
      &quot;body&quot;: {
        &quot;type&quot;: &quot;BinaryExpression&quot;,
        &quot;left&quot;: {
          &quot;type&quot;: &quot;identifier&quot;,
          &quot;identifierName&quot;: &quot;a&quot;
        },
        &quot;operator&quot;: &quot;+&quot;,
        &quot;right&quot;: {
          &quot;type&quot;: &quot;identifier&quot;,
          &quot;identifierName&quot;: &quot;b&quot;
        }
      }
    }
  }]
}
</code></pre>

<p>可以看出这个语法树包含了整个语法的一个层级关系，并且标注了他们的名称、类型以及位置</p>

<h4 id="2-3traverser">2.3Traverser</h4>

<p><code>Traverser</code>会对生成好<code>AST</code>进行一个遍历，在此过程中对节点进行添加、删除等等操作，这也是其他插件将要处理的地方，通过这些插件，也可以处理不同的<code>AST</code>语法树，然后转换符合相应规则的代码，比如<code>Taro</code>，就可以视为将<code>React</code>代码转换成小程序对应代码的一个插件。<code>Traverser</code>中会引入<code>visitors</code>，用它来进行一个深度遍历操作；<code>Path</code>用于关联各个节点，这样使得节点操作简单，例如：</p>

<p>例如，如果有下面这样一个节点及其子节点︰</p>

<pre><code class="language-javascript">{
  type: &quot;ArrowFunctionExpression&quot;,
  id: {
    type: &quot;Identifier&quot;,
    name: &quot;a&quot;
  },
  ...
}
</code></pre>

<p>将子节点 <code>Identifier</code> 表示为一个路径（Path）的话，看起来是这样的：</p>

<pre><code class="language-javascript">{
  &quot;parent&quot;: {
    &quot;type&quot;: &quot;ArrowFunctionExpression&quot;,
    &quot;id&quot;: {...},
    ....
  },
  &quot;node&quot;: {
    &quot;type&quot;: &quot;Identifier&quot;,
    &quot;name&quot;: &quot;a&quot;
  }
}
</code></pre>

<p><code>Scope</code>用来表示树中各个节点的一个作用域关系，就好像<code>js</code>语法中，创建变量、函数时所呈现的一个作用域效果，在<code>babel</code>中，新添加的引用或者变量名，<code>Scope</code>表示的时候需要体现出节点的路径，节点间的关系，如以下形式:</p>

<pre><code class="language-javascript">{
  path: path,
  block: path.node,
  parentBlock: path.parent,
  parent: parentScope,
  bindings: [...]
  .
  .
  .
}
</code></pre>

<p>还有个很重要的概念<code>Bindings</code>，<code>Bindings</code>可以获取当前作用域下所有的标识符，其返回的信息包括节点的<code>标识符</code>、<code>scope</code>、<code>path</code>、<code>引用</code>等等信息，通过对这些属性的操作，达到对节点信息的一个更改</p>

<pre><code class="language-javascript">export class Binding {
  identifier: t.Identifier;
  scope: Scope;
  path: NodePath;
  kind: &quot;var&quot; | &quot;let&quot; | &quot;const&quot; | &quot;module&quot;;
  referenced: boolean;
  references: number;              // 被引用的数量
  referencePaths: NodePath[];      // 获取所有应用该标识符的节点路径
  constant: boolean;               // 是否是常量
  constantViolations: NodePath[];
}
</code></pre>

<h4 id="2-4transform">2.4Transform</h4>

<p><code>transform</code>会对抽象语法树进行又一次遍历，针对已经处理好的<code>AST</code>做进一步处理，如对代码的更改，对节点的操作、节点的增删改查、压缩代码、删除注释等等。得到最终的一个<code>AST</code></p>

<h4 id="2-5生成代码">2.5生成代码</h4>

<p>得到上一步生成的<code>AST</code>之后，会调用对应的代码生成器代码，通过递归遍历生成最终的代码，其中遇到不同的节点类型时，会做不同的处理，比如函数类型、参数定义类型、代码块类型等等</p>

<h3 id="3-babel里面的一些依赖包">3.babel里面的一些依赖包</h3>

<h4 id="3-1-babel-core">3.1@babel/core</h4>

<p><code>@babel/core</code>整个<code>babel</code>的一个核心，也算是<code>babel</code>的一个入口，它会加载和处理用户定义的配置，加载各种各样的插件；调用<code>Parser</code>进行语法解析，生成<code>Tokens</code>以及<code>AST</code>；调用<code>Traverser</code>遍历<code>AST</code>，进行一个转换；最后<code>generator</code>生成源代码</p>

<h4 id="3-2插件">3.2插件</h4>

<p>语法插件：<code>babel</code>有很多语法插件，用于支持<code>JavaScript</code>的各种语法特性，在解析的时候会用的到，通常其形式为<code>@babel/plugin-syntax-*</code>，比如<code>babel-plugin-syntax-dynamic-import</code>就是用来处理<code>import</code>语法的一个插件</p>

<p>转换插件： 用于对 <code>AST</code> 进行转换, 实现转换为<code>ES5</code>代码、压缩、功能增强等目的，<code>babel</code>仓库将转换插件划分为两种(只是命名上的区别)：</p>

<p>如<code>@babel/plugin-transform-*</code>： <code>babel</code>中的一个转换插件</p>

<p>预定义的插件：插件集合或者分组，可设置项目内所用插件的使用场景，主要方便用户对插件进行管理和使用。</p>

<p><code>@babel/preset-env</code>：<code>preset-env</code>是ES语法插件的合集，在根目录下创建<code>.babelrc</code>配置文件</p>

<pre><code class="language-javascript"> {
   &quot;presets&quot;: [
     [&quot;@babel/preset-env&quot;, {
       &quot;modules&quot;: false,
       &quot;targets&quot;: {
         &quot;browsers&quot;: [&quot;&gt; 1%&quot;, &quot;last 2 versions&quot;, &quot;not ie &lt;= 8&quot;]
       },
       &quot;useBuiltIns&quot;: false,
       &quot;corejs&quot;: false
     }]
   ]
 }
</code></pre>

<p><code>targets</code>生成指定环境的代码，<code>useBuiltIns</code>配合<code>@babel/polyfill</code>使用，当然最新版的<code>babel</code>可直接使用<code>corejs</code>，填上对应的数值就行，<code>modules</code>表示是否将代码ES6的模块语法转换为另一种类型或标准，比如<code>amd</code>、<code>commonjs</code>等</p>

<p><code>@babel/polyfill</code>顾名思义，在<code>babel</code>转化的过程中，对于一些无法处理的特性或者属性，使用<code>@babel/polyfill</code>来对这些功能进行处理；</p>

<p><code>@babel/runtime</code>一般应用于两种场景：开发类库/工具（生成不污染全局空间和内置对象原型的代码）、借助 <code>@babel/runtime</code> 中帮助函数（helper function）移除冗余工具函数，在最新的版本中，完全可以用<code>@babel/runtime</code>代替<code>@babel/polyfill</code></p>

<h4 id="3-3辅助开发工具">3.3辅助开发工具</h4>

<p><code>@babel/template</code>： 某些场景直接操作<code>AST</code>太麻烦，就比如我们直接操作<code>DOM</code>一样，所以<code>babel</code>实现了这么一个简单的模板引擎，可以将字符串代码转换为<code>AST</code>。比如在生成一些辅助代码<code>(helper)</code>时会用到这个库</p>

<p><code>@babel/types</code>： 主要用途是在创建<code>AST</code>的过程中判断各种语法的类型。</p>

<p><code>@babel/helper-*</code>： 一些辅助器，用于辅助插件开发，例如简化<code>AST</code>操作</p>

<p><code>@babel/helper</code>： 辅助代码，单纯的语法转换可能无法让代码运行起来，比如低版本浏览器无法识别<code>class</code>关键字，这时候需要添加辅助代码，对<code>class</code>进行模拟。</p>

<h4 id="4-参考链接">4.参考链接</h4>

<p>1.<a href="https://juejin.im/post/5d94bfbf5188256db95589be" rel="nofollow noreferrer" target="_blank">深入浅出Babel</a></p>

<p>2.<a href="https://www.babeljs.cn/" rel="nofollow noreferrer" target="_blank">babel中文网</a></p>

<p>3.<a href="https://github.com/jamiebuilds/babel-handbook" rel="nofollow noreferrer" target="_blank">babel-handbook</a></p>

    </div>

    

  
    <div class="post-tags">
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://xtid.github.io">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://xtid.github.io/2020/vue2.x%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B%E7%AE%80%E4%BB%8B/" class="prev" rel="prev" title="Vue的初始化渲染过程简介"><i class="iconfont icon-left"></i>&nbsp;Vue的初始化渲染过程简介</a>
         
        
        <a href="https://xtid.github.io/2020/webpack%E7%90%86%E8%A7%A3/" class="next" rel="next" title="Webpack理解">Webpack理解&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2019 - 2021</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
     <link href="//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css" rel="stylesheet">  
      
     <script src="/js/vendor_gallery.min.js" async="" ></script>
    
  



     </div>
  </body>
</html>
