<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>GraphQLçš„å…¥é—¨ - æ—©èµ·çš„è€å¹´äººã®åšå®¢</title><meta name="Description" content="æ—©èµ·çš„è€å¹´äººåšçš„ç½‘ç«™"><meta property="og:title" content="GraphQLçš„å…¥é—¨" />
<meta property="og:description" content="GraphQL æ—¢æ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ï¼Œå®ƒå¯¹APIä¸­çš„æ•°æ®æä¾›äº†ä¸€å¥—æ˜“äºç†è§£çš„å®Œæ•´æè¿°ï¼Œä½¿å¾—å®¢æˆ·ç«¯èƒ½å¤Ÿå‡†ç¡®åœ°è·å¾—å®ƒéœ€è¦çš„æ•°æ®ï¼Œè€Œä¸”æ²¡æœ‰ä»»ä½•å†—ä½™ï¼Œä¹Ÿè®© API æ›´" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://baskep.com/graphql%E7%9A%84%E5%85%A5%E9%97%A8/" />
<meta property="og:image" content="https://baskep.com/logo.png"/>
<meta property="article:published_time" content="2022-06-30T21:32:24+08:00" />
<meta property="article:modified_time" content="2022-06-30T21:32:24+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://baskep.com/logo.png"/>

<meta name="twitter:title" content="GraphQLçš„å…¥é—¨"/>
<meta name="twitter:description" content="GraphQL æ—¢æ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ï¼Œå®ƒå¯¹APIä¸­çš„æ•°æ®æä¾›äº†ä¸€å¥—æ˜“äºç†è§£çš„å®Œæ•´æè¿°ï¼Œä½¿å¾—å®¢æˆ·ç«¯èƒ½å¤Ÿå‡†ç¡®åœ°è·å¾—å®ƒéœ€è¦çš„æ•°æ®ï¼Œè€Œä¸”æ²¡æœ‰ä»»ä½•å†—ä½™ï¼Œä¹Ÿè®© API æ›´"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="canonical" href="https://baskep.com/graphql%E7%9A%84%E5%85%A5%E9%97%A8/" /><link rel="prev" href="https://baskep.com/react18%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7/" /><link rel="next" href="https://baskep.com/png%E6%A0%BC%E5%BC%8F%E7%9A%84%E8%AF%A6%E8%A7%A3/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "GraphQLçš„å…¥é—¨",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/baskep.com\/graphql%E7%9A%84%E5%85%A5%E9%97%A8\/"
        },"image": ["https:\/\/baskep.com\/images\/Apple-Devices-Preview.png"],"genre": "posts","wordcount":  5226 ,
        "url": "https:\/\/baskep.com\/graphql%E7%9A%84%E5%85%A5%E9%97%A8\/","datePublished": "2022-06-30T21:32:24+08:00","dateModified": "2022-06-30T21:32:24+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "https:\/\/baskep.com\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "æ—©èµ·çš„è€å¹´äºº"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="æ—©èµ·çš„è€å¹´äººã®åšå®¢"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"><i class='fa fa-book'></i> æ–‡ç«  </a><a class="menu-item" href="/categories/"><i class='fa fa-th'></i> åˆ†ç±» </a><a class="menu-item" href="/about/"><i class='fa fa-info-circle'></i> å…³äº </a><a class="menu-item" href="/links/"><i class='fas fa-user-friends'></i> å‹é“¾ </a><a class="menu-item" href="https://github.com/baskep" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i> Github </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="æ—©èµ·çš„è€å¹´äººã®åšå®¢"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title=""><i class='fa fa-book'></i>æ–‡ç« </a><a class="menu-item" href="/categories/" title=""><i class='fa fa-th'></i>åˆ†ç±»</a><a class="menu-item" href="/about/" title=""><i class='fa fa-info-circle'></i>å…³äº</a><a class="menu-item" href="/links/" title=""><i class='fas fa-user-friends'></i>å‹é“¾</a><a class="menu-item" href="https://github.com/baskep" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>Github</a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">GraphQLçš„å…¥é—¨</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>æ—©èµ·çš„è€å¹´äºº</a></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/"><i class="far fa-folder fa-fw"></i>æ—¥å¸¸å­¦ä¹ </a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2022-06-30">2022-06-30</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 5226 å­—&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 11 åˆ†é’Ÿ&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1æœ€åŸºæœ¬çš„æŸ¥è¯¢">1.æœ€åŸºæœ¬çš„æŸ¥è¯¢</a></li>
    <li><a href="#2æŸ¥è¯¢å’Œå˜æ›´">2.æŸ¥è¯¢å’Œå˜æ›´</a>
      <ul>
        <li><a href="#21å­—æ®µ">2.1.å­—æ®µ</a></li>
        <li><a href="#22åˆ«å">2.2.åˆ«å</a></li>
        <li><a href="#23å˜é‡">2.3.å˜é‡</a></li>
        <li><a href="#24æŒ‡ä»¤">2.4.æŒ‡ä»¤</a></li>
        <li><a href="#25æ“ä½œç±»å‹">2.5.æ“ä½œç±»å‹</a>
          <ul>
            <li><a href="#251query">2.5.1.query</a></li>
            <li><a href="#252mutation">2.5.2.mutation</a></li>
            <li><a href="#253substription">2.5.3.substription</a></li>
          </ul>
        </li>
        <li><a href="#26schemaå’Œç±»å‹">2.6.Schemaå’Œç±»å‹</a>
          <ul>
            <li><a href="#261å¯¹è±¡ç±»å‹">2.6.1.å¯¹è±¡ç±»å‹</a></li>
            <li><a href="#262æ ‡é‡ç±»å‹">2.6.2.æ ‡é‡ç±»å‹</a></li>
            <li><a href="#263æšä¸¾">2.6.3.æšä¸¾</a></li>
            <li><a href="#264åˆ—è¡¨å’Œéç©º">2.6.4.åˆ—è¡¨å’Œéç©º</a></li>
            <li><a href="#265è”åˆç±»å‹">2.6.5.è”åˆç±»å‹</a></li>
            <li><a href="#267interfaceæ¥å£">2.6.7.interface(æ¥å£)</a></li>
            <li><a href="#268-inputç±»å‹">2.6.8. inputç±»å‹</a></li>
            <li><a href="#269resolver">2.6.9.resolver</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#3å®æˆ˜æµ‹è¯•">3.å®æˆ˜æµ‹è¯•</a>
      <ul>
        <li><a href="#31å…¥å£appjs">3.1.å…¥å£app.js</a></li>
        <li><a href="#32mongodbè¿æ¥é…ç½®">3.2.mongodbè¿æ¥é…ç½®</a></li>
        <li><a href="#33mongodb-schemaçš„å®šä¹‰">3.3.mongodb schemaçš„å®šä¹‰</a></li>
        <li><a href="#34mongodbè¿æ¥æ–‡ä»¶">3.4.mongodbè¿æ¥æ–‡ä»¶</a></li>
        <li><a href="#35graphql-schemaå®šä¹‰">3.5.Graphql schemaå®šä¹‰</a></li>
      </ul>
    </li>
    <li><a href="#4n--1-queryçš„é—®é¢˜">4.n + 1 queryçš„é—®é¢˜</a></li>
    <li><a href="#5å‚è€ƒé“¾æ¥">5.å‚è€ƒé“¾æ¥</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><blockquote>
<p>GraphQL æ—¢æ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ï¼Œå®ƒå¯¹APIä¸­çš„æ•°æ®æä¾›äº†ä¸€å¥—æ˜“äºç†è§£çš„å®Œæ•´æè¿°ï¼Œä½¿å¾—å®¢æˆ·ç«¯èƒ½å¤Ÿå‡†ç¡®åœ°è·å¾—å®ƒéœ€è¦çš„æ•°æ®ï¼Œè€Œä¸”æ²¡æœ‰ä»»ä½•å†—ä½™ï¼Œä¹Ÿè®© API æ›´å®¹æ˜“åœ°éšç€æ—¶é—´æ¨ç§»è€Œæ¼”è¿›ï¼Œè¿˜èƒ½ç”¨äºæ„å»ºå¼ºå¤§çš„å¼€å‘è€…å·¥å…·ã€‚å®ƒæ²¡æœ‰å’Œä»»ä½•ç‰¹å®šæ•°æ®åº“æˆ–è€…å­˜å‚¨å¼•æ“ç»‘å®šï¼Œè€Œæ˜¯ä¾é ä½ ç°æœ‰çš„ä»£ç å’Œæ•°æ®æ”¯æ’‘</p>
</blockquote>
<p>æ¢è¨€ä¹‹ï¼ŒGraphQL æœåŠ¡æ˜¯é€šè¿‡å®šä¹‰ç±»å‹å’Œç±»å‹ä¸Šçš„å­—æ®µæ¥åˆ›å»ºçš„ï¼Œç„¶åç»™æ¯ä¸ªç±»å‹ä¸Šçš„æ¯ä¸ªå­—æ®µæä¾›è§£æå‡½æ•°ï¼Œå½“æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯å‘é€ç›¸åº”è¯·æ±‚æ—¶ï¼Œé€šè¿‡æˆ‘ä»¬å†™çš„è§£æå‡½æ•°ï¼ŒGraphQLèƒ½è¿”å›æˆ‘ä»¬æƒ³è¦çš„å­—æ®µ</p>
<p>åœ¨å¼€å‘ä¸­ä¹Ÿè®¸æœ‰è¿™æ ·çš„ç—›ç‚¹ï¼Œå½“æŸä¸ªéœ€æ±‚æ”¹å˜æ—¶ï¼Œåç«¯å› ä¸ºå„ç§åŸå› ä¸éœ€è¦å˜åŠ¨æ¥å£ï¼ŒæŠŠå·¥ä½œå…¨éƒ¨æ‰”ç»™å‰ç«¯ï¼Œç”±å‰ç«¯å»ä»å„ç§å­—æ®µé‡Œé¢ç­›é€‰ç»„åˆæƒ³è¦çš„å­—æ®µï¼Œè¿™æ˜¯å¾ˆçƒ¦çš„</p>
<p>åŒæ ·çš„ï¼Œåœ¨ä¸€äº›äº§å“é“¾å¤æ‚çš„åœºæ™¯ï¼Œåç«¯éœ€è¦æä¾›å¯¹åº” WebAppã€WebPCã€APPã€å°ç¨‹åºã€å¿«åº”ç”¨ç­‰å„ç«¯ APIï¼Œæ­¤æ—¶ API çš„ç²’åº¦å¤§å°å°±æ˜¾å¾—æ ¼å¤–é‡è¦ï¼Œç²—ç²’åº¦ä¼šå¯¼è‡´ç§»åŠ¨ç«¯ä¸å¿…è¦çš„æµé‡æŸè€—ï¼Œç»†ç²’åº¦åˆ™ä¼šé€ æˆå‡½æ•°çˆ†ç‚¸ (Function Explosion)ï¼Œåœ¨æ­¤æƒ…æ™¯ä¸‹ Facebook çš„å·¥ç¨‹å¸ˆäº 2015 å¹´å¼€æºäº†GraphQL è§„èŒƒï¼Œè®©å‰ç«¯è‡ªå·±æè¿°è‡ªå·±å¸Œæœ›çš„æ•°æ®å½¢å¼ï¼ŒæœåŠ¡ç«¯åˆ™è¿”å›å‰ç«¯æ‰€æè¿°çš„æ•°æ®ç»“æ„</p>
<p>å½“ç„¶ï¼Œå®ƒçš„æœ¬è´¨å°±æ˜¯é€šè¿‡å®šä¹‰æŸ¥è¯¢çš„ç±»å‹ã€å†™è§£æå‡½æ•°ã€å“åº”å¯¹åº”å­—æ®µï¼Œ è¿™å’ŒNodejsåšBFFç­›é€‰è¿‡æ»¤çš„ä½œç”¨å…¶å®æ˜¯æœ‰ç‚¹ç±»ä¼¼çš„ï¼ŒGraphQLä¹Ÿä¸æ˜¯æ²¡æœ‰ç¼ºç‚¹ï¼Œè¿™ä¸ªåé¢å†è¯´</p>
<h1 id="1æœ€åŸºæœ¬çš„æŸ¥è¯¢">1.æœ€åŸºæœ¬çš„æŸ¥è¯¢</h1>
<p>é¦–å…ˆå®šä¹‰æŸ¥è¯¢çš„å­—æ®µç±»å‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">type Query {
  me: User
}
 
type User {
  id: ID
  name: String
}
</code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢å…ˆæ˜¯å®šä¹‰äº†ä¸€ä¸ª<code>User</code>çš„ç±»å‹ï¼›å†å®šä¹‰äº†ä¸€ä¸ª<code>Query</code>ï¼Œä»£è¡¨å¯ä»¥è¿”å›ç±»å‹ä¸º<code>User</code>ã€å­—æ®µåä¸º<code>me</code>è¿™æ ·ä¸€ä¸ªç±»å‹</p>
<p>ä¸€æ—¦ä¸€ä¸ª GraphQL æœåŠ¡è¿è¡Œèµ·æ¥ï¼ˆé€šå¸¸åœ¨ web æœåŠ¡çš„ä¸€ä¸ª URL ä¸Šï¼‰ï¼Œå®ƒå°±èƒ½æ¥æ”¶ GraphQL æŸ¥è¯¢ï¼Œå¹¶éªŒè¯å’Œæ‰§è¡Œï¼Œæ¥æ”¶åˆ°çš„æŸ¥è¯¢é¦–å…ˆä¼šè¢«æ£€æŸ¥ç¡®ä¿å®ƒåªå¼•ç”¨äº†å·²å®šä¹‰çš„ç±»å‹å’Œå­—æ®µï¼Œç„¶åè¿è¡ŒæŒ‡å®šçš„è§£æå‡½æ•°æ¥ç”Ÿæˆç»“æœ</p>
<p>å½“æ‰§è¡Œè¿™æ ·ä¸€ä¸ªæŸ¥è¯¢æ—¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">{
  me {
    name
  }
}
</code></pre></td></tr></table>
</div>
</div><p>æ„æ€å°±æ˜¯æŸ¥è¯¢<code>me</code>ä¸‹é¢çš„<code>name</code>å­—æ®µï¼Œè€Œ<code>me</code>çš„ç±»å‹å°±æ˜¯<code>User</code>ï¼Œé‡Œé¢æ˜¯åŒ…å«<code>name</code>å­—æ®µçš„</p>
<p>å“åº”çš„ç»“æœä¸º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">{
  &#34;me&#34;: {
    &#34;name&#34;: &#34;Luke Skywalker&#34;
  }
}
</code></pre></td></tr></table>
</div>
</div><h1 id="2æŸ¥è¯¢å’Œå˜æ›´">2.æŸ¥è¯¢å’Œå˜æ›´</h1>
<h2 id="21å­—æ®µ">2.1.å­—æ®µ</h2>
<p>å­—æ®µå°±æ˜¯å®¢æˆ·ç«¯è°ƒç”¨æ‰€è¿”å›çš„ï¼Œåœ¨å®šä¹‰æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¯ä»¥åµŒå¥—æœ‰å¤šå±‚é€‰æ‹©</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">{
  hero {
    name
    # æŸ¥è¯¢å¯ä»¥æœ‰å¤‡æ³¨ï¼
    friends {
      name
    }
  }
}
</code></pre></td></tr></table>
</div>
</div><p>å½“ç„¶ä¹Ÿå¯ä»¥å¸¦ä¸Šå‚æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">{
  human(id: &#34;1000&#34;) {
    name
    height
  }
}
</code></pre></td></tr></table>
</div>
</div><h2 id="22åˆ«å">2.2.åˆ«å</h2>
<p>æ¯”å¦‚æˆ‘è¦æ ¹æ®å‚æ•°çš„ä¸åŒï¼Œåˆ†åˆ«æŸ¥ä¸åŒçš„æ•°æ®ï¼Œå¦‚æœéƒ½æ˜¯å®šä¹‰ä¸º<code>human</code>ï¼Œé‚£ä¹ˆå­—æ®µå°±ä¼šèµ·å†²çªï¼Œè¿™ä¸ªæ—¶å€™å°±è¦å–åˆ«åäº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">{
  people: human(id: &#34;1000&#34;) {
    name
    height
  }
  human: human(id: &#34;2000&#34;) {
    name
    height
  }
}
</code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„<code>people</code>ä»¥åŠ<code>human</code>å°±æ˜¯åˆ«å</p>
<h2 id="23å˜é‡">2.3.å˜é‡</h2>
<blockquote>
<p>åœ¨å¾ˆå¤šåº”ç”¨ä¸­ï¼Œå­—æ®µçš„å‚æ•°å¯èƒ½æ˜¯åŠ¨æ€çš„ï¼šä¾‹å¦‚ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ª&quot;ä¸‹æ‹‰èœå•&quot;è®©ä½ é€‰æ‹©æ„Ÿå…´è¶£çš„ã€Šæ˜Ÿçƒå¤§æˆ˜ã€‹ç»­é›†ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæœç´¢åŒºï¼Œæˆ–è€…æ˜¯ä¸€ç»„è¿‡æ»¤å™¨</p>
<p>å°†è¿™äº›åŠ¨æ€å‚æ•°ç›´æ¥ä¼ è¿›æŸ¥è¯¢å­—ç¬¦ä¸²å¹¶ä¸æ˜¯å¥½ä¸»æ„ï¼Œå› ä¸ºè¿™æ ·æˆ‘ä»¬çš„å®¢æˆ·ç«¯å°±å¾—åŠ¨æ€åœ°åœ¨è¿è¡Œæ—¶æ“ä½œè¿™äº›æŸ¥è¯¢å­—ç¬¦ä¸²äº†ï¼Œå†æŠŠå®ƒåºåˆ—åŒ–æˆ GraphQL ä¸“ç”¨çš„æ ¼å¼ã€‚å…¶å®ï¼ŒGraphQL æ‹¥æœ‰ä¸€çº§æ–¹æ³•å°†åŠ¨æ€å€¼æå–åˆ°æŸ¥è¯¢ä¹‹å¤–ï¼Œç„¶åä½œä¸ºåˆ†ç¦»çš„å­—å…¸ä¼ è¿›å»ã€‚è¿™äº›åŠ¨æ€å€¼å³ç§°ä¸º<strong>å˜é‡</strong></p>
</blockquote>
<p>å˜é‡å‰ç¼€å¿…é¡»ä¸º <code>$</code>ï¼Œåè·Ÿå…¶ç±»å‹ï¼Œå˜é‡çš„ä½¿ç”¨æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback"># { &#34;graphiql&#34;: true, &#34;variables&#34;: { &#34;episode&#34;: JEDI } }
query HeroNameAndFriends($episode: Episode) {
  hero(episode: $episode) {
    name
    friends {
      name
    }
  }
}
</code></pre></td></tr></table>
</div>
</div><p><code>hero(episode: $episode)</code>ä»£è¡¨è¿™æ¬¡æŸ¥è¯¢éœ€è¦ä¼ å…¥å‚æ•°ï¼Œå‚æ•°åä¸º<code>episode</code>ï¼Œ<code>$episode</code>ä¸ºå‚æ•°å€¼ï¼Œä¸Šé¢çš„<code>($episode: Episode)</code>å…¶å®æ˜¯å¯¹å‚æ•°å€¼çš„çº¦æŸï¼Œä»£è¡¨å®ƒå¿…é¡»ä¸º<code>Episode</code>ç±»å‹</p>
<p>åœ¨æŸ¥è¯¢ä¸­çš„ç±»å‹å®šä¹‰åé¢é™„å¸¦é»˜è®¤å€¼çš„æ–¹å¼ï¼Œå°†é»˜è®¤å€¼èµ‹ç»™å˜é‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">query HeroNameAndFriends($episode: Episode = &#34;JEDI&#34;)
</code></pre></td></tr></table>
</div>
</div><h2 id="24æŒ‡ä»¤">2.4.æŒ‡ä»¤</h2>
<p>GraphQLçš„æŒ‡ä»¤å¯ä»¥é™„ç€åœ¨å­—æ®µæˆ–è€…ç‰‡æ®µåŒ…å«çš„å­—æ®µä¸Šï¼Œç„¶åä»¥ä»»ä½•æœåŠ¡ç«¯æœŸå¾…çš„æ–¹å¼æ¥æ”¹å˜æŸ¥è¯¢çš„æ‰§è¡Œï¼ŒGraphQL çš„æ ¸å¿ƒè§„èŒƒåŒ…å«ä¸¤ä¸ªæŒ‡ä»¤ï¼Œå…¶å¿…é¡»è¢«ä»»ä½•è§„èŒƒå…¼å®¹çš„ GraphQL æœåŠ¡å™¨å®ç°æ‰€æ”¯æŒ</p>
<ul>
<li><code>@include(if: Boolean)</code> ä»…åœ¨å‚æ•°ä¸º <code>true</code> æ—¶ï¼ŒåŒ…å«æ­¤å­—æ®µ</li>
<li><code>@skip(if: Boolean)</code> å¦‚æœå‚æ•°ä¸º <code>true</code>ï¼Œè·³è¿‡æ­¤å­—æ®µ</li>
</ul>
<p>æŒ‡ä»¤åœ¨ä½ ä¸å¾—ä¸é€šè¿‡å­—ç¬¦ä¸²æ“ä½œæ¥å¢å‡æŸ¥è¯¢çš„å­—æ®µæ—¶è§£æ•‘ä½ ã€‚æœåŠ¡ç«¯å®ç°ä¹Ÿå¯ä»¥å®šä¹‰æ–°çš„æŒ‡ä»¤æ¥æ·»åŠ æ–°çš„ç‰¹æ€§</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">query Hero($episode: Episode, $withFriends: Boolean!) {
  hero(episode: $episode) {
    name
    friends @include(if: $withFriends) {
      name
    }
  }
}
</code></pre></td></tr></table>
</div>
</div><h2 id="25æ“ä½œç±»å‹">2.5.æ“ä½œç±»å‹</h2>
<blockquote>
<p><strong>æ“ä½œç±»å‹</strong>å¯ä»¥æ˜¯ <em>query</em>ã€<em>mutation</em> æˆ– <em>subscription</em>ï¼Œæè¿°ä½ æ‰“ç®—åšä»€ä¹ˆç±»å‹çš„æ“ä½œã€‚æ“ä½œç±»å‹æ˜¯å¿…éœ€çš„ï¼Œé™¤éä½ ä½¿ç”¨æŸ¥è¯¢ç®€å†™è¯­æ³•ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ æ— æ³•ä¸ºæ“ä½œæä¾›åç§°æˆ–å˜é‡å®šä¹‰</p>
</blockquote>
<h3 id="251query">2.5.1.query</h3>
<p>ä¹Ÿå°±æ˜¯åŸºæœ¬çš„è·å–æ•°æ®ï¼ŒæŸ¥è¯¢</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">query {
  user {
    id
  }
}
</code></pre></td></tr></table>
</div>
</div><h3 id="252mutation">2.5.2.mutation</h3>
<p>ä¸€èˆ¬ç”¨ä½œæ•°æ®å˜æ›´ã€ä¿®æ”¹æ•°æ®ã€‚ä¸€èˆ¬æ¥è®²ï¼Œç”¨äºå˜æ›´æ•°æ®çš„<code>mutation</code>å»ºè®®ä¸è¦ä½¿ç”¨<code>get</code>è¯·æ±‚ï¼Œè€Œæ˜¯ä½¿ç”¨<code>post</code>ï¼Œä½¿ç”¨postå‘èµ·çš„httpè¯·æ±‚å¦‚ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">mutation ($id: Int!) {
  upvotePost(postId: $id) {
    id
  }
}
</code></pre></td></tr></table>
</div>
</div><p>å½“ç”¨axioså‘èµ·ä¸€ä¸ªpostè¯·æ±‚ï¼Œä¼ å…¥æ•°æ®ä¸º<code>id=1</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">axios({
  method: &#39;post&#39;,
  url: &#39;/graphql&#39;,
  data: {id : 1},
});
</code></pre></td></tr></table>
</div>
</div><p>è¯·æ±‚ä¸»ä½“JSONæ•°æ®ä¸º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">{
  &#34;query&#34;: &#34;mutation ($id: Int!) { upvotePost(postId: $id) { id } } &#34;, 
  &#34;variables&#34;: { &#34;id&#34;: 1 } 
}
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æŸ¥è¯¢ä¸€æ ·ï¼Œå¦‚æœä»»ä½•å˜æ›´å­—æ®µè¿”å›ä¸€ä¸ªå¯¹è±¡ç±»å‹ï¼Œä¹Ÿèƒ½è¯·æ±‚å…¶åµŒå¥—å­—æ®µ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">mutation CreateReviewForEpisode($ep: Episode!, $review: ReviewInput!) {
  createReview(episode: $ep, review: $review) {
    stars
    commentary
  }
}

// response
{
  &#34;data&#34;: {
    &#34;createReview&#34;: {
      &#34;stars&#34;: 5,
      &#34;commentary&#34;: &#34;This is a great movie!&#34;
    }
  }
}
</code></pre></td></tr></table>
</div>
</div><p>æŸ¥è¯¢å’Œå˜æ›´ä¹‹é—´åç§°ä¹‹å¤–çš„ä¸€ä¸ªé‡è¦åŒºåˆ«æ˜¯ï¼š<code>æŸ¥è¯¢å­—æ®µæ—¶ï¼Œæ˜¯å¹¶è¡Œæ‰§è¡Œï¼Œè€Œå˜æ›´å­—æ®µæ—¶ï¼Œæ˜¯çº¿æ€§æ‰§è¡Œï¼Œä¸€ä¸ªæ¥ç€ä¸€ä¸ª</code></p>
<h3 id="253substription">2.5.3.substription</h3>
<p>è®¢é˜…ï¼Œå½“æ•°æ®å‘ç”Ÿæ›´æ”¹æ—¶è¿›è¡Œé€šçŸ¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">subscription subscription {
  author {
  	id
  	login
  }
}
</code></pre></td></tr></table>
</div>
</div><h2 id="26schemaå’Œç±»å‹">2.6.Schemaå’Œç±»å‹</h2>
<p><code>graphql</code>é‡Œçš„schemaå’Œ<code>mongoose</code>é‡Œçš„schemaæ˜¯æœ‰äº›ç±»ä¼¼çš„ï¼Œå®ƒå®šä¹‰äº†å­—æ®µçš„ç±»å‹ã€æ•°æ®çš„ç»“æ„ï¼Œæè¿°äº†æ¥å£æ•°æ®è¯·æ±‚çš„è§„åˆ™ï¼Œä¸€èˆ¬è¿™æ ·è¡¨ç¤ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">type Character {
  name: String!
  appearsIn: [Episode!]!
}
</code></pre></td></tr></table>
</div>
</div><p>å®ƒçš„ç±»å‹ä¹Ÿæ˜¯åˆ†ä¸ºå¥½å‡ ç§</p>
<h3 id="261å¯¹è±¡ç±»å‹">2.6.1.å¯¹è±¡ç±»å‹</h3>
<ul>
<li><code>Character</code> æ˜¯ä¸€ä¸ª <strong>GraphQL å¯¹è±¡ç±»å‹</strong>ï¼Œè¡¨ç¤ºå…¶æ˜¯ä¸€ä¸ªæ‹¥æœ‰ä¸€äº›å­—æ®µçš„ç±»å‹ã€‚ä½ çš„ schema ä¸­çš„å¤§å¤šæ•°ç±»å‹éƒ½ä¼šæ˜¯å¯¹è±¡ç±»å‹</li>
<li><code>name</code> å’Œ <code>appearsIn</code> æ˜¯ <code>Character</code> ç±»å‹ä¸Šçš„<strong>å­—æ®µ</strong>ã€‚è¿™æ„å‘³ç€åœ¨ä¸€ä¸ªæ“ä½œ <code>Character</code> ç±»å‹çš„ GraphQL æŸ¥è¯¢ä¸­çš„ä»»ä½•éƒ¨åˆ†ï¼Œéƒ½åªèƒ½å‡ºç° <code>name</code> å’Œ <code>appearsIn</code> å­—æ®µ</li>
<li><code>String</code> æ˜¯å†…ç½®çš„<strong>æ ‡é‡</strong>ç±»å‹ä¹‹ä¸€ â€”â€” æ ‡é‡ç±»å‹æ˜¯è§£æåˆ°å•ä¸ªæ ‡é‡å¯¹è±¡çš„ç±»å‹ï¼Œæ— æ³•åœ¨æŸ¥è¯¢ä¸­å¯¹å®ƒè¿›è¡Œæ¬¡çº§é€‰æ‹©ã€‚åé¢æˆ‘ä»¬å°†ç»†è¿°æ ‡é‡ç±»å‹</li>
<li><code>String!</code> è¡¨ç¤ºè¿™ä¸ªå­—æ®µæ˜¯<strong>éç©ºçš„</strong>ï¼ŒGraphQL æœåŠ¡ä¿è¯å½“ä½ æŸ¥è¯¢è¿™ä¸ªå­—æ®µåæ€»ä¼šç»™ä½ è¿”å›ä¸€ä¸ªå€¼ã€‚åœ¨ç±»å‹è¯­è¨€é‡Œé¢ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªæ„Ÿå¹å·æ¥è¡¨ç¤ºè¿™ä¸ªç‰¹æ€§</li>
<li><code>[Episode!]!</code> è¡¨ç¤ºä¸€ä¸ª <code>Episode</code> <strong>æ•°ç»„</strong>ã€‚å› ä¸ºå®ƒä¹Ÿæ˜¯<strong>éç©ºçš„</strong>ï¼Œæ‰€ä»¥å½“ä½ æŸ¥è¯¢ <code>appearsIn</code> å­—æ®µçš„æ—¶å€™ï¼Œä½ ä¹Ÿæ€»èƒ½å¾—åˆ°ä¸€ä¸ªæ•°ç»„ï¼ˆé›¶ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ ï¼‰ï¼Œä¸”ç”±äº <code>Episode!</code> ä¹Ÿæ˜¯<strong>éç©ºçš„</strong>ï¼Œä½ æ€»æ˜¯å¯ä»¥é¢„æœŸåˆ°æ•°ç»„ä¸­çš„æ¯ä¸ªé¡¹ç›®éƒ½æ˜¯ä¸€ä¸ª <code>Episode</code> å¯¹è±¡</li>
</ul>
<h3 id="262æ ‡é‡ç±»å‹">2.6.2.æ ‡é‡ç±»å‹</h3>
<ul>
<li><code>Int</code>ï¼šæœ‰ç¬¦å· 32 ä½æ•´æ•°</li>
<li><code>Float</code>ï¼šæœ‰ç¬¦å·åŒç²¾åº¦æµ®ç‚¹å€¼</li>
<li><code>String</code>ï¼šUTFâ€8 å­—ç¬¦åºåˆ—</li>
<li><code>Boolean</code>ï¼š<code>true</code> æˆ–è€… <code>false</code></li>
<li><code>ID</code>ï¼šID æ ‡é‡ç±»å‹è¡¨ç¤ºä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œé€šå¸¸ç”¨ä»¥é‡æ–°è·å–å¯¹è±¡æˆ–è€…ä½œä¸ºç¼“å­˜ä¸­çš„é”®ã€‚ID ç±»å‹ä½¿ç”¨å’Œ String ä¸€æ ·çš„æ–¹å¼åºåˆ—åŒ–ï¼›ç„¶è€Œå°†å…¶å®šä¹‰ä¸º ID æ„å‘³ç€å¹¶ä¸éœ€è¦äººç±»å¯è¯»å‹</li>
</ul>
<h3 id="263æšä¸¾">2.6.3.æšä¸¾</h3>
<p>æšä¸¾ç±»å‹ç”¨<code>enum</code>å…³é”®è¯å®šä¹‰ï¼Œç„¶åå®šä¹‰schemaçš„ç±»å‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">enum CompanyType {
   GOOGLE
   GITHUB
   OUTLOOK
}

type Episode {
	company: CompanyType
}
</code></pre></td></tr></table>
</div>
</div><h3 id="264åˆ—è¡¨å’Œéç©º">2.6.4.åˆ—è¡¨å’Œéç©º</h3>
<p>éç©ºæŒ‡çš„æ˜¯åœ¨æŸä¸ªå­—æ®µçš„ç±»å‹ååé¢æ·»åŠ ä¸€ä¸ªæ„Ÿå¹å·<code>!</code>å°†å…¶æ ‡æ³¨ä¸ºéç©ºï¼Œå¦‚æœæœåŠ¡ç«¯è®²è¿™ä¸ªå­—æ®µè®¾ç½®ä¸ºç©ºå€¼ï¼Œé‚£graphqlåˆ™ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œå¯¹äºæ•°ç»„æˆ–è€…è¯´åˆ—è¡¨ï¼Œä½¿ç”¨ä¼šç¨å¾®çµæ´»ä¸€ç‚¹</p>
<p>åŸºæœ¬ç”¨æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">type Character {
  name: String!
}
</code></pre></td></tr></table>
</div>
</div><p>ç»“åˆæ•°ç»„ï¼š</p>
<p>é¦–å…ˆæ˜¯æ¯ä¸ªæˆå‘˜æœ¬èº«ä¸èƒ½ä¸ºç©ºçš„æƒ…å†µ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">myField: [String!]

// è¿™è¡¨ç¤ºæ•°ç»„æœ¬èº«å¯ä»¥ä¸ºç©ºï¼Œä½†æ˜¯å…¶ä¸èƒ½æœ‰ä»»ä½•ç©ºå€¼æˆå‘˜
myField: null // æœ‰æ•ˆ
myField: [] // æœ‰æ•ˆ
myField: [&#39;a&#39;, &#39;b&#39;] // æœ‰æ•ˆ
myField: [&#39;a&#39;, null, &#39;b&#39;] // é”™è¯¯
</code></pre></td></tr></table>
</div>
</div><p>è¿˜æœ‰æ•°ç»„ä¸èƒ½ä¸ºç©ºçš„æƒ…å†µï¼Œè¿™ä»£è¡¨æ•°ç»„å¯ä»¥æœ‰ç©ºé€‰é¡¹ï¼Œä½†å¿…é¡»æœ‰æˆå‘˜</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">myField: [String]!

myField: null // é”™è¯¯
myField: [] // æœ‰æ•ˆ
myField: [&#39;a&#39;, &#39;b&#39;] // æœ‰æ•ˆ
myField: [&#39;a&#39;, null, &#39;b&#39;] // æœ‰æ•ˆ
</code></pre></td></tr></table>
</div>
</div><h3 id="265è”åˆç±»å‹">2.6.5.è”åˆç±»å‹</h3>
<p>ç”¨<code>union</code>å…³é”®å­—å»å®šä¹‰ä¸€ä¸ªè”åˆç±»å‹ï¼Œè”åˆç±»å‹çš„æˆå‘˜éœ€è¦æ˜¯å…·ä½“å¯¹è±¡ç±»å‹ï¼›ä½ ä¸èƒ½ä½¿ç”¨æ¥å£æˆ–è€…å…¶ä»–è”åˆç±»å‹æ¥åˆ›é€ ä¸€ä¸ªè”åˆç±»å‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">union SearchResult = Human | Droid | Starship
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">{
  search(text: &#34;an&#34;) {
    ... on Human {
      name
      height
    }
    ... on Droid {
      name
      primaryFunction
    }
    ... on Starship {
      name
      length
    }
  }
}
</code></pre></td></tr></table>
</div>
</div><p>æŸ¥è¯¢è”åˆç±»å‹çš„å¯¹è±¡æ—¶ï¼Œé™¤äº†æ²¡æœ‰å…¬å…±å­—æ®µå¤–ï¼Œå…¶ä»–ä¸æ¥å£ç±»å‹çš„æŸ¥è¯¢ä¸€è‡´ï¼Œä¹Ÿæ˜¯ä½¿ç”¨<code>... on</code>è¯­æ³•æ¥æŸ¥è¯¢</p>
<h3 id="267interfaceæ¥å£">2.6.7.interface(æ¥å£)</h3>
<p>ä¸€ä¸ª<strong>æ¥å£</strong>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»å‹ï¼Œå®ƒåŒ…å«æŸäº›å­—æ®µï¼Œè€Œå¯¹è±¡ç±»å‹å¿…é¡»åŒ…å«è¿™äº›å­—æ®µï¼Œæ‰èƒ½ç®—å®ç°äº†è¿™ä¸ªæ¥å£</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">interface Character {
  id: ID!
  name: String!
  friends: [Character]
  appearsIn: [Episode]!
}

// å®ç°Characteræ¥å£è¦åŒ…å«å…¶æ‰€æœ‰å±æ€§
type Human implements Character {
  id: ID!
  name: String!
  friends: [Character]
  appearsIn: [Episode]!
  starships: [Starship]
  totalCredits: Int
}
</code></pre></td></tr></table>
</div>
</div><h3 id="268-inputç±»å‹">2.6.8. inputç±»å‹</h3>
<p>è¾“å…¥ç±»å‹çœ‹ä¸Šå»å’Œå¸¸è§„å¯¹è±¡ä¸€æ¨¡ä¸€æ ·ï¼Œé™¤äº†å…³é”®å­—æ˜¯ <code>input</code> è€Œä¸æ˜¯ <code>type</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">input ReviewInput {
  stars: Int!
  commentary: String
}
</code></pre></td></tr></table>
</div>
</div><p>inputé€šå¸¸å®šä¹‰é‚£ç§å¾ˆå¤æ‚çš„å¯¹è±¡ï¼Œç”¨äºåœ¨<code>mutation</code>ä¸­çš„æ“ä½œ</p>
<h3 id="269resolver">2.6.9.resolver</h3>
<p>å½“æ¥æ”¶åˆ°<code>query</code>ã€<code>mutation</code>ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å†™åŒåçš„Resolveræ¥è§£ææˆ–è€…å¤„ç†æ•°æ®ï¼Œå¢å¼ºäº†Graphqlç­›é€‰æ•°æ®ã€å¤„ç†æ•°æ®çš„èƒ½åŠ›</p>
<p>ä¸€ä¸ª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// å®šä¹‰ä¸€ä¸ªquery
</span><span class="c1"></span><span class="nx">query</span> <span class="p">{</span>
  <span class="nx">hello</span>
<span class="p">}</span>

<span class="c1">// åŒåçš„Resolver
</span><span class="c1"></span><span class="nx">Query</span> <span class="p">{</span>
  <span class="nx">hello</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">1</span>
  <span class="p">},</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>è§£æå‡½æ•°æ¥å—å››ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸º</p>
<ol>
<li><code>parent</code>ï¼šå½“å‰ä¸Šä¸€ä¸ªè§£æå‡½æ•°çš„è¿”å›å€¼</li>
<li><code>args</code>ï¼šæŸ¥è¯¢ä¸­ä¼ å…¥çš„å‚æ•°</li>
<li><code>context</code>ï¼šæä¾›ç»™æ‰€æœ‰è§£æå™¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯</li>
<li><code>info</code>ï¼šä¸€ä¸ªä¿å­˜ä¸å½“å‰æŸ¥è¯¢ç›¸å…³çš„å­—æ®µç‰¹å®šä¿¡æ¯ä»¥åŠ schema è¯¦ç»†ä¿¡æ¯çš„å€¼</li>
</ol>
<p>è§£æå‡½æ•°çš„è¿”å›å€¼å¯ä»¥æ˜¯ä¸€ä¸ªå…·ä½“çš„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ Promise æˆ– Promise æ•°ç»„ã€‚</p>
<h1 id="3å®æˆ˜æµ‹è¯•">3.å®æˆ˜æµ‹è¯•</h1>
<p>GraphQL ç°åœ¨ä¹Ÿæœ‰å¾ˆå¤šç¤¾åŒºæä¾›çš„åº“ï¼Œå¯ä»¥å¿«é€Ÿçš„æ•´åˆä½¿ç”¨ï¼Œæ¯”å¦‚<a href="https://github.com/glennreyes/graphpack" target="_blank" rel="noopener noreffer">graphpack</a>ï¼Œä½†æ˜¯å¾ˆé—æ†¾ï¼Œè¿™ä¸ªåº“å·²ç»å¾ˆä¹…æ²¡ç»´æŠ¤äº†ï¼Œè¿™é‡Œä½¿ç”¨<code>nodejs + mongoDB + koa + apollo-server-koa</code>æ­å»ºä¸€ä¸ªåŸºæœ¬çš„GraphQLæœåŠ¡ï¼Œ[apollo-server][https://github.com/apollographql/apollo-server]æ˜¯ä¸€ä¸ªGraphQLé›†æˆæœåŠ¡ï¼Œå¯ä»¥æ”¯æŒ<code>Express</code>ã€<code>Koa</code></p>
<h2 id="31å…¥å£appjs">3.1.å…¥å£app.js</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">Koa</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;koa&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">KoaStatic</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;koa-static&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">Router</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;koa-router&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;koa-bodyparser&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="p">{</span> <span class="nx">ApolloServer</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;apollo-server-koa&#39;</span><span class="p">)</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./mongodb&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">routerMap</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./router&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="p">{</span> <span class="nx">typeDefs</span><span class="p">,</span> <span class="nx">resolvers</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./graphql/schema&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Koa</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Router</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">apollo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ApolloServer</span><span class="p">({</span> <span class="nx">typeDefs</span><span class="p">,</span> <span class="nx">resolvers</span> <span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">())</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">KoaStatic</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/static&#39;</span><span class="p">))</span>
<span class="c1">// è·¯ç”±é…ç½®
</span><span class="c1"></span><span class="nx">router</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">routerMap</span><span class="p">.</span><span class="nx">routes</span><span class="p">())</span>
<span class="c1">// ä½¿ç”¨è·¯ç”±
</span><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">router</span><span class="p">.</span><span class="nx">routes</span><span class="p">())</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">router</span><span class="p">.</span><span class="nx">allowedMethods</span><span class="p">())</span>
<span class="c1">// ä½¿ç”¨apollo
</span><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">apollo</span><span class="p">.</span><span class="nx">getMiddleware</span><span class="p">())</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ğŸš€ GraphQL-demo server listen at http://localhost:4000\n&#39;</span><span class="p">)</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ğŸš€ Server ready at http://localhost:4000</span><span class="si">${</span><span class="nx">apollo</span><span class="p">.</span><span class="nx">graphqlPath</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="p">})</span>

</code></pre></td></tr></table>
</div>
</div><h2 id="32mongodbè¿æ¥é…ç½®">3.2.mongodbè¿æ¥é…ç½®</h2>
<p>ç”±äºæ˜¯åœ¨æœ¬åœ°æµ‹è¯•ï¼Œæ‰€ä»¥åœ¨å†™mongodbè¿æ¥çš„åœ°å€è®°å¾—å¸¦ä¸Šadminæƒé™ï¼Œæ¯”å¦‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">dbPath</span><span class="o">:</span> <span class="s1">&#39;mongodb://root:root@localhost:27017/graphql?authSource=admin&#39;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="33mongodb-schemaçš„å®šä¹‰">3.3.mongodb schemaçš„å®šä¹‰</h2>
<p>ä¹Ÿå°±æ˜¯å®šä¹‰mongodbé‡Œçš„æ•°æ®ç»“æ„ï¼Œè¿™é‡Œçš„ç¤ºä¾‹ä»£ç å®šä¹‰äº†ä¸‰ä¸ªschema</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// student
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">Schema</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span>
<span class="kr">const</span> <span class="nx">ObjectId</span> <span class="o">=</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span>

<span class="kr">const</span> <span class="nx">StudentSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">sex</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">age</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span>
  <span class="nx">meta</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">createdAt</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span>
      <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
    <span class="p">},</span>
    <span class="nx">updatedAt</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span>
      <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">StudentSchema</span><span class="p">.</span><span class="nx">pre</span><span class="p">(</span><span class="s1">&#39;save&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isNew</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">createdAt</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">updatedAt</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">updatedAt</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
  <span class="p">}</span>
  <span class="nx">next</span><span class="p">()</span>
<span class="p">})</span>

<span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Student&#39;</span><span class="p">,</span> <span class="nx">StudentSchema</span><span class="p">)</span>



<span class="c1">// course
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">Schema</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span>
<span class="kr">const</span> <span class="nx">ObjectId</span> <span class="o">=</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span>

<span class="kr">const</span> <span class="nx">CourseSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">desc</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">page</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span>
  <span class="nx">author</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">meta</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">createdAt</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span>
      <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
    <span class="p">},</span>
    <span class="nx">updatedAt</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span>
      <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">CourseSchema</span><span class="p">.</span><span class="nx">pre</span><span class="p">(</span><span class="s1">&#39;save&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isNew</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">createdAt</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">updatedAt</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">updatedAt</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="nx">next</span><span class="p">()</span>
<span class="p">})</span>

<span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Course&#39;</span><span class="p">,</span> <span class="nx">CourseSchema</span><span class="p">)</span>



<span class="c1">// info
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">Schema</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span>
<span class="kr">const</span> <span class="nx">ObjectId</span> <span class="o">=</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span>

<span class="c1">// å­¦ç”Ÿé™„åŠ ä¿¡æ¯
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">InfoSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span>
  <span class="nx">hobby</span><span class="o">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">],</span>
  <span class="nx">height</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">weight</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">studentId</span><span class="o">:</span> <span class="nx">ObjectId</span><span class="p">,</span>
  <span class="nx">meta</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">createdAt</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span>
      <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
    <span class="p">},</span>
    <span class="nx">updatedAt</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span>
      <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">InfoSchema</span><span class="p">.</span><span class="nx">pre</span><span class="p">(</span><span class="s1">&#39;save&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isNew</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">createdAt</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">updatedAt</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">updatedAt</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
  <span class="p">}</span>
  <span class="nx">next</span><span class="p">()</span>
<span class="p">})</span>

<span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Info&#39;</span><span class="p">,</span> <span class="nx">InfoSchema</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="34mongodbè¿æ¥æ–‡ä»¶">3.4.mongodbè¿æ¥æ–‡ä»¶</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../config&#39;</span><span class="p">)</span>

<span class="c1">// å¼•å…¥ä¸Šè¿°å®šä¹‰çš„schema
</span><span class="c1"></span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./schema/info&#39;</span><span class="p">)</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./schema/student&#39;</span><span class="p">)</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./schema/course&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">database</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">mongoose</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
  <span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">dbPath</span><span class="p">)</span>
  <span class="nx">mongoose</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;disconnected&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">dbPath</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="nx">mongoose</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
  <span class="p">})</span>

  <span class="nx">mongoose</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="nx">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Connected to MongoDB &#39;</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">dbPath</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="nx">database</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="35graphql-schemaå®šä¹‰">3.5.Graphql schemaå®šä¹‰</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="p">{</span> <span class="nx">gql</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;apollo-server-koa&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">CourseModel</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Course&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">InfoModel</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Info&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">StudentModel</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Student&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">typeDefs</span> <span class="o">=</span> <span class="nx">gql</span><span class="sb">`
</span><span class="sb">  type Course {
</span><span class="sb">    title: String
</span><span class="sb">    desc: String
</span><span class="sb">    page: Int
</span><span class="sb">    author: String
</span><span class="sb">  }
</span><span class="sb">  type Info {
</span><span class="sb">    height: String
</span><span class="sb">    weight: String
</span><span class="sb">    hobby: [String],
</span><span class="sb">    studentId: ID,
</span><span class="sb">    _id: ID
</span><span class="sb">  }
</span><span class="sb">  type Student {
</span><span class="sb">    name: String
</span><span class="sb">    sex: String
</span><span class="sb">    age: Int,
</span><span class="sb">    _id: ID,
</span><span class="sb">    info: Info
</span><span class="sb">  }
</span><span class="sb">  type Query {
</span><span class="sb">    getCourse: [Course]
</span><span class="sb">    getStudent: [Student]
</span><span class="sb">    getStudentInfo(id: ID): Info
</span><span class="sb">    getInfo: [Info]
</span><span class="sb">  }
</span><span class="sb">  type Mutation {
</span><span class="sb">    addCourse(post: CourseInput): Course,
</span><span class="sb">    addStudent(post: StudentInput): Student
</span><span class="sb">    addStudentInfo(id: ID, height: String, weight: String, hobby: [String]): Info
</span><span class="sb">    changeStudentInfo(id: ID, height: String, weight: String, hobby: [String]): Info
</span><span class="sb">  }
</span><span class="sb">  input CourseInput {
</span><span class="sb">    title: String
</span><span class="sb">    desc: String
</span><span class="sb">    page: Int
</span><span class="sb">    author: String
</span><span class="sb">  }
</span><span class="sb">  input StudentInput {
</span><span class="sb">    name: String
</span><span class="sb">    sex: String
</span><span class="sb">    age: Int
</span><span class="sb">  }
</span><span class="sb">`</span>

<span class="kr">const</span> <span class="nx">resolvers</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">Query</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">getCourse</span><span class="o">:</span> <span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">CourseModel</span><span class="p">.</span><span class="nx">find</span><span class="p">({})</span>
    <span class="p">},</span>
    <span class="nx">getStudent</span><span class="o">:</span> <span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">StudentModel</span><span class="p">.</span><span class="nx">find</span><span class="p">({})</span>
    <span class="p">},</span>
    <span class="nx">getStudentInfo</span><span class="o">:</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">InfoModel</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">studentId</span><span class="o">:</span> <span class="nx">args</span><span class="p">.</span><span class="nx">id</span><span class="p">})</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">getInfo</span><span class="o">:</span> <span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">InfoModel</span><span class="p">.</span><span class="nx">find</span><span class="p">({})</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">Mutation</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">addCourse</span><span class="o">:</span> <span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="p">{</span> <span class="nx">title</span><span class="p">,</span> <span class="nx">desc</span><span class="p">,</span> <span class="nx">page</span><span class="p">,</span> <span class="nx">author</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">post</span>
      <span class="k">return</span> <span class="nx">CourseModel</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span><span class="nx">title</span><span class="p">,</span> <span class="nx">desc</span><span class="p">,</span> <span class="nx">page</span><span class="p">,</span> <span class="nx">author</span><span class="p">})</span>
    <span class="p">},</span>
    <span class="nx">addStudent</span><span class="o">:</span> <span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="p">{</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">sex</span><span class="p">,</span> <span class="nx">age</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">post</span>
      <span class="k">return</span> <span class="nx">StudentModel</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span><span class="nx">name</span><span class="p">,</span> <span class="nx">sex</span><span class="p">,</span> <span class="nx">age</span> <span class="p">})</span>
    <span class="p">},</span>
    <span class="nx">addStudentInfo</span><span class="o">:</span> <span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="p">{</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">weight</span><span class="p">,</span> <span class="nx">hobby</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">args</span>
      <span class="k">return</span> <span class="nx">InfoModel</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="nx">hobby</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">weight</span><span class="p">,</span> <span class="nx">studentId</span><span class="o">:</span> <span class="nx">id</span> <span class="p">})</span>
    <span class="p">},</span>
    <span class="nx">changeStudentInfo</span><span class="o">:</span> <span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="p">{</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">weight</span><span class="p">,</span> <span class="nx">hobby</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">args</span>
      <span class="k">return</span> <span class="nx">InfoModel</span><span class="p">.</span><span class="nx">findOneAndUpdate</span><span class="p">({</span><span class="nx">studentId</span><span class="o">:</span> <span class="nx">id</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">hobby</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">weight</span> <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">resolvers</span><span class="p">,</span>
  <span class="nx">typeDefs</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>ä»¥ä¸Šå®šä¹‰äº†Graphqlçš„æŸ¥è¯¢ä»¥åŠinputç±»å‹ï¼Œåˆå®šä¹‰äº†<code>Query</code>ã€<code>Mutation</code>çš„æ“ä½œä»¥åŠå¯¹åº”çš„Resolverï¼Œè¿™å°±æ˜¯ä¸€ä¸ªç®€å•åœ°GraphqlæŸ¥è¯¢å®šä¹‰äº†</p>
<h1 id="4n--1-queryçš„é—®é¢˜">4.n + 1 queryçš„é—®é¢˜</h1>
<p>GraphQLçš„æŸ¥è¯¢æ¯æ¬¡åªèƒ½æŸ¥å•ä¸ªçš„ä¿¡æ¯ï¼Œé‡åˆ°å¤šæ¡ç›¸åŒçš„æ•°æ®çš„æ—¶å€™è¦æŸ¥è¯¢å¤šæ¬¡ï¼Œæ¯”å¦‚æˆ‘è¦æŸ¥å¤šæœ¬ä¹¦çš„ä½œè€…çš„å§“åï¼Œé‚£æˆ‘å°±è¦ä¾æ¬¡ä¸ºæ¯æœ¬ä¹¦æŸ¥è¯¢æ¯ä¸ªä½œè€…ï¼Œè¿™ä¸ªæ•ˆç‡æ˜¯å¾ˆä½çš„ï¼›æ›´å¥½çš„åšæ³•æ˜¯æŸ¥è¯¢åˆ°æ‰€æœ‰ä¹¦çš„ä½œè€…çš„idï¼Œç„¶åä¸€æ¬¡æ€§å»æŸ¥æ‰€æœ‰çš„ä½œè€…çš„å§“åï¼›ä¸ºäº†è§£å†³è¿™ä¸ªæ–¹æ³•ï¼ŒGraphQLä¼šé…åˆ<a href="https://github.com/graphql/dataloader" target="_blank" rel="noopener noreffer">dataloader</a>å»ä½¿ç”¨ï¼Œè¿™ä¸ªä¹Ÿæ˜¯GraphQLå®˜æ–¹å‡ºå“</p>
<p>å®ƒçš„ä¸€ä¸ªæ€è·¯æ˜¯</p>
<blockquote>
<p>å½“å‰äº‹ä»¶å¾ªç¯æ”¶é›† callback å’Œæ‰€æœ‰çš„ keysï¼Œä¸‹ä¸€è½®äº‹ä»¶å¾ªç¯è§¦å‘ callback å¹¶ä¼ å…¥æ‰€æœ‰å½“å‰äº‹ä»¶å¾ªç¯ä¸­æ”¶é›†çš„ keysï¼š</p>
<p>let datas = callback(keys)</p>
<p>dataloader æ ¹æ® keys çš„é¡ºåºä¾æ¬¡è§¦å‘æ¯ä¸ª load çš„ resolve æ ¹æ®é¡ºåºä¼ å…¥å¯¹åº”çš„ data</p>
</blockquote>
<p>å…·ä½“çš„è¯·çœ‹<a href="https://github.com/graphql/dataloader" target="_blank" rel="noopener noreffer">dataloader</a>ï¼Œè¿™é‡Œä¸å¤šèµ˜è¿°</p>
<h1 id="5å‚è€ƒé“¾æ¥">5.å‚è€ƒé“¾æ¥</h1>
<p>1.<a href="https://graphql.cn/learn/" target="_blank" rel="noopener noreffer">GraphQLå®˜æ–¹æ–‡æ¡£</a></p>
<p>2.<a href="https://juejin.cn/post/6844903795407716366" target="_blank" rel="noopener noreffer">GraphQL ä»å…¥é—¨åˆ°å®è·µ</a></p>
<p>3.<a href="https://github.com/naihe138/GraphQL-demo.git" target="_blank" rel="noopener noreffer">GraphQL demo</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2022-06-30</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://baskep.com/graphql%E7%9A%84%E5%85%A5%E9%97%A8/" data-title="GraphQLçš„å…¥é—¨"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://baskep.com/graphql%E7%9A%84%E5%85%A5%E9%97%A8/"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Hacker News" data-sharer="hackernews" data-url="https://baskep.com/graphql%E7%9A%84%E5%85%A5%E9%97%A8/" data-title="GraphQLçš„å…¥é—¨"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://baskep.com/graphql%E7%9A%84%E5%85%A5%E9%97%A8/" data-title="GraphQLçš„å…¥é—¨"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://baskep.com/graphql%E7%9A%84%E5%85%A5%E9%97%A8/" data-title="GraphQLçš„å…¥é—¨"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/react18%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7/" class="prev" rel="prev" title="React18çš„æ–°ç‰¹æ€§"><i class="fas fa-angle-left fa-fw"></i>React18çš„æ–°ç‰¹æ€§</a>
            <a href="/png%E6%A0%BC%E5%BC%8F%E7%9A%84%E8%AF%A6%E8%A7%A3/" class="next" rel="next" title="PNGæ ¼å¼çš„è¯¦è§£">PNGæ ¼å¼çš„è¯¦è§£<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">æ—©èµ·çš„è€å¹´äºº</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/typeit.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":10000},"comment":{},"data":{"id-1":"ä»Šå¤©å°±åˆ°è¿™é‡Œï¼Œå›å»ç­‰é€šçŸ¥å§","id-2":"ä»Šå¤©å°±åˆ°è¿™é‡Œï¼Œå›å»ç­‰é€šçŸ¥å§"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
