<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  
  
  
  
  <link rel="prev" href="https://xtid.github.io/2019/d3.js%E7%BB%98%E5%88%B6%E4%B8%AD%E5%9B%BD%E5%9C%B0%E5%9B%BE/" />
  <link rel="next" href="https://xtid.github.io/2019/nodejs%E5%AE%9E%E7%8E%B0excel%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8A%9F%E8%83%BD/" />
  <link rel="canonical" href="https://xtid.github.io/2019/nginx%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" sizes="32x32" href="/favicon.ico">
  <link rel="icon" sizes="16x16" href="/favicon.ico">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           nginx学习总结 | 👨🏻‍💻
       
  </title>
  <meta name="title" content="nginx学习总结 | 👨🏻‍💻">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/xtid.github.io"
    },
    "articleSection" : "posts",
    "name" : "nginx学习总结",
    "headline" : "nginx学习总结",
    "description" : "1.nginx简介 \x26ldquo;nginx是一款轻量级的HTTP服务器，采用事件驱动的异步非阻塞处理方式框架，这让其具有极好的IO性能，时常",
    "inLanguage" : "zh-CN",
    "author" : "",
    "creator" : "",
    "publisher": "",
    "accountablePerson" : "",
    "copyrightHolder" : "",
    "copyrightYear" : "2019",
    "datePublished": "2019-10-25 22:42:19 \x2b0915 \x2b0915",
    "dateModified" : "2019-10-25 22:42:19 \x2b0915 \x2b0915",
    "url" : "https:\/\/xtid.github.io\/2019\/nginx%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93\/",
    "wordCount" : "1721",
    "keywords" : [  "👨🏻‍💻"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://xtid.github.io">👨🏻‍💻</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://xtid.github.io">👨🏻‍💻</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">nginx学习总结</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://xtid.github.io" rel="author"></a> with ♥ 
                <span class="post-time">
                on <time datetime=2019-10-25 itemprop="datePublished">October 25, 2019</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://xtid.github.io/categories/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/"> 日常学习 </a>
                        
                </span>
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          

<h4 id="1-nginx简介">1.nginx简介</h4>

<blockquote>
<p>&ldquo;nginx是一款轻量级的HTTP服务器，采用事件驱动的异步非阻塞处理方式框架，这让其具有极好的IO性能，时常用于服务端的反向代理和负载均衡。&rdquo;</p>
</blockquote>

<h4 id="2-nginx优点">2.nginx优点</h4>

<blockquote>
<p>2.1 支持海量高并发：采用IO多路复用epoll。官方测试nginx能够支持5万并发链接，实际生产环境中可以支撑2-4万并发连接数。</p>

<p>2.2 内存消耗少：在主流的服务器中nginx目前是内存消耗最小的了，比如我们用nginx+PHP，在3万并发链接下，开启10个nginx进程消耗150M内存。</p>

<p>2.3 免费使用可以商业化：nginx为开源软件，采用的是2-clause BSD-like协议，可以免费使用，并且可以用于商业。并且配置简单</p>
</blockquote>

<h4 id="3-nginx配置介绍">3.nginx配置介绍</h4>

<p><code>nginx.conf</code> 文件是nginx总配置文件，nginx的基本配置或者设置代理等等基本配置可以在此设置</p>

<pre><code class="language-nginx">#运行用户，默认即是nginx，可以不进行设置
user  nginx;
#nginx进程，一般设置为和CPU核数一样
worker_processes  1;   
#错误日志存放目录
error_log  /var/log/nginx/error.log warn;
#进程pid存放位置
pid        /var/run/nginx.pid;


events {
    worker_connections  1024; # 单个后台进程的最大并发数
}


http {
    include       /etc/nginx/mime.types;   #文件扩展名与类型映射表
    default_type  application/octet-stream;  #默认文件类型
    #设置日志模式
    log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
                      '$status $body_bytes_sent &quot;$http_referer&quot; '
                      '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';

    access_log  /var/log/nginx/access.log  main;   #nginx访问日志存放位置

    sendfile        on;   #开启高效传输模式
    #tcp_nopush     on;    #减少网络报文段的数量

    keepalive_timeout  65;  #保持连接的时间，也叫超时时间

    #gzip  on;  #开启gzip压缩

    include /etc/nginx/conf.d/*.conf; #包含的子配置项位置和文件
</code></pre>

<p><code>nginx.default.conf</code>，nginx具体的默认配置，代理，服务配置等等都可以写在这个配置文件里</p>

<pre><code class="language-nginx">server {
    listen       80;   #配置监听端口
    server_name  localhost;  //配置域名

    #charset koi8-r;     
    #access_log  /var/log/nginx/host.access.log  main;

    location / {
        root   /usr/share/nginx/html;     #服务默认启动目录
        index  index.html index.htm;    #默认访问文件
    }

    #error_page  404              /404.html;   # 配置404页面

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;   #错误状态码的显示页面，配置后需要重启
    location = /50x.html {
        root   /usr/share/nginx/html;
    }

    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1;
    #}

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    #location ~ \.php$ {
    #    root           html;
    #    fastcgi_pass   127.0.0.1:9000;
    #    fastcgi_index  index.php;
    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
    #    include        fastcgi_params;
    #}

    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    #location ~ /\.ht {
    #    deny  all;
    #}
}
</code></pre>

<h4 id="4-nginx基本的访问权限配置">4.nginx基本的访问权限配置</h4>

<p>依靠deny和allow这两个指令，可以实现基本的访问权限控制，如以下的配置，表示只允许<code>45.76.202.231</code>进行访问，其他的IP是禁止访问的</p>

<pre><code class="language-nginx">location / {
        allow  45.76.202.231;
        deny   all;
	}
</code></pre>

<p>如果对于其他复杂的需求，可以使用<a href="http://seanlook.com/2015/05/17/nginx-location-rewrite/" rel="nofollow noreferrer" target="_blank">正则</a>实现。</p>

<h4 id="5-nginx设置虚拟主机">5.nginx设置虚拟主机</h4>

<blockquote>
<p>虚拟主机是指在一台物理主机服务器上划分出多个磁盘空间，每个磁盘空间都是一个虚拟主机，每台虚拟主机都可以对外提供Web服务，并且互不干扰。在外界看来，虚拟主机就是一台独立的服务器主机，这意味着用户能够利用虚拟主机把多个不同域名的网站部署在同一台服务器上，而不必再为简历一个网站单独购买一台服务器，既解决了维护服务器技术的难题，同时又极大地节省了服务器硬件成本和相关的维护费用。</p>
</blockquote>

<p>具体做法是，在<code>nginx.default.conf</code>添加多个server，可根据ip，端口或域名来划分，这样，就可以访问同一台服务器上的不同资源了，值得注意是，如果是使用域名，这还要让域名的dns解析指向你的服务器</p>

<pre><code class="language-nginx">server{
        listen 8001;
        server_name localhost;
        root /usr/share/nginx/html/html8001;
        index index.html;
}
server{
        listen 8002;
        server_name localhost;
        root /usr/share/nginx/html/html8002;
        index index.html;
}
</code></pre>

<h4 id="6-nginx设置反向代理">6.nginx设置反向代理</h4>

<p>客户端发送的请求，想要访问server服务器上的内容。发送的内容被发送到代理服务器上，这个代理服务器再把请求发送到自己设置好的内部服务器上，而用户真实想获得的内容就在这些设置好的服务器上，反向代理实际生产环境可以说用的非常多</p>

<pre><code class="language-nginx">server{
        listen 80;
        server_name https://www.baidu.com;
        location / {
               proxy_pass https://www.baidu1.com;
        }
}
</code></pre>

<p>这样，当你访问<code>https://www.baidu.com</code>的时候就会去请求<code>https://www.baidu1.com</code>的资源了，以下还有常用的反向代理命令</p>

<pre><code class="language-nginx">proxy_set_header :在将客户端请求发送给后端服务器之前，更改来自客户端的请求头信息。

proxy_connect_timeout:配置nginx与后端代理服务器尝试建立连接的超时时间。

proxy_read_timeout : 配置nginx向后端服务器组发出read请求后，等待相应的超时时间。

proxy_send_timeout：配置nginx向后端服务器组发出write请求后，等待相应的超时时间。

proxy_redirect :用于修改后端服务器返回的响应头中的Location和Refresh
</code></pre>

<h4 id="7-nginx匹配pc或wap端">7.nginx匹配PC或wap端</h4>

<pre><code class="language-nginx">server{
        listen 80;
        server_name nginx2.jspang.com;
        location / {
         root /usr/share/nginx/pc;
         if ($http_user_agent ~* '(Android|webOS|iPhone|iPod|BlackBerry)') {
            root /usr/share/nginx/mobile;
         }
         index index.html;
        }
}
</code></pre>

    </div>

    

  
    <div class="post-tags">
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://xtid.github.io">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://xtid.github.io/2019/d3.js%E7%BB%98%E5%88%B6%E4%B8%AD%E5%9B%BD%E5%9C%B0%E5%9B%BE/" class="prev" rel="prev" title="d3.js绘制中国地图"><i class="iconfont icon-left"></i>&nbsp;d3.js绘制中国地图</a>
         
        
        <a href="https://xtid.github.io/2019/nodejs%E5%AE%9E%E7%8E%B0excel%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8A%9F%E8%83%BD/" class="next" rel="next" title="nodejs实现excel导出数据的功能">nodejs实现excel导出数据的功能&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2019 - 2020</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  



     </div>
  </body>
</html>
