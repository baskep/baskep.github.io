<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  
  
  
  
  <link rel="prev" href="https://xtid.github.io/2019/d3.js%E7%BB%98%E5%88%B6%E4%B8%AD%E5%9B%BD%E5%9C%B0%E5%9B%BE/" />
  <link rel="next" href="https://xtid.github.io/2019/nodejs%E5%AE%9E%E7%8E%B0excel%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8A%9F%E8%83%BD/" />
  <link rel="canonical" href="https://xtid.github.io/2019/nginx%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" sizes="32x32" href="/favicon.ico">
  <link rel="icon" sizes="16x16" href="/favicon.ico">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           nginxå­¦ä¹ æ€»ç»“ | ğŸ‘¨ğŸ»â€ğŸ’»
       
  </title>
  <meta name="title" content="nginxå­¦ä¹ æ€»ç»“ | ğŸ‘¨ğŸ»â€ğŸ’»">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/xtid.github.io"
    },
    "articleSection" : "posts",
    "name" : "nginxå­¦ä¹ æ€»ç»“",
    "headline" : "nginxå­¦ä¹ æ€»ç»“",
    "description" : "1.nginxç®€ä»‹ \x26ldquo;nginxæ˜¯ä¸€æ¬¾è½»é‡çº§çš„HTTPæœåŠ¡å™¨ï¼Œé‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥éé˜»å¡å¤„ç†æ–¹å¼æ¡†æ¶ï¼Œè¿™è®©å…¶å…·æœ‰æå¥½çš„IOæ€§èƒ½ï¼Œæ—¶å¸¸",
    "inLanguage" : "zh-CN",
    "author" : "",
    "creator" : "",
    "publisher": "",
    "accountablePerson" : "",
    "copyrightHolder" : "",
    "copyrightYear" : "2019",
    "datePublished": "2019-10-25 22:42:19 \x2b0915 \x2b0915",
    "dateModified" : "2019-10-25 22:42:19 \x2b0915 \x2b0915",
    "url" : "https:\/\/xtid.github.io\/2019\/nginx%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93\/",
    "wordCount" : "1721",
    "keywords" : [  "ğŸ‘¨ğŸ»â€ğŸ’»"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://xtid.github.io">ğŸ‘¨ğŸ»â€ğŸ’»</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://xtid.github.io">ğŸ‘¨ğŸ»â€ğŸ’»</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">nginxå­¦ä¹ æ€»ç»“</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://xtid.github.io" rel="author"></a> with â™¥ 
                <span class="post-time">
                on <time datetime=2019-10-25 itemprop="datePublished">October 25, 2019</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://xtid.github.io/categories/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/"> æ—¥å¸¸å­¦ä¹  </a>
                        
                </span>
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          

<h4 id="1-nginxç®€ä»‹">1.nginxç®€ä»‹</h4>

<blockquote>
<p>&ldquo;nginxæ˜¯ä¸€æ¬¾è½»é‡çº§çš„HTTPæœåŠ¡å™¨ï¼Œé‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥éé˜»å¡å¤„ç†æ–¹å¼æ¡†æ¶ï¼Œè¿™è®©å…¶å…·æœ‰æå¥½çš„IOæ€§èƒ½ï¼Œæ—¶å¸¸ç”¨äºæœåŠ¡ç«¯çš„åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ã€‚&rdquo;</p>
</blockquote>

<h4 id="2-nginxä¼˜ç‚¹">2.nginxä¼˜ç‚¹</h4>

<blockquote>
<p>2.1 æ”¯æŒæµ·é‡é«˜å¹¶å‘ï¼šé‡‡ç”¨IOå¤šè·¯å¤ç”¨epollã€‚å®˜æ–¹æµ‹è¯•nginxèƒ½å¤Ÿæ”¯æŒ5ä¸‡å¹¶å‘é“¾æ¥ï¼Œå®é™…ç”Ÿäº§ç¯å¢ƒä¸­å¯ä»¥æ”¯æ’‘2-4ä¸‡å¹¶å‘è¿æ¥æ•°ã€‚</p>

<p>2.2 å†…å­˜æ¶ˆè€—å°‘ï¼šåœ¨ä¸»æµçš„æœåŠ¡å™¨ä¸­nginxç›®å‰æ˜¯å†…å­˜æ¶ˆè€—æœ€å°çš„äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬ç”¨nginx+PHPï¼Œåœ¨3ä¸‡å¹¶å‘é“¾æ¥ä¸‹ï¼Œå¼€å¯10ä¸ªnginxè¿›ç¨‹æ¶ˆè€—150Må†…å­˜ã€‚</p>

<p>2.3 å…è´¹ä½¿ç”¨å¯ä»¥å•†ä¸šåŒ–ï¼šnginxä¸ºå¼€æºè½¯ä»¶ï¼Œé‡‡ç”¨çš„æ˜¯2-clause BSD-likeåè®®ï¼Œå¯ä»¥å…è´¹ä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºå•†ä¸šã€‚å¹¶ä¸”é…ç½®ç®€å•</p>
</blockquote>

<h4 id="3-nginxé…ç½®ä»‹ç»">3.nginxé…ç½®ä»‹ç»</h4>

<p><code>nginx.conf</code> æ–‡ä»¶æ˜¯nginxæ€»é…ç½®æ–‡ä»¶ï¼Œnginxçš„åŸºæœ¬é…ç½®æˆ–è€…è®¾ç½®ä»£ç†ç­‰ç­‰åŸºæœ¬é…ç½®å¯ä»¥åœ¨æ­¤è®¾ç½®</p>

<pre><code class="language-nginx">#è¿è¡Œç”¨æˆ·ï¼Œé»˜è®¤å³æ˜¯nginxï¼Œå¯ä»¥ä¸è¿›è¡Œè®¾ç½®
user  nginx;
#nginxè¿›ç¨‹ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºå’ŒCPUæ ¸æ•°ä¸€æ ·
worker_processes  1;   
#é”™è¯¯æ—¥å¿—å­˜æ”¾ç›®å½•
error_log  /var/log/nginx/error.log warn;
#è¿›ç¨‹pidå­˜æ”¾ä½ç½®
pid        /var/run/nginx.pid;


events {
    worker_connections  1024; # å•ä¸ªåå°è¿›ç¨‹çš„æœ€å¤§å¹¶å‘æ•°
}


http {
    include       /etc/nginx/mime.types;   #æ–‡ä»¶æ‰©å±•åä¸ç±»å‹æ˜ å°„è¡¨
    default_type  application/octet-stream;  #é»˜è®¤æ–‡ä»¶ç±»å‹
    #è®¾ç½®æ—¥å¿—æ¨¡å¼
    log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
                      '$status $body_bytes_sent &quot;$http_referer&quot; '
                      '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';

    access_log  /var/log/nginx/access.log  main;   #nginxè®¿é—®æ—¥å¿—å­˜æ”¾ä½ç½®

    sendfile        on;   #å¼€å¯é«˜æ•ˆä¼ è¾“æ¨¡å¼
    #tcp_nopush     on;    #å‡å°‘ç½‘ç»œæŠ¥æ–‡æ®µçš„æ•°é‡

    keepalive_timeout  65;  #ä¿æŒè¿æ¥çš„æ—¶é—´ï¼Œä¹Ÿå«è¶…æ—¶æ—¶é—´

    #gzip  on;  #å¼€å¯gzipå‹ç¼©

    include /etc/nginx/conf.d/*.conf; #åŒ…å«çš„å­é…ç½®é¡¹ä½ç½®å’Œæ–‡ä»¶
</code></pre>

<p><code>nginx.default.conf</code>ï¼Œnginxå…·ä½“çš„é»˜è®¤é…ç½®ï¼Œä»£ç†ï¼ŒæœåŠ¡é…ç½®ç­‰ç­‰éƒ½å¯ä»¥å†™åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶é‡Œ</p>

<pre><code class="language-nginx">server {
    listen       80;   #é…ç½®ç›‘å¬ç«¯å£
    server_name  localhost;  //é…ç½®åŸŸå

    #charset koi8-r;     
    #access_log  /var/log/nginx/host.access.log  main;

    location / {
        root   /usr/share/nginx/html;     #æœåŠ¡é»˜è®¤å¯åŠ¨ç›®å½•
        index  index.html index.htm;    #é»˜è®¤è®¿é—®æ–‡ä»¶
    }

    #error_page  404              /404.html;   # é…ç½®404é¡µé¢

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;   #é”™è¯¯çŠ¶æ€ç çš„æ˜¾ç¤ºé¡µé¢ï¼Œé…ç½®åéœ€è¦é‡å¯
    location = /50x.html {
        root   /usr/share/nginx/html;
    }

    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1;
    #}

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    #location ~ \.php$ {
    #    root           html;
    #    fastcgi_pass   127.0.0.1:9000;
    #    fastcgi_index  index.php;
    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
    #    include        fastcgi_params;
    #}

    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    #location ~ /\.ht {
    #    deny  all;
    #}
}
</code></pre>

<h4 id="4-nginxåŸºæœ¬çš„è®¿é—®æƒé™é…ç½®">4.nginxåŸºæœ¬çš„è®¿é—®æƒé™é…ç½®</h4>

<p>ä¾é denyå’Œallowè¿™ä¸¤ä¸ªæŒ‡ä»¤ï¼Œå¯ä»¥å®ç°åŸºæœ¬çš„è®¿é—®æƒé™æ§åˆ¶ï¼Œå¦‚ä»¥ä¸‹çš„é…ç½®ï¼Œè¡¨ç¤ºåªå…è®¸<code>45.76.202.231</code>è¿›è¡Œè®¿é—®ï¼Œå…¶ä»–çš„IPæ˜¯ç¦æ­¢è®¿é—®çš„</p>

<pre><code class="language-nginx">location / {
        allow  45.76.202.231;
        deny   all;
	}
</code></pre>

<p>å¦‚æœå¯¹äºå…¶ä»–å¤æ‚çš„éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨<a href="http://seanlook.com/2015/05/17/nginx-location-rewrite/" rel="nofollow noreferrer" target="_blank">æ­£åˆ™</a>å®ç°ã€‚</p>

<h4 id="5-nginxè®¾ç½®è™šæ‹Ÿä¸»æœº">5.nginxè®¾ç½®è™šæ‹Ÿä¸»æœº</h4>

<blockquote>
<p>è™šæ‹Ÿä¸»æœºæ˜¯æŒ‡åœ¨ä¸€å°ç‰©ç†ä¸»æœºæœåŠ¡å™¨ä¸Šåˆ’åˆ†å‡ºå¤šä¸ªç£ç›˜ç©ºé—´ï¼Œæ¯ä¸ªç£ç›˜ç©ºé—´éƒ½æ˜¯ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œæ¯å°è™šæ‹Ÿä¸»æœºéƒ½å¯ä»¥å¯¹å¤–æä¾›WebæœåŠ¡ï¼Œå¹¶ä¸”äº’ä¸å¹²æ‰°ã€‚åœ¨å¤–ç•Œçœ‹æ¥ï¼Œè™šæ‹Ÿä¸»æœºå°±æ˜¯ä¸€å°ç‹¬ç«‹çš„æœåŠ¡å™¨ä¸»æœºï¼Œè¿™æ„å‘³ç€ç”¨æˆ·èƒ½å¤Ÿåˆ©ç”¨è™šæ‹Ÿä¸»æœºæŠŠå¤šä¸ªä¸åŒåŸŸåçš„ç½‘ç«™éƒ¨ç½²åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œè€Œä¸å¿…å†ä¸ºç®€å†ä¸€ä¸ªç½‘ç«™å•ç‹¬è´­ä¹°ä¸€å°æœåŠ¡å™¨ï¼Œæ—¢è§£å†³äº†ç»´æŠ¤æœåŠ¡å™¨æŠ€æœ¯çš„éš¾é¢˜ï¼ŒåŒæ—¶åˆæå¤§åœ°èŠ‚çœäº†æœåŠ¡å™¨ç¡¬ä»¶æˆæœ¬å’Œç›¸å…³çš„ç»´æŠ¤è´¹ç”¨ã€‚</p>
</blockquote>

<p>å…·ä½“åšæ³•æ˜¯ï¼Œåœ¨<code>nginx.default.conf</code>æ·»åŠ å¤šä¸ªserverï¼Œå¯æ ¹æ®ipï¼Œç«¯å£æˆ–åŸŸåæ¥åˆ’åˆ†ï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥è®¿é—®åŒä¸€å°æœåŠ¡å™¨ä¸Šçš„ä¸åŒèµ„æºäº†ï¼Œå€¼å¾—æ³¨æ„æ˜¯ï¼Œå¦‚æœæ˜¯ä½¿ç”¨åŸŸåï¼Œè¿™è¿˜è¦è®©åŸŸåçš„dnsè§£ææŒ‡å‘ä½ çš„æœåŠ¡å™¨</p>

<pre><code class="language-nginx">server{
        listen 8001;
        server_name localhost;
        root /usr/share/nginx/html/html8001;
        index index.html;
}
server{
        listen 8002;
        server_name localhost;
        root /usr/share/nginx/html/html8002;
        index index.html;
}
</code></pre>

<h4 id="6-nginxè®¾ç½®åå‘ä»£ç†">6.nginxè®¾ç½®åå‘ä»£ç†</h4>

<p>å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ï¼Œæƒ³è¦è®¿é—®serveræœåŠ¡å™¨ä¸Šçš„å†…å®¹ã€‚å‘é€çš„å†…å®¹è¢«å‘é€åˆ°ä»£ç†æœåŠ¡å™¨ä¸Šï¼Œè¿™ä¸ªä»£ç†æœåŠ¡å™¨å†æŠŠè¯·æ±‚å‘é€åˆ°è‡ªå·±è®¾ç½®å¥½çš„å†…éƒ¨æœåŠ¡å™¨ä¸Šï¼Œè€Œç”¨æˆ·çœŸå®æƒ³è·å¾—çš„å†…å®¹å°±åœ¨è¿™äº›è®¾ç½®å¥½çš„æœåŠ¡å™¨ä¸Šï¼Œåå‘ä»£ç†å®é™…ç”Ÿäº§ç¯å¢ƒå¯ä»¥è¯´ç”¨çš„éå¸¸å¤š</p>

<pre><code class="language-nginx">server{
        listen 80;
        server_name https://www.baidu.com;
        location / {
               proxy_pass https://www.baidu1.com;
        }
}
</code></pre>

<p>è¿™æ ·ï¼Œå½“ä½ è®¿é—®<code>https://www.baidu.com</code>çš„æ—¶å€™å°±ä¼šå»è¯·æ±‚<code>https://www.baidu1.com</code>çš„èµ„æºäº†ï¼Œä»¥ä¸‹è¿˜æœ‰å¸¸ç”¨çš„åå‘ä»£ç†å‘½ä»¤</p>

<pre><code class="language-nginx">proxy_set_header :åœ¨å°†å®¢æˆ·ç«¯è¯·æ±‚å‘é€ç»™åç«¯æœåŠ¡å™¨ä¹‹å‰ï¼Œæ›´æ”¹æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚å¤´ä¿¡æ¯ã€‚

proxy_connect_timeout:é…ç½®nginxä¸åç«¯ä»£ç†æœåŠ¡å™¨å°è¯•å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚

proxy_read_timeout : é…ç½®nginxå‘åç«¯æœåŠ¡å™¨ç»„å‘å‡ºreadè¯·æ±‚åï¼Œç­‰å¾…ç›¸åº”çš„è¶…æ—¶æ—¶é—´ã€‚

proxy_send_timeoutï¼šé…ç½®nginxå‘åç«¯æœåŠ¡å™¨ç»„å‘å‡ºwriteè¯·æ±‚åï¼Œç­‰å¾…ç›¸åº”çš„è¶…æ—¶æ—¶é—´ã€‚

proxy_redirect :ç”¨äºä¿®æ”¹åç«¯æœåŠ¡å™¨è¿”å›çš„å“åº”å¤´ä¸­çš„Locationå’ŒRefresh
</code></pre>

<h4 id="7-nginxåŒ¹é…pcæˆ–wapç«¯">7.nginxåŒ¹é…PCæˆ–wapç«¯</h4>

<pre><code class="language-nginx">server{
        listen 80;
        server_name nginx2.jspang.com;
        location / {
         root /usr/share/nginx/pc;
         if ($http_user_agent ~* '(Android|webOS|iPhone|iPod|BlackBerry)') {
            root /usr/share/nginx/mobile;
         }
         index index.html;
        }
}
</code></pre>

    </div>

    

  
    <div class="post-tags">
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> Â· 
                <span><a href="https://xtid.github.io">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://xtid.github.io/2019/d3.js%E7%BB%98%E5%88%B6%E4%B8%AD%E5%9B%BD%E5%9C%B0%E5%9B%BE/" class="prev" rel="prev" title="d3.jsç»˜åˆ¶ä¸­å›½åœ°å›¾"><i class="iconfont icon-left"></i>&nbsp;d3.jsç»˜åˆ¶ä¸­å›½åœ°å›¾</a>
         
        
        <a href="https://xtid.github.io/2019/nodejs%E5%AE%9E%E7%8E%B0excel%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8A%9F%E8%83%BD/" class="next" rel="next" title="nodejså®ç°excelå¯¼å‡ºæ•°æ®çš„åŠŸèƒ½">nodejså®ç°excelå¯¼å‡ºæ•°æ®çš„åŠŸèƒ½&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2019 - 2020</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  



     </div>
  </body>
</html>
