<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Nginxå­¦ä¹ æ€»ç»“ - ğŸ‘¨ğŸ»â€ğŸ’»</title><meta name="Description" content="æ—©èµ·çš„å¹´è½»äººåšçš„ç½‘ç«™"><meta property="og:title" content="Nginxå­¦ä¹ æ€»ç»“" />
<meta property="og:description" content="1.nginx ç®€ä»‹ &ldquo;nginx æ˜¯ä¸€æ¬¾è½»é‡çº§çš„ HTTP æœåŠ¡å™¨ï¼Œé‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥éé˜»å¡å¤„ç†æ–¹å¼æ¡†æ¶ï¼Œè¿™è®©å…¶å…·æœ‰æå¥½çš„ IO æ€§èƒ½ï¼Œæ—¶å¸¸ç”¨äºæœåŠ¡ç«¯çš„åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ã€‚&rdqu" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xtidcr.com/nginx%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" />
<meta property="og:image" content="https://xtidcr.com/logo.png"/>
<meta property="article:published_time" content="2019-10-25T22:42:19+09:15" />
<meta property="article:modified_time" content="2019-10-25T22:42:19+09:15" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://xtidcr.com/logo.png"/>

<meta name="twitter:title" content="Nginxå­¦ä¹ æ€»ç»“"/>
<meta name="twitter:description" content="1.nginx ç®€ä»‹ &ldquo;nginx æ˜¯ä¸€æ¬¾è½»é‡çº§çš„ HTTP æœåŠ¡å™¨ï¼Œé‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥éé˜»å¡å¤„ç†æ–¹å¼æ¡†æ¶ï¼Œè¿™è®©å…¶å…·æœ‰æå¥½çš„ IO æ€§èƒ½ï¼Œæ—¶å¸¸ç”¨äºæœåŠ¡ç«¯çš„åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ã€‚&rdqu"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="canonical" href="https://xtidcr.com/nginx%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" /><link rel="prev" href="https://xtidcr.com/d3.js%E7%BB%98%E5%88%B6%E4%B8%AD%E5%9B%BD%E5%9C%B0%E5%9B%BE/" /><link rel="next" href="https://xtidcr.com/nodejs%E5%AE%9E%E7%8E%B0excel%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8A%9F%E8%83%BD/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Nginxå­¦ä¹ æ€»ç»“",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/xtidcr.com\/nginx%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93\/"
        },"image": ["https:\/\/xtidcr.com\/images\/Apple-Devices-Preview.png"],"genre": "posts","wordcount":  1727 ,
        "url": "https:\/\/xtidcr.com\/nginx%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93\/","datePublished": "2019-10-25T22:42:19+09:15","dateModified": "2019-10-25T22:42:19+09:15","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "https:\/\/xtidcr.com\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "æ—©èµ·çš„è€å¹´äºº"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="ğŸ‘¨ğŸ»â€ğŸ’»"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"><i class='fa fa-book'></i> æ–‡ç«  </a><a class="menu-item" href="/categories/"><i class='fa fa-th'></i> åˆ†ç±» </a><a class="menu-item" href="/about/"><i class='fa fa-info-circle'></i> å…³äº </a><a class="menu-item" href="https://github.com/xtid" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i> Github </a><a class="menu-item" href="/links/"><i class='fas fa-user-friends'></i> å‹é“¾ </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="ğŸ‘¨ğŸ»â€ğŸ’»"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title=""><i class='fa fa-book'></i>æ–‡ç« </a><a class="menu-item" href="/categories/" title=""><i class='fa fa-th'></i>åˆ†ç±»</a><a class="menu-item" href="/about/" title=""><i class='fa fa-info-circle'></i>å…³äº</a><a class="menu-item" href="https://github.com/xtid" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>Github</a><a class="menu-item" href="/links/" title=""><i class='fas fa-user-friends'></i>å‹é“¾</a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Nginxå­¦ä¹ æ€»ç»“</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>æ—©èµ·çš„è€å¹´äºº</a></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/"><i class="far fa-folder fa-fw"></i>æ—¥å¸¸å­¦ä¹ </a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2019-10-25">2019-10-25</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 1727 å­—&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 4 åˆ†é’Ÿ&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1nginx-ç®€ä»‹">1.nginx ç®€ä»‹</a></li>
    <li><a href="#2nginx-ä¼˜ç‚¹">2.nginx ä¼˜ç‚¹</a></li>
    <li><a href="#3nginx-é…ç½®ä»‹ç»">3.nginx é…ç½®ä»‹ç»</a></li>
    <li><a href="#4nginx-åŸºæœ¬çš„è®¿é—®æƒé™é…ç½®">4.nginx åŸºæœ¬çš„è®¿é—®æƒé™é…ç½®</a></li>
    <li><a href="#5nginx-è®¾ç½®è™šæ‹Ÿä¸»æœº">5.nginx è®¾ç½®è™šæ‹Ÿä¸»æœº</a></li>
    <li><a href="#6nginx-è®¾ç½®åå‘ä»£ç†">6.nginx è®¾ç½®åå‘ä»£ç†</a></li>
    <li><a href="#7nginx-åŒ¹é…-pc-æˆ–-wap-ç«¯">7.nginx åŒ¹é… PC æˆ– wap ç«¯</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="1nginx-ç®€ä»‹">1.nginx ç®€ä»‹</h1>
<blockquote>
<p>&ldquo;nginx æ˜¯ä¸€æ¬¾è½»é‡çº§çš„ HTTP æœåŠ¡å™¨ï¼Œé‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥éé˜»å¡å¤„ç†æ–¹å¼æ¡†æ¶ï¼Œè¿™è®©å…¶å…·æœ‰æå¥½çš„ IO æ€§èƒ½ï¼Œæ—¶å¸¸ç”¨äºæœåŠ¡ç«¯çš„åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ã€‚&rdquo;</p>
</blockquote>
<h1 id="2nginx-ä¼˜ç‚¹">2.nginx ä¼˜ç‚¹</h1>
<blockquote>
<p>2.1 æ”¯æŒæµ·é‡é«˜å¹¶å‘ï¼šé‡‡ç”¨ IO å¤šè·¯å¤ç”¨ epollã€‚å®˜æ–¹æµ‹è¯• nginx èƒ½å¤Ÿæ”¯æŒ 5 ä¸‡å¹¶å‘é“¾æ¥ï¼Œå®é™…ç”Ÿäº§ç¯å¢ƒä¸­å¯ä»¥æ”¯æ’‘ 2-4 ä¸‡å¹¶å‘è¿æ¥æ•°ã€‚</p>
<p>2.2 å†…å­˜æ¶ˆè€—å°‘ï¼šåœ¨ä¸»æµçš„æœåŠ¡å™¨ä¸­ nginx ç›®å‰æ˜¯å†…å­˜æ¶ˆè€—æœ€å°çš„äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬ç”¨ nginx+PHPï¼Œåœ¨ 3 ä¸‡å¹¶å‘é“¾æ¥ä¸‹ï¼Œå¼€å¯ 10 ä¸ª nginx è¿›ç¨‹æ¶ˆè€— 150M å†…å­˜ã€‚</p>
<p>2.3 å…è´¹ä½¿ç”¨å¯ä»¥å•†ä¸šåŒ–ï¼šnginx ä¸ºå¼€æºè½¯ä»¶ï¼Œé‡‡ç”¨çš„æ˜¯ 2-clause BSD-like åè®®ï¼Œå¯ä»¥å…è´¹ä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºå•†ä¸šã€‚å¹¶ä¸”é…ç½®ç®€å•</p>
</blockquote>
<h1 id="3nginx-é…ç½®ä»‹ç»">3.nginx é…ç½®ä»‹ç»</h1>
<p><code>nginx.conf</code> æ–‡ä»¶æ˜¯ nginx æ€»é…ç½®æ–‡ä»¶ï¼Œnginx çš„åŸºæœ¬é…ç½®æˆ–è€…è®¾ç½®ä»£ç†ç­‰ç­‰åŸºæœ¬é…ç½®å¯ä»¥åœ¨æ­¤è®¾ç½®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-nginx" data-lang="nginx"><span class="c1">#è¿è¡Œç”¨æˆ·ï¼Œé»˜è®¤å³æ˜¯nginxï¼Œå¯ä»¥ä¸è¿›è¡Œè®¾ç½®
</span><span class="c1"></span><span class="k">user</span>  <span class="s">nginx</span><span class="p">;</span>
<span class="c1">#nginxè¿›ç¨‹ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºå’ŒCPUæ ¸æ•°ä¸€æ ·
</span><span class="c1"></span><span class="k">worker_processes</span>  <span class="mi">1</span><span class="p">;</span>
<span class="c1">#é”™è¯¯æ—¥å¿—å­˜æ”¾ç›®å½•
</span><span class="c1"></span><span class="k">error_log</span>  <span class="s">/var/log/nginx/error.log</span> <span class="s">warn</span><span class="p">;</span>
<span class="c1">#è¿›ç¨‹pidå­˜æ”¾ä½ç½®
</span><span class="c1"></span><span class="k">pid</span>        <span class="s">/var/run/nginx.pid</span><span class="p">;</span>


<span class="k">events</span> <span class="p">{</span>
    <span class="kn">worker_connections</span>  <span class="mi">1024</span><span class="p">;</span> <span class="c1"># å•ä¸ªåå°è¿›ç¨‹çš„æœ€å¤§å¹¶å‘æ•°
</span><span class="c1"></span><span class="p">}</span>


<span class="k">http</span> <span class="p">{</span>
    <span class="kn">include</span>       <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>   <span class="c1">#æ–‡ä»¶æ‰©å±•åä¸ç±»å‹æ˜ å°„è¡¨
</span><span class="c1"></span>    <span class="kn">default_type</span>  <span class="s">application/octet-stream</span><span class="p">;</span>  <span class="c1">#é»˜è®¤æ–‡ä»¶ç±»å‹
</span><span class="c1"></span>    <span class="c1">#è®¾ç½®æ—¥å¿—æ¨¡å¼
</span><span class="c1"></span>    <span class="kn">log_format</span>  <span class="s">main</span>  <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span> <span class="s">&#34;</span><span class="nv">$request&#34;</span> <span class="s">&#39;</span>
                      <span class="s">&#39;</span><span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">&#34;</span><span class="nv">$http_referer&#34;</span> <span class="s">&#39;</span>
                      <span class="s">&#39;&#34;</span><span class="nv">$http_user_agent&#34;</span> <span class="s">&#34;</span><span class="nv">$http_x_forwarded_for&#34;&#39;</span><span class="p">;</span>

    <span class="kn">access_log</span>  <span class="s">/var/log/nginx/access.log</span>  <span class="s">main</span><span class="p">;</span>   <span class="c1">#nginxè®¿é—®æ—¥å¿—å­˜æ”¾ä½ç½®
</span><span class="c1"></span>
    <span class="kn">sendfile</span>        <span class="no">on</span><span class="p">;</span>   <span class="c1">#å¼€å¯é«˜æ•ˆä¼ è¾“æ¨¡å¼
</span><span class="c1"></span>    <span class="c1">#tcp_nopush     on;    #å‡å°‘ç½‘ç»œæŠ¥æ–‡æ®µçš„æ•°é‡
</span><span class="c1"></span>
    <span class="kn">keepalive_timeout</span>  <span class="mi">65</span><span class="p">;</span>  <span class="c1">#ä¿æŒè¿æ¥çš„æ—¶é—´ï¼Œä¹Ÿå«è¶…æ—¶æ—¶é—´
</span><span class="c1"></span>
    <span class="c1">#gzip  on;  #å¼€å¯gzipå‹ç¼©
</span><span class="c1"></span>
    <span class="kn">include</span> <span class="s">/etc/nginx/conf.d/*.conf</span><span class="p">;</span> <span class="c1">#åŒ…å«çš„å­é…ç½®é¡¹ä½ç½®å’Œæ–‡ä»¶
</span></code></pre></td></tr></table>
</div>
</div><p><code>nginx.default.conf</code>ï¼Œnginx å…·ä½“çš„é»˜è®¤é…ç½®ï¼Œä»£ç†ï¼ŒæœåŠ¡é…ç½®ç­‰ç­‰éƒ½å¯ä»¥å†™åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶é‡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span>       <span class="mi">80</span><span class="p">;</span>   <span class="c1">#é…ç½®ç›‘å¬ç«¯å£
</span><span class="c1"></span>    <span class="kn">server_name</span>  <span class="s">localhost</span><span class="p">;</span>  <span class="kn">//é…ç½®åŸŸå</span>

    <span class="c1">#charset koi8-r;
</span><span class="c1"></span>    <span class="c1">#access_log  /var/log/nginx/host.access.log  main;
</span><span class="c1"></span>
    <span class="s">location</span> <span class="s">/</span> <span class="p">{</span>
        <span class="kn">root</span>   <span class="s">/usr/share/nginx/html</span><span class="p">;</span>     <span class="c1">#æœåŠ¡é»˜è®¤å¯åŠ¨ç›®å½•
</span><span class="c1"></span>        <span class="kn">index</span>  <span class="s">index.html</span> <span class="s">index.htm</span><span class="p">;</span>    <span class="c1">#é»˜è®¤è®¿é—®æ–‡ä»¶
</span><span class="c1"></span>    <span class="p">}</span>

    <span class="c1">#error_page  404              /404.html;   # é…ç½®404é¡µé¢
</span><span class="c1"></span>
    <span class="c1"># redirect server error pages to the static page /50x.html
</span><span class="c1"></span>    <span class="c1">#
</span><span class="c1"></span>    <span class="kn">error_page</span>   <span class="mi">500</span> <span class="mi">502</span> <span class="mi">503</span> <span class="mi">504</span>  <span class="s">/50x.html</span><span class="p">;</span>   <span class="c1">#é”™è¯¯çŠ¶æ€ç çš„æ˜¾ç¤ºé¡µé¢ï¼Œé…ç½®åéœ€è¦é‡å¯
</span><span class="c1"></span>    <span class="kn">location</span> <span class="p">=</span> <span class="s">/50x.html</span> <span class="p">{</span>
        <span class="kn">root</span>   <span class="s">/usr/share/nginx/html</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1"># proxy the PHP scripts to Apache listening on 127.0.0.1:80
</span><span class="c1"></span>    <span class="c1">#
</span><span class="c1"></span>    <span class="c1">#location ~ \.php$ {
</span><span class="c1"></span>    <span class="c1">#    proxy_pass   http://127.0.0.1;
</span><span class="c1"></span>    <span class="c1">#}
</span><span class="c1"></span>
    <span class="c1"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
</span><span class="c1"></span>    <span class="c1">#
</span><span class="c1"></span>    <span class="c1">#location ~ \.php$ {
</span><span class="c1"></span>    <span class="c1">#    root           html;
</span><span class="c1"></span>    <span class="c1">#    fastcgi_pass   127.0.0.1:9000;
</span><span class="c1"></span>    <span class="c1">#    fastcgi_index  index.php;
</span><span class="c1"></span>    <span class="c1">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
</span><span class="c1"></span>    <span class="c1">#    include        fastcgi_params;
</span><span class="c1"></span>    <span class="c1">#}
</span><span class="c1"></span>
    <span class="c1"># deny access to .htaccess files, if Apache&#39;s document root
</span><span class="c1"></span>    <span class="c1"># concurs with nginx&#39;s one
</span><span class="c1"></span>    <span class="c1">#
</span><span class="c1"></span>    <span class="c1">#location ~ /\.ht {
</span><span class="c1"></span>    <span class="c1">#    deny  all;
</span><span class="c1"></span>    <span class="c1">#}
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="4nginx-åŸºæœ¬çš„è®¿é—®æƒé™é…ç½®">4.nginx åŸºæœ¬çš„è®¿é—®æƒé™é…ç½®</h1>
<p>ä¾é  deny å’Œ allow è¿™ä¸¤ä¸ªæŒ‡ä»¤ï¼Œå¯ä»¥å®ç°åŸºæœ¬çš„è®¿é—®æƒé™æ§åˆ¶ï¼Œå¦‚ä»¥ä¸‹çš„é…ç½®ï¼Œè¡¨ç¤ºåªå…è®¸<code>45.76.202.231</code>è¿›è¡Œè®¿é—®ï¼Œå…¶ä»–çš„ IP æ˜¯ç¦æ­¢è®¿é—®çš„</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">location</span> <span class="s">/</span> <span class="p">{</span>
        <span class="kn">allow</span>  <span class="mi">45</span><span class="s">.76.202.231</span><span class="p">;</span>
        <span class="kn">deny</span>   <span class="s">all</span><span class="p">;</span>
	<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æœå¯¹äºå…¶ä»–å¤æ‚çš„éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨<a href="http://seanlook.com/2015/05/17/nginx-location-rewrite/" target="_blank" rel="noopener noreffer">æ­£åˆ™</a>å®ç°ã€‚</p>
<h1 id="5nginx-è®¾ç½®è™šæ‹Ÿä¸»æœº">5.nginx è®¾ç½®è™šæ‹Ÿä¸»æœº</h1>
<blockquote>
<p>è™šæ‹Ÿä¸»æœºæ˜¯æŒ‡åœ¨ä¸€å°ç‰©ç†ä¸»æœºæœåŠ¡å™¨ä¸Šåˆ’åˆ†å‡ºå¤šä¸ªç£ç›˜ç©ºé—´ï¼Œæ¯ä¸ªç£ç›˜ç©ºé—´éƒ½æ˜¯ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œæ¯å°è™šæ‹Ÿä¸»æœºéƒ½å¯ä»¥å¯¹å¤–æä¾› Web æœåŠ¡ï¼Œå¹¶ä¸”äº’ä¸å¹²æ‰°ã€‚åœ¨å¤–ç•Œçœ‹æ¥ï¼Œè™šæ‹Ÿä¸»æœºå°±æ˜¯ä¸€å°ç‹¬ç«‹çš„æœåŠ¡å™¨ä¸»æœºï¼Œè¿™æ„å‘³ç€ç”¨æˆ·èƒ½å¤Ÿåˆ©ç”¨è™šæ‹Ÿä¸»æœºæŠŠå¤šä¸ªä¸åŒåŸŸåçš„ç½‘ç«™éƒ¨ç½²åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œè€Œä¸å¿…å†ä¸ºç®€å†ä¸€ä¸ªç½‘ç«™å•ç‹¬è´­ä¹°ä¸€å°æœåŠ¡å™¨ï¼Œæ—¢è§£å†³äº†ç»´æŠ¤æœåŠ¡å™¨æŠ€æœ¯çš„éš¾é¢˜ï¼ŒåŒæ—¶åˆæå¤§åœ°èŠ‚çœäº†æœåŠ¡å™¨ç¡¬ä»¶æˆæœ¬å’Œç›¸å…³çš„ç»´æŠ¤è´¹ç”¨ã€‚</p>
</blockquote>
<p>å…·ä½“åšæ³•æ˜¯ï¼Œåœ¨<code>nginx.default.conf</code>æ·»åŠ å¤šä¸ª serverï¼Œå¯æ ¹æ® ipï¼Œç«¯å£æˆ–åŸŸåæ¥åˆ’åˆ†ï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥è®¿é—®åŒä¸€å°æœåŠ¡å™¨ä¸Šçš„ä¸åŒèµ„æºäº†ï¼Œå€¼å¾—æ³¨æ„æ˜¯ï¼Œå¦‚æœæ˜¯ä½¿ç”¨åŸŸåï¼Œè¿™è¿˜è¦è®©åŸŸåçš„ dns è§£ææŒ‡å‘ä½ çš„æœåŠ¡å™¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">server{</span>
        <span class="s">listen</span> <span class="mi">8001</span><span class="p">;</span>
        <span class="k">server_name</span> <span class="s">localhost</span><span class="p">;</span>
        <span class="k">root</span> <span class="s">/usr/share/nginx/html/html8001</span><span class="p">;</span>
        <span class="k">index</span> <span class="s">index.html</span><span class="p">;</span>
<span class="k">}</span>
<span class="s">server</span><span class="p">{</span>
        <span class="kn">listen</span> <span class="mi">8002</span><span class="p">;</span>
        <span class="kn">server_name</span> <span class="s">localhost</span><span class="p">;</span>
        <span class="kn">root</span> <span class="s">/usr/share/nginx/html/html8002</span><span class="p">;</span>
        <span class="kn">index</span> <span class="s">index.html</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="6nginx-è®¾ç½®åå‘ä»£ç†">6.nginx è®¾ç½®åå‘ä»£ç†</h1>
<p>å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ï¼Œæƒ³è¦è®¿é—® server æœåŠ¡å™¨ä¸Šçš„å†…å®¹ã€‚å‘é€çš„å†…å®¹è¢«å‘é€åˆ°ä»£ç†æœåŠ¡å™¨ä¸Šï¼Œè¿™ä¸ªä»£ç†æœåŠ¡å™¨å†æŠŠè¯·æ±‚å‘é€åˆ°è‡ªå·±è®¾ç½®å¥½çš„å†…éƒ¨æœåŠ¡å™¨ä¸Šï¼Œè€Œç”¨æˆ·çœŸå®æƒ³è·å¾—çš„å†…å®¹å°±åœ¨è¿™äº›è®¾ç½®å¥½çš„æœåŠ¡å™¨ä¸Šï¼Œåå‘ä»£ç†å®é™…ç”Ÿäº§ç¯å¢ƒå¯ä»¥è¯´ç”¨çš„éå¸¸å¤š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">server{</span>
        <span class="s">listen</span> <span class="mi">80</span><span class="p">;</span>
        <span class="k">server_name</span> <span class="s">https://www.baidu.com</span><span class="p">;</span>
        <span class="k">location</span> <span class="s">/</span> <span class="p">{</span>
               <span class="kn">proxy_pass</span> <span class="s">https://www.baidu1.com</span><span class="p">;</span>
        <span class="p">}</span>
<span class="k">}</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼Œå½“ä½ è®¿é—®<code>https://www.baidu.com</code>çš„æ—¶å€™å°±ä¼šå»è¯·æ±‚<code>https://www.baidu1.com</code>çš„èµ„æºäº†ï¼Œä»¥ä¸‹è¿˜æœ‰å¸¸ç”¨çš„åå‘ä»£ç†å‘½ä»¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">proxy_set_header</span> <span class="p">:</span><span class="s">åœ¨å°†å®¢æˆ·ç«¯è¯·æ±‚å‘é€ç»™åç«¯æœåŠ¡å™¨ä¹‹å‰ï¼Œæ›´æ”¹æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚å¤´ä¿¡æ¯ã€‚</span>

<span class="s">proxy_connect_timeout:é…ç½®nginxä¸åç«¯ä»£ç†æœåŠ¡å™¨å°è¯•å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚</span>

<span class="s">proxy_read_timeout</span> <span class="p">:</span> <span class="s">é…ç½®nginxå‘åç«¯æœåŠ¡å™¨ç»„å‘å‡ºreadè¯·æ±‚åï¼Œç­‰å¾…ç›¸åº”çš„è¶…æ—¶æ—¶é—´ã€‚</span>

<span class="s">proxy_send_timeoutï¼šé…ç½®nginxå‘åç«¯æœåŠ¡å™¨ç»„å‘å‡ºwriteè¯·æ±‚åï¼Œç­‰å¾…ç›¸åº”çš„è¶…æ—¶æ—¶é—´ã€‚</span>

<span class="s">proxy_redirect</span> <span class="p">:</span><span class="s">ç”¨äºä¿®æ”¹åç«¯æœåŠ¡å™¨è¿”å›çš„å“åº”å¤´ä¸­çš„Locationå’ŒRefresh</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="7nginx-åŒ¹é…-pc-æˆ–-wap-ç«¯">7.nginx åŒ¹é… PC æˆ– wap ç«¯</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">server{</span>
        <span class="s">listen</span> <span class="mi">80</span><span class="p">;</span>
        <span class="k">server_name</span> <span class="s">nginx2.jspang.com</span><span class="p">;</span>
        <span class="k">location</span> <span class="s">/</span> <span class="p">{</span>
         <span class="kn">root</span> <span class="s">/usr/share/nginx/pc</span><span class="p">;</span>
         <span class="kn">if</span> <span class="s">(</span><span class="nv">$http_user_agent</span> <span class="p">~</span><span class="sr">*</span> <span class="s">&#39;(Android|webOS|iPhone|iPod|BlackBerry)&#39;)</span> <span class="p">{</span>
            <span class="kn">root</span> <span class="s">/usr/share/nginx/mobile</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="kn">index</span> <span class="s">index.html</span><span class="p">;</span>
        <span class="p">}</span>
<span class="k">}</span>
</code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2019-10-25</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://xtidcr.com/nginx%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" data-title="Nginxå­¦ä¹ æ€»ç»“"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://xtidcr.com/nginx%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Hacker News" data-sharer="hackernews" data-url="https://xtidcr.com/nginx%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" data-title="Nginxå­¦ä¹ æ€»ç»“"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://xtidcr.com/nginx%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" data-title="Nginxå­¦ä¹ æ€»ç»“"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://xtidcr.com/nginx%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" data-title="Nginxå­¦ä¹ æ€»ç»“"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/d3.js%E7%BB%98%E5%88%B6%E4%B8%AD%E5%9B%BD%E5%9C%B0%E5%9B%BE/" class="prev" rel="prev" title="D3.jsç»˜åˆ¶ä¸­å›½åœ°å›¾"><i class="fas fa-angle-left fa-fw"></i>D3.jsç»˜åˆ¶ä¸­å›½åœ°å›¾</a>
            <a href="/nodejs%E5%AE%9E%E7%8E%B0excel%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8A%9F%E8%83%BD/" class="next" rel="next" title="Nodejså®ç°excelå¯¼å‡ºæ•°æ®çš„åŠŸèƒ½">Nodejså®ç°excelå¯¼å‡ºæ•°æ®çš„åŠŸèƒ½<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">æ—©èµ·çš„è€å¹´äºº</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/typeit.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":10000},"comment":{},"data":{"id-1":"ä¸‰å—ç»™ä½ ä¹°éº»å‰","id-2":"ä¸‰å—ç»™ä½ ä¹°éº»å‰"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
