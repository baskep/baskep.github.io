<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>useEffectçš„ä½¿ç”¨ - ğŸ‘¨ğŸ»â€ğŸ’»</title><meta name="Description" content="æ—©èµ·çš„å¹´è½»äººåšçš„ç½‘ç«™"><meta property="og:title" content="useEffectçš„ä½¿ç”¨" />
<meta property="og:description" content="react hooksä¸­çš„useEffectæ˜¯ç”¨çš„æœ€é¢‘ç¹ï¼Œä¹Ÿæ˜¯éœ€è¦&#39;&lsquo;å°å¿ƒ&#39;&lsquo;çš„çš„hooksï¼Œå› ä¸ºä¸€æ—¶ä¸ç•™ç¥ï¼Œé¡µé¢å°±é€ æˆäº†æ­»å¾ª" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xtidcr.com/useeffect%E7%9A%84%E4%BD%BF%E7%94%A8/" />
<meta property="og:image" content="https://xtidcr.com/logo.png"/>
<meta property="article:published_time" content="2021-11-15T22:41:34+08:00" />
<meta property="article:modified_time" content="2021-11-15T22:41:34+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://xtidcr.com/logo.png"/>

<meta name="twitter:title" content="useEffectçš„ä½¿ç”¨"/>
<meta name="twitter:description" content="react hooksä¸­çš„useEffectæ˜¯ç”¨çš„æœ€é¢‘ç¹ï¼Œä¹Ÿæ˜¯éœ€è¦&#39;&lsquo;å°å¿ƒ&#39;&lsquo;çš„çš„hooksï¼Œå› ä¸ºä¸€æ—¶ä¸ç•™ç¥ï¼Œé¡µé¢å°±é€ æˆäº†æ­»å¾ª"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="canonical" href="https://xtidcr.com/useeffect%E7%9A%84%E4%BD%BF%E7%94%A8/" /><link rel="prev" href="https://xtidcr.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BC%96%E7%A0%81%E7%9A%84%E7%AE%80%E4%BB%8B/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "useEffectçš„ä½¿ç”¨",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/xtidcr.com\/useeffect%E7%9A%84%E4%BD%BF%E7%94%A8\/"
        },"image": ["https:\/\/xtidcr.com\/images\/Apple-Devices-Preview.png"],"genre": "posts","wordcount":  4731 ,
        "url": "https:\/\/xtidcr.com\/useeffect%E7%9A%84%E4%BD%BF%E7%94%A8\/","datePublished": "2021-11-15T22:41:34+08:00","dateModified": "2021-11-15T22:41:34+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "https:\/\/xtidcr.com\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "æ—©èµ·çš„è€å¹´äºº"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="ğŸ‘¨ğŸ»â€ğŸ’»"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"><i class='fa fa-book'></i> æ–‡ç«  </a><a class="menu-item" href="/categories/"><i class='fa fa-th'></i> åˆ†ç±» </a><a class="menu-item" href="/about/"><i class='fa fa-info-circle'></i> å…³äº </a><a class="menu-item" href="https://github.com/xtid" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i> Github </a><a class="menu-item" href="/links/"><i class='fas fa-user-friends'></i> å‹é“¾ </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="ğŸ‘¨ğŸ»â€ğŸ’»"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title=""><i class='fa fa-book'></i>æ–‡ç« </a><a class="menu-item" href="/categories/" title=""><i class='fa fa-th'></i>åˆ†ç±»</a><a class="menu-item" href="/about/" title=""><i class='fa fa-info-circle'></i>å…³äº</a><a class="menu-item" href="https://github.com/xtid" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>Github</a><a class="menu-item" href="/links/" title=""><i class='fas fa-user-friends'></i>å‹é“¾</a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">useEffectçš„ä½¿ç”¨</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>æ—©èµ·çš„è€å¹´äºº</a></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/%E6%BA%90%E7%A0%81%E7%90%86%E8%A7%A32/"><i class="far fa-folder fa-fw"></i>æºç ç†è§£2</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-11-15">2021-11-15</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 4731 å­—&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 10 åˆ†é’Ÿ&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1useeffectçš„æºç ">1.useEffectçš„æºç </a>
      <ul>
        <li><a href="#11mounteffect">1.1.mountEffect</a></li>
        <li><a href="#12updateeffect">1.2.updateEffect</a></li>
        <li><a href="#13pusheffect">1.3.pushEffect</a></li>
      </ul>
    </li>
    <li><a href="#2useeffectå‚æ•°çš„æ„ä¹‰">2.useEffectå‚æ•°çš„æ„ä¹‰</a></li>
    <li><a href="#3ä½¿ç”¨çš„æŠ€å·§ä»¥åŠå‘">3.ä½¿ç”¨çš„æŠ€å·§ä»¥åŠå‘</a>
      <ul>
        <li><a href="#31åˆæ¬¡æ¸²æŸ“useeffectåªæ‰§è¡Œä¸€æ¬¡">3.1.åˆæ¬¡æ¸²æŸ“useEffectåªæ‰§è¡Œä¸€æ¬¡</a></li>
        <li><a href="#32useeffectçš„ä¾èµ–é¡¹">3.2.useEffectçš„ä¾èµ–é¡¹</a></li>
        <li><a href="#33é—­åŒ…é—®é¢˜">3.3.é—­åŒ…é—®é¢˜</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>react hooksä¸­çš„useEffectæ˜¯ç”¨çš„æœ€é¢‘ç¹ï¼Œä¹Ÿæ˜¯éœ€è¦'&lsquo;å°å¿ƒ'&lsquo;çš„çš„hooksï¼Œå› ä¸ºä¸€æ—¶ä¸ç•™ç¥ï¼Œé¡µé¢å°±é€ æˆäº†æ­»å¾ªç¯ï¼Œåˆæˆ–è€…æ•°æ®ä¸æ›´æ–°ï¼Œåˆæˆ–è€…æ•°æ®è¯·æ±‚ç»“æœä¸å¯¹ï¼Œè¿™ç¯‡æ–‡ç« ä¼šä»‹ç»ä¸€ä¸‹åŸºæœ¬æ¦‚å¿µä»¥åŠæˆ‘çš„ä¸€äº›ä½¿ç”¨å¿ƒå¾—ã€‚</p>
<h1 id="1useeffectçš„æºç ">1.useEffectçš„æºç </h1>
<p>useEffectçš„å…¥å£åœ¨ ReactFiberHooks.jsä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶ï¼Œä¼šåœ¨reactå†…éƒ¨è°ƒåº¦çš„æ—¶å€™(æ¸²æŸ“æˆ–è€…æ›´æ–°)å…ˆè°ƒç”¨renderWithHooksï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæ ¹æ®å½“å‰æ˜¯å¦æœ‰ä¸€ä¸ªhooksé“¾è¡¨æ¥åˆ¤æ–­æ˜¯åˆ›å»ºæ–°çš„hooksé“¾è¡¨è¿˜æ˜¯è°ƒç”¨ç›¸åº”çš„updateæ–¹æ³•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">renderWithHooks</span><span class="p">(</span>
  <span class="nx">current</span><span class="o">:</span> <span class="nx">Fiber</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">workInProgress</span><span class="o">:</span> <span class="nx">Fiber</span><span class="p">,</span>
  <span class="nx">Component</span><span class="o">:</span> <span class="nx">any</span><span class="p">,</span>
  <span class="nx">props</span><span class="o">:</span> <span class="nx">any</span><span class="p">,</span>
  <span class="nx">refOrContext</span><span class="o">:</span> <span class="nx">any</span><span class="p">,</span>
  <span class="nx">nextRenderExpirationTime</span><span class="o">:</span> <span class="nx">ExpirationTime</span><span class="p">,</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">any</span> <span class="p">{</span>
  <span class="nx">renderExpirationTime</span> <span class="o">=</span> <span class="nx">nextRenderExpirationTime</span><span class="p">;</span>
  <span class="c1">// workInProgressè¡¨ç¤ºæ­£åœ¨è°ƒåº¦çš„Fiberä»»åŠ¡
</span><span class="c1"></span>  <span class="nx">currentlyRenderingFiber</span> <span class="o">=</span> <span class="nx">workInProgress</span><span class="p">;</span>
  <span class="c1">// memoizedStateä¸ºæŒ‚è½½çš„hooksé“¾è¡¨
</span><span class="c1"></span>  <span class="nx">firstCurrentHook</span> <span class="o">=</span> <span class="nx">nextCurrentHook</span> <span class="o">=</span>
    <span class="nx">current</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">current</span><span class="p">.</span><span class="nx">memoizedState</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
  
  <span class="c1">// åˆ¤æ–­æ˜¯è°ƒç”¨åˆ›å»ºhooksé“¾è¡¨æ–¹æ³•è¿˜æ˜¯æ›´æ–°hooksæ–¹æ³•
</span><span class="c1"></span>  <span class="c1">// å°†æ–¹æ³•èµ‹äºˆReactCurrentDispatcherï¼Œç”±ReactCurrentDispatcherç»Ÿä¸€è°ƒç”¨
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">__DEV__</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ReactCurrentDispatcher</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span>
      <span class="nx">nextCurrentHook</span> <span class="o">===</span> <span class="kc">null</span>
        <span class="o">?</span> <span class="nx">HooksDispatcherOnMountInDEV</span>
        <span class="o">:</span> <span class="nx">HooksDispatcherOnUpdateInDEV</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">ReactCurrentDispatcher</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span>
      <span class="nx">nextCurrentHook</span> <span class="o">===</span> <span class="kc">null</span>
        <span class="o">?</span> <span class="nx">HooksDispatcherOnMount</span>
        <span class="o">:</span> <span class="nx">HooksDispatcherOnUpdate</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ç„¶åä¼šçœ‹åˆ°HooksDispatcherOnMountInDEVå®šä¹‰ä¸­ï¼Œåˆæ¬¡æ¸²æŸ“çš„æ—¶å€™useEffectè°ƒç”¨çš„æ˜¯mountEffect</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="p">...</span>
<span class="nx">useEffect</span><span class="p">(</span>
  <span class="nx">create</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(()</span> <span class="p">=&gt;</span> <span class="k">void</span><span class="p">)</span> <span class="o">|</span> <span class="k">void</span><span class="p">,</span>
  <span class="nx">deps</span><span class="o">:</span> <span class="nb">Array</span> <span class="o">&lt;</span> <span class="nx">mixed</span> <span class="o">&gt;</span> <span class="o">|</span> <span class="k">void</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span>
<span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
  <span class="nx">currentHookNameInDev</span> <span class="o">=</span> <span class="s1">&#39;useEffect&#39;</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">mountEffect</span><span class="p">(</span><span class="nx">create</span><span class="p">,</span> <span class="nx">deps</span><span class="p">);</span>
<span class="p">},</span>
<span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div><p>ç„¶åæ›´æ–°çš„æ—¶å€™HooksDispatcherOnUpdateInDEVï¼Œè°ƒç”¨çš„æ˜¯updateEffect</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="p">...</span>
<span class="nx">useEffect</span><span class="p">(</span>
  <span class="nx">create</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(()</span> <span class="p">=&gt;</span> <span class="k">void</span><span class="p">)</span> <span class="o">|</span> <span class="k">void</span><span class="p">,</span>
  <span class="nx">deps</span><span class="o">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">mixed</span><span class="o">&gt;</span> <span class="o">|</span> <span class="k">void</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span>
<span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
  <span class="nx">currentHookNameInDev</span> <span class="o">=</span> <span class="s1">&#39;useEffect&#39;</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">updateEffect</span><span class="p">(</span><span class="nx">create</span><span class="p">,</span> <span class="nx">deps</span><span class="p">);</span>
<span class="p">},</span>
<span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="11mounteffect">1.1.mountEffect</h2>
<p>é¦–å…ˆæ˜¯mountEffect</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">mountEffect</span><span class="p">(</span>
  <span class="nx">create</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(()</span> <span class="p">=&gt;</span> <span class="k">void</span><span class="p">)</span> <span class="o">|</span> <span class="k">void</span><span class="p">,</span>
  <span class="nx">deps</span><span class="o">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">mixed</span><span class="o">&gt;</span> <span class="o">|</span> <span class="k">void</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span>
<span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">mountEffectImpl</span><span class="p">(</span>
    <span class="nx">UpdateEffect</span> <span class="o">|</span> <span class="nx">PassiveEffect</span><span class="p">,</span>
    <span class="nx">UnmountPassive</span> <span class="o">|</span> <span class="nx">MountPassive</span><span class="p">,</span>
    <span class="nx">create</span><span class="p">,</span>
    <span class="nx">deps</span><span class="p">,</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­çš„mountEffectImplæ–¹æ³•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">mountEffectImpl</span><span class="p">(</span><span class="nx">fiberEffectTag</span><span class="p">,</span> <span class="nx">hookEffectTag</span><span class="p">,</span> <span class="nx">create</span><span class="p">,</span> <span class="nx">deps</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">hook</span> <span class="o">=</span> <span class="nx">mountWorkInProgressHook</span><span class="p">();</span>
  <span class="kr">const</span> <span class="nx">nextDeps</span> <span class="o">=</span> <span class="nx">deps</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="nx">deps</span><span class="p">;</span>
  <span class="nx">sideEffectTag</span> <span class="o">|=</span> <span class="nx">fiberEffectTag</span><span class="p">;</span>
  <span class="nx">hook</span><span class="p">.</span><span class="nx">memoizedState</span> <span class="o">=</span> <span class="nx">pushEffect</span><span class="p">(</span><span class="nx">hookEffectTag</span><span class="p">,</span> <span class="nx">create</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">nextDeps</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p><code>mountWorkInProgressHook</code> å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„hookï¼Œè€ŒmemoizedStateåˆ™è®°å½•è°ƒç”¨pushEffectåçš„è¿”å›å€¼ï¼Œè¿™ç‚¹å…ˆè®°ä¸‹</p>
<h2 id="12updateeffect">1.2.updateEffect</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">updateEffect</span><span class="p">(</span>
  <span class="nx">create</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(()</span> <span class="p">=&gt;</span> <span class="k">void</span><span class="p">)</span> <span class="o">|</span> <span class="k">void</span><span class="p">,</span>
  <span class="nx">deps</span><span class="o">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">mixed</span><span class="o">&gt;</span> <span class="o">|</span> <span class="k">void</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span>
<span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">updateEffectImpl</span><span class="p">(</span>
    <span class="nx">UpdateEffect</span> <span class="o">|</span> <span class="nx">PassiveEffect</span><span class="p">,</span>
    <span class="nx">UnmountPassive</span> <span class="o">|</span> <span class="nx">MountPassive</span><span class="p">,</span>
    <span class="nx">create</span><span class="p">,</span>
    <span class="nx">deps</span><span class="p">,</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ç„¶åæ˜¯å…¶ä¸­çš„<code>updateEffectImpl</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">updateEffectImpl</span><span class="p">(</span><span class="nx">fiberEffectTag</span><span class="p">,</span> <span class="nx">hookEffectTag</span><span class="p">,</span> <span class="nx">create</span><span class="p">,</span> <span class="nx">deps</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">hook</span> <span class="o">=</span> <span class="nx">updateWorkInProgressHook</span><span class="p">();</span>
  <span class="kr">const</span> <span class="nx">nextDeps</span> <span class="o">=</span> <span class="nx">deps</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="nx">deps</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">destroy</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">currentHook</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">prevEffect</span> <span class="o">=</span> <span class="nx">currentHook</span><span class="p">.</span><span class="nx">memoizedState</span><span class="p">;</span>
    <span class="nx">destroy</span> <span class="o">=</span> <span class="nx">prevEffect</span><span class="p">.</span><span class="nx">destroy</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">nextDeps</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">prevDeps</span> <span class="o">=</span> <span class="nx">prevEffect</span><span class="p">.</span><span class="nx">deps</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">areHookInputsEqual</span><span class="p">(</span><span class="nx">nextDeps</span><span class="p">,</span> <span class="nx">prevDeps</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">pushEffect</span><span class="p">(</span><span class="nx">NoHookEffect</span><span class="p">,</span> <span class="nx">create</span><span class="p">,</span> <span class="nx">destroy</span><span class="p">,</span> <span class="nx">nextDeps</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">sideEffectTag</span> <span class="o">|=</span> <span class="nx">fiberEffectTag</span><span class="p">;</span>
  <span class="nx">hook</span><span class="p">.</span><span class="nx">memoizedState</span> <span class="o">=</span> <span class="nx">pushEffect</span><span class="p">(</span><span class="nx">hookEffectTag</span><span class="p">,</span> <span class="nx">create</span><span class="p">,</span> <span class="nx">destroy</span><span class="p">,</span> <span class="nx">nextDeps</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>1.updateWorkInProgressHookæ˜¯è·å–æ­£åœ¨è°ƒåº¦ä¸­çš„hookï¼Œå½“currentHookä¸ºç©ºçš„æ—¶å€™ï¼Œ<code>updateEffectImpl</code>å’Œ<code>mountEffectImpl</code>çš„é€»è¾‘æ²¡ä»€ä¹ˆåŒºåˆ«</p>
<p>2.å½“<code>currentHook</code>ä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰å¤„ç†çš„hookæœ‰å€¼ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨<code> currentHook.memoizedState</code>ï¼Œæ‹¿åˆ°<code>prevEffect</code>ä¸Šçš„<code>destroy</code>ï¼Œ<code>deps</code>ï¼Œå¤åˆ¶ç»™æ–¹æ³•å†…çš„destroy</p>
<p>3.ç„¶åå¯¹æ¯”<code>nextDeps</code>, <code>prevDeps</code>ï¼Œå¦‚æœç›¸åŒï¼Œä¼šè°ƒç”¨<code> pushEffect(NoHookEffect, create, destroy, nextDeps)</code>ï¼ŒçŒœæµ‹ä¸€ä¸‹ï¼Œä»£è¡¨ä¸æ‰§è¡Œè¿™æ¬¡çš„useEffect</p>
<p>å¦‚æœä¸åŒï¼Œä¼šèµ°åˆ°æœ€åè°ƒç”¨<code>pushEffect</code>ã€‚å…¶å®å°±å¯ä»¥çŒœä¸€ä¸‹ï¼Œè¿™ä¸ªpushEffectå°±æ˜¯è¿”å›çš„ä¸€ä¸ª<code>effect</code>å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¿ç•™äº†<code>useEffect</code>ä¸Šé¢çš„ä¾èµ–(deps)ï¼Œreturnæ–¹æ³•(destroy)ç­‰ç­‰ï¼Œå¹¶å°†è¿™ä¸ª<code>effect</code>å¯¹è±¡ä¿ç•™åœ¨å½“å‰<code>hook</code>çš„<code>memoizedState</code>å¯¹è±¡ä¸Šï¼Œä»¥ä¾¿åç»­updateçš„æ—¶å€™å†å¯¹æ¯”</p>
<h2 id="13pusheffect">1.3.pushEffect</h2>
<p>ä¸‹é¢æ˜¯<code>pushEffect</code>çš„å®šä¹‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">pushEffect</span><span class="p">(</span><span class="nx">tag</span><span class="p">,</span> <span class="nx">create</span><span class="p">,</span> <span class="nx">destroy</span><span class="p">,</span> <span class="nx">deps</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">effect</span><span class="o">:</span> <span class="nx">Effect</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">tag</span><span class="p">,</span>
    <span class="nx">create</span><span class="p">,</span>
    <span class="nx">destroy</span><span class="p">,</span>
    <span class="nx">deps</span><span class="p">,</span>
    <span class="nx">next</span><span class="o">:</span> <span class="p">(</span><span class="kc">null</span><span class="o">:</span> <span class="nx">any</span><span class="p">),</span>
  <span class="p">};</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">componentUpdateQueue</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">componentUpdateQueue</span> <span class="o">=</span> <span class="nx">createFunctionComponentUpdateQueue</span><span class="p">();</span>
    <span class="nx">componentUpdateQueue</span><span class="p">.</span><span class="nx">lastEffect</span> <span class="o">=</span> <span class="nx">effect</span><span class="p">.</span><span class="nx">next</span> <span class="o">=</span> <span class="nx">effect</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">lastEffect</span> <span class="o">=</span> <span class="nx">componentUpdateQueue</span><span class="p">.</span><span class="nx">lastEffect</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">lastEffect</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">componentUpdateQueue</span><span class="p">.</span><span class="nx">lastEffect</span> <span class="o">=</span> <span class="nx">effect</span><span class="p">.</span><span class="nx">next</span> <span class="o">=</span> <span class="nx">effect</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">firstEffect</span> <span class="o">=</span> <span class="nx">lastEffect</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
      <span class="nx">lastEffect</span><span class="p">.</span><span class="nx">next</span> <span class="o">=</span> <span class="nx">effect</span><span class="p">;</span>
      <span class="nx">effect</span><span class="p">.</span><span class="nx">next</span> <span class="o">=</span> <span class="nx">firstEffect</span><span class="p">;</span>
      <span class="nx">componentUpdateQueue</span><span class="p">.</span><span class="nx">lastEffect</span> <span class="o">=</span> <span class="nx">effect</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">effect</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Effectçš„å®šä¹‰
</span><span class="c1"></span><span class="nx">type</span> <span class="nx">Effect</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">tag</span><span class="o">:</span> <span class="nx">HookEffectTag</span><span class="p">,</span> <span class="c1">// ä¸€ä¸ªäºŒè¿›åˆ¶æ•°ï¼Œå®ƒå°†å†³å®š effect çš„è¡Œä¸º
</span><span class="c1"></span>  <span class="nx">create</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(()</span> <span class="p">=&gt;</span> <span class="k">void</span><span class="p">)</span> <span class="o">|</span> <span class="k">void</span><span class="p">,</span> <span class="c1">// ç»˜åˆ¶ååº”è¯¥è¿è¡Œçš„å›è°ƒ
</span><span class="c1"></span>  <span class="nx">destroy</span><span class="o">:</span> <span class="p">(()</span> <span class="p">=&gt;</span> <span class="k">void</span><span class="p">)</span> <span class="o">|</span> <span class="k">void</span><span class="p">,</span> <span class="c1">// ç”¨äºç¡®å®šæ˜¯å¦åº”é”€æ¯å’Œé‡æ–°åˆ›å»º effect
</span><span class="c1"></span>  <span class="nx">deps</span><span class="o">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">mixed</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span> <span class="c1">// å†³å®šé‡ç»˜åˆ¶åæ˜¯å¦æ‰§è¡Œçš„ deps
</span><span class="c1"></span>  <span class="nx">next</span><span class="o">:</span> <span class="nx">Effect</span><span class="p">,</span> <span class="c1">// å‡½æ•°ç»„ä»¶ä¸­å®šä¹‰çš„ä¸‹ä¸€ä¸ª effect çš„å¼•ç”¨
</span><span class="c1"></span><span class="p">};</span>

</code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°pushEffecté‡Œé¢çš„é€»è¾‘ï¼ŒcomponentUpdateQueueæ˜¯ä¸€ä¸ªå­˜å‚¨å½“å‰é¡µé¢effectçš„å˜é‡</p>
<p>1.å½“<code>componentUpdateQueue === null</code>ï¼Œä¹Ÿå°±æ˜¯mountEffectçš„æ—¶å€™ï¼Œå°±åˆ›å»ºä¸€ä¸ªé“¾è¡¨ï¼Œæ”¹ä¸€ä¸‹nextçš„æŒ‡å‘ï¼Œæ–¹ä¾¿åç»­æ·»åŠ </p>
<p>2.å½“å®ƒä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œè¿˜ä¼šåˆ¤æ–­<code>lastEffect</code>çš„å€¼ï¼Œç„¶ålastEffect ä¸ºç©ºçš„æ—¶å€™ï¼Œä»£è¡¨çš„æ˜¯è¿™æ¬¡æ¸²æŸ“é˜¶æ®µä¸­é‡åˆ°çš„ç¬¬ä¸€ä¸ªeffectï¼Œå’Œä¸Šä¸€æ­¥å¤„ç†é€»è¾‘ä¸€æ ·ï¼›å½“lastEffect ä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œå°±å°†componentUpdateQueueé“¾è¡¨æ·»åŠ æ–°çš„effectï¼Œå¹¶æ›´æ–°nextæŒ‡å‘</p>
<p>3.æœ€åä¹Ÿå°±æ˜¯return è¿™ä¸ªæ–°çš„effect</p>
<p>4.ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªpushEffectæ–¹æ³•çš„ä½œç”¨å¦‚ä¸Šè¯´çš„ä¸€æ ·ï¼Œç”¨æ¥åˆ›å»ºeffecté“¾è¡¨æˆ–æ›´æ–°effecté“¾è¡¨ï¼Œæ–¹æ³•é‡Œé¢<code>retrun effect</code>ä¼šæŒ‚è½½åˆ°<code>hook.memoizedState</code>ç”¨äºä¸‹æ¬¡å¯¹è¿™ä¸ªeffectçš„çŠ¶æ€æ¯”è¾ƒ</p>
<p>5.è¿˜æœ‰ä¸€ä¸ªéœ€è¦ä¸»è¦çš„åœ°æ–¹ï¼Œè¿™ä¸ªcomponentUpdateQueueæœ€åä¿å­˜ç€effecté“¾è¡¨ï¼Œå®ƒä¼šæŒ‚è½½åˆ°å½“å‰<code>fiberNode</code>çš„<code>updateQueue</code>å¯¹è±¡ä¸Šï¼Œç„¶åä¼šä¾æ¬¡å»è°ƒç”¨ï¼Œç¢°åˆ°äº†<code>NoHookEffect</code>ä¼šè·³è¿‡è¿™ä¸ªeffectä»£è¡¨æ— é¡»æ‰§è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">fiber</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">child</span> <span class="c1">// å­èŠ‚ç‚¹
</span><span class="c1"></span>  <span class="nx">sibling</span> <span class="c1">// å…„å¼ŸèŠ‚ç‚¹
</span><span class="c1"></span>  <span class="nx">memoizedState</span> <span class="c1">// ä¿å­˜æ‰€æœ‰hooksé“¾è¡¨
</span><span class="c1"></span>  <span class="nx">updateQueue</span> <span class="c1">// effecté“¾è¡¨
</span><span class="c1"></span>  <span class="k">return</span> <span class="c1">// çˆ¶èŠ‚ç‚¹
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="2useeffectå‚æ•°çš„æ„ä¹‰">2.useEffectå‚æ•°çš„æ„ä¹‰</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// code
</span><span class="c1"></span>  <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// code
</span><span class="c1"></span>  <span class="p">}</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">deps</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><p>é‡Œé¢returnå›è°ƒä¼šåœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™è°ƒç”¨ï¼›[deps]åˆ™æ˜¯æ•°ç»„é‡Œé¢çš„å˜é‡æ›´æ–°åuseEffectä¼šé‡æ–°æ‰§è¡Œï¼Œå…¶å†…éƒ¨å°±åƒä¸Šé¢æºç è¯´çš„ï¼Œä¼šè°ƒç”¨areHookInputsEqualå…ˆè¿›è¡Œå¯¹æ¯”</p>
<h1 id="3ä½¿ç”¨çš„æŠ€å·§ä»¥åŠå‘">3.ä½¿ç”¨çš„æŠ€å·§ä»¥åŠå‘</h1>
<h2 id="31åˆæ¬¡æ¸²æŸ“useeffectåªæ‰§è¡Œä¸€æ¬¡">3.1.åˆæ¬¡æ¸²æŸ“useEffectåªæ‰§è¡Œä¸€æ¬¡</h2>
<p>æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šä¸€ä¸ªçˆ¶ç»„ä»¶åŒ…å«ä¸€ä¸ªå­ç»„ä»¶ï¼Œå­ç»„ä»¶çš„æ•°æ®ä¾èµ–çˆ¶ç»„ä»¶ä¼ å…¥ï¼Œçˆ¶ç»„ä»¶ä¼šåœ¨ä¸€å¼€å§‹useEffectè¿›è¡Œå¼‚æ­¥è¯·æ±‚ï¼Œæ›´æ”¹å­ç»„ä»¶ä¾èµ–çš„æ•°æ®ï¼Œå­ç»„ä»¶å†å†™ä¸€ä¸ªuseEffectå»ä¾èµ–çˆ¶ç»„ä»¶ä¼ å…¥çš„æ•°æ®å†è¿›è¡Œç›¸åº”çš„æ“ä½œï¼Œå¦‚ä¸‹ä»£ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">Test</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">name</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;useEffect&#34;</span><span class="p">);</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">name</span><span class="p">]);</span>

  <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;;</span>
<span class="p">};</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">name</span><span class="p">,</span> <span class="nx">setName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">setName</span><span class="p">(</span><span class="s1">&#39;å­ç»„ä»¶&#39;</span><span class="p">)</span>
    <span class="p">},</span> <span class="mi">300</span><span class="p">)</span>
  <span class="p">},</span> <span class="p">[])</span>

  <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Test</span> <span class="nx">name</span><span class="o">=</span><span class="p">{</span><span class="nx">name</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="err">/Test&gt;;</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>è¿™æ®µä»£ç çš„ç¼ºç‚¹åœ¨äºå­ç»„ä»¶çš„<code>useEffect</code>ä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Œå› ä¸ºuseEffectä¸ç®¡ä¾èµ–æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œåœ¨åˆæ¬¡æ¸²æŸ“è°ƒç”¨<code>pushEffect</code>çš„æ—¶å€™æ˜¯ä¼šè°ƒç”¨ä¸€æ¬¡çš„</p>
<p>åœ¨æ­¤æ®µä»£ç ä¸­ï¼Œå¦‚æœåœ¨å­ç»„ä»¶Testä¸­çš„useEffectè¿›è¡Œäº†æ¥å£è¯·æ±‚ï¼Œé‚£ä¹ˆåœ¨ä¸€å¼€å§‹å°±ä¼šè°ƒç”¨ä¸¤æ¬¡ï¼Œè¿™ä¼šé€ æˆç½‘ç»œèµ„æºçš„æµªè´¹ï¼Œå¹¶ä¸”å¦‚æœå¼‚æ­¥æ¥å£çš„å“åº”æ—¶é—´ç›¸åäº†ï¼Œåè°ƒç”¨çš„å…ˆè¿”å›äº†ï¼Œé‚£è¿™ä¸ªé¡µé¢çš„æ•°æ®ä¹Ÿå°±ä¸æ­£å¸¸äº†ï¼Œè¿™å°±æ˜¯éšæ‚£</p>
<p>è§£å†³åŠæ³•ï¼š</p>
<p>1.åœ¨Testç»„ä»¶ä¸­ä¸€å¼€å§‹å¯¹nameå±æ€§è¿›è¡Œä¸€ä¸ªç©ºå€¼çš„åˆ¤æ–­ï¼Œç”¨äºè¿‡æ»¤æ— æ•ˆçš„è¯·æ±‚ï¼Œå½“ç„¶è¿™æ˜¯æ¡ä»¶æ¯”è¾ƒç‰¹åˆ«(åˆå§‹åŒ–å€¼ä¸ºç©º)æ‰ä¼šè¿™ä¹ˆåš</p>
<p>2.é…åˆ<code>useRef</code>ä½¿ç”¨ï¼ŒuseRefä¸åŒäºuseStateéœ€è¦æ‰‹åŠ¨setå€¼çš„æ”¹å˜ï¼ŒuseRefä¸ä»…ä»…ç”¨äºä¿å­˜domå…ƒç´ çš„åº”ç”¨ï¼Œå®ƒçš„currentå±æ€§è¿˜å¯ä»¥ä¿ç•™å“åº”å¼å€¼ã€‚é‚£è¿™é‡Œæˆ‘åˆ›å»ºä¸€ä¸ªå±æ€§<code>isMounted</code>ä»£è¡¨æ˜¯å¦æ˜¯<code>updateEffect</code>é˜¶æ®µï¼Œç”¨äºè¿‡æ»¤ç¬¬ä¸€æ¬¡è°ƒç”¨çš„effcet</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">Test</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">name</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// isMountedä»£è¡¨åˆæ¬¡æ¸²æŸ“æ˜¯å¦å®Œæˆ
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">isMounted</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isMounted</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">isMounted</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;useEffect&#34;</span><span class="p">);</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">name</span><span class="p">]);</span>

  <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;;</span>
<span class="p">};</span>

</code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·å°±èƒ½è¿‡æ»¤æ‰ç¬¬ä¸€æ¬¡å¤šä½™çš„è°ƒç”¨ï¼Œè¿™ä¸ªæŠ€å·§åœ¨useEffectè¿‡å¤šæˆ–è€…ä¾èµ–é¡¹å¤æ‚çš„æ—¶å€™è¿˜æ˜¯æ¯”è¾ƒå®ç”¨çš„ï¼›åŒæ ·çš„ï¼Œå¦‚æœæ˜¯å¤šæ¬¡è°ƒç”¨æ¥å£çš„åœºæ™¯ï¼Œä¹Ÿå¯ä»¥ç”¨è¿™æ ·ä¸€ä¸ªå˜é‡æ¥æ§åˆ¶è¯·æ±‚æ˜¯å¦å‘èµ·ï¼Œä»è€Œä¿è¯å¼‚æ­¥æ¥å£çš„é¡ºåº</p>
<h2 id="32useeffectçš„ä¾èµ–é¡¹">3.2.useEffectçš„ä¾èµ–é¡¹</h2>
<p>ä¸Šé¢çš„ä»£ç æ”¹é€ ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåä¸º<code>obj</code>çš„stateï¼Œè€Œå½“æˆ‘ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™ï¼Œä¼šsetObjä¸€ä¸ªç©ºå¯¹è±¡ï¼Œè€Œè¿™æ—¶useEffectå´ä¼šæ‰§è¡Œ<code>console.log</code>è¯­å¥ï¼Œä»è¡¨é¢ä¸Šçœ‹<code>obj</code>çš„å±æ€§å¹¶æ²¡æœ‰æ”¹å˜ï¼ŒæŒ‰ä¸€èˆ¬çš„æœŸæœ›ï¼Œåº”è¯¥æ˜¯<code>obj</code>æ”¹äº†æ‰ä¼šæ‰§è¡Œæ‰å¯¹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">isMounted</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">setObj</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">({</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;&#34;</span>
  <span class="p">});</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isMounted</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">isMounted</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;useEffect&#34;</span><span class="p">);</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">obj</span><span class="p">]);</span>

  <span class="kr">const</span> <span class="nx">handleChangeObjValue</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setObj</span><span class="p">({</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;&#34;</span>
    <span class="p">});</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleChangeObjValue</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">æŒ‰é’®</span><span class="o">&lt;</span><span class="err">/button&gt;;</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>é€ æˆè¿™ç§ç°è±¡çš„åŸå› ï¼Œè¿˜æ˜¯å¯ä»¥ä»æºç ä¸­çœ‹åˆ°ï¼Œåœ¨<code>updateEffectImpl</code>ä¸­ä¼šè°ƒç”¨<code>areHookInputsEqual</code>è¿™ä¸ªæ–¹æ³•æ¥éå†useEffectä¸­çš„ä¾èµ–ï¼Œæ¥å¯¹æ¯”æ¯ä¸ªä¾èµ–é¡¹æ˜¯å¦ç›¸åŒï¼Œå¦‚æœæœ‰ä¸€ä¸ªä¸åŒï¼Œå°±è¿”å›falseï¼Œè¿”å›falseä¹‹åå°±ä¼šèµ°<code>hook.memoizedState = pushEffect(hookEffectTag, create, destroy, nextDeps)</code>ä¹Ÿå°±æ˜¯ä¸Šé¢è¯´çš„æ›´æ–°effecté“¾è¡¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// updateEffectImplæ–¹æ³•
</span><span class="c1"></span><span class="p">...</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">areHookInputsEqual</span><span class="p">(</span><span class="nx">nextDeps</span><span class="p">,</span> <span class="nx">prevDeps</span><span class="p">))</span> <span class="p">{</span>
   <span class="nx">pushEffect</span><span class="p">(</span><span class="nx">NoHookEffect</span><span class="p">,</span> <span class="nx">create</span><span class="p">,</span> <span class="nx">destroy</span><span class="p">,</span> <span class="nx">nextDeps</span><span class="p">);</span>
   <span class="k">return</span><span class="p">;</span>
 <span class="p">}</span>

<span class="nx">sideEffectTag</span> <span class="o">|=</span> <span class="nx">fiberEffectTag</span><span class="p">;</span>
<span class="nx">hook</span><span class="p">.</span><span class="nx">memoizedState</span> <span class="o">=</span> <span class="nx">pushEffect</span><span class="p">(</span><span class="nx">hookEffectTag</span><span class="p">,</span> <span class="nx">create</span><span class="p">,</span> <span class="nx">destroy</span><span class="p">,</span> <span class="nx">nextDeps</span><span class="p">);</span>
<span class="p">...</span>

<span class="c1">// areHookInputsEqualæ–¹æ³•
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">areHookInputsEqual</span><span class="p">(</span>
  <span class="nx">nextDeps</span><span class="o">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">mixed</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">prevDeps</span><span class="o">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">mixed</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">prevDeps</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
  	<span class="p">...</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">...</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">prevDeps</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">nextDeps</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">is</span><span class="p">(</span><span class="nx">nextDeps</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">prevDeps</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>areHookInputsEqual</code>é‡Œé¢çš„isæ˜¯åŸºäº<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/is" target="_blank" rel="noopener noreffer">Object.is</a>ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸Šé¢çš„ä»£ç <code>setObj</code>è®¾ç½®æ–°çš„å¯¹è±¡çš„æ—¶å€™useEffectå†…éƒ¨ä¸æ—§çš„ä¾èµ–å¯¹æ¯”çš„æ—¶å€™æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œæ‰€ä»¥ä¼šæ‰§è¡Œè¿™ä¸ªeffectï¼Œå› ä¸º<code>{}</code>è¯­æ³•æœ¬æ¥å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ‰€ä»¥ä¸¤è€…å¯¹æ¯”ä¼šè¿”å›falseã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨å†™çš„æ—¶å€™è¦å†™æ˜ç™½æˆ‘ä»¬æ‰€éœ€çš„ä¾èµ–ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™ä¼šæ˜¯ä¸€ä¸ªåŸºæœ¬ç±»å‹çš„å€¼(å½“ç„¶ä¹Ÿæœ‰å…¶å®ƒå¯¹è±¡ã€æ•°ç»„ç­‰å¼•ç”¨ç±»å‹çš„å€¼)ï¼Œè€Œä¸æ˜¯ä¸€è‚¡è„‘çš„ç›´æ¥æ‰”ä¸€ä¸ªå¯¹è±¡åˆ°[]ä¸­å°±å®Œäº‹äº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;useEffect&#34;</span><span class="p">);</span>
  <span class="c1">// å†™æ˜ä¾èµ–obj.name
</span><span class="c1"></span><span class="p">},</span> <span class="p">[</span><span class="nx">obj</span><span class="p">.</span><span class="nx">name</span><span class="p">]);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="33é—­åŒ…é—®é¢˜">3.3.é—­åŒ…é—®é¢˜</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">Test</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">playing</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="p">[</span><span class="nx">count</span><span class="p">,</span> <span class="nx">setCount</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">timer</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">playing</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
      <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">playingm</span><span class="p">,</span> <span class="nx">count</span><span class="p">]);</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;App&#34;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">count</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">playing</span><span class="p">,</span> <span class="nx">setPlaying</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;App&#34;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="nx">setPlaying</span><span class="p">(</span><span class="o">!</span><span class="nx">playing</span><span class="p">)}</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="nx">playing</span> <span class="o">?</span> <span class="s2">&#34;æ’­æ”¾&#34;</span> <span class="o">:</span> <span class="s2">&#34;æš‚åœ&#34;</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="err">/button&gt;</span>
      <span class="o">&lt;</span><span class="nx">Test</span> <span class="nx">playing</span><span class="o">=</span><span class="p">{</span><span class="nx">playing</span><span class="p">}</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>è¿™æ®µä»£ç æƒ³è¦å®ç°çš„æ•ˆæœæ˜¯ï¼Œåœ¨ç‚¹å‡»æ’­æ”¾çš„æ—¶å€™ï¼Œcountèƒ½æ¯ä¸€ç§’éƒ½+1ï¼Œå¹¶ä¸”æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚è€Œå®é™…çš„æ•ˆæœæ˜¯é¡µé¢ä¸Šçš„countå¹¶ä¸ä¼šå˜ï¼Œå› ä¸ºåœ¨<code>useEffect</code>å®šä¹‰çš„<code>setInterval</code>ä¼šäº§ç”Ÿä¸€ä¸ªé—­åŒ…ï¼Œä¸€ç›´å¼•ç”¨ç€æœ€åˆçš„countï¼Œå¯¼è‡´æ¯æ¬¡<code>setCount</code>çš„å€¼ä¸€ç›´æ²¡å˜ï¼Œæ‰€ä»¥é¡µé¢ä¹Ÿå°±æ²¡æœ‰åˆ·æ–°ï¼Œè§£å†³çš„åŠæ³•ï¼š</p>
<p>1.å°†countæ·»åŠ åˆ°useEffectçš„ä¾èµ–é¡¹ä¸­ï¼Œè®©setIntervalæ¯æ¬¡èƒ½å¤Ÿå¼•ç”¨åˆ°æœ€æ–°çš„countå€¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">timer</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">playing</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">playing</span><span class="p">,</span> <span class="nx">count</span><span class="p">]);</span>


</code></pre></td></tr></table>
</div>
</div><p>è¿™ç§æ–¹å¼ç¡®å®èƒ½è§£å†³countæœªæ”¹å˜çš„é—®é¢˜ï¼Œä½†æ˜¯å®ƒæ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®šæ—¶å™¨å¯¹è±¡ï¼Œè¿™å¯¹äºæµè§ˆå™¨æ€§èƒ½æ¥è¯´æ˜¯æ˜¯ä¸å‹å¥½çš„</p>
<p>2.æˆ‘ä»¬éœ€è¦ä¸€ç§ä¸è®²countæ”¾è¿›useEffectä¾èµ–é¡¹çš„è§£å†³æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨<code>useState</code>ä¸­çš„å›è°ƒå‡½æ•°ï¼Œæ¯æ¬¡æ‹¿åˆ°ä¸Šä¸€æ¬¡æ›´æ–°çš„å€¼ï¼Œç„¶ååœ¨è¿›è¡Œè¿™ä¸€æ¬¡æ›´æ–°æ“ä½œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">timer</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">playing</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// ä½¿ç”¨å›è°ƒæ‹¿åˆ°ä¸Šä¸€æ¬¡æ›´æ–°åçš„å€¼ï¼Œä¿è¯æ¯æ¬¡çš„å€¼æ˜¯æœ€æ–°çš„
</span><span class="c1"></span>      <span class="c1">// è¿™ä¸ªæ˜¯reactæ‰€æä¾›çš„api
</span><span class="c1"></span>      <span class="nx">setCount</span><span class="p">(</span><span class="nx">v</span> <span class="p">=&gt;</span> <span class="nx">v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">playing</span><span class="p">]);</span>

</code></pre></td></tr></table>
</div>
</div><p>3.è¿˜æœ‰ä¸€ç§æ–¹å¼ï¼Œåœ¨<code>setInterval</code>é—­åŒ…ä¸­å¯¹å½“å‰å¼•ç”¨çš„å˜é‡è¿›è¡Œä¿®æ”¹ï¼Œè¿™æ ·é—­åŒ…å†…æ‰€å¼•ç”¨çš„å˜é‡çš„å°±ä¼šå˜åŒ–ï¼Œåœ¨é€šè¿‡<code>set</code>æ“ä½œï¼Œå°†å¤–å±‚çš„å“åº”å¼å˜é‡æ›´é«˜ï¼Œä»è€Œé‡æ–°æ¸²æŸ“é¡µé¢</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">timer</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">playing</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// å¯¹é—­åŒ…å†…å¼•ç”¨çš„countè¿›è¡Œä¿®æ”¹
</span><span class="c1"></span>      <span class="c1">// setCountårender
</span><span class="c1"></span>      <span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span><span class="o">++</span><span class="p">)</span>
    <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">playing</span><span class="p">]);</span>
</code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2021-11-15</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://xtidcr.com/useeffect%E7%9A%84%E4%BD%BF%E7%94%A8/" data-title="useEffectçš„ä½¿ç”¨"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://xtidcr.com/useeffect%E7%9A%84%E4%BD%BF%E7%94%A8/"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Hacker News" data-sharer="hackernews" data-url="https://xtidcr.com/useeffect%E7%9A%84%E4%BD%BF%E7%94%A8/" data-title="useEffectçš„ä½¿ç”¨"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://xtidcr.com/useeffect%E7%9A%84%E4%BD%BF%E7%94%A8/" data-title="useEffectçš„ä½¿ç”¨"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://xtidcr.com/useeffect%E7%9A%84%E4%BD%BF%E7%94%A8/" data-title="useEffectçš„ä½¿ç”¨"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BC%96%E7%A0%81%E7%9A%84%E7%AE%80%E4%BB%8B/" class="prev" rel="prev" title="è®¡ç®—æœºç¼–ç çš„ç®€ä»‹"><i class="fas fa-angle-left fa-fw"></i>è®¡ç®—æœºç¼–ç çš„ç®€ä»‹</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">æ—©èµ·çš„è€å¹´äºº</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/typeit.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":10000},"comment":{},"data":{"id-1":"ä¸‰å—ç»™ä½ ä¹°éº»å‰","id-2":"ä¸‰å—ç»™ä½ ä¹°éº»å‰"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
