<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  
  
  
  
  <link rel="prev" href="https://xtid.github.io/2021/%E5%89%8D%E7%AB%AF%E7%9A%84%E6%A8%A1%E5%9D%97%E8%A7%84%E8%8C%83%E7%AE%80%E8%BF%B0%E4%BB%A5%E5%8F%8A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAumd-loader%E6%96%B9%E6%B3%95/" />
  
  <link rel="canonical" href="https://xtid.github.io/2021/webpack5%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7%E4%BB%A5%E5%8F%8A%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E9%85%8D%E7%BD%AE/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" sizes="32x32" href="/favicon.ico">
  <link rel="icon" sizes="16x16" href="/favicon.ico">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           Webpack5的新特性以及项目实战配置 | 👨🏻‍💻
       
  </title>
  <meta name="title" content="Webpack5的新特性以及项目实战配置 | 👨🏻‍💻">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/xtid.github.io"
    },
    "articleSection" : "posts",
    "name" : "Webpack5的新特性以及项目实战配置",
    "headline" : "Webpack5的新特性以及项目实战配置",
    "description" : "前言 webpack5也已经发布了(2021.08)接进一年了，之前刚出来的时候还有些坑也不敢急着实际应用在项目中，现在官方的bug也修的差不",
    "inLanguage" : "zh-CN",
    "author" : "",
    "creator" : "",
    "publisher": "",
    "accountablePerson" : "",
    "copyrightHolder" : "",
    "copyrightYear" : "2021",
    "datePublished": "2021-08-03 22:34:03 \x2b0800 CST",
    "dateModified" : "2021-08-03 22:34:03 \x2b0800 CST",
    "url" : "https:\/\/xtid.github.io\/2021\/webpack5%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7%E4%BB%A5%E5%8F%8A%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E9%85%8D%E7%BD%AE\/",
    "wordCount" : "2541",
    "keywords" : [  "👨🏻‍💻"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://xtid.github.io">👨🏻‍💻</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/links/" title="">Links</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://xtid.github.io">👨🏻‍💻</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/links/" title="">Links</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Webpack5的新特性以及项目实战配置</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://xtid.github.io" rel="author"></a> with ♥ 
                <span class="post-time">
                on <time datetime=2021-08-03 itemprop="datePublished">August 3, 2021</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://xtid.github.io/categories/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/"> 日常学习 </a>
                        
                </span>
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          

<h3 id="前言">前言</h3>

<p>webpack5也已经发布了(2021.08)接进一年了，之前刚出来的时候还有些坑也不敢急着实际应用在项目中，现在官方的bug也修的差不多了，我也实际在项目中运用了下，所以现在做个总结</p>

<h3 id="新特性">新特性</h3>

<h4 id="1-用持久性缓存来提高构建性能">1.用持久性缓存来提高构建性能</h4>

<p>在webpack4中，我们可以通过cache-loader等手段来将编译的结果写入到磁盘中，现在可以直接通过设置将编译结果缓存到文件系统中</p>

<p>type：<code>string: 'memory' | 'filesystem'</code> ，将 <code>cache</code> 类型设置为内存或者文件系统</p>

<p>buildDependencies：<code>object</code>，针对构建的额外代码依赖的数组对象。webpack 将使用这些项和所有依赖项的哈希值来使文件系统缓存失效</p>

<pre><code class="language-javascript">cache: {
  type: 'filesystem', // 将缓存类型设置为文件系统，默认为memory
  buildDependencies: {
    config: [__filename], // 这样设置后webpack能获取最新的配置以及依赖项来重新缓存
  },
},
</code></pre>

<h4 id="2-对资源实现了内部支持而不需要额外的loader">2.对资源实现了内部支持而不需要额外的loader</h4>

<p><code>asset/resource</code> 发送一个单独的文件并导出 URL。之前通过使用 file-loader 实现。</p>

<p><code>asset/inline</code> 导出一个资源的 data URI。之前通过使用 url-loader 实现。</p>

<p><code>asset/source</code> 导出资源的源代码。之前通过使用 raw-loader 实现。</p>

<p><code>asset</code> 在导出一个 data URI 和发送一个单独的文件之间自动选择。之前通过使用 url-loader，并且配置资源体积限制实现</p>

<pre><code class="language-javascript">module.export = {
  module: {
    rules: [{
      test: /\.png$/,
      type: &quot;asset/resource&quot;, //对应file-loader
    },
    {
      test: /\.svg$/,
      type: &quot;asset/inline&quot;, //对应url-loader 大小&lt;limt 转化为base64
    },
    {
      test: /\.txt$/,
      type: &quot;asset/source&quot;, //对应raw-loader
    },
    {
      test: /\.gif$/,
      type: &quot;asset&quot;, //自动选择
      parser: {
        dataUrlCondition: {
          maxSize: 4 * 1024,
        },
      },
    }],
  },
}
</code></pre>

<h4 id="3-用更好的-tree-shaking-和代码生成来改善包大小">3.用更好的 Tree Shaking 和代码生成来改善包大小</h4>

<p>现在的Tree Shaking 能够完全剔除未使用的代码，同样使用ES6模块，并开起production mode；并且现在能处理对 Commonjs 的 tree shaking，<strong>允许消除未使用的CommonJs导出并跟踪require()调用中引用的导出名称</strong>，在打包出的文件中可以看到最终的代码。</p>

<h4 id="4-moduleids-chunkids-content-hash-的优化">4.moduleIds &amp; chunkIds &amp; content hash 的优化</h4>

<p><strong>moduleIds &amp; chunkIds的优化</strong></p>

<p>在webpack5以前，没有从entry打包的chunk文件，都会以1，2，3&hellip;的文件命名方式输出，文件名称后的hash值是用chunkhash生成的。这样会造成当删除或者暂时不用1.js这个文件后，那么重新打包时2.js-&gt;1.js,3.js-&gt;2.js，这样会造成原来线上的2.js和3.js缓存失效。</p>

<p>webpack5为了确保moduleId，chunkId 的确定性， 增加了如下配置：</p>

<p><code>optimization.moduleIds</code></p>

<table>
<thead>
<tr>
<th align="left">选荐值</th>
<th align="center">描述</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><code>natural</code></td>
<td align="center">按使用顺序的数字 id。</td>
</tr>

<tr>
<td align="left"><code>named</code></td>
<td align="center">对调试更友好的可读的 id。</td>
</tr>

<tr>
<td align="left"><code>deterministic</code></td>
<td align="center">被哈希转化成的小位数值模块名。</td>
</tr>

<tr>
<td align="left"><code>size</code></td>
<td align="center">专注于让初始下载包大小更小的数字 id。</td>
</tr>
</tbody>
</table>

<p><code>deterministic</code> 选项有益于长期缓存，但对比于 <code>hashed</code> 来说，它会导致更小的文件 bundles。数字值的长度会被选作用于填满最多 80%的 id 空间。 当 <code>optimization.moduleIds</code> 被设置成 <code>deterministic</code>，默认最小 3 位数字会被使用。deterministic配置在生产模式下是默认开启）</p>

<pre><code class="language-javascript">optimization.moduleIds = 'deterministic'
optimization.chunkIds = 'deterministic'
</code></pre>

<p>当然在开发模式下，可以设置成<code>natural</code>以保持以前的老模式</p>

<p><strong>content hash的优化</strong></p>

<p>之前使用content hash的时候，当改动文件内容的时候content hash会重新生成；而现在Webpack 5 将使用真正的文件内容哈希值，也就是说当进行了修改注释或者修改变量名等代码逻辑是没有影响的操作时，文件内容的变更不会导致 contenthash 变化。</p>

<h4 id="5-支持生成es6-es2015的代码">5.支持生成ES6/ES2015的代码</h4>

<p>webpack 4 默认只能输出 ES5 代码，现在支持指定环境，然后生成该环境的一个代码</p>

<blockquote>
<p><code>target</code></p>

<p><code>string</code> <code>[string]</code> <code>false</code></p>

<p>告知 webpack 为目标(target)指定一个环境。默认值为 <code>&quot;browserslist&quot;</code>，如果没有找到 browserslist 的配置，则默认为 <code>&quot;web&quot;</code></p>
</blockquote>

<p>然后我们设置</p>

<p><code>target: ['web', 'es5']</code></p>

<p>webpack 将生成 web 平台的运行时代码，并且只使用 ES5 相关的特性</p>

<h4 id="6-移除了-node-js-polyfills">6.移除了 Node.js Polyfills</h4>

<blockquote>
<p>在早期，webpack 的目的是为了让大多数的 Node.js 模块运行在浏览器中，但如今模块的格局已经发生了变化，现在许多模块主要是为前端而编写。webpack &lt;= 4 的版本中提供了许多 Node.js 核心模块的 polyfills，一旦某个模块引用了任何一个核心模块（如 <code>cypto</code> 模块），webpack 就会自动引用这些 polyfills。</p>

<p>尽管这会使得使用为 Node.js 编写模块变得容易，但它在构建时给 bundle 附加了庞大的 polyfills。在大部分情况下，这些 polyfills 并非必须。</p>

<p>从 webpack 5 开始不再自动填充这些 polyfills，而会专注于前端模块兼容。我们的目标是提高 web 平台的兼容性。</p>

<p><strong>迁移</strong>：</p>

<ul>
<li>尽量使用前端兼容的模块。</li>
<li>可以手动为 Node.js 核心模块添加 polyfill。错误提示会告诉你如何实现。</li>
<li>Package 作者：在 <code>package.json</code> 中添加 <code>browser</code> 字段，使 package 与前端兼容。为浏览器提供其他的实现/dependencies。</li>
</ul>
</blockquote>

<h4 id="7-module-federation">7.Module Federation</h4>

<blockquote>
<p>多个独立的构建可以组成一个应用程序，这些独立的构建之间不应该存在依赖关系，因此可以单独开发和部&gt;署它们。</p>

<p>这通常被称作微前端，但并不仅限于此。</p>
</blockquote>

<p>简单来说就是允许一个应用中动态地去加载和引入另一个应用的代码，就好像本地起一个应用作CDN库，其它地方去引用，具体可以看<a href="https://webpack.docschina.org/concepts/module-federation/" rel="nofollow noreferrer" target="_blank">官方配置</a>，个人感觉并不是特别的实用</p>

<h3 id="项目实战">项目实战</h3>

<p>首先定义一个webpack.config.base.js，即开发环境以及生产环境都需要的配置</p>

<pre><code class="language-javascript">const path = require('path')
const { CleanWebpackPlugin } = require('clean-webpack-plugin')
const HtmlWebpackPlugin = require('html-webpack-plugin')
const MiniCssExtractPlugin = require(&quot;mini-css-extract-plugin&quot;)

module.exports = {
  entry: './src/index.js', 
  output: {
    filename: '[name].[chunkhash].bundle.js',
    path: path.resolve(__dirname, 'dist') 
  },
  module: {
    rules: [{
        test: /\.m?js$/,
        exclude: /node_modules/,
        use: {
          loader: 'babel-loader', 
        }
      },
      {
        test: /\.s[ac]ss$/, 
        use: [MiniCssExtractPlugin.loader, 'css-loader', 'sass-loader']
      },
      {
        test: /\.(png|svg|jpg|gif|webp|jfif)$/,
        use: [{
          loader: 'url-loader',
          options: {
            limit: 1024 * 100,
            name: 'assets/[name]_[hash:10].[ext]'
          }
        }]
      }
    ]
  },
  plugins: [
    new CleanWebpackPlugin({ // 每次打包前删除dist文件夹中的文件
      cleanOnceBeforeBuildPatterns: ['**/*', '!favicon.ico', '!lib/**'], // dist文件夹下的favicon.ico文件和lib文件夹下的东西都忽略不进行删除
    }),
    new HtmlWebpackPlugin({
      template: 'index.html', 
      favicon: 'favicon.ico', 
      inject: 'head' 
    }),
    new MiniCssExtractPlugin({
      filename: '[name]-[contenthash].css'
    }),
  ],
};
</code></pre>

<p>然后配置webpack.config.dev.js，开发环境主要配置代理服务器，代码热更新，以及使用最新的缓存特性</p>

<pre><code class="language-javascript">const { merge } = require('webpack-merge')
const path = require('path')
const baseConfig = require('./webpack.base.js')
const ReactRefreshPlugin = require('@pmmmwh/react-refresh-webpack-plugin')
const webpack = require('webpack')

module.exports = merge(baseConfig, {
  mode: 'development',
  devtool: 'eval-cheap-module-source-map',
  devServer: { 
    contentBase: path.resolve(__dirname, 'dist'),
    port: '8090',
    proxy: { 
      '/api': {
        target: 'http://127.0.0.1:3001',
        pathRewrite: {
          '^/api': '
        }
      },
    },
    hot: true,
    open: true,
  },
  // 热更新
  plugins: [
    new ReactRefreshPlugin({
      overlay: false,
    }),
    new webpack.HotModuleReplacementPlugin()
  ],
  // 缓存
  cache: {
    type: 'filesystem',
    buildDependencies: {
      config: [__filename],
    },
  },
})
</code></pre>

<p>最后是生产环境的配置，生产环境的配置主要是对代码进行一个压缩</p>

<pre><code class="language-javascript">const { merge } = require('webpack-merge') 
const OptimizeCSSAssetsPlugin = require(&quot;optimize-css-assets-webpack-plugin&quot;)
const TerserJSPlugin = require(&quot;terser-webpack-plugin&quot;)
const baseConfig = require('./webpack.base.js')

module.exports = merge(baseConfig, {
  mode: &quot;production&quot;,
  optimization: {
    minimizer: [new OptimizeCSSAssetsPlugin({})],
    minimizer: [new TerserJSPlugin({}), new OptimizeCSSAssetsPlugin({})] 
  }
})
</code></pre>

<p>以上就是一个webpack5的基本配置，可以看到除了其内部更新的特性意外，其它的还是可以用原来的loader去配置，主要用到的还是它的缓存的一个功能，当然其它的你也可以按照官方文档进行一个配置</p>

<h3 id="参考链接">参考链接</h3>

<p><a href="https://webpack.docschina.org/" rel="nofollow noreferrer" target="_blank">webpack官方网站</a></p>

<p><a href="https://juejin.cn/post/6983985071699001357" rel="nofollow noreferrer" target="_blank">webpack新特性</a></p>

    </div>

    

  
    <div class="post-tags">
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://xtid.github.io">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://xtid.github.io/2021/%E5%89%8D%E7%AB%AF%E7%9A%84%E6%A8%A1%E5%9D%97%E8%A7%84%E8%8C%83%E7%AE%80%E8%BF%B0%E4%BB%A5%E5%8F%8A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAumd-loader%E6%96%B9%E6%B3%95/" class="prev" rel="prev" title="前端的模块规范简述以及如何实现一个UMD-Loader方法"><i class="iconfont icon-left"></i>&nbsp;前端的模块规范简述以及如何实现一个UMD-Loader方法</a>
         
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2019 - 2021</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  



     </div>
  </body>
</html>
